metric_name,file
org.apache.synapse.Command,"package org.apache.synapse;
public interface Command {
  void execute();
}
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\Command.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.FaultHandler,"/*     */ package org.apache.synapse;
/*     */ 
/*     */ import java.io.PrintWriter;
/*     */ import java.io.StringWriter;
/*     */ import java.io.Writer;
/*     */ import java.util.Stack;
/*     */ import org.apache.commons.logging.Log;
/*     */ import org.apache.commons.logging.LogFactory;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public abstract class FaultHandler
/*     */ {
/*  39 */   private static final Log log = LogFactory.getLog(FaultHandler.class);
/*  40 */   private static final Log trace = LogFactory.getLog(""TRACE_LOGGER"");
/*     */ 
/*     */   
/*     */   public void handleFault(MessageContext synCtx) {
/*  44 */     boolean traceOn = (synCtx.getTracingState() == 1);
/*  45 */     boolean traceOrDebugOn = (traceOn || log.isDebugEnabled());
/*     */     
/*  47 */     if (traceOrDebugOn) {
/*  48 */       traceOrDebugWarn(traceOn, ""FaultHandler executing impl: "" + getClass().getName());
/*     */     }
/*     */     
/*     */     try {
/*  52 */       synCtx.getServiceLog().info(""FaultHandler executing impl: "" + getClass().getName());
/*  53 */       onFault(synCtx);
/*     */     }
/*  55 */     catch (SynapseException e) {
/*     */       
/*  57 */       Stack<FaultHandler> faultStack = synCtx.getFaultStack();
/*  58 */       if (faultStack != null && !faultStack.isEmpty()) {
/*  59 */         ((FaultHandler)faultStack.pop()).handleFault(synCtx);
/*     */       }
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public void handleFault(MessageContext synCtx, Exception e) {
/*  71 */     boolean traceOn = (synCtx.getTracingState() == 1);
/*  72 */     boolean traceOrDebugOn = (traceOn || log.isDebugEnabled());
/*     */     
/*  74 */     synCtx.setProperty(""ERROR_CODE"", ""00000"");
/*     */     
/*  76 */     synCtx.setProperty(""ERROR_MESSAGE"", e.getMessage().split(""\n"")[0]);
/*     */     
/*  78 */     synCtx.setProperty(""ERROR_DETAIL"", getStackTrace(e));
/*  79 */     synCtx.setProperty(""ERROR_EXCEPTION"", e);
/*     */     
/*  81 */     if (traceOrDebugOn) {
/*  82 */       traceOrDebugWarn(traceOn, ""Fault handler - setting ERROR_MESSAGE : "" + synCtx.getProperty(""ERROR_MESSAGE""));
/*     */       
/*  84 */       traceOrDebugWarn(traceOn, ""Fault handler - setting ERROR_DETAIL : "" + synCtx.getProperty(""ERROR_DETAIL""));
/*     */       
/*  86 */       traceOrDebugWarn(traceOn, ""Fault handler - setting ERROR_EXCEPTION : "" + synCtx.getProperty(""ERROR_EXCEPTION""));
/*     */     } 
/*     */ 
/*     */     
/*  90 */     synCtx.getServiceLog().warn(""Fault handler - setting ERROR_MESSAGE : "" + synCtx.getProperty(""ERROR_MESSAGE""));
/*     */ 
/*     */     
/*     */     try {
/*  94 */       onFault(synCtx);
/*     */     }
/*  96 */     catch (SynapseException se) {
/*     */       
/*  98 */       Stack<FaultHandler> faultStack = synCtx.getFaultStack();
/*  99 */       if (faultStack != null && !faultStack.isEmpty()) {
/* 100 */         ((FaultHandler)faultStack.pop()).handleFault(synCtx, se);
/*     */       }
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public abstract void onFault(MessageContext paramMessageContext);
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public static String getStackTrace(Throwable aThrowable) {
/* 118 */     Writer result = new StringWriter();
/* 119 */     PrintWriter printWriter = new PrintWriter(result);
/* 120 */     aThrowable.printStackTrace(printWriter);
/* 121 */     return result.toString();
/*     */   }
/*     */   
/*     */   private void traceOrDebugWarn(boolean traceOn, String msg) {
/* 125 */     if (traceOn) {
/* 126 */       trace.warn(msg);
/*     */     }
/* 128 */     log.warn(msg);
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\FaultHandler.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.ManagedLifecycle,"package org.apache.synapse;
import org.apache.synapse.core.SynapseEnvironment;
public interface ManagedLifecycle {
  void init(SynapseEnvironment paramSynapseEnvironment);
  void destroy();
}
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\ManagedLifecycle.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.Mediator,"package org.apache.synapse;
public interface Mediator {
  boolean mediate(MessageContext paramMessageContext);
  String getType();
  int getTraceState();
  void setTraceState(int paramInt);
}
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\Mediator.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.MessageContext,"package org.apache.synapse;
import java.util.Map;
import java.util.Set;
import java.util.Stack;
import org.apache.axiom.soap.SOAPEnvelope;
import org.apache.axis2.AxisFault;
import org.apache.axis2.addressing.EndpointReference;
import org.apache.axis2.addressing.RelatesTo;
import org.apache.commons.logging.Log;
import org.apache.synapse.config.SynapseConfiguration;
import org.apache.synapse.core.SynapseEnvironment;
import org.apache.synapse.endpoints.Endpoint;
public interface MessageContext {
  SynapseConfiguration getConfiguration();
  void setConfiguration(SynapseConfiguration paramSynapseConfiguration);
  SynapseEnvironment getEnvironment();
  void setEnvironment(SynapseEnvironment paramSynapseEnvironment);
  Map getContextEntries();
  void setContextEntries(Map<String, Object> paramMap);
  Mediator getMainSequence();
  Mediator getFaultSequence();
  Mediator getSequence(String paramString);
  Endpoint getEndpoint(String paramString);
  Object getProperty(String paramString);
  Object getEntry(String paramString);
  void setProperty(String paramString, Object paramObject);
  Set getPropertyKeySet();
  SOAPEnvelope getEnvelope();
  void setEnvelope(SOAPEnvelope paramSOAPEnvelope) throws AxisFault;
  EndpointReference getFaultTo();
  void setFaultTo(EndpointReference paramEndpointReference);
  EndpointReference getFrom();
  void setFrom(EndpointReference paramEndpointReference);
  String getMessageID();
  void setMessageID(String paramString);
  RelatesTo getRelatesTo();
  void setRelatesTo(RelatesTo[] paramArrayOfRelatesTo);
  EndpointReference getReplyTo();
  void setReplyTo(EndpointReference paramEndpointReference);
  EndpointReference getTo();
  void setTo(EndpointReference paramEndpointReference);
  void setWSAAction(String paramString);
  String getWSAAction();
  String getSoapAction();
  void setSoapAction(String paramString);
  void setWSAMessageID(String paramString);
  String getWSAMessageID();
  boolean isDoingMTOM();
  boolean isDoingSWA();
  void setDoingMTOM(boolean paramBoolean);
  void setDoingSWA(boolean paramBoolean);
  boolean isDoingPOX();
  void setDoingPOX(boolean paramBoolean);
  boolean isDoingGET();
  void setDoingGET(boolean paramBoolean);
  boolean isSOAP11();
  void setResponse(boolean paramBoolean);
  boolean isResponse();
  void setFaultResponse(boolean paramBoolean);
  boolean isFaultResponse();
  int getTracingState();
  void setTracingState(int paramInt);
  Stack getFaultStack();
  void pushFaultHandler(FaultHandler paramFaultHandler);
  Log getServiceLog();
}
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\MessageContext.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.ServerManager,"/*     */ package org.apache.synapse;
/*     */ 
/*     */ import java.io.File;
/*     */ import java.net.InetAddress;
/*     */ import java.net.URL;
/*     */ import java.net.URLStreamHandler;
/*     */ import java.net.URLStreamHandlerFactory;
/*     */ import java.net.UnknownHostException;
/*     */ import java.util.Map;
/*     */ import org.apache.axis2.builder.Builder;
/*     */ import org.apache.axis2.context.ConfigurationContext;
/*     */ import org.apache.axis2.context.ConfigurationContextFactory;
/*     */ import org.apache.axis2.description.AxisModule;
/*     */ import org.apache.axis2.description.AxisService;
/*     */ import org.apache.axis2.description.Parameter;
/*     */ import org.apache.axis2.description.TransportInDescription;
/*     */ import org.apache.axis2.engine.AxisConfiguration;
/*     */ import org.apache.axis2.engine.ListenerManager;
/*     */ import org.apache.commons.logging.Log;
/*     */ import org.apache.commons.logging.LogFactory;
/*     */ import org.apache.synapse.config.SynapseConfiguration;
/*     */ import org.apache.synapse.core.SynapseEnvironment;
/*     */ import org.apache.synapse.format.BinaryBuilder;
/*     */ import org.apache.synapse.format.PlainTextBuilder;
/*     */ import org.apache.synapse.util.ClasspathURLStreamHandler;
/*     */ import org.apache.synapse.util.RMIRegistryController;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class ServerManager
/*     */ {
/*  55 */   private static final Log log = LogFactory.getLog(ServerManager.class);
/*     */ 
/*     */   
/*  58 */   private static ServerManager instance = new ServerManager();
/*     */ 
/*     */   
/*     */   private String axis2Repolocation;
/*     */   
/*     */   private String axis2Xml;
/*     */   
/*     */   private String synapseHome;
/*     */   
/*     */   private String synapseXMLPath;
/*     */   
/*     */   private String resolveRoot;
/*     */   
/*  71 */   private String serverName = ""localhost"";
/*     */ 
/*     */   
/*     */   private ListenerManager listenerManager;
/*     */   
/*     */   private ConfigurationContext configctx;
/*     */   
/*  78 */   private SynapseConfiguration synConfig = null;
/*  79 */   private Map callbackStore = null;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  86 */   public static ServerManager getInstance() { return instance; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public void start() {
/*  95 */     validate();
/*     */ 
/*     */     
/*     */     try {
/*  99 */       URL.setURLStreamHandlerFactory(new URLStreamHandlerFactoryImpl());
/* 100 */     } catch (Throwable t) {
/* 101 */       log.debug(""Unable to register a URLStreamHandlerFactory - Custom URL protocols may not work properly (e.g. classpath://)"");
/*     */     } 
/*     */ 
/*     */     
/*     */     try {
/* 106 */       this.configctx = ConfigurationContextFactory.createConfigurationContextFromFileSystem(this.axis2Repolocation, this.axis2Xml);
/*     */ 
/*     */       
/* 109 */       addDefaultBuildersAndFormatters(this.configctx.getAxisConfiguration());
/*     */       
/* 111 */       this.listenerManager = this.configctx.getListenerManager();
/* 112 */       if (this.listenerManager == null) {
/* 113 */         this.listenerManager = new ListenerManager();
/* 114 */         this.listenerManager.init(this.configctx);
/*     */       } 
/*     */       
/* 117 */       for (Object o : this.configctx.getAxisConfiguration().getTransportsIn().keySet()) {
/*     */         
/* 119 */         String trp = (String)o;
/* 120 */         TransportInDescription trsIn = (TransportInDescription)this.configctx.getAxisConfiguration().getTransportsIn().get(trp);
/*     */ 
/*     */         
/* 123 */         String msg = ""Starting transport "" + trsIn.getName();
/* 124 */         if (trsIn.getParameter(""port"") != null) {
/* 125 */           msg = msg + "" on port "" + trsIn.getParameter(""port"").getValue();
/*     */         }
/* 127 */         log.info(msg);
/*     */         
/* 129 */         this.listenerManager.addListener(trsIn, false);
/*     */       } 
/*     */ 
/*     */       
/* 133 */       Parameter synEnv = this.configctx.getAxisConfiguration().getParameter(""synapse.env"");
/*     */       
/* 135 */       Parameter synCfg = this.configctx.getAxisConfiguration().getParameter(""synapse.config"");
/*     */ 
/*     */       
/* 138 */       String message = ""Unable to initialize the Synapse Configuration : Cannot find the "";
/* 139 */       if (synCfg == null || synCfg.getValue() == null || !(synCfg.getValue() instanceof SynapseConfiguration)) {
/*     */         
/* 141 */         log.fatal(message + ""Synapse Configuration"");
/* 142 */         throw new SynapseException(message + ""Synapse Configuration"");
/*     */       } 
/* 144 */       this.synConfig = (SynapseConfiguration)synCfg.getValue();
/*     */ 
/*     */       
/* 147 */       if (synEnv == null || synEnv.getValue() == null || !(synEnv.getValue() instanceof SynapseEnvironment)) {
/*     */         
/* 149 */         log.fatal(message + ""Synapse Environment"");
/* 150 */         throw new SynapseException(message + ""Synapse Environment"");
/*     */       } 
/*     */       
/* 153 */       ((SynapseEnvironment)synEnv.getValue()).setInitialized(true);
/*     */ 
/*     */       
/* 156 */       for (Startup stp : ((SynapseConfiguration)synCfg.getValue()).getStartups()) {
/* 157 */         if (stp != null) {
/* 158 */           stp.init((SynapseEnvironment)synEnv.getValue());
/*     */         }
/*     */       } 
/*     */ 
/*     */       
/* 163 */       log.info(""Ready for processing"");
/*     */     }
/* 165 */     catch (Throwable t) {
/* 166 */       log.fatal(""Synaps startup failed..."", t);
/* 167 */       throw new SynapseException(""Synapse startup failed"", t);
/*     */     } 
/*     */   }
/*     */   
/*     */   private void addDefaultBuildersAndFormatters(AxisConfiguration axisConf) {
/* 172 */     if (axisConf.getMessageBuilder(""text/plain"") == null) {
/* 173 */       axisConf.addMessageBuilder(""text/plain"", (Builder)new PlainTextBuilder());
/*     */     }
/* 175 */     if (axisConf.getMessageBuilder(""application/octet-stream"") == null) {
/* 176 */       axisConf.addMessageBuilder(""application/octet-stream"", (Builder)new BinaryBuilder());
/*     */     }
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public void stop() {
/*     */     try {
/* 185 */       RMIRegistryController.getInstance().removeLocalRegistry();
/*     */ 
/*     */       
/* 188 */       if (this.configctx != null && this.configctx.getAxisConfiguration() != null) {
/* 189 */         Map<String, AxisService> serviceMap = this.configctx.getAxisConfiguration().getServices();
/* 190 */         for (AxisService svc : serviceMap.values()) {
/* 191 */           svc.setActive(false);
/*     */         }
/*     */ 
/*     */         
/* 195 */         Map<String, AxisModule> moduleMap = this.configctx.getAxisConfiguration().getModules();
/* 196 */         for (AxisModule mod : moduleMap.values()) {
/* 197 */           if (mod.getModule() != null && !""synapse"".equals(mod.getName())) {
/* 198 */             mod.getModule().shutdown(this.configctx);
/*     */           }
/*     */         } 
/*     */       } 
/*     */ 
/*     */       
/* 204 */       if (this.listenerManager != null) {
/* 205 */         this.listenerManager.stop();
/* 206 */         this.listenerManager.destroy();
/*     */       } 
/*     */ 
/*     */       
/* 210 */       if (this.configctx != null) {
/* 211 */         this.configctx.terminate();
/*     */       }
/* 213 */     } catch (Exception e) {
/* 214 */       log.error(""Error stopping the ServerManager"", e);
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public int pendingCallbacks() {
/* 223 */     if (this.callbackStore != null) {
/* 224 */       return this.callbackStore.size();
/*     */     }
/* 226 */     return 0;
/*     */   }
/*     */   
/*     */   private static final class URLStreamHandlerFactoryImpl
/*     */     implements URLStreamHandlerFactory {
/*     */     private URLStreamHandlerFactoryImpl() {}
/*     */     
/*     */     public URLStreamHandler createURLStreamHandler(String protocol) {
/* 234 */       if (protocol == null) {
/* 235 */         throw new IllegalArgumentException(""'protocol' cannot be null"");
/*     */       }
/* 237 */       Object object = null;
/* 238 */       if (protocol.equals(""classpath"")) {
/* 239 */         object = new ClasspathURLStreamHandler();
/*     */       }
/* 241 */       return (URLStreamHandler)object;
/*     */     }
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   private void validate() {
/* 249 */     if (this.synapseHome == null || !(new File(this.synapseHome)).exists()) {
/* 250 */       handleFatal(""Synapse home"");
/*     */     } else {
/* 252 */       log.info(""Using Synapse home as : "" + this.synapseHome);
/*     */     } 
/*     */     
/* 255 */     if (this.axis2Repolocation == null || !(new File(this.axis2Repolocation)).exists()) {
/* 256 */       handleFatal(""Axis2 repository"");
/*     */     } else {
/* 258 */       log.info(""Using the Axis2 Repository : "" + (new File(this.axis2Repolocation)).getAbsolutePath());
/*     */     } 
/*     */     
/* 261 */     if (this.axis2Xml == null || !(new File(this.axis2Xml)).exists()) {
/* 262 */       handleFatal(""axis2.xml location"");
/*     */     } else {
/* 264 */       log.info(""Using the axis2.xml : "" + (new File(this.axis2Xml)).getAbsolutePath());
/*     */     } 
/*     */     
/* 267 */     if (this.synapseXMLPath == null || !(new File(this.synapseXMLPath)).exists()) {
/* 268 */       handleFatal(""synapse.xml path"");
/*     */     }
/*     */     
/* 271 */     if (this.serverName == null) {
/*     */       try {
/* 273 */         this.serverName = InetAddress.getLocalHost().getHostName();
/* 274 */       } catch (UnknownHostException ignore) {}
/* 275 */       log.info(""The server name was not specified, defaulting to : "" + this.serverName);
/*     */     } else {
/* 277 */       log.info(""Using server name : "" + this.serverName);
/*     */     } 
/*     */     
/* 280 */     log.info(""The timeout handler will run every : "" + (getTimeoutHandlerInterval() / 1000L) + ""s"");
/*     */   }
/*     */   
/*     */   public void handleFatal(String msgPre) {
/* 284 */     String msg = ""The "" + msgPre + "" must be set as a system property or init-parameter"";
/* 285 */     log.fatal(msg);
/* 286 */     throw new SynapseException(msg);
/*     */   }
/*     */ 
/*     */ 
/*     */   
/* 291 */   public ConfigurationContext getConfigurationContext() { return this.configctx; }
/*     */ 
/*     */ 
/*     */   
/* 295 */   public void setCallbackStore(Map callbackStore) { this.callbackStore = callbackStore; }
/*     */ 
/*     */   
/*     */   public void setAxis2Repolocation(String axis2Repolocation) {
/* 299 */     if (!(new File(axis2Repolocation)).isAbsolute() && this.synapseHome != null) {
/* 300 */       this.axis2Repolocation = this.synapseHome + File.separator + axis2Repolocation;
/*     */     } else {
/* 302 */       this.axis2Repolocation = axis2Repolocation;
/*     */     } 
/*     */   }
/*     */   
/*     */   public void setAxis2Xml(String axis2Xml) {
/* 307 */     if (!(new File(axis2Xml)).isAbsolute() && this.synapseHome != null) {
/* 308 */       this.axis2Xml = this.synapseHome + File.separator + axis2Xml;
/*     */     } else {
/* 310 */       this.axis2Xml = axis2Xml;
/*     */     } 
/*     */   }
/*     */ 
/*     */   
/* 315 */   public String getSynapseHome() { return this.synapseHome; }
/*     */ 
/*     */ 
/*     */   
/* 319 */   public void setSynapseHome(String synapseHome) { this.synapseHome = synapseHome; }
/*     */ 
/*     */ 
/*     */   
/* 323 */   public String getResolveRoot() { return this.resolveRoot; }
/*     */ 
/*     */   
/*     */   public void setResolveRoot(String resolveRoot) {
/* 327 */     if (!(new File(resolveRoot)).isAbsolute() && this.synapseHome != null) {
/* 328 */       this.resolveRoot = this.synapseHome + File.separator + resolveRoot;
/*     */     } else {
/* 330 */       this.resolveRoot = resolveRoot;
/*     */     } 
/*     */   }
/*     */ 
/*     */   
/* 335 */   public String getServerName() { return this.serverName; }
/*     */ 
/*     */ 
/*     */   
/* 339 */   public void setServerName(String serverName) { this.serverName = serverName; }
/*     */ 
/*     */ 
/*     */   
/* 343 */   public String getSynapseXMLPath() { return this.synapseXMLPath; }
/*     */ 
/*     */   
/*     */   public void setSynapseXMLPath(String synapseXMLPath) {
/* 347 */     if (!(new File(synapseXMLPath)).isAbsolute() && this.synapseHome != null) {
/* 348 */       this.synapseXMLPath = this.synapseHome + File.separator + synapseXMLPath;
/*     */     } else {
/* 350 */       this.synapseXMLPath = synapseXMLPath;
/*     */     } 
/*     */   }
/*     */   
/*     */   public int getConnectTimeout() {
/* 355 */     if (this.synConfig == null) {
/* 356 */       return 86400000;
/*     */     }
/* 358 */     return (int)this.synConfig.getProperty(""synapse.connection.connect_timeout"", 20000L);
/*     */   }
/*     */ 
/*     */ 
/*     */   
/*     */   public int getReadTimeout() {
/* 364 */     if (this.synConfig == null) {
/* 365 */       return 100000;
/*     */     }
/* 367 */     return (int)this.synConfig.getProperty(""synapse.connection.read_timeout"", 100000L);
/*     */   }
/*     */ 
/*     */ 
/*     */   
/*     */   public long getTimeoutHandlerInterval() {
/* 373 */     if (this.synConfig == null) {
/* 374 */       return 15000L;
/*     */     }
/* 376 */     return this.synConfig.getProperty(""synapse.timeout_handler_interval"", 15000L);
/*     */   }
/*     */ 
/*     */ 
/*     */   
/*     */   public long getGlobalTimeoutInterval() {
/* 382 */     if (this.synConfig == null) {
/* 383 */       return 86400000L;
/*     */     }
/* 385 */     return this.synConfig.getProperty(""synapse.global_timeout_interval"", 86400000L);
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\ServerManager.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.Startup,"package org.apache.synapse;
import javax.xml.namespace.QName;
public interface Startup extends ManagedLifecycle {
  QName getTagQName();
  String getName();
  void setName(String paramString);
}
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\Startup.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.SynapseConstants,"/*    */ package org.apache.synapse;
/*    */ 
/*    */ import javax.xml.namespace.QName;
/*    */ import org.apache.axiom.om.OMAbstractFactory;
/*    */ import org.apache.axiom.om.OMNamespace;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public final class SynapseConstants
/*    */ {
/*    */   public static final String SYNAPSE_NAMESPACE = ""http://ws.apache.org/ns/synapse"";
/* 35 */   public static final OMNamespace SYNAPSE_OMNAMESPACE = OMAbstractFactory.getOMFactory().createOMNamespace(""http://ws.apache.org/ns/synapse"", ""syn"");
/*    */ 
/*    */   
/*    */   public static final String MAIN_SEQUENCE_KEY = ""main"";
/*    */ 
/*    */   
/*    */   public static final String FAULT_SEQUENCE_KEY = ""fault"";
/*    */ 
/*    */   
/*    */   public static final String MANDATORY_SEQUENCE_KEY = ""pre-mediate"";
/*    */   
/*    */   public static final String SYNAPSE_SERVICE_NAME = ""__SynapseService"";
/*    */   
/* 48 */   public static final QName SYNAPSE_OPERATION_NAME = new QName(""mediate"");
/*    */   public static final String MERCURY_MODULE_NAME = ""Mercury"";
/*    */   public static final String ADDRESSING_MODULE_NAME = ""addressing"";
/*    */   public static final String RAMPART_MODULE_NAME = ""rampart"";
/*    */   public static final String HEADER_TO = ""To"";
/*    */   public static final String HEADER_FROM = ""From"";
/*    */   public static final String HEADER_FAULT = ""FaultTo"";
/*    */   public static final String HEADER_ACTION = ""Action"";
/*    */   public static final String HEADER_REPLY_TO = ""ReplyTo"";
/*    */   public static final String HEADER_RELATES_TO = ""RelatesTo"";
/*    */   public static final String HEADER_MESSAGE_ID = ""MessageID"";
/*    */   public static final String PROPERTY_MESSAGE_FORMAT = ""MESSAGE_FORMAT"";
/*    */   public static final String PROPERTY_OPERATION_NAME = ""OperationName"";
/*    */   public static final String PROPERTY_OPERATION_NAMESPACE = ""OperationNamespace"";
/*    */   public static final String SYSTEM_TIME = ""SYSTEM_TIME"";
/*    */   public static final String SYSTEM_DATE = ""SYSTEM_DATE"";
/*    */   public static final String ADDRESSING_VERSION_FINAL = ""final"";
/*    */   public static final String ADDRESSING_VERSION_SUBMISSION = ""submission"";
/*    */   public static final String RAMPART_POLICY = ""rampartPolicy"";
/*    */   public static final String SANDESHA_POLICY = ""sandeshaPolicy"";
/*    */   public static final String SYNAPSE_CONFIG = ""synapse.config"";
/*    */   public static final String SYNAPSE_ENV = ""synapse.env"";
/*    */   public static final String SYNAPSE_HOME = ""synapse.home"";
/*    */   public static final String SYNAPSE_XML = ""synapse.xml"";
/*    */   public static final String SYNAPSE_PROPERTIES = ""synapse.properties"";
/*    */   public static final String CONF_DIRECTORY = ""conf"";
/*    */   public static final String PROXY_SERVICE = ""proxy.name"";
/*    */   public static final String RESPONSE = ""RESPONSE"";
/*    */   public static final String OUT_ONLY = ""OUT_ONLY"";
/*    */   public static final String ERROR_CODE = ""ERROR_CODE"";
/*    */   public static final String ERROR_MESSAGE = ""ERROR_MESSAGE"";
/*    */   public static final String ERROR_DETAIL = ""ERROR_DETAIL"";
/*    */   public static final String ERROR_EXCEPTION = ""ERROR_EXCEPTION"";
/*    */   public static final String MERCURY_LAST_MESSAGE = ""MercuryLastMessage"";
/*    */   public static final String MERCURY_SEQUENCE_KEY = ""MercurySequenceKey"";
/*    */   public static final String MERCURY_SPEC_VERSION = ""MercuryRMSpecVersion"";
/*    */   public static final String RELATES_TO_FOR_POX = ""synapse.RelatesToForPox"";
/*    */   public static final String ISRESPONSE_PROPERTY = ""synapse.isresponse"";
/*    */   public static final String TRACE_LOGGER = ""TRACE_LOGGER"";
/*    */   public static final String SERVICE_LOGGER_PREFIX = ""SERVICE_LOGGER."";
/*    */   public static final int TRACING_OFF = 0;
/*    */   public static final int TRACING_ON = 1;
/*    */   public static final int TRACING_UNSET = 2;
/*    */   public static final int STATISTICS_OFF = 0;
/*    */   public static final int STATISTICS_ON = 1;
/*    */   public static final int STATISTICS_UNSET = 2;
/*    */   public static final String SEQUENCE_STATS = ""synapse.sequence.stats"";
/*    */   public static final String PROXY_STATS = ""synapse.proxy.stats"";
/*    */   public static final String SERVICE_STATS = ""synapse.service.stats"";
/*    */   public static final String ENDPOINT_STATS = ""synapse.endpoint.stats"";
/*    */   public static final int SEQUENCE_STATISTICS = 0;
/*    */   public static final int PROXYSERVICE_STATISTICS = 1;
/*    */   public static final int ENDPOINT_STATISTICS = 2;
/*    */   public static final String TIMEOUT_HANDLER_INTERVAL = ""synapse.timeout_handler_interval"";
/*    */   public static final long DEFAULT_TIMEOUT_HANDLER_INTERVAL = 15000L;
/*    */   public static final String GLOBAL_TIMEOUT_INTERVAL = ""synapse.global_timeout_interval"";
/*    */   public static final long DEFAULT_GLOBAL_TIMEOUT = 86400000L;
/*    */   public static final int NONE = 100;
/*    */   public static final int DISCARD = 101;
/*    */   public static final int DISCARD_AND_FAULT = 102;
/*    */   public static final String TIME_OUT = ""504"";
/*    */   public static final String SENDING_FAULT = ""503"";
/*    */   public static final String PROCESSED_ENDPOINT = ""processed_endpoint"";
/*    */   public static final String ANONYMOUS_ENDPOINT = ""AnonymousEndpoint"";
/*    */   public static final String ANONYMOUS_SEQUENCE = ""AnonymousSequence"";
/*    */   public static final String FORMAT_POX = ""pox"";
/*    */   public static final String FORMAT_GET = ""get"";
/*    */   public static final String FORMAT_SOAP11 = ""soap11"";
/*    */   public static final String FORMAT_SOAP12 = ""soap12"";
/*    */   public static final String SERVER_NAME = ""serverName"";
/*    */   public static final String SYNAPSE_DATASOURCES = ""synapse.datasources"";
/*    */   public static final String RESOLVE_ROOT = ""resolve.root"";
/*    */   public static final int DEFAULT_READTIMEOUT = 100000;
/*    */   public static final int DEFAULT_CONNECTTIMEOUT = 20000;
/*    */   public static final String READTIMEOUT = ""synapse.connection.read_timeout"";
/*    */   public static final String CONNECTTIMEOUT = ""synapse.connection.connect_timeout"";
/*    */   public static final int DEFAULT_THRESHOLD_CHUNKS = 8;
/*    */   public static final int DEFAULT_CHUNK_SIZE = 1024;
/*    */   public static final String DEFAULT_TEMPFILE_PREFIX = ""tmp_"";
/*    */   public static final String DEFAULT_TEMPFILE_SUFIX = "".dat"";
/*    */   public static final String THRESHOLD_CHUNKS = ""synapse.temp_data.chunk.threshold"";
/*    */   public static final String CHUNK_SIZE = ""synapse.temp_data.chunk.size"";
/*    */   public static final String TEMP_FILE_PREFIX = ""synapse.tempfile.prefix"";
/*    */   public static final String TEMP_FILE_SUFIX = ""synapse.tempfile.sufix"";
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\SynapseConstants.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.SynapseException,"/*    */ package org.apache.synapse;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class SynapseException
/*    */   extends RuntimeException
/*    */ {
/*    */   private static final long serialVersionUID = -7244032125641596311L;
/*    */   
/* 30 */   public SynapseException(String string) { super(string); }
/*    */ 
/*    */ 
/*    */   
/* 34 */   public SynapseException(String msg, Throwable e) { super(msg, e); }
/*    */ 
/*    */ 
/*    */   
/* 38 */   public SynapseException(Throwable t) { super(t); }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\SynapseException.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.SynapseServer,"/*    */ package org.apache.synapse;
/*    */ 
/*    */ import java.io.File;
/*    */ import org.apache.commons.logging.Log;
/*    */ import org.apache.commons.logging.LogFactory;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class SynapseServer
/*    */ {
/* 37 */   private static final Log log = LogFactory.getLog(SynapseServer.class);
/*    */ 
/*    */   
/*    */   private static final String USAGE_TXT = ""Usage: SynapseServer <axis2_repository> <axis2_xml> <synapse_home> <synapse_xml> <resolve_root>\n Opts: -? this message"";
/*    */ 
/*    */   
/*    */   public static void printUsage() {
/* 44 */     System.out.println(""Usage: SynapseServer <axis2_repository> <axis2_xml> <synapse_home> <synapse_xml> <resolve_root>\n Opts: -? this message"");
/* 45 */     System.exit(1);
/*    */   }
/*    */ 
/*    */ 
/*    */   
/*    */   public static void main(String[] args) throws Exception {
/* 51 */     if (args.length != 1 && args.length != 4 && args.length != 5 && args.length != 6) {
/* 52 */       printUsage();
/*    */     }
/*    */     
/* 55 */     ServerManager serverManager = ServerManager.getInstance();
/* 56 */     serverManager.setAxis2Repolocation(args[0]);
/* 57 */     if (args.length == 1) {
/* 58 */       log.warn(""Configuring server manager using deprecated system properties; please update your configuration"");
/* 59 */       serverManager.setAxis2Xml(System.getProperty(""axis2.xml""));
/* 60 */       serverManager.setSynapseHome(System.getProperty(""synapse.home""));
/* 61 */       serverManager.setSynapseXMLPath(System.getProperty(""synapse.xml""));
/* 62 */       serverManager.setResolveRoot(System.getProperty(""resolve.root""));
/* 63 */     } else if (args.length == 4) {
/* 64 */       serverManager.setAxis2Xml(args[1]);
/* 65 */       serverManager.setSynapseHome(args[2]);
/* 66 */       serverManager.setSynapseXMLPath(args[3]);
/* 67 */       serverManager.setResolveRoot(args[2] + File.separator + ""repository"");
/* 68 */     } else if (args.length == 5) {
/* 69 */       serverManager.setAxis2Xml(args[1]);
/* 70 */       serverManager.setSynapseHome(args[2]);
/* 71 */       serverManager.setSynapseXMLPath(args[3]);
/* 72 */       serverManager.setResolveRoot(args[4]);
/* 73 */     } else if (args.length == 6) {
/* 74 */       serverManager.setAxis2Xml(args[1]);
/* 75 */       serverManager.setSynapseHome(args[2]);
/* 76 */       serverManager.setSynapseXMLPath(args[3]);
/* 77 */       serverManager.setResolveRoot(args[4]);
/* 78 */       serverManager.setServerName(args[5]);
/*    */     } 
/*    */     
/* 81 */     serverManager.start();
/* 82 */     addShutdownHook();
/*    */   }
/*    */   
/*    */   private static void addShutdownHook() {
/* 86 */     Thread shutdownHook = new Thread() {
/*    */         public void run() {
/* 88 */           log.info(""Shutting down Apache Synapse ..."");
/*    */           try {
/* 90 */             ServerManager.getInstance().stop();
/* 91 */             log.info(""Shutdown complete"");
/* 92 */             log.info(""Halting JVM"");
/* 93 */           } catch (Exception e) {
/* 94 */             log.warn(""Error occurred while shutting down Apache Synapse : "" + e);
/*    */           } 
/*    */         }
/*    */       };
/* 98 */     Runtime.getRuntime().addShutdownHook(shutdownHook);
/*    */   }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\SynapseServer.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.Entry,"/*     */ package org.apache.synapse.config;
/*     */ 
/*     */ import java.net.URL;
/*     */ import org.apache.commons.logging.Log;
/*     */ import org.apache.commons.logging.LogFactory;
/*     */ import org.apache.synapse.SynapseException;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class Entry
/*     */ {
/*  35 */   private static final Log log = LogFactory.getLog(Entry.class);
/*     */   
/*     */   private String key;
/*     */   
/*     */   private int type;
/*     */   
/*     */   private URL src;
/*     */   
/*     */   private Object value;
/*     */   
/*     */   private XMLToObjectMapper mapper;
/*     */   private long version;
/*     */   private long expiryTime;
/*     */   public static final int INLINE_TEXT = 0;
/*     */   public static final int INLINE_XML = 1;
/*     */   public static final int URL_SRC = 2;
/*     */   public static final int REMOTE_ENTRY = 3;
/*     */   
/*     */   public Entry() {}
/*     */   
/*  55 */   public Entry(String key) { this.key = key; }
/*     */ 
/*     */ 
/*     */   
/*  59 */   public int getType() { return this.type; }
/*     */ 
/*     */ 
/*     */   
/*  63 */   public boolean isRemote() { return (this.type == 3); }
/*     */ 
/*     */ 
/*     */   
/*  67 */   public boolean isURLSource() { return (this.type == 2); }
/*     */ 
/*     */ 
/*     */   
/*  71 */   public boolean isInlineXML() { return (this.type == 1); }
/*     */ 
/*     */ 
/*     */   
/*  75 */   public boolean isInlineText() { return (this.type == 0); }
/*     */ 
/*     */   
/*     */   public void setType(int type) {
/*  79 */     if (type <= 4 && type >= 0) {
/*  80 */       this.type = type;
/*     */     } else {
/*  82 */       handleException(""Invalid entry type for the static entry"");
/*     */     } 
/*     */   }
/*     */ 
/*     */   
/*  87 */   public URL getSrc() { return this.src; }
/*     */ 
/*     */ 
/*     */   
/*  91 */   public void setSrc(URL src) { this.src = src; }
/*     */ 
/*     */ 
/*     */   
/*  95 */   public String getKey() { return this.key; }
/*     */ 
/*     */ 
/*     */   
/*  99 */   public void setKey(String key) { this.key = key; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 108 */   public Object getValue() { return this.value; }
/*     */ 
/*     */ 
/*     */   
/* 112 */   public void setValue(Object value) { this.value = value; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 120 */   public XMLToObjectMapper getMapper() { return this.mapper; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 128 */   public void setMapper(XMLToObjectMapper mapper) { this.mapper = mapper; }
/*     */ 
/*     */ 
/*     */   
/* 132 */   public long getVersion() { return this.version; }
/*     */ 
/*     */ 
/*     */   
/* 136 */   public void setVersion(long version) { this.version = version; }
/*     */ 
/*     */ 
/*     */   
/* 140 */   public long getExpiryTime() { return this.expiryTime; }
/*     */ 
/*     */ 
/*     */   
/* 144 */   public void setExpiryTime(long expiryTime) { this.expiryTime = expiryTime; }
/*     */ 
/*     */   
/*     */   public boolean isExpired() {
/* 148 */     if (getType() == 3 && getExpiryTime() > 0L) {
/* 149 */       return (System.currentTimeMillis() > this.expiryTime);
/*     */     }
/* 151 */     return false;
/*     */   }
/*     */ 
/*     */ 
/*     */   
/* 156 */   public boolean isCached() { return (this.value != null); }
/*     */ 
/*     */   
/*     */   public void clearCache() {
/* 160 */     if (isDynamic()) {
/* 161 */       this.value = null;
/* 162 */       this.expiryTime = System.currentTimeMillis();
/*     */     } 
/*     */   }
/*     */ 
/*     */   
/* 167 */   public boolean isDynamic() { return (this.type == 3); }
/*     */ 
/*     */   
/*     */   private void handleException(String msg) {
/* 171 */     log.error(msg);
/* 172 */     throw new SynapseException(msg);
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\Entry.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.SynapseConfiguration,"/*     */ package org.apache.synapse.config;
/*     */ 
/*     */ import java.io.IOException;
/*     */ import java.util.Collection;
/*     */ import java.util.Collections;
/*     */ import java.util.HashMap;
/*     */ import java.util.Map;
/*     */ import java.util.Properties;
/*     */ import java.util.Timer;
/*     */ import javax.xml.namespace.QName;
/*     */ import org.apache.axis2.AxisFault;
/*     */ import org.apache.axis2.engine.AxisConfiguration;
/*     */ import org.apache.commons.logging.Log;
/*     */ import org.apache.commons.logging.LogFactory;
/*     */ import org.apache.synapse.ManagedLifecycle;
/*     */ import org.apache.synapse.Mediator;
/*     */ import org.apache.synapse.Startup;
/*     */ import org.apache.synapse.SynapseException;
/*     */ import org.apache.synapse.config.xml.MediatorFactoryFinder;
/*     */ import org.apache.synapse.config.xml.endpoints.XMLToEndpointMapper;
/*     */ import org.apache.synapse.core.SynapseEnvironment;
/*     */ import org.apache.synapse.core.axis2.ProxyService;
/*     */ import org.apache.synapse.endpoints.Endpoint;
/*     */ import org.apache.synapse.mediators.base.SequenceMediator;
/*     */ import org.apache.synapse.registry.Registry;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class SynapseConfiguration
/*     */   implements ManagedLifecycle
/*     */ {
/*  45 */   private static final Log log = LogFactory.getLog(SynapseConfiguration.class);
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  51 */   Registry registry = null;
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  56 */   private QName defaultQName = null;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  63 */   private Mediator mandatorySequence = null;
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  68 */   private Map<String, ProxyService> proxyServices = new HashMap<String, ProxyService>();
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  73 */   private Map<String, Startup> startups = new HashMap<String, Startup>();
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  80 */   private Map<String, Object> localRegistry = new HashMap<String, Object>();
/*     */ 
/*     */   
/*  83 */   private Properties properties = new Properties();
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  88 */   private Timer synapseTimer = new Timer(true);
/*     */ 
/*     */   
/*  91 */   private AxisConfiguration axisConfiguration = null;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  97 */   private String pathToConfigFile = null;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 108 */   public void addSequence(String key, Mediator mediator) { this.localRegistry.put(key, mediator); }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 122 */   public void addSequence(String key, Entry entry) { this.localRegistry.put(key, entry); }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public Map<String, SequenceMediator> getDefinedSequences() {
/* 133 */     Map<String, SequenceMediator> definedSequences = new HashMap<String, SequenceMediator>();
/*     */     
/* 135 */     for (Object o : this.localRegistry.values()) {
/*     */       
/* 137 */       if (o instanceof SequenceMediator) {
/* 138 */         SequenceMediator seq = (SequenceMediator)o;
/* 139 */         definedSequences.put(seq.getName(), seq);
/*     */       } 
/*     */     } 
/* 142 */     return definedSequences;
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 153 */   public Mediator getMandatorySequence() { return this.mandatorySequence; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 162 */   public void setMandatorySequence(Mediator mandatorySequence) { this.mandatorySequence = mandatorySequence; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public Mediator getSequence(String key) {
/*     */     Entry entry;
/* 173 */     Object o = this.localRegistry.get(key);
/* 174 */     if (o != null && o instanceof Mediator) {
/* 175 */       return (Mediator)o;
/*     */     }
/*     */ 
/*     */     
/* 179 */     if (o != null && o instanceof Entry) {
/* 180 */       entry = (Entry)o;
/*     */     } else {
/* 182 */       entry = new Entry(key);
/* 183 */       entry.setType(3);
/* 184 */       entry.setMapper((XMLToObjectMapper)MediatorFactoryFinder.getInstance());
/*     */     } 
/*     */     
/* 187 */     if (this.registry != null) {
/* 188 */       o = this.registry.getResource(entry);
/* 189 */       if (o != null && o instanceof Mediator) {
/* 190 */         this.localRegistry.put(key, entry);
/* 191 */         return (Mediator)o;
/*     */       } 
/*     */     } 
/*     */     
/* 195 */     return null;
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 205 */   public void removeSequence(String key) { this.localRegistry.remove(key); }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 215 */   public Mediator getMainSequence() { return getSequence(""main""); }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 225 */   public Mediator getFaultSequence() { return getSequence(""fault""); }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public void addEntry(String key, Entry entry) {
/* 243 */     if (entry.getType() == 2 && entry.getValue() == null) {
/*     */       try {
/* 245 */         entry.setValue(SynapseConfigUtils.getOMElementFromURL(entry.getSrc().toString()));
/*     */         
/* 247 */         this.localRegistry.put(key, entry);
/* 248 */       } catch (IOException e) {
/* 249 */         handleException(""Can not read from source URL : "" + entry.getSrc());
/*     */       } 
/*     */     } else {
/*     */       
/* 253 */       this.localRegistry.put(key, entry);
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public Map<String, Entry> getCachedEntries() {
/* 265 */     Map<String, Entry> cachedEntries = new HashMap<String, Entry>();
/* 266 */     for (Object o : this.localRegistry.values()) {
/*     */       
/* 268 */       if (o != null && o instanceof Entry) {
/* 269 */         Entry entry = (Entry)o;
/* 270 */         if (entry.isDynamic() && entry.isCached()) {
/* 271 */           cachedEntries.put(entry.getKey(), entry);
/*     */         }
/*     */       } 
/*     */     } 
/*     */     
/* 276 */     return cachedEntries;
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public Map<String, Entry> getDefinedEntries() {
/* 287 */     Map<String, Entry> definedEntries = new HashMap<String, Entry>();
/* 288 */     for (Object o : this.localRegistry.values()) {
/*     */       
/* 290 */       if (o instanceof Entry && ((Entry)o).getType() != 3) {
/*     */ 
/*     */         
/* 293 */         Entry entry = (Entry)o;
/* 294 */         definedEntries.put(entry.getKey(), entry);
/*     */       } 
/*     */     } 
/* 297 */     return definedEntries;
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public Object getEntry(String key) {
/* 308 */     Object o = this.localRegistry.get(key);
/* 309 */     if (o != null && o instanceof Entry) {
/* 310 */       Entry entry = (Entry)o;
/* 311 */       if (entry.isDynamic()) {
/* 312 */         if (entry.isCached() && !entry.isExpired())
/* 313 */           return entry.getValue(); 
/* 314 */         if (this.registry != null) {
/* 315 */           o = this.registry.getResource(entry);
/*     */         } else {
/* 317 */           if (log.isDebugEnabled()) {
/* 318 */             log.debug(""Will not  evaluate the value of the remote entry with a key "" + key + "",  because the registry is not available"");
/*     */           }
/*     */           
/* 321 */           return null;
/*     */         } 
/*     */       } else {
/*     */         
/* 325 */         return entry.getValue();
/*     */       } 
/*     */     } 
/* 328 */     return o;
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public Entry getEntryDefinition(String key) {
/* 339 */     Object o = this.localRegistry.get(key);
/* 340 */     if (o == null || o instanceof Entry) {
/* 341 */       if (o == null) {
/*     */         
/* 343 */         Entry entry = new Entry(key);
/* 344 */         entry.setType(3);
/* 345 */         addEntry(key, entry);
/* 346 */         return entry;
/*     */       } 
/* 348 */       return (Entry)o;
/*     */     } 
/* 350 */     handleException(""Invalid local registry entry : "" + key);
/* 351 */     return null;
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 362 */   public void removeEntry(String key) { this.localRegistry.remove(key); }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public void clearCachedEntry(String key) {
/* 371 */     Entry entry = getEntryDefinition(key);
/* 372 */     if (entry.isDynamic() && entry.isCached()) {
/* 373 */       entry.clearCache();
/*     */     }
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public void clearCache() {
/* 383 */     for (Object o : this.localRegistry.values()) {
/*     */       
/* 385 */       if (o != null && o instanceof Entry) {
/* 386 */         Entry entry = (Entry)o;
/* 387 */         if (entry.isDynamic() && entry.isCached()) {
/* 388 */           entry.clearCache();
/*     */         }
/*     */       } 
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 403 */   public void addEndpoint(String key, Endpoint endpoint) { this.localRegistry.put(key, endpoint); }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 415 */   public void addEndpoint(String key, Entry entry) { this.localRegistry.put(key, entry); }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public Map<String, Endpoint> getDefinedEndpoints() {
/* 426 */     Map<String, Endpoint> definedEndpoints = new HashMap<String, Endpoint>();
/* 427 */     for (Object o : this.localRegistry.values()) {
/*     */       
/* 429 */       if (o instanceof Endpoint) {
/* 430 */         Endpoint ep = (Endpoint)o;
/* 431 */         definedEndpoints.put(ep.getName(), ep);
/*     */       } 
/*     */     } 
/*     */     
/* 435 */     return definedEndpoints;
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public Endpoint getEndpoint(String key) {
/*     */     Entry entry;
/* 447 */     Object o = this.localRegistry.get(key);
/* 448 */     if (o != null && o instanceof Endpoint) {
/* 449 */       return (Endpoint)o;
/*     */     }
/*     */ 
/*     */     
/* 453 */     if (o != null && o instanceof Entry) {
/* 454 */       entry = (Entry)o;
/*     */     } else {
/* 456 */       entry = new Entry(key);
/* 457 */       entry.setType(3);
/* 458 */       entry.setMapper((XMLToObjectMapper)XMLToEndpointMapper.getInstance());
/*     */     } 
/*     */     
/* 461 */     if (this.registry != null) {
/* 462 */       o = this.registry.getResource(entry);
/* 463 */       if (o != null && o instanceof Endpoint) {
/* 464 */         this.localRegistry.put(key, entry);
/* 465 */         return (Endpoint)o;
/*     */       } 
/*     */     } 
/*     */     
/* 469 */     return null;
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 479 */   public void removeEndpoint(String key) { this.localRegistry.remove(key); }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 491 */   public void addProxyService(String name, ProxyService proxy) { this.proxyServices.put(name, proxy); }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 502 */   public ProxyService getProxyService(String name) { return this.proxyServices.get(name); }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public void removeProxyService(String name) {
/* 512 */     Object o = this.proxyServices.get(name);
/* 513 */     if (o == null) {
/* 514 */       handleException(""Unknown proxy service for name : "" + name);
/*     */     } else {
/*     */       try {
/* 517 */         if (getAxisConfiguration().getServiceForActivation(name) != null) {
/* 518 */           if (getAxisConfiguration().getServiceForActivation(name).isActive())
/*     */           {
/* 520 */             getAxisConfiguration().getService(name).setActive(false);
/*     */           }
/*     */           
/* 523 */           getAxisConfiguration().removeService(name);
/*     */         } 
/* 525 */         this.proxyServices.remove(name);
/* 526 */       } catch (AxisFault axisFault) {
/* 527 */         handleException(axisFault.getMessage());
/*     */       } 
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 538 */   public Collection<ProxyService> getProxyServices() { return this.proxyServices.values(); }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 547 */   public Map getLocalRegistry() { return Collections.unmodifiableMap(this.localRegistry); }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 556 */   public Registry getRegistry() { return this.registry; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 566 */   public void setRegistry(Registry registry) { this.registry = registry; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 575 */   public void setAxisConfiguration(AxisConfiguration axisConfig) { this.axisConfiguration = axisConfig; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 584 */   public AxisConfiguration getAxisConfiguration() { return this.axisConfiguration; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 593 */   public String getPathToConfigFile() { return this.pathToConfigFile; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 603 */   public void setPathToConfigFile(String pathToConfigFile) { this.pathToConfigFile = pathToConfigFile; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 613 */   public void setDefaultQName(QName defaultQName) { this.defaultQName = defaultQName; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 622 */   public QName getDefaultQName() { return this.defaultQName; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 631 */   public Timer getSynapseTimer() { return this.synapseTimer; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 640 */   public Collection<Startup> getStartups() { return this.startups.values(); }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 650 */   public Startup getStartup(String id) { return this.startups.get(id); }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 659 */   public void addStartup(Startup startup) { this.startups.put(startup.getName(), startup); }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 668 */   public void removeStartup(String name) { this.startups.remove(name); }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 677 */   public Properties getProperties() { return this.properties; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 686 */   public void setProperties(Properties properties) { this.properties = properties; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public String getProperty(String propKey, String def) {
/* 698 */     String val = System.getProperty(propKey);
/* 699 */     if (val == null) {
/* 700 */       val = this.properties.getProperty(propKey);
/*     */     }
/*     */     
/* 703 */     if (val != null) {
/* 704 */       if (log.isDebugEnabled()) {
/* 705 */         log.debug(""Using synapse tuning parameter : "" + propKey + "" = "" + val);
/*     */       }
/* 707 */       return val;
/*     */     } 
/* 709 */     return def;
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public long getProperty(String propKey, long def) {
/* 721 */     String val = System.getProperty(propKey);
/* 722 */     if (val == null) {
/* 723 */       val = this.properties.getProperty(propKey);
/*     */     }
/*     */     
/* 726 */     if (val != null) {
/* 727 */       if (log.isDebugEnabled()) {
/* 728 */         log.debug(""Using synapse tuning parameter : "" + propKey + "" = "" + val);
/*     */       }
/* 730 */       return Long.valueOf(val).longValue();
/*     */     } 
/* 732 */     return def;
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public String getProperty(String propKey) {
/* 742 */     String val = System.getProperty(propKey);
/* 743 */     if (val == null) {
/* 744 */       val = this.properties.getProperty(propKey);
/*     */     }
/*     */     
/* 747 */     if (val != null) {
/* 748 */       if (log.isDebugEnabled()) {
/* 749 */         log.debug(""Using synapse tuning parameter : "" + propKey + "" = "" + val);
/*     */       }
/* 751 */       return val;
/*     */     } 
/* 753 */     return null;
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public void destroy() {
/* 762 */     if (log.isDebugEnabled()) {
/* 763 */       log.debug(""Destroying the Synapse Configuration"");
/*     */     }
/*     */ 
/*     */     
/* 767 */     this.synapseTimer.cancel();
/* 768 */     this.synapseTimer = null;
/*     */ 
/*     */     
/* 771 */     for (ProxyService p : getProxyServices()) {
/*     */       
/* 773 */       if (p.getTargetInLineInSequence() != null) {
/* 774 */         p.getTargetInLineInSequence().destroy();
/*     */       }
/*     */       
/* 777 */       if (p.getTargetInLineOutSequence() != null) {
/* 778 */         p.getTargetInLineOutSequence().destroy();
/*     */       }
/*     */     } 
/*     */ 
/*     */     
/* 783 */     for (SequenceMediator seq : getDefinedSequences().values()) {
/* 784 */       if (seq != null) {
/* 785 */         seq.destroy();
/*     */       }
/*     */     } 
/*     */ 
/*     */     
/* 790 */     if (this.startups != null)
/*     */     {
/* 792 */       for (Startup stp : this.startups.values()) {
/* 793 */         if (stp != null) {
/* 794 */           stp.destroy();
/*     */         }
/*     */       } 
/*     */     }
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public void init(SynapseEnvironment se) {
/* 809 */     if (log.isDebugEnabled()) {
/* 810 */       log.debug(""Initializing the Synapse Configuration"");
/*     */     }
/*     */ 
/*     */     
/* 814 */     if (this.registry != null && this.registry instanceof ManagedLifecycle) {
/* 815 */       ((ManagedLifecycle)this.registry).init(se);
/*     */     }
/*     */ 
/*     */     
/* 819 */     for (ProxyService p : getProxyServices()) {
/*     */       
/* 821 */       if (p.getTargetInLineInSequence() != null) {
/* 822 */         p.getTargetInLineInSequence().init(se);
/*     */       }
/*     */       
/* 825 */       if (p.getTargetInLineOutSequence() != null) {
/* 826 */         p.getTargetInLineOutSequence().init(se);
/*     */       }
/*     */     } 
/*     */ 
/*     */     
/* 831 */     for (SequenceMediator seq : getDefinedSequences().values()) {
/* 832 */       if (seq != null) {
/* 833 */         seq.init(se);
/*     */       }
/*     */     } 
/*     */   }
/*     */   
/*     */   private void handleException(String msg) {
/* 839 */     log.error(msg);
/* 840 */     throw new SynapseException(msg);
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\SynapseConfiguration.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.SynapseConfigurationBuilder,"/*     */ package org.apache.synapse.config;
/*     */ 
/*     */ import java.io.File;
/*     */ import java.io.FileInputStream;
/*     */ import java.io.FileNotFoundException;
/*     */ import java.io.InputStream;
/*     */ import java.util.Properties;
/*     */ import org.apache.commons.logging.Log;
/*     */ import org.apache.commons.logging.LogFactory;
/*     */ import org.apache.synapse.Mediator;
/*     */ import org.apache.synapse.SynapseException;
/*     */ import org.apache.synapse.config.xml.XMLConfigurationBuilder;
/*     */ import org.apache.synapse.mediators.base.SequenceMediator;
/*     */ import org.apache.synapse.mediators.builtin.DropMediator;
/*     */ import org.apache.synapse.mediators.builtin.LogMediator;
/*     */ import org.apache.synapse.util.DataSourceRegistrar;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class SynapseConfigurationBuilder
/*     */ {
/*  44 */   private static Log log = LogFactory.getLog(SynapseConfigurationBuilder.class);
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public static SynapseConfiguration getDefaultConfiguration() {
/*  52 */     SynapseConfiguration config = new SynapseConfiguration();
/*  53 */     SequenceMediator mainmediator = new SequenceMediator();
/*  54 */     mainmediator.addChild((Mediator)new LogMediator());
/*  55 */     mainmediator.addChild((Mediator)new DropMediator());
/*  56 */     config.addSequence(""main"", (Mediator)mainmediator);
/*  57 */     SequenceMediator faultmediator = new SequenceMediator();
/*  58 */     LogMediator fault = new LogMediator();
/*  59 */     fault.setLogLevel(3);
/*  60 */     faultmediator.addChild((Mediator)fault);
/*  61 */     config.addSequence(""fault"", (Mediator)faultmediator);
/*  62 */     return config;
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public static SynapseConfiguration getConfiguration(String configFile) {
/*     */     try {
/*  75 */       Properties synapseProperties = loadSynapseProperties();
/*  76 */       DataSourceRegistrar.registerDataSources(synapseProperties);
/*  77 */       SynapseConfiguration synCfg = XMLConfigurationBuilder.getConfiguration(new FileInputStream(configFile));
/*     */       
/*  79 */       log.info(""Loaded Synapse configuration from : "" + configFile);
/*  80 */       synCfg.setPathToConfigFile((new File(configFile)).getAbsolutePath());
/*  81 */       synCfg.setProperties(synapseProperties);
/*  82 */       return synCfg;
/*     */     }
/*  84 */     catch (FileNotFoundException fnf) {
/*  85 */       handleException(""Cannot load Synapse configuration from : "" + configFile, fnf);
/*  86 */     } catch (Exception e) {
/*  87 */       handleException(""Could not initialize Synapse : "" + e.getMessage(), e);
/*     */     } 
/*  89 */     return null;
/*     */   }
/*     */ 
/*     */   
/*     */   private static Properties loadSynapseProperties() {
/*     */     try {
/*  95 */       Properties properties = new Properties();
/*  96 */       ClassLoader cl = Thread.currentThread().getContextClassLoader();
/*     */       
/*  98 */       if (log.isDebugEnabled()) {
/*  99 */         log.debug(""synapse.properties file is loading from classpath"");
/*     */       }
/*     */       
/* 102 */       InputStream in = cl.getResourceAsStream(""synapse.properties"");
/* 103 */       if (in == null) {
/* 104 */         if (log.isDebugEnabled()) {
/* 105 */           log.debug(""Unable to load synapse.propeties file"");
/*     */         }
/*     */         
/* 108 */         String path = ""conf"" + File.separatorChar + ""synapse.properties"";
/*     */         
/* 110 */         if (log.isDebugEnabled()) {
/* 111 */           log.debug(""synapse.properties file is loading from classpath with resource path '"" + path + "" '"");
/*     */         }
/*     */ 
/*     */         
/* 115 */         in = cl.getResourceAsStream(path);
/* 116 */         if (in == null && 
/* 117 */           log.isDebugEnabled()) {
/* 118 */           log.debug(""Unable to load the synapse.properties file from classpath with resource name '"" + path + "" '"");
/*     */         }
/*     */       } 
/*     */ 
/*     */ 
/*     */       
/* 124 */       if (in != null) {
/* 125 */         properties.load(in);
/*     */       }
/*     */       
/* 128 */       return properties;
/*     */     }
/* 130 */     catch (Exception e) {
/* 131 */       log.info(""Using the default tuning parameters for Synapse"");
/*     */       
/* 133 */       return new Properties();
/*     */     } 
/*     */   }
/*     */   private static void handleException(String msg, Exception e) {
/* 137 */     log.error(msg, e);
/* 138 */     throw new SynapseException(msg, e);
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\SynapseConfigurationBuilder.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.SynapseConfigUtils,"/*     */ package org.apache.synapse.config;
/*     */ 
/*     */ import java.io.BufferedInputStream;
/*     */ import java.io.ByteArrayInputStream;
/*     */ import java.io.ByteArrayOutputStream;
/*     */ import java.io.IOException;
/*     */ import java.io.InputStream;
/*     */ import java.net.MalformedURLException;
/*     */ import java.net.URI;
/*     */ import java.net.URISyntaxException;
/*     */ import java.net.URL;
/*     */ import java.net.URLConnection;
/*     */ import javax.activation.DataHandler;
/*     */ import javax.activation.DataSource;
/*     */ import javax.xml.stream.XMLInputFactory;
/*     */ import javax.xml.stream.XMLStreamException;
/*     */ import javax.xml.stream.XMLStreamReader;
/*     */ import javax.xml.transform.stream.StreamSource;
/*     */ import org.apache.axiom.om.OMAbstractFactory;
/*     */ import org.apache.axiom.om.OMElement;
/*     */ import org.apache.axiom.om.OMException;
/*     */ import org.apache.axiom.om.OMFactory;
/*     */ import org.apache.axiom.om.OMNode;
/*     */ import org.apache.axiom.om.OMText;
/*     */ import org.apache.axiom.om.impl.builder.StAXOMBuilder;
/*     */ import org.apache.commons.logging.Log;
/*     */ import org.apache.commons.logging.LogFactory;
/*     */ import org.apache.synapse.ServerManager;
/*     */ import org.apache.synapse.SynapseException;
/*     */ import org.apache.synapse.util.SynapseBinaryDataSource;
/*     */ import org.xml.sax.InputSource;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class SynapseConfigUtils
/*     */ {
/*  42 */   private static final Log log = LogFactory.getLog(SynapseConfigUtils.class);
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public static StreamSource getStreamSource(Object o) {
/*  52 */     if (o == null) {
/*  53 */       handleException(""Cannot convert null to a StreamSource"");
/*     */     }
/*  55 */     else if (o instanceof OMElement) {
/*  56 */       OMElement omElement = (OMElement)o;
/*  57 */       ByteArrayOutputStream baos = new ByteArrayOutputStream();
/*     */       try {
/*  59 */         omElement.serialize(baos);
/*  60 */         return new StreamSource(new ByteArrayInputStream(baos.toByteArray()));
/*  61 */       } catch (XMLStreamException e) {
/*  62 */         handleException(""Error converting to a StreamSource"", e);
/*     */       }
/*     */     
/*  65 */     } else if (o instanceof OMText) {
/*  66 */       DataHandler dataHandler = (DataHandler)((OMText)o).getDataHandler();
/*  67 */       if (dataHandler != null) {
/*     */         try {
/*  69 */           return new StreamSource(dataHandler.getInputStream());
/*  70 */         } catch (IOException e) {
/*  71 */           handleException(""Error in reading content as a stream "");
/*     */         } 
/*     */       }
/*     */     } else {
/*     */       
/*  76 */       handleException(""Cannot convert object to a StreamSource"");
/*     */     } 
/*  78 */     return null;
/*     */   }
/*     */ 
/*     */   
/*     */   public static InputStream getInputStream(Object o) {
/*  83 */     if (o == null) {
/*  84 */       handleException(""Cannot convert null to a StreamSource"");
/*     */     }
/*  86 */     else if (o instanceof OMElement) {
/*  87 */       OMElement omElement = (OMElement)o;
/*  88 */       ByteArrayOutputStream baos = new ByteArrayOutputStream();
/*     */       try {
/*  90 */         omElement.serialize(baos);
/*  91 */         return new ByteArrayInputStream(baos.toByteArray());
/*  92 */       } catch (XMLStreamException e) {
/*  93 */         handleException(""Error converting to a StreamSource"", e);
/*     */       }
/*     */     
/*  96 */     } else if (o instanceof OMText) {
/*  97 */       DataHandler dataHandler = (DataHandler)((OMText)o).getDataHandler();
/*  98 */       if (dataHandler != null) {
/*     */         try {
/* 100 */           return dataHandler.getInputStream();
/* 101 */         } catch (IOException e) {
/* 102 */           handleException(""Error in reading content as a stream "");
/*     */         } 
/*     */       }
/* 105 */     } else if (o instanceof URI) {
/*     */       try {
/* 107 */         return ((URI)o).toURL().openStream();
/* 108 */       } catch (IOException e) {
/* 109 */         handleException(""Error opening stream form URI"", e);
/*     */       } 
/*     */     } else {
/* 112 */       handleException(""Cannot convert object to a StreamSource"");
/*     */     } 
/* 114 */     return null;
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public static Object getObject(URL url) {
/*     */     try {
/* 129 */       if (url != null && ""file"".equals(url.getProtocol())) {
/*     */         try {
/* 131 */           url.openStream();
/* 132 */         } catch (IOException ignored) {
/* 133 */           String path = url.getPath();
/* 134 */           if (log.isDebugEnabled()) {
/* 135 */             log.debug(""Can not open a connection to the URL with a path :"" + path);
/*     */           }
/*     */           
/* 138 */           String synapseHome = ServerManager.getInstance().getSynapseHome();
/* 139 */           if (synapseHome != null) {
/* 140 */             if (log.isDebugEnabled()) {
/* 141 */               log.debug(""Trying  to resolve an absolute path of the  URL using the synapse.home : "" + synapseHome);
/*     */             }
/*     */             
/* 144 */             if (synapseHome.endsWith(""/"")) {
/* 145 */               synapseHome = synapseHome.substring(0, synapseHome.lastIndexOf(""/""));
/*     */             }
/* 147 */             url = new URL(url.getProtocol() + "":"" + synapseHome + ""/"" + path);
/*     */             try {
/* 149 */               url.openStream();
/* 150 */             } catch (IOException e) {
/* 151 */               if (log.isDebugEnabled()) {
/* 152 */                 log.debug(""Faild to resolve an absolute path of the  URL using the synapse.home : "" + synapseHome);
/*     */               }
/*     */               
/* 155 */               log.warn(""IO Error reading from URL "" + url.getPath() + e);
/*     */             } 
/*     */           } 
/*     */         } 
/*     */       }
/* 160 */       if (url == null) {
/* 161 */         return null;
/*     */       }
/* 163 */       URLConnection urlc = url.openConnection();
/* 164 */       XMLToObjectMapper xmlToObject = getXmlToObjectMapper(urlc.getContentType());
/*     */       
/* 166 */       InputStream inputStream = urlc.getInputStream();
/*     */       try {
/* 168 */         XMLStreamReader parser = XMLInputFactory.newInstance().createXMLStreamReader(inputStream);
/*     */         
/* 170 */         StAXOMBuilder builder = new StAXOMBuilder(parser);
/* 171 */         OMElement omElem = builder.getDocumentElement();
/*     */ 
/*     */ 
/*     */         
/* 175 */         omElem.build();
/*     */         
/* 177 */         if (xmlToObject != null) {
/* 178 */           return xmlToObject.getObjectFromOMNode((OMNode)omElem);
/*     */         }
/* 180 */         return omElem;
/*     */       
/*     */       }
/* 183 */       catch (XMLStreamException e) {
/* 184 */         if (log.isDebugEnabled()) {
/* 185 */           log.debug(""Content at URL : "" + url + "" is non XML.."");
/*     */         }
/* 187 */         return readNonXML(url);
/* 188 */       } catch (OMException e) {
/* 189 */         if (log.isDebugEnabled()) {
/* 190 */           log.debug(""Content at URL : "" + url + "" is non XML.."");
/*     */         }
/* 192 */         return readNonXML(url);
/*     */       } finally {
/* 194 */         inputStream.close();
/*     */       }
/*     */     
/* 197 */     } catch (IOException e) {
/* 198 */       handleException(""Error connecting to URL : "" + url, e);
/*     */       
/* 200 */       return null;
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public static OMNode readNonXML(URL url) {
/*     */     try {
/* 213 */       URLConnection newConnection = url.openConnection();
/*     */       
/* 215 */       BufferedInputStream newInputStream = new BufferedInputStream(newConnection.getInputStream());
/*     */ 
/*     */       
/* 218 */       OMFactory omFactory = OMAbstractFactory.getOMFactory();
/* 219 */       return (OMNode)omFactory.createOMText(new DataHandler((DataSource)new SynapseBinaryDataSource(newInputStream, newConnection.getContentType())), true);
/*     */ 
/*     */     
/*     */     }
/* 223 */     catch (IOException e) {
/* 224 */       handleException(""Error when getting a stream from resource's content"", e);
/*     */       
/* 226 */       return null;
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public static OMNode getOMElementFromURL(String urlStr) throws IOException {
/* 238 */     URL url = getURLFromPath(urlStr);
/* 239 */     if (url == null) {
/* 240 */       return null;
/*     */     }
/* 242 */     URLConnection conn = url.openConnection();
/* 243 */     conn.setReadTimeout(getReadTimeout());
/* 244 */     conn.setConnectTimeout(getConnectionTimeout());
/* 245 */     conn.setRequestProperty(""Connection"", ""close"");
/* 246 */     BufferedInputStream urlInStream = new BufferedInputStream(conn.getInputStream());
/*     */     
/*     */     try {
/* 249 */       StAXOMBuilder builder = new StAXOMBuilder(urlInStream);
/* 250 */       OMElement doc = builder.getDocumentElement();
/* 251 */       doc.build();
/* 252 */       return (OMNode)doc;
/* 253 */     } catch (Exception e) {
/* 254 */       if (log.isDebugEnabled()) {
/* 255 */         log.info(""Content at URL : "" + url + "" is non XML.."");
/*     */       }
/*     */       
/* 258 */       Object content = readNonXML(url);
/* 259 */       if (content instanceof OMNode) {
/* 260 */         return (OMNode)content;
/*     */       }
/*     */     } finally {
/*     */       try {
/* 264 */         urlInStream.close();
/* 265 */       } catch (IOException ignore) {}
/*     */     } 
/*     */     
/* 268 */     return null;
/*     */   }
/*     */   
/*     */   public static InputSource getInputSourceFormURI(URI uri) {
/* 272 */     if (uri == null) {
/* 273 */       if (log.isDebugEnabled()) {
/* 274 */         log.debug(""Can not create a URL from 'null' "");
/*     */       }
/* 276 */       return null;
/*     */     } 
/*     */     try {
/* 279 */       URL url = uri.toURL();
/* 280 */       String protocol = url.getProtocol();
/* 281 */       String path = url.getPath();
/* 282 */       if (protocol == null || """".equals(protocol)) {
/* 283 */         url = new URL(""file:"" + path);
/*     */       }
/* 285 */       URLConnection conn = url.openConnection();
/* 286 */       conn.setReadTimeout(getReadTimeout());
/* 287 */       conn.setConnectTimeout(getConnectionTimeout());
/* 288 */       conn.setRequestProperty(""Connection"", ""close"");
/* 289 */       BufferedInputStream urlInStream = new BufferedInputStream(conn.getInputStream());
/*     */       
/* 291 */       return new InputSource(urlInStream);
/* 292 */     } catch (MalformedURLException e) {
/* 293 */       handleException(""Invalid URL ' "" + uri + "" '"", e);
/* 294 */     } catch (IOException e) {
/* 295 */       handleException(""Error reading at URI ' "" + uri + "" ' "", e);
/*     */     } 
/* 297 */     return null;
/*     */   }
/*     */ 
/*     */   
/* 301 */   private static int getReadTimeout() { return ServerManager.getInstance().getReadTimeout(); }
/*     */ 
/*     */ 
/*     */   
/* 305 */   private static int getConnectionTimeout() { return ServerManager.getInstance().getConnectTimeout(); }
/*     */ 
/*     */   
/*     */   private static void handleException(String msg, Exception e) {
/* 309 */     log.warn(msg, e);
/* 310 */     throw new SynapseException(msg, e);
/*     */   }
/*     */   
/*     */   private static void handleException(String msg) {
/* 314 */     log.warn(msg);
/* 315 */     throw new SynapseException(msg);
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 326 */   public static XMLToObjectMapper getXmlToObjectMapper(String contentType) { return null; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public static URL getURLFromPath(String path) {
/* 336 */     if (path == null || ""null"".equals(path)) {
/* 337 */       if (log.isDebugEnabled()) {
/* 338 */         log.debug(""Can not create a URL from 'null' "");
/*     */       }
/* 340 */       return null;
/*     */     } 
/* 342 */     URL url = null;
/*     */     try {
/* 344 */       url = new URL(path);
/* 345 */       if (""file"".equals(url.getProtocol())) {
/*     */         try {
/* 347 */           url.openStream();
/* 348 */         } catch (MalformedURLException e) {
/* 349 */           handleException(""Invalid URL reference : "" + path, e);
/* 350 */         } catch (IOException ignored) {
/* 351 */           if (log.isDebugEnabled()) {
/* 352 */             log.debug(""Can not open a connection to the URL with a path :"" + path);
/*     */           }
/*     */           
/* 355 */           String synapseHome = ServerManager.getInstance().getSynapseHome();
/* 356 */           if (synapseHome != null) {
/* 357 */             if (synapseHome.endsWith(""/"")) {
/* 358 */               synapseHome = synapseHome.substring(0, synapseHome.lastIndexOf(""/""));
/*     */             }
/* 360 */             if (log.isDebugEnabled()) {
/* 361 */               log.debug(""Trying  to resolve an absolute path of the  URL using the synapse.home : "" + synapseHome);
/*     */             }
/*     */             
/*     */             try {
/* 365 */               url = new URL(url.getProtocol() + "":"" + synapseHome + ""/"" + url.getPath());
/*     */               
/* 367 */               url.openStream();
/* 368 */             } catch (MalformedURLException e) {
/* 369 */               handleException(""Invalid URL reference "" + url.getPath() + e);
/* 370 */             } catch (IOException e) {
/* 371 */               if (log.isDebugEnabled()) {
/* 372 */                 log.debug(""Faild to resolve an absolute path of the  URL using the synapse.home : "" + synapseHome);
/*     */               }
/*     */               
/* 375 */               log.warn(""IO Error reading from URL : "" + url.getPath() + e);
/*     */             } 
/*     */           } 
/*     */         } 
/*     */       }
/* 380 */     } catch (MalformedURLException e) {
/* 381 */       handleException(""Invalid URL reference :  "" + path, e);
/* 382 */     } catch (IOException e) {
/* 383 */       handleException(""IO Error reading from URL : "" + path, e);
/*     */     } 
/* 385 */     return url;
/*     */   }
/*     */ 
/*     */   
/*     */   public static String resolveRelativeURI(String parentLocation, String relativeLocation) {
/* 390 */     if (relativeLocation == null) {
/* 391 */       throw new IllegalArgumentException(""Import URI cannot be null"");
/*     */     }
/*     */     
/* 394 */     if (log.isDebugEnabled()) {
/* 395 */       log.debug(""Resolving import URI ' "" + parentLocation + "" '  against base URI ' "" + relativeLocation + "" '  "");
/*     */     }
/*     */     
/* 398 */     URI importUri = null;
/*     */     try {
/* 400 */       importUri = new URI(relativeLocation);
/* 401 */       if (importUri.isAbsolute()) {
/* 402 */         return importUri.toString();
/*     */       }
/* 404 */     } catch (URISyntaxException e) {
/* 405 */       handleException(""Invalid URI : "" + relativeLocation, e);
/*     */     } 
/*     */     
/* 408 */     if (parentLocation == null) {
/* 409 */       return importUri.toString();
/*     */     }
/*     */     
/* 412 */     if (relativeLocation.startsWith(""/"") || relativeLocation.startsWith(""\\"")) {
/* 413 */       if (importUri != null && !importUri.isAbsolute()) {
/*     */         try {
/* 415 */           importUri = new URI(""file:"" + relativeLocation);
/* 416 */           return importUri.toString();
/* 417 */         } catch (URISyntaxException e) {
/* 418 */           handleException(""Invalid URI ' "" + importUri.getPath() + "" '"", e);
/*     */         } 
/*     */       }
/*     */     } else {
/* 422 */       int index = parentLocation.lastIndexOf(""/"");
/* 423 */       if (index == -1) {
/* 424 */         index = parentLocation.lastIndexOf(""\\"");
/*     */       }
/* 426 */       if (index != -1) {
/* 427 */         String basepath = parentLocation.substring(0, index + 1);
/* 428 */         String resolvedPath = basepath + relativeLocation;
/*     */         try {
/* 430 */           URI resolvedUri = new URI(resolvedPath);
/* 431 */           if (!resolvedUri.isAbsolute()) {
/* 432 */             resolvedUri = new URI(""file:"" + resolvedPath);
/*     */           }
/* 434 */           return resolvedUri.toString();
/* 435 */         } catch (URISyntaxException e) {
/* 436 */           handleException(""Invalid URI ' "" + resolvedPath + "" '"", e);
/*     */         } 
/*     */       } else {
/* 439 */         return importUri.toString();
/*     */       } 
/*     */     } 
/*     */     
/* 443 */     return null;
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\SynapseConfigUtils.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.XMLToObjectMapper,"package org.apache.synapse.config;
import org.apache.axiom.om.OMNode;
public interface XMLToObjectMapper {
  Object getObjectFromOMNode(OMNode paramOMNode);
}
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\XMLToObjectMapper.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.AbstractDBMediatorFactory,"/*     */ package org.apache.synapse.config.xml;
/*     */ 
/*     */ import java.util.Hashtable;
/*     */ import java.util.Iterator;
/*     */ import javax.naming.Context;
/*     */ import javax.naming.InitialContext;
/*     */ import javax.naming.NamingException;
/*     */ import javax.sql.DataSource;
/*     */ import javax.xml.namespace.QName;
/*     */ import org.apache.axiom.om.OMAttribute;
/*     */ import org.apache.axiom.om.OMElement;
/*     */ import org.apache.commons.dbcp.BasicDataSource;
/*     */ import org.apache.synapse.mediators.db.AbstractDBMediator;
/*     */ import org.apache.synapse.mediators.db.Statement;
/*     */ import org.apache.synapse.util.xpath.SynapseXPath;
/*     */ import org.jaxen.JaxenException;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public abstract class AbstractDBMediatorFactory
/*     */   extends AbstractMediatorFactory
/*     */ {
/*  90 */   public static final QName URL_Q = new QName(""http://ws.apache.org/ns/synapse"", ""url"");
/*  91 */   static final QName DRIVER_Q = new QName(""http://ws.apache.org/ns/synapse"", ""driver"");
/*  92 */   static final QName USER_Q = new QName(""http://ws.apache.org/ns/synapse"", ""user"");
/*  93 */   static final QName PASS_Q = new QName(""http://ws.apache.org/ns/synapse"", ""password"");
/*     */   
/*  95 */   static final QName DSNAME_Q = new QName(""http://ws.apache.org/ns/synapse"", ""dsName"");
/*  96 */   static final QName ICCLASS_Q = new QName(""http://ws.apache.org/ns/synapse"", ""icClass"");
/*     */   
/*  98 */   static final QName STMNT_Q = new QName(""http://ws.apache.org/ns/synapse"", ""statement"");
/*  99 */   static final QName SQL_Q = new QName(""http://ws.apache.org/ns/synapse"", ""sql"");
/* 100 */   static final QName PARAM_Q = new QName(""http://ws.apache.org/ns/synapse"", ""parameter"");
/* 101 */   static final QName RESULT_Q = new QName(""http://ws.apache.org/ns/synapse"", ""result"");
/*     */   
/* 103 */   static final QName ATT_COLUMN = new QName(""column"");
/* 104 */   static final QName ATT_TYPE = new QName(""type"");
/*     */ 
/*     */   
/*     */   protected void buildDataSource(OMElement elem, AbstractDBMediator mediator) {
/* 108 */     OMElement pool = null;
/*     */ 
/*     */     
/*     */     try {
/* 112 */       SynapseXPath xpath = new SynapseXPath(""self::node()/syn:connection/syn:pool"");
/* 113 */       xpath.addNamespace(""syn"", ""http://ws.apache.org/ns/synapse"");
/* 114 */       pool = (OMElement)xpath.selectSingleNode(elem);
/*     */       
/* 116 */       if (pool.getFirstChildWithName(DRIVER_Q) != null) {
/* 117 */         mediator.setDataSource(createCustomDataSource(pool, mediator));
/*     */       }
/* 119 */       else if (pool.getFirstChildWithName(ICCLASS_Q) != null && pool.getFirstChildWithName(DSNAME_Q) != null) {
/*     */ 
/*     */         
/* 122 */         mediator.setDataSource(lookupDataSource(pool, mediator));
/*     */       } else {
/* 124 */         handleException(""The DataSource connection information must be specified for using a custom DataSource connection pool or for a JNDI lookup"");
/*     */       }
/*     */     
/*     */     }
/* 128 */     catch (JaxenException e) {
/* 129 */       handleException(""Error looking up DataSource connection information"", (Exception)e);
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   private DataSource lookupDataSource(OMElement pool, AbstractDBMediator mediator) {
/* 141 */     Hashtable<Object, Object> props = new Hashtable<Object, Object>();
/*     */     
/* 143 */     props.put(""java.naming.factory.initial"", getValue(pool, ICCLASS_Q));
/* 144 */     props.put(""java.naming.security.principal"", getValue(pool, USER_Q));
/* 145 */     props.put(""java.naming.security.credentials"", getValue(pool, PASS_Q));
/* 146 */     props.put(""java.naming.provider.url"", getValue(pool, URL_Q));
/* 147 */     String dsName = getValue(pool, DSNAME_Q);
/*     */ 
/*     */     
/* 150 */     mediator.addDataSourceProperty(ICCLASS_Q, getValue(pool, ICCLASS_Q));
/* 151 */     mediator.addDataSourceProperty(DSNAME_Q, getValue(pool, DSNAME_Q));
/* 152 */     mediator.addDataSourceProperty(URL_Q, getValue(pool, URL_Q));
/* 153 */     mediator.addDataSourceProperty(USER_Q, getValue(pool, USER_Q));
/* 154 */     mediator.addDataSourceProperty(PASS_Q, getValue(pool, PASS_Q));
/*     */     
/*     */     try {
/* 157 */       Context ctx = new InitialContext(props);
/* 158 */       Object ds = ctx.lookup(dsName);
/* 159 */       if (ds != null && ds instanceof DataSource) {
/* 160 */         return (DataSource)ds;
/*     */       }
/* 162 */       handleException(""DataSource : "" + dsName + "" not found when looking up"" + "" using JNDI properties : "" + props);
/*     */ 
/*     */     
/*     */     }
/* 166 */     catch (NamingException e) {
/* 167 */       handleException(""Error looking up DataSource : "" + dsName + "" using JNDI properties : "" + props, e);
/*     */     } 
/*     */     
/* 170 */     return null;
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   private DataSource createCustomDataSource(OMElement pool, AbstractDBMediator mediator) {
/* 181 */     BasicDataSource ds = new BasicDataSource();
/*     */ 
/*     */     
/* 184 */     ds.setDriverClassName(getValue(pool, DRIVER_Q));
/* 185 */     ds.setUsername(getValue(pool, USER_Q));
/* 186 */     ds.setPassword(getValue(pool, PASS_Q));
/* 187 */     ds.setUrl(getValue(pool, URL_Q));
/*     */ 
/*     */     
/* 190 */     mediator.addDataSourceProperty(DRIVER_Q, getValue(pool, DRIVER_Q));
/* 191 */     mediator.addDataSourceProperty(URL_Q, getValue(pool, URL_Q));
/* 192 */     mediator.addDataSourceProperty(USER_Q, getValue(pool, USER_Q));
/* 193 */     mediator.addDataSourceProperty(PASS_Q, getValue(pool, PASS_Q));
/*     */     
/* 195 */     Iterator<OMElement> props = pool.getChildrenWithName(PROP_Q);
/* 196 */     while (props.hasNext()) {
/*     */       
/* 198 */       OMElement prop = props.next();
/* 199 */       String name = prop.getAttribute(ATT_NAME).getAttributeValue();
/* 200 */       String value = prop.getAttribute(ATT_VALUE).getAttributeValue();
/*     */       
/* 202 */       mediator.addDataSourceProperty(name, value);
/*     */       
/* 204 */       if (""autocommit"".equals(name)) {
/* 205 */         if (""true"".equals(value)) {
/* 206 */           ds.setDefaultAutoCommit(true); continue;
/* 207 */         }  if (""false"".equals(value))
/* 208 */           ds.setDefaultAutoCommit(false);  continue;
/*     */       } 
/* 210 */       if (""isolation"".equals(name))
/*     */         
/* 212 */         try { if (""Connection.TRANSACTION_NONE"".equals(value)) {
/* 213 */             ds.setDefaultTransactionIsolation(0); continue;
/* 214 */           }  if (""Connection.TRANSACTION_READ_COMMITTED"".equals(value)) {
/* 215 */             ds.setDefaultTransactionIsolation(2); continue;
/* 216 */           }  if (""Connection.TRANSACTION_READ_UNCOMMITTED"".equals(value)) {
/* 217 */             ds.setDefaultTransactionIsolation(1); continue;
/* 218 */           }  if (""Connection.TRANSACTION_REPEATABLE_READ"".equals(value)) {
/* 219 */             ds.setDefaultTransactionIsolation(4); continue;
/* 220 */           }  if (""Connection.TRANSACTION_SERIALIZABLE"".equals(value))
/* 221 */             ds.setDefaultTransactionIsolation(8); 
/*     */           continue; }
/* 223 */         catch (NumberFormatException ignore) { continue; }
/* 224 */           if (""initialsize"".equals(name))
/*     */         
/* 226 */         try { ds.setInitialSize(Integer.parseInt(value)); continue; }
/* 227 */         catch (NumberFormatException ignore) { continue; }
/* 228 */           if (""maxactive"".equals(name))
/*     */         
/* 230 */         try { ds.setMaxActive(Integer.parseInt(value)); continue; }
/* 231 */         catch (NumberFormatException ignore) { continue; }
/* 232 */           if (""maxidle"".equals(name))
/*     */         
/* 234 */         try { ds.setMaxIdle(Integer.parseInt(value)); continue; }
/* 235 */         catch (NumberFormatException ignore) { continue; }
/* 236 */           if (""maxopenstatements"".equals(name))
/*     */         
/* 238 */         try { ds.setMaxOpenPreparedStatements(Integer.parseInt(value)); continue; }
/* 239 */         catch (NumberFormatException ignore) { continue; }
/* 240 */           if (""maxwait"".equals(name))
/*     */         
/* 242 */         try { ds.setMaxWait(Long.parseLong(value)); continue; }
/* 243 */         catch (NumberFormatException ignore) { continue; }
/* 244 */           if (""minidle"".equals(name))
/*     */         
/* 246 */         try { ds.setMinIdle(Integer.parseInt(value)); continue; }
/* 247 */         catch (NumberFormatException ignore) { continue; }
/* 248 */           if (""poolstatements"".equals(name)) {
/* 249 */         if (""true"".equals(value)) {
/* 250 */           ds.setPoolPreparedStatements(true); continue;
/* 251 */         }  if (""false"".equals(value))
/* 252 */           ds.setPoolPreparedStatements(false);  continue;
/*     */       } 
/* 254 */       if (""testonborrow"".equals(name)) {
/* 255 */         if (""true"".equals(value)) {
/* 256 */           ds.setTestOnBorrow(true); continue;
/* 257 */         }  if (""false"".equals(value))
/* 258 */           ds.setTestOnBorrow(false);  continue;
/*     */       } 
/* 260 */       if (""testonreturn"".equals(name)) {
/* 261 */         if (""true"".equals(value)) {
/* 262 */           ds.setTestOnReturn(true); continue;
/* 263 */         }  if (""false"".equals(value))
/* 264 */           ds.setTestOnReturn(false);  continue;
/*     */       } 
/* 266 */       if (""testwhileidle"".equals(name)) {
/* 267 */         if (""true"".equals(value)) {
/* 268 */           ds.setTestWhileIdle(true); continue;
/* 269 */         }  if (""false"".equals(value))
/* 270 */           ds.setTestWhileIdle(false);  continue;
/*     */       } 
/* 272 */       if (""validationquery"".equals(name)) {
/* 273 */         ds.setValidationQuery(value);
/*     */       }
/*     */     } 
/* 276 */     return (DataSource)ds;
/*     */   }
/*     */ 
/*     */   
/*     */   protected void processStatements(OMElement elem, AbstractDBMediator mediator) {
/* 281 */     Iterator<OMElement> iter = elem.getChildrenWithName(STMNT_Q);
/* 282 */     while (iter.hasNext()) {
/*     */       
/* 284 */       OMElement stmntElt = iter.next();
/* 285 */       Statement statement = new Statement(getValue(stmntElt, SQL_Q));
/*     */       
/* 287 */       Iterator<OMElement> paramIter = stmntElt.getChildrenWithName(PARAM_Q);
/* 288 */       while (paramIter.hasNext()) {
/*     */         
/* 290 */         OMElement paramElt = paramIter.next();
/* 291 */         String xpath = getAttribute(paramElt, ATT_EXPRN);
/* 292 */         String value = getAttribute(paramElt, ATT_VALUE);
/*     */         
/* 294 */         if (xpath != null || value != null) {
/*     */           
/* 296 */           SynapseXPath xp = null;
/* 297 */           if (xpath != null) {
/*     */             try {
/* 299 */               xp = SynapseXPathFactory.getSynapseXPath(paramElt, ATT_EXPRN);
/*     */             }
/* 301 */             catch (JaxenException e) {
/* 302 */               handleException(""Invalid XPath specified for the source attribute : "" + xpath);
/*     */             } 
/*     */           }
/*     */           
/* 306 */           statement.addParameter(value, xp, getAttribute(paramElt, ATT_TYPE));
/*     */         } 
/*     */       } 
/*     */ 
/*     */ 
/*     */ 
/*     */       
/* 313 */       Iterator<OMElement> resultIter = stmntElt.getChildrenWithName(RESULT_Q);
/* 314 */       while (resultIter.hasNext()) {
/*     */         
/* 316 */         OMElement resultElt = resultIter.next();
/* 317 */         statement.addResult(getAttribute(resultElt, ATT_NAME), getAttribute(resultElt, ATT_COLUMN));
/*     */       } 
/*     */ 
/*     */ 
/*     */       
/* 322 */       mediator.addStatement(statement);
/*     */     } 
/*     */   }
/*     */   
/*     */   protected String getValue(OMElement elt, QName qName) {
/* 327 */     OMElement e = elt.getFirstChildWithName(qName);
/* 328 */     if (e != null) {
/* 329 */       return e.getText();
/*     */     }
/* 331 */     handleException(""Unable to read configuration value for : "" + qName);
/*     */     
/* 333 */     return null;
/*     */   }
/*     */   
/*     */   protected String getAttribute(OMElement elt, QName qName) {
/* 337 */     OMAttribute a = elt.getAttribute(qName);
/* 338 */     if (a != null) {
/* 339 */       return a.getAttributeValue();
/*     */     }
/* 341 */     return null;
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\AbstractDBMediatorFactory.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.AbstractDBMediatorSerializer,"/*     */ package org.apache.synapse.config.xml;
/*     */ 
/*     */ import java.util.Iterator;
/*     */ import javax.xml.namespace.QName;
/*     */ import org.apache.axiom.om.OMElement;
/*     */ import org.apache.axiom.om.OMNode;
/*     */ import org.apache.axiom.om.OMText;
/*     */ import org.apache.synapse.SynapseException;
/*     */ import org.apache.synapse.mediators.db.AbstractDBMediator;
/*     */ import org.apache.synapse.mediators.db.Statement;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public abstract class AbstractDBMediatorSerializer
/*     */   extends AbstractMediatorSerializer
/*     */ {
/*     */   protected void serializeDBInformation(AbstractDBMediator mediator, OMElement dbParent) {
/*  84 */     OMElement connElt = fac.createOMElement(""connection"", synNS);
/*  85 */     OMElement poolElt = fac.createOMElement(""pool"", synNS);
/*     */     
/*  87 */     Iterator iter = mediator.getDataSourceProps().keySet().iterator();
/*  88 */     while (iter.hasNext()) {
/*     */       
/*  90 */       Object o = iter.next();
/*  91 */       String value = (String)mediator.getDataSourceProps().get(o);
/*     */       
/*  93 */       if (o instanceof QName) {
/*  94 */         QName name = (QName)o;
/*  95 */         OMElement elt = fac.createOMElement(name.getLocalPart(), synNS);
/*  96 */         elt.setText(value);
/*  97 */         poolElt.addChild((OMNode)elt); continue;
/*     */       } 
/*  99 */       if (o instanceof String) {
/* 100 */         OMElement elt = fac.createOMElement(AbstractDBMediatorFactory.PROP_Q.getLocalPart(), synNS);
/*     */         
/* 102 */         elt.addAttribute(fac.createOMAttribute(""name"", nullNS, (String)o));
/* 103 */         elt.addAttribute(fac.createOMAttribute(""value"", nullNS, value));
/* 104 */         poolElt.addChild((OMNode)elt);
/*     */       } 
/*     */     } 
/*     */     
/* 108 */     connElt.addChild((OMNode)poolElt);
/* 109 */     dbParent.addChild((OMNode)connElt);
/*     */ 
/*     */     
/* 112 */     Iterator<Statement> statementIter = mediator.getStatementList().iterator();
/* 113 */     while (statementIter.hasNext()) {
/*     */       
/* 115 */       Statement statement = statementIter.next();
/* 116 */       OMElement stmntElt = fac.createOMElement(AbstractDBMediatorFactory.STMNT_Q.getLocalPart(), synNS);
/*     */ 
/*     */       
/* 119 */       OMElement sqlElt = fac.createOMElement(AbstractDBMediatorFactory.SQL_Q.getLocalPart(), synNS);
/*     */       
/* 121 */       OMText sqlText = fac.createOMText(statement.getRawStatement(), 12);
/* 122 */       sqlElt.addChild((OMNode)sqlText);
/* 123 */       stmntElt.addChild((OMNode)sqlElt);
/*     */ 
/*     */       
/* 126 */       for (Iterator<Statement.Parameter> it = statement.getParameters().iterator(); it.hasNext(); ) {
/*     */         
/* 128 */         Statement.Parameter param = it.next();
/* 129 */         OMElement paramElt = fac.createOMElement(AbstractDBMediatorFactory.PARAM_Q.getLocalPart(), synNS);
/*     */ 
/*     */         
/* 132 */         if (param.getPropertyName() != null) {
/* 133 */           paramElt.addAttribute(fac.createOMAttribute(""value"", nullNS, param.getPropertyName()));
/*     */         }
/*     */         
/* 136 */         if (param.getXpath() != null) {
/* 137 */           SynapseXPathSerializer.serializeXPath(param.getXpath(), paramElt, ""expression"");
/*     */         }
/*     */         
/* 140 */         switch (param.getType()) {
/*     */           case 1:
/* 142 */             paramElt.addAttribute(fac.createOMAttribute(""type"", nullNS, ""CHAR""));
/*     */             break;
/*     */           
/*     */           case 12:
/* 146 */             paramElt.addAttribute(fac.createOMAttribute(""type"", nullNS, ""VARCHAR""));
/*     */             break;
/*     */           
/*     */           case -1:
/* 150 */             paramElt.addAttribute(fac.createOMAttribute(""type"", nullNS, ""LONGVARCHAR""));
/*     */             break;
/*     */           
/*     */           case 2:
/* 154 */             paramElt.addAttribute(fac.createOMAttribute(""type"", nullNS, ""NUMERIC""));
/*     */             break;
/*     */           
/*     */           case 3:
/* 158 */             paramElt.addAttribute(fac.createOMAttribute(""type"", nullNS, ""DECIMAL""));
/*     */             break;
/*     */           
/*     */           case -7:
/* 162 */             paramElt.addAttribute(fac.createOMAttribute(""type"", nullNS, ""BIT""));
/*     */             break;
/*     */           
/*     */           case -6:
/* 166 */             paramElt.addAttribute(fac.createOMAttribute(""type"", nullNS, ""TINYINT""));
/*     */             break;
/*     */           
/*     */           case 5:
/* 170 */             paramElt.addAttribute(fac.createOMAttribute(""type"", nullNS, ""SMALLINT""));
/*     */             break;
/*     */           
/*     */           case 4:
/* 174 */             paramElt.addAttribute(fac.createOMAttribute(""type"", nullNS, ""INTEGER""));
/*     */             break;
/*     */           
/*     */           case -5:
/* 178 */             paramElt.addAttribute(fac.createOMAttribute(""type"", nullNS, ""BIGINT""));
/*     */             break;
/*     */           
/*     */           case 7:
/* 182 */             paramElt.addAttribute(fac.createOMAttribute(""type"", nullNS, ""REAL""));
/*     */             break;
/*     */           
/*     */           case 6:
/* 186 */             paramElt.addAttribute(fac.createOMAttribute(""type"", nullNS, ""FLOAT""));
/*     */             break;
/*     */           
/*     */           case 8:
/* 190 */             paramElt.addAttribute(fac.createOMAttribute(""type"", nullNS, ""DOUBLE""));
/*     */             break;
/*     */           
/*     */           case 91:
/* 194 */             paramElt.addAttribute(fac.createOMAttribute(""type"", nullNS, ""DATE""));
/*     */             break;
/*     */           
/*     */           case 92:
/* 198 */             paramElt.addAttribute(fac.createOMAttribute(""type"", nullNS, ""TIME""));
/*     */             break;
/*     */           
/*     */           case 93:
/* 202 */             paramElt.addAttribute(fac.createOMAttribute(""type"", nullNS, ""TIMESTAMP""));
/*     */             break;
/*     */           
/*     */           default:
/* 206 */             throw new SynapseException(""Unknown or unsupported JDBC type : "" + param.getType());
/*     */         } 
/*     */ 
/*     */ 
/*     */         
/* 211 */         stmntElt.addChild((OMNode)paramElt);
/*     */       } 
/*     */ 
/*     */       
/* 215 */       for (Iterator<String> it = statement.getResultsMap().keySet().iterator(); it.hasNext(); ) {
/*     */         
/* 217 */         String name = it.next();
/* 218 */         String columnStr = (String)statement.getResultsMap().get(name);
/*     */         
/* 220 */         OMElement resultElt = fac.createOMElement(AbstractDBMediatorFactory.RESULT_Q.getLocalPart(), synNS);
/*     */ 
/*     */         
/* 223 */         resultElt.addAttribute(fac.createOMAttribute(""name"", nullNS, name));
/*     */         
/* 225 */         resultElt.addAttribute(fac.createOMAttribute(""column"", nullNS, columnStr));
/*     */ 
/*     */         
/* 228 */         stmntElt.addChild((OMNode)resultElt);
/*     */       } 
/*     */       
/* 231 */       dbParent.addChild((OMNode)stmntElt);
/*     */     } 
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\AbstractDBMediatorSerializer.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.AbstractListMediatorFactory,"/*    */ package org.apache.synapse.config.xml;
/*    */ 
/*    */ import java.util.Iterator;
/*    */ import org.apache.axiom.om.OMElement;
/*    */ import org.apache.synapse.Mediator;
/*    */ import org.apache.synapse.SynapseException;
/*    */ import org.apache.synapse.mediators.ListMediator;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public abstract class AbstractListMediatorFactory
/*    */   extends AbstractMediatorFactory
/*    */ {
/*    */   protected static void addChildren(OMElement el, ListMediator m) {
/* 39 */     Iterator<OMElement> it = el.getChildElements();
/* 40 */     while (it.hasNext()) {
/* 41 */       OMElement child = it.next();
/* 42 */       Mediator med = MediatorFactoryFinder.getInstance().getMediator(child);
/* 43 */       if (med != null) {
/* 44 */         m.addChild(med); continue;
/*    */       } 
/* 46 */       String msg = ""Unknown mediator : "" + child.getLocalName();
/* 47 */       log.error(msg);
/* 48 */       throw new SynapseException(msg);
/*    */     } 
/*    */   }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\AbstractListMediatorFactory.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.AbstractListMediatorSerializer,"/*    */ package org.apache.synapse.config.xml;
/*    */ 
/*    */ import java.util.Iterator;
/*    */ import java.util.List;
/*    */ import org.apache.axiom.om.OMElement;
/*    */ import org.apache.synapse.Mediator;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public abstract class AbstractListMediatorSerializer
/*    */   extends AbstractMediatorSerializer
/*    */ {
/*    */   protected void serializeChildren(OMElement parent, List list) {
/* 34 */     Iterator<Mediator> iter = list.iterator();
/* 35 */     while (iter.hasNext()) {
/* 36 */       Mediator child = iter.next();
/* 37 */       MediatorSerializer medSer = MediatorSerializerFinder.getInstance().getSerializer(child);
/* 38 */       if (medSer != null) {
/* 39 */         medSer.serializeMediator(parent, child); continue;
/*    */       } 
/* 41 */       handleException(""Unable to find a serializer for mediator : "" + child.getType());
/*    */     } 
/*    */   }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\AbstractListMediatorSerializer.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.AbstractMediatorFactory,"/*    */ package org.apache.synapse.config.xml;
/*    */ 
/*    */ import javax.xml.namespace.QName;
/*    */ import org.apache.axiom.om.OMAttribute;
/*    */ import org.apache.axiom.om.OMElement;
/*    */ import org.apache.commons.logging.Log;
/*    */ import org.apache.commons.logging.LogFactory;
/*    */ import org.apache.synapse.Mediator;
/*    */ import org.apache.synapse.SynapseException;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public abstract class AbstractMediatorFactory
/*    */   implements MediatorFactory
/*    */ {
/*    */   protected static Log log;
/* 35 */   protected static final QName ATT_NAME = new QName(""name"");
/* 36 */   protected static final QName ATT_VALUE = new QName(""value"");
/* 37 */   protected static final QName ATT_XPATH = new QName(""xpath"");
/* 38 */   protected static final QName ATT_REGEX = new QName(""regex"");
/* 39 */   protected static final QName ATT_SEQUENCE = new QName(""sequence"");
/* 40 */   protected static final QName ATT_EXPRN = new QName(""expression"");
/* 41 */   protected static final QName ATT_KEY = new QName(""key"");
/* 42 */   protected static final QName ATT_SOURCE = new QName(""source"");
/* 43 */   protected static final QName ATT_TARGET = new QName(""target"");
/* 44 */   protected static final QName ATT_ONERROR = new QName(""onError"");
/* 45 */   protected static final QName ATT_STATS = new QName(""statistics"");
/*    */   
/* 47 */   protected static final QName PROP_Q = new QName(""http://ws.apache.org/ns/synapse"", ""property"");
/*    */   
/* 49 */   protected static final QName FEATURE_Q = new QName(""http://ws.apache.org/ns/synapse"", ""feature"");
/*    */   
/* 51 */   protected static final QName TARGET_Q = new QName(""http://ws.apache.org/ns/synapse"", ""target"");
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */   
/* 58 */   protected AbstractMediatorFactory() { log = LogFactory.getLog(getClass()); }
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */   
/*    */   protected void processTraceState(Mediator mediator, OMElement mediatorOmElement) {
/* 69 */     OMAttribute trace = mediatorOmElement.getAttribute(new QName("""", ""trace""));
/*    */ 
/*    */     
/* 72 */     if (trace != null) {
/* 73 */       String traceValue = trace.getAttributeValue();
/* 74 */       if (traceValue != null) {
/* 75 */         if (traceValue.equals(""enable"")) {
/* 76 */           mediator.setTraceState(1);
/* 77 */         } else if (traceValue.equals(""disable"")) {
/* 78 */           mediator.setTraceState(0);
/*    */         } 
/*    */       }
/*    */     } 
/*    */   }
/*    */   
/*    */   protected void handleException(String message, Exception e) {
/* 85 */     LogFactory.getLog(getClass()).error(message, e);
/* 86 */     throw new SynapseException(message, e);
/*    */   }
/*    */   
/*    */   protected void handleException(String message) {
/* 90 */     LogFactory.getLog(getClass()).error(message);
/* 91 */     throw new SynapseException(message);
/*    */   }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\AbstractMediatorFactory.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.AbstractMediatorSerializer,"/*     */ package org.apache.synapse.config.xml;
/*     */ 
/*     */ import java.util.Collection;
/*     */ import java.util.Iterator;
/*     */ import javax.xml.namespace.QName;
/*     */ import org.apache.axiom.om.OMAbstractFactory;
/*     */ import org.apache.axiom.om.OMContainer;
/*     */ import org.apache.axiom.om.OMElement;
/*     */ import org.apache.axiom.om.OMFactory;
/*     */ import org.apache.axiom.om.OMNamespace;
/*     */ import org.apache.axiom.om.xpath.AXIOMXPath;
/*     */ import org.apache.commons.logging.Log;
/*     */ import org.apache.commons.logging.LogFactory;
/*     */ import org.apache.synapse.Mediator;
/*     */ import org.apache.synapse.SynapseException;
/*     */ import org.apache.synapse.mediators.MediatorProperty;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public abstract class AbstractMediatorSerializer
/*     */   implements MediatorSerializer
/*     */ {
/*     */   protected static Log log;
/*  42 */   protected static final OMFactory fac = OMAbstractFactory.getOMFactory();
/*  43 */   protected static final OMNamespace synNS = fac.createOMNamespace(""http://ws.apache.org/ns/synapse"", ""syn"");
/*     */   
/*  45 */   protected static final OMNamespace nullNS = fac.createOMNamespace("""", """");
/*     */   
/*  47 */   protected static final QName PROP_Q = new QName(""http://ws.apache.org/ns/synapse"", ""property"", ""syn"");
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  54 */   protected AbstractMediatorSerializer() { log = LogFactory.getLog(getClass()); }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   protected static void saveTracingState(OMElement mediatorOmElement, Mediator mediator) {
/*  65 */     int traceState = mediator.getTraceState();
/*  66 */     String traceValue = null;
/*  67 */     if (traceState == 1) {
/*  68 */       traceValue = ""enable"";
/*  69 */     } else if (traceState == 0) {
/*  70 */       traceValue = ""disable"";
/*     */     } 
/*  72 */     if (traceValue != null) {
/*  73 */       mediatorOmElement.addAttribute(fac.createOMAttribute(""trace"", nullNS, traceValue));
/*     */     }
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   protected void serializeMediatorProperties(OMElement parent, Collection props) {
/*  81 */     Iterator<MediatorProperty> iter = props.iterator();
/*  82 */     while (iter.hasNext()) {
/*  83 */       MediatorProperty mp = iter.next();
/*  84 */       OMElement prop = fac.createOMElement(""property"", synNS, (OMContainer)parent);
/*  85 */       if (mp.getName() != null) {
/*  86 */         prop.addAttribute(fac.createOMAttribute(""name"", nullNS, mp.getName()));
/*     */       } else {
/*  88 */         handleException(""Mediator property name missing"");
/*     */       } 
/*     */       
/*  91 */       if (mp.getValue() != null) {
/*  92 */         prop.addAttribute(fac.createOMAttribute(""value"", nullNS, mp.getValue())); continue;
/*     */       } 
/*  94 */       if (mp.getExpression() != null) {
/*  95 */         SynapseXPathSerializer.serializeXPath(mp.getExpression(), prop, ""expression"");
/*     */         continue;
/*     */       } 
/*  98 */       handleException(""Mediator property must have a literal value or be an expression"");
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */   
/* 104 */   protected void serializeProperties(OMElement parent, Collection props) { serializeMediatorProperties(parent, props); }
/*     */ 
/*     */   
/*     */   protected void serializeNamespaces(OMElement elem, AXIOMXPath xpath) {
/* 108 */     Iterator<String> iter = xpath.getNamespaces().keySet().iterator();
/* 109 */     while (iter.hasNext()) {
/* 110 */       String prefix = iter.next();
/* 111 */       String uri = xpath.getNamespaceContext().translateNamespacePrefixToUri(prefix);
/* 112 */       if (!""http://ws.apache.org/ns/synapse"".equals(uri)) {
/* 113 */         elem.declareNamespace(uri, prefix);
/*     */       }
/*     */     } 
/*     */   }
/*     */   
/*     */   protected void handleException(String msg) {
/* 119 */     LogFactory.getLog(getClass()).error(msg);
/* 120 */     throw new SynapseException(msg);
/*     */   }
/*     */   
/*     */   protected void handleException(String msg, Exception e) {
/* 124 */     LogFactory.getLog(getClass()).error(msg, e);
/* 125 */     throw new SynapseException(msg, e);
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\AbstractMediatorSerializer.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.AggregateMediatorFactory,"/*     */ package org.apache.synapse.config.xml;
/*     */ 
/*     */ import javax.xml.namespace.QName;
/*     */ import org.apache.axiom.om.OMAttribute;
/*     */ import org.apache.axiom.om.OMElement;
/*     */ import org.apache.commons.logging.Log;
/*     */ import org.apache.commons.logging.LogFactory;
/*     */ import org.apache.synapse.Mediator;
/*     */ import org.apache.synapse.mediators.base.SequenceMediator;
/*     */ import org.apache.synapse.mediators.builtin.DropMediator;
/*     */ import org.apache.synapse.mediators.eip.aggregator.AggregateMediator;
/*     */ import org.jaxen.JaxenException;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class AggregateMediatorFactory
/*     */   extends AbstractMediatorFactory
/*     */ {
/*  51 */   private static final Log log = LogFactory.getLog(AggregateMediatorFactory.class);
/*     */   
/*  53 */   private static final QName AGGREGATE_Q = new QName(""http://ws.apache.org/ns/synapse"", ""aggregate"");
/*  54 */   private static final QName CORELATE_ON_Q = new QName(""http://ws.apache.org/ns/synapse"", ""correlateOn"");
/*  55 */   private static final QName COMPLETE_CONDITION_Q = new QName(""http://ws.apache.org/ns/synapse"", ""completeCondition"");
/*     */   
/*  57 */   private static final QName MESSAGE_COUNT_Q = new QName(""http://ws.apache.org/ns/synapse"", ""messageCount"");
/*     */   
/*  59 */   private static final QName ON_COMPLETE_Q = new QName(""http://ws.apache.org/ns/synapse"", ""onComplete"");
/*  60 */   private static final QName EXPRESSION_Q = new QName("""", ""expression"");
/*  61 */   private static final QName TIMEOUT_Q = new QName("""", ""timeout"");
/*  62 */   private static final QName MIN_Q = new QName("""", ""min"");
/*  63 */   private static final QName MAX_Q = new QName("""", ""max"");
/*  64 */   private static final QName SEQUENCE_Q = new QName("""", ""sequence"");
/*     */ 
/*     */   
/*     */   public Mediator createMediator(OMElement elem) {
/*  68 */     AggregateMediator mediator = new AggregateMediator();
/*  69 */     processTraceState((Mediator)mediator, elem);
/*     */     
/*  71 */     OMElement corelateOn = elem.getFirstChildWithName(CORELATE_ON_Q);
/*  72 */     if (corelateOn != null) {
/*  73 */       OMAttribute corelateExpr = corelateOn.getAttribute(EXPRESSION_Q);
/*  74 */       if (corelateExpr != null) {
/*     */         try {
/*  76 */           mediator.setCorrelateExpression(SynapseXPathFactory.getSynapseXPath(corelateOn, EXPRESSION_Q));
/*     */         }
/*  78 */         catch (JaxenException e) {
/*  79 */           handleException(""Unable to load the corelate XPATH expression"", (Exception)e);
/*     */         } 
/*     */       }
/*     */     } 
/*     */     
/*  84 */     OMElement completeCond = elem.getFirstChildWithName(COMPLETE_CONDITION_Q);
/*  85 */     if (completeCond != null) {
/*  86 */       OMAttribute completeTimeout = completeCond.getAttribute(TIMEOUT_Q);
/*  87 */       if (completeTimeout != null) {
/*  88 */         mediator.setCompletionTimeoutMillis(Long.parseLong(completeTimeout.getAttributeValue()) * 1000L);
/*     */       }
/*     */ 
/*     */       
/*  92 */       OMElement messageCount = completeCond.getFirstChildWithName(MESSAGE_COUNT_Q);
/*  93 */       if (messageCount != null) {
/*  94 */         OMAttribute min = messageCount.getAttribute(MIN_Q);
/*  95 */         if (min != null) {
/*  96 */           mediator.setMinMessagesToComplete(Integer.parseInt(min.getAttributeValue()));
/*     */         }
/*     */         
/*  99 */         OMAttribute max = messageCount.getAttribute(MAX_Q);
/* 100 */         if (max != null) {
/* 101 */           mediator.setMaxMessagesToComplete(Integer.parseInt(max.getAttributeValue()));
/*     */         }
/*     */       } 
/*     */     } 
/*     */     
/* 106 */     OMElement onComplete = elem.getFirstChildWithName(ON_COMPLETE_Q);
/* 107 */     if (onComplete != null) {
/*     */       
/* 109 */       OMAttribute aggregateExpr = onComplete.getAttribute(EXPRESSION_Q);
/* 110 */       if (aggregateExpr != null) {
/*     */         try {
/* 112 */           mediator.setAggregationExpression(SynapseXPathFactory.getSynapseXPath(onComplete, EXPRESSION_Q));
/*     */         }
/* 114 */         catch (JaxenException e) {
/* 115 */           handleException(""Unable to load the aggregating XPATH"", (Exception)e);
/*     */         } 
/*     */       }
/*     */       
/* 119 */       OMAttribute onCompleteSequence = onComplete.getAttribute(SEQUENCE_Q);
/* 120 */       if (onCompleteSequence != null) {
/* 121 */         mediator.setOnCompleteSequenceRef(onCompleteSequence.getAttributeValue());
/* 122 */       } else if (onComplete.getFirstElement() != null) {
/* 123 */         mediator.setOnCompleteSequence((new SequenceMediatorFactory()).createAnonymousSequence(onComplete));
/*     */       } else {
/*     */         
/* 126 */         SequenceMediator sequence = new SequenceMediator();
/* 127 */         sequence.addChild((Mediator)new DropMediator());
/* 128 */         mediator.setOnCompleteSequence(sequence);
/*     */       } 
/*     */     } 
/* 131 */     return (Mediator)mediator;
/*     */   }
/*     */ 
/*     */   
/* 135 */   public QName getTagQName() { return AGGREGATE_Q; }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\AggregateMediatorFactory.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.AggregateMediatorSerializer,"/*    */ package org.apache.synapse.config.xml;
/*    */ 
/*    */ import org.apache.axiom.om.OMElement;
/*    */ import org.apache.axiom.om.OMNode;
/*    */ import org.apache.commons.logging.Log;
/*    */ import org.apache.commons.logging.LogFactory;
/*    */ import org.apache.synapse.Mediator;
/*    */ import org.apache.synapse.mediators.eip.aggregator.AggregateMediator;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class AggregateMediatorSerializer
/*    */   extends AbstractMediatorSerializer
/*    */ {
/* 45 */   private static final Log log = LogFactory.getLog(AggregateMediatorSerializer.class);
/*    */ 
/*    */   
/*    */   public OMElement serializeMediator(OMElement parent, Mediator m) {
/* 49 */     if (!(m instanceof AggregateMediator)) {
/* 50 */       handleException(""Unsupported mediator passed in for serialization : "" + m.getType());
/*    */     }
/* 52 */     AggregateMediator mediator = (AggregateMediator)m;
/* 53 */     OMElement aggregator = fac.createOMElement(""aggregate"", synNS);
/* 54 */     saveTracingState(aggregator, (Mediator)mediator);
/*    */     
/* 56 */     if (mediator.getCorrelateExpression() != null) {
/* 57 */       OMElement corelateOn = fac.createOMElement(""correlateOn"", synNS);
/* 58 */       SynapseXPathSerializer.serializeXPath(mediator.getCorrelateExpression(), corelateOn, ""expression"");
/*    */       
/* 60 */       aggregator.addChild((OMNode)corelateOn);
/*    */     } 
/*    */     
/* 63 */     OMElement completeCond = fac.createOMElement(""completeCondition"", synNS);
/* 64 */     if (mediator.getCompletionTimeoutMillis() != 0L) {
/* 65 */       completeCond.addAttribute(""timeout"", Long.toString(mediator.getCompletionTimeoutMillis() / 1000L), nullNS);
/*    */     }
/* 67 */     OMElement messageCount = fac.createOMElement(""messageCount"", synNS);
/* 68 */     if (mediator.getMinMessagesToComplete() != 0) {
/* 69 */       messageCount.addAttribute(""min"", Integer.toString(mediator.getMinMessagesToComplete()), nullNS);
/*    */     }
/* 71 */     if (mediator.getMaxMessagesToComplete() != 0) {
/* 72 */       messageCount.addAttribute(""max"", Integer.toString(mediator.getMaxMessagesToComplete()), nullNS);
/*    */     }
/* 74 */     completeCond.addChild((OMNode)messageCount);
/* 75 */     aggregator.addChild((OMNode)completeCond);
/*    */     
/* 77 */     OMElement onCompleteElem = fac.createOMElement(""onComplete"", synNS);
/* 78 */     if (mediator.getAggregationExpression() != null) {
/* 79 */       SynapseXPathSerializer.serializeXPath(mediator.getAggregationExpression(), onCompleteElem, ""expression"");
/*    */     }
/*    */     
/* 82 */     if (mediator.getOnCompleteSequenceRef() != null) {
/* 83 */       onCompleteElem.addAttribute(""sequence"", mediator.getOnCompleteSequenceRef(), nullNS);
/* 84 */     } else if (mediator.getOnCompleteSequence() != null) {
/* 85 */       (new SequenceMediatorSerializer()).serializeChildren(onCompleteElem, mediator.getOnCompleteSequence().getList());
/*    */     } 
/*    */     
/* 88 */     aggregator.addChild((OMNode)onCompleteElem);
/*    */     
/* 90 */     if (parent != null) {
/* 91 */       parent.addChild((OMNode)aggregator);
/*    */     }
/*    */     
/* 94 */     return aggregator;
/*    */   }
/*    */ 
/*    */   
/* 98 */   public String getMediatorClassName() { return AggregateMediator.class.getName(); }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\AggregateMediatorSerializer.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.AnnotatedCommandMediatorFactory,"/*     */ package org.apache.synapse.config.xml;
/*     */ 
/*     */ import java.util.Iterator;
/*     */ import javax.xml.namespace.QName;
/*     */ import org.apache.axiom.om.OMAttribute;
/*     */ import org.apache.axiom.om.OMElement;
/*     */ import org.apache.synapse.Mediator;
/*     */ import org.apache.synapse.SynapseException;
/*     */ import org.apache.synapse.mediators.ext.AnnotatedCommandMediator;
/*     */ import org.apache.synapse.util.xpath.SynapseXPath;
/*     */ import org.jaxen.JaxenException;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class AnnotatedCommandMediatorFactory
/*     */   extends AbstractMediatorFactory
/*     */ {
/*  47 */   private static final QName ANNOTATED_COMMAND_Q = new QName(""http://ws.apache.org/ns/synapse"", ""annotatedCommand"");
/*     */ 
/*     */ 
/*     */   
/*     */   public Mediator createMediator(OMElement elem) {
/*  52 */     AnnotatedCommandMediator pojoMediator = new AnnotatedCommandMediator();
/*     */ 
/*     */     
/*  55 */     OMAttribute name = elem.getAttribute(ATT_NAME);
/*  56 */     if (name == null) {
/*  57 */       String msg = ""The name of the actual POJO command implementation class is a required attribute"";
/*     */       
/*  59 */       log.error(msg);
/*  60 */       throw new SynapseException(msg);
/*     */     } 
/*     */ 
/*     */     
/*     */     try {
/*  65 */       pojoMediator.setCommand(getClass().getClassLoader().loadClass(name.getAttributeValue()));
/*     */     }
/*  67 */     catch (ClassNotFoundException e) {
/*  68 */       handleException(""Unable to load the class specified as the command "" + name.getAttributeValue(), e);
/*     */     } 
/*     */ 
/*     */ 
/*     */ 
/*     */     
/*  74 */     for (Iterator<OMElement> it = elem.getChildElements(); it.hasNext(); ) {
/*  75 */       OMElement child = it.next();
/*  76 */       if (""property"".equals(child.getLocalName())) {
/*     */         
/*  78 */         String propName = child.getAttribute(ATT_NAME).getAttributeValue();
/*  79 */         if (propName == null) {
/*  80 */           handleException(""A POJO command mediator property must specify the name attribute"");
/*     */           continue;
/*     */         } 
/*  83 */         if (child.getAttribute(ATT_EXPRN) != null) {
/*  84 */           SynapseXPath xpath = null;
/*     */           try {
/*  86 */             xpath = SynapseXPathFactory.getSynapseXPath(child, ATT_EXPRN);
/*  87 */             pojoMediator.addMessageSetterProperty(propName, xpath); continue;
/*  88 */           } catch (JaxenException e) {
/*  89 */             handleException(""Error instantiating XPath expression : "" + child.getAttribute(ATT_EXPRN), (Exception)e);
/*     */             continue;
/*     */           } 
/*     */         } 
/*  93 */         if (child.getAttribute(ATT_VALUE) != null) {
/*  94 */           pojoMediator.addStaticSetterProperty(propName, child.getAttribute(ATT_VALUE).getAttributeValue());
/*     */           continue;
/*     */         } 
/*  97 */         handleException(""A POJO mediator property must specify either name and expression attributes, or name and value attributes"");
/*     */       } 
/*     */     } 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */     
/* 105 */     return (Mediator)pojoMediator;
/*     */   }
/*     */ 
/*     */   
/* 109 */   public QName getTagQName() { return ANNOTATED_COMMAND_Q; }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\AnnotatedCommandMediatorFactory.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.AnonymousListMediator,"/*    */ package org.apache.synapse.config.xml;
/*    */ 
/*    */ import org.apache.synapse.MessageContext;
/*    */ import org.apache.synapse.mediators.AbstractListMediator;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class AnonymousListMediator
/*    */   extends AbstractListMediator
/*    */ {
/* 31 */   public boolean mediate(MessageContext synCtx) { return super.mediate(synCtx); }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\AnonymousListMediator.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.AnonymousListMediatorFactory,"/*    */ package org.apache.synapse.config.xml;
/*    */ 
/*    */ import org.apache.axiom.om.OMElement;
/*    */ import org.apache.synapse.mediators.ListMediator;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public abstract class AnonymousListMediatorFactory
/*    */   extends AbstractListMediatorFactory
/*    */ {
/*    */   public static AnonymousListMediator createAnonymousListMediator(OMElement el) {
/* 43 */     AnonymousListMediator mediator = new AnonymousListMediator();
/*    */     
/* 45 */     addChildren(el, (ListMediator)mediator);
/*    */     
/* 47 */     return mediator;
/*    */   }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\AnonymousListMediatorFactory.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.AnonymousListMediatorSerializer,"/*    */ package org.apache.synapse.config.xml;
/*    */ 
/*    */ import org.apache.axiom.om.OMElement;
/*    */ import org.apache.synapse.Mediator;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class AnonymousListMediatorSerializer
/*    */   extends AbstractListMediatorSerializer
/*    */ {
/*    */   public OMElement serializeMediator(OMElement parent, Mediator m) {
/* 41 */     if (!(m instanceof AnonymousListMediator)) {
/* 42 */       handleException(""Unsupported mediator passed in for serialization : "" + m.getType());
/*    */     }
/* 44 */     AnonymousListMediator mediator = (AnonymousListMediator)m;
/* 45 */     serializeChildren(parent, mediator.getList());
/* 46 */     return parent;
/*    */   }
/*    */ 
/*    */   
/* 50 */   public String getMediatorClassName() { return AnonymousListMediator.class.getName(); }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\AnonymousListMediatorSerializer.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.CacheMediatorFactory,"/*     */ package org.apache.synapse.config.xml;
/*     */ 
/*     */ import java.util.Iterator;
/*     */ import javax.xml.namespace.QName;
/*     */ import org.apache.axiom.om.OMAttribute;
/*     */ import org.apache.axiom.om.OMElement;
/*     */ import org.apache.synapse.Mediator;
/*     */ import org.apache.synapse.mediators.builtin.CacheMediator;
/*     */ import org.wso2.caching.digest.DigestGenerator;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class CacheMediatorFactory
/*     */   extends AbstractMediatorFactory
/*     */ {
/*  47 */   private static final QName CACHE_Q = new QName(""http://ws.apache.org/ns/synapse"", ""cache"");
/*  48 */   private static final QName ATT_ID = new QName(""id"");
/*  49 */   private static final QName ATT_COLLECTOR = new QName(""collector"");
/*  50 */   private static final QName ATT_HASH_GENERATOR = new QName(""hashGenerator"");
/*  51 */   private static final QName ATT_MAX_MSG_SIZE = new QName(""maxMessageSize"");
/*  52 */   private static final QName ATT_TIMEOUT = new QName(""timeout"");
/*  53 */   private static final QName ATT_SCOPE = new QName(""scope"");
/*  54 */   private static final QName ATT_SEQUENCE = new QName(""sequence"");
/*  55 */   private static final QName ATT_TYPE = new QName(""type"");
/*  56 */   private static final QName ATT_SIZE = new QName(""maxSize"");
/*  57 */   private static final QName ON_CACHE_HIT_Q = new QName(""http://ws.apache.org/ns/synapse"", ""onCacheHit"");
/*     */   
/*  59 */   private static final QName IMPLEMENTATION_Q = new QName(""http://ws.apache.org/ns/synapse"", ""implementation"");
/*     */   
/*     */   private static final long DEFAULT_TIMEOUT = 5000L;
/*     */   
/*     */   private static final int DEFAULT_DISK_CACHE_SIZE = 200;
/*     */   
/*     */   public Mediator createMediator(OMElement elem) {
/*  66 */     if (!CACHE_Q.equals(elem.getQName())) {
/*  67 */       handleException(""Unable to create the cache mediator. Unexpected element as the cache mediator configuration"");
/*     */     }
/*     */ 
/*     */     
/*  71 */     CacheMediator cache = new CacheMediator();
/*     */     
/*  73 */     OMAttribute idAttr = elem.getAttribute(ATT_ID);
/*  74 */     if (idAttr != null && idAttr.getAttributeValue() != null) {
/*  75 */       cache.setId(idAttr.getAttributeValue());
/*     */     }
/*     */     
/*  78 */     OMAttribute scopeAttr = elem.getAttribute(ATT_SCOPE);
/*  79 */     if (scopeAttr != null && scopeAttr.getAttributeValue() != null && isValidScope(scopeAttr.getAttributeValue(), cache.getId())) {
/*     */       
/*  81 */       cache.setScope(scopeAttr.getAttributeValue());
/*     */     } else {
/*  83 */       cache.setScope(""per-host"");
/*     */     } 
/*     */     
/*  86 */     OMAttribute collectorAttr = elem.getAttribute(ATT_COLLECTOR);
/*  87 */     if (collectorAttr != null && collectorAttr.getAttributeValue() != null && ""true"".equals(collectorAttr.getAttributeValue())) {
/*     */ 
/*     */       
/*  90 */       cache.setCollector(true);
/*     */     } else {
/*     */       
/*  93 */       cache.setCollector(false);
/*     */       
/*  95 */       OMAttribute hashGeneratorAttr = elem.getAttribute(ATT_HASH_GENERATOR);
/*  96 */       if (hashGeneratorAttr != null && hashGeneratorAttr.getAttributeValue() != null) {
/*     */         try {
/*  98 */           Class<?> generator = Class.forName(hashGeneratorAttr.getAttributeValue());
/*  99 */           Object o = generator.newInstance();
/* 100 */           if (o instanceof DigestGenerator) {
/* 101 */             cache.setDigestGenerator((DigestGenerator)o);
/*     */           } else {
/* 103 */             handleException(""Specified class for the hashGenerator is not a DigestGenerator. It *must* implement org.wso2.caching.digest.DigestGenerator interface"");
/*     */           }
/*     */         
/*     */         }
/* 107 */         catch (ClassNotFoundException e) {
/* 108 */           handleException(""Unable to load the hash generator class"", e);
/* 109 */         } catch (IllegalAccessException e) {
/* 110 */           handleException(""Unable to access the hash generator class"", e);
/* 111 */         } catch (InstantiationException e) {
/* 112 */           handleException(""Unable to instantiate the hash generator class"", e);
/*     */         } 
/*     */       }
/*     */       
/* 116 */       OMAttribute timeoutAttr = elem.getAttribute(ATT_TIMEOUT);
/* 117 */       if (timeoutAttr != null && timeoutAttr.getAttributeValue() != null) {
/* 118 */         cache.setTimeout(Long.parseLong(timeoutAttr.getAttributeValue()));
/*     */       } else {
/* 120 */         cache.setTimeout(5000L);
/*     */       } 
/*     */       
/* 123 */       OMAttribute maxMessageSizeAttr = elem.getAttribute(ATT_MAX_MSG_SIZE);
/* 124 */       if (maxMessageSizeAttr != null && maxMessageSizeAttr.getAttributeValue() != null) {
/* 125 */         cache.setMaxMessageSize(Integer.parseInt(maxMessageSizeAttr.getAttributeValue()));
/*     */       }
/*     */       
/* 128 */       OMElement onCacheHitElem = elem.getFirstChildWithName(ON_CACHE_HIT_Q);
/* 129 */       if (onCacheHitElem != null) {
/* 130 */         OMAttribute sequenceAttr = onCacheHitElem.getAttribute(ATT_SEQUENCE);
/* 131 */         if (sequenceAttr != null && sequenceAttr.getAttributeValue() != null) {
/* 132 */           cache.setOnCacheHitRef(sequenceAttr.getAttributeValue());
/* 133 */         } else if (onCacheHitElem.getFirstElement() != null) {
/* 134 */           cache.setOnCacheHitSequence((new SequenceMediatorFactory()).createAnonymousSequence(onCacheHitElem));
/*     */         } 
/*     */       } 
/*     */ 
/*     */       
/* 139 */       for (Iterator<OMElement> itr = elem.getChildrenWithName(IMPLEMENTATION_Q); itr.hasNext(); ) {
/* 140 */         OMElement implElem = itr.next();
/* 141 */         OMAttribute typeAttr = implElem.getAttribute(ATT_TYPE);
/* 142 */         OMAttribute sizeAttr = implElem.getAttribute(ATT_SIZE);
/* 143 */         if (typeAttr != null && typeAttr.getAttributeValue() != null) {
/* 144 */           String type = typeAttr.getAttributeValue();
/* 145 */           if (""memory"".equals(type) && sizeAttr != null && sizeAttr.getAttributeValue() != null) {
/*     */             
/* 147 */             cache.setInMemoryCacheSize(Integer.parseInt(sizeAttr.getAttributeValue())); continue;
/* 148 */           }  if (""disk"".equals(type)) {
/* 149 */             log.warn(""Disk based and hirearchycal caching is not implemented yet"");
/* 150 */             if (sizeAttr != null && sizeAttr.getAttributeValue() != null) {
/* 151 */               cache.setDiskCacheSize(Integer.parseInt(sizeAttr.getAttributeValue())); continue;
/*     */             } 
/* 153 */             cache.setDiskCacheSize(200);
/*     */             continue;
/*     */           } 
/* 156 */           handleException(""unknown implementation type for the Cache mediator"");
/*     */         } 
/*     */       } 
/*     */     } 
/*     */ 
/*     */     
/* 162 */     return (Mediator)cache;
/*     */   }
/*     */   
/*     */   private boolean isValidScope(String scope, String id) {
/* 166 */     if (""per-host"".equals(scope))
/* 167 */       return true; 
/* 168 */     if (""per-mediator"".equals(scope)) {
/* 169 */       if (id != null) {
/* 170 */         return true;
/*     */       }
/* 172 */       handleException(""Id is required for a cache wirth scope : "" + scope);
/* 173 */       return false;
/*     */     } 
/* 175 */     if (""distributed"".equals(scope)) {
/* 176 */       handleException(""Scope distributed is not supported yet by the Cache mediator"");
/* 177 */       return false;
/*     */     } 
/* 179 */     handleException(""Unknown scope "" + scope + "" for the Cache mediator"");
/* 180 */     return false;
/*     */   }
/*     */ 
/*     */ 
/*     */   
/* 185 */   public QName getTagQName() { return CACHE_Q; }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\CacheMediatorFactory.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.CacheMediatorSerializer,"/*     */ package org.apache.synapse.config.xml;
/*     */ 
/*     */ import org.apache.axiom.om.OMElement;
/*     */ import org.apache.axiom.om.OMNode;
/*     */ import org.apache.synapse.Mediator;
/*     */ import org.apache.synapse.mediators.builtin.CacheMediator;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class CacheMediatorSerializer
/*     */   extends AbstractMediatorSerializer
/*     */ {
/*     */   public OMElement serializeMediator(OMElement parent, Mediator m) {
/*  43 */     if (!(m instanceof CacheMediator)) {
/*  44 */       handleException(""Unsupported mediator passed in for serialization : "" + m.getType());
/*     */     }
/*  46 */     CacheMediator mediator = (CacheMediator)m;
/*  47 */     OMElement cache = fac.createOMElement(""cache"", synNS);
/*  48 */     saveTracingState(cache, (Mediator)mediator);
/*     */     
/*  50 */     if (mediator.getId() != null) {
/*  51 */       cache.addAttribute(fac.createOMAttribute(""id"", nullNS, mediator.getId()));
/*     */     }
/*     */     
/*  54 */     if (mediator.getScope() != null) {
/*  55 */       cache.addAttribute(fac.createOMAttribute(""scope"", nullNS, mediator.getScope()));
/*     */     }
/*     */     
/*  58 */     if (mediator.isCollector()) {
/*  59 */       cache.addAttribute(fac.createOMAttribute(""collector"", nullNS, ""true""));
/*     */     } else {
/*     */       
/*  62 */       cache.addAttribute(fac.createOMAttribute(""collector"", nullNS, ""false""));
/*     */       
/*  64 */       if (mediator.getDigestGenerator() != null) {
/*  65 */         cache.addAttribute(fac.createOMAttribute(""hashGenerator"", nullNS, mediator.getDigestGenerator().getClass().getName()));
/*     */       }
/*     */ 
/*     */       
/*  69 */       if (mediator.getTimeout() != 0L) {
/*  70 */         cache.addAttribute(fac.createOMAttribute(""timeout"", nullNS, Long.toString(mediator.getTimeout())));
/*     */       }
/*     */ 
/*     */       
/*  74 */       if (mediator.getMaxMessageSize() != 0) {
/*  75 */         cache.addAttribute(fac.createOMAttribute(""maxMessageSize"", nullNS, Integer.toString(mediator.getMaxMessageSize())));
/*     */       }
/*     */ 
/*     */ 
/*     */       
/*  80 */       if (mediator.getOnCacheHitRef() != null) {
/*  81 */         OMElement onCacheHit = fac.createOMElement(""onCacheHit"", synNS);
/*  82 */         onCacheHit.addAttribute(fac.createOMAttribute(""sequence"", nullNS, mediator.getOnCacheHitRef()));
/*     */         
/*  84 */         cache.addChild((OMNode)onCacheHit);
/*  85 */       } else if (mediator.getOnCacheHitSequence() != null) {
/*  86 */         OMElement onCacheHit = fac.createOMElement(""onCacheHit"", synNS);
/*  87 */         (new SequenceMediatorSerializer()).serializeChildren(onCacheHit, mediator.getOnCacheHitSequence().getList());
/*     */         
/*  89 */         cache.addChild((OMNode)onCacheHit);
/*     */       } 
/*     */       
/*  92 */       if (mediator.getInMemoryCacheSize() != 0) {
/*  93 */         OMElement implElem = fac.createOMElement(""implementation"", synNS);
/*  94 */         implElem.addAttribute(fac.createOMAttribute(""type"", nullNS, ""memory""));
/*  95 */         implElem.addAttribute(fac.createOMAttribute(""maxSize"", nullNS, Integer.toString(mediator.getInMemoryCacheSize())));
/*     */         
/*  97 */         cache.addChild((OMNode)implElem);
/*     */       } 
/*     */       
/* 100 */       if (mediator.getDiskCacheSize() != 0) {
/* 101 */         OMElement implElem = fac.createOMElement(""implementation"", synNS);
/* 102 */         implElem.addAttribute(fac.createOMAttribute(""type"", nullNS, ""disk""));
/* 103 */         implElem.addAttribute(fac.createOMAttribute(""maxSize"", nullNS, Integer.toString(mediator.getDiskCacheSize())));
/*     */         
/* 105 */         cache.addChild((OMNode)implElem);
/*     */       } 
/*     */     } 
/*     */     
/* 109 */     if (parent != null) {
/* 110 */       parent.addChild((OMNode)cache);
/*     */     }
/*     */     
/* 113 */     return cache;
/*     */   }
/*     */ 
/*     */   
/* 117 */   public String getMediatorClassName() { return CacheMediator.class.getName(); }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\CacheMediatorSerializer.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.CalloutMediatorFactory,"/*     */ package org.apache.synapse.config.xml;
/*     */ 
/*     */ import javax.xml.namespace.QName;
/*     */ import org.apache.axiom.om.OMAttribute;
/*     */ import org.apache.axiom.om.OMElement;
/*     */ import org.apache.synapse.Mediator;
/*     */ import org.apache.synapse.mediators.builtin.CalloutMediator;
/*     */ import org.jaxen.JaxenException;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class CalloutMediatorFactory
/*     */   extends AbstractMediatorFactory
/*     */ {
/*  43 */   private static final QName TAG_NAME = new QName(""http://ws.apache.org/ns/synapse"", ""callout"");
/*     */   
/*  45 */   private static final QName ATT_URL = new QName(""serviceURL"");
/*  46 */   private static final QName ATT_ACTION = new QName(""action"");
/*  47 */   private static final QName ATT_AXIS2XML = new QName(""axis2xml"");
/*  48 */   private static final QName ATT_REPOSITORY = new QName(""repository"");
/*  49 */   private static final QName Q_CONFIG = new QName(""http://ws.apache.org/ns/synapse"", ""configuration"");
/*     */   
/*  51 */   private static final QName Q_SOURCE = new QName(""http://ws.apache.org/ns/synapse"", ""source"");
/*     */   
/*  53 */   private static final QName Q_TARGET = new QName(""http://ws.apache.org/ns/synapse"", ""target"");
/*     */ 
/*     */ 
/*     */   
/*     */   public Mediator createMediator(OMElement elem) {
/*  58 */     CalloutMediator callout = new CalloutMediator();
/*     */     
/*  60 */     OMAttribute attServiceURL = elem.getAttribute(ATT_URL);
/*  61 */     OMAttribute attAction = elem.getAttribute(ATT_ACTION);
/*  62 */     OMElement configElt = elem.getFirstChildWithName(Q_CONFIG);
/*  63 */     OMElement sourceElt = elem.getFirstChildWithName(Q_SOURCE);
/*  64 */     OMElement targetElt = elem.getFirstChildWithName(Q_TARGET);
/*     */     
/*  66 */     if (attServiceURL != null) {
/*  67 */       callout.setServiceURL(attServiceURL.getAttributeValue());
/*     */     } else {
/*  69 */       handleException(""The 'serviceURL' attribute is required for the Callout mediator"");
/*     */     } 
/*     */     
/*  72 */     if (attAction != null) {
/*  73 */       callout.setAction(attAction.getAttributeValue());
/*     */     }
/*     */     
/*  76 */     if (configElt != null) {
/*     */       
/*  78 */       OMAttribute axis2xmlAttr = configElt.getAttribute(ATT_AXIS2XML);
/*  79 */       OMAttribute repoAttr = configElt.getAttribute(ATT_REPOSITORY);
/*     */       
/*  81 */       if (axis2xmlAttr != null && axis2xmlAttr.getAttributeValue() != null) {
/*  82 */         callout.setAxis2xml(axis2xmlAttr.getAttributeValue());
/*     */       }
/*     */       
/*  85 */       if (repoAttr != null && repoAttr.getAttributeValue() != null) {
/*  86 */         callout.setClientRepository(repoAttr.getAttributeValue());
/*     */       }
/*     */     } 
/*     */     
/*  90 */     if (sourceElt != null) {
/*  91 */       if (sourceElt.getAttribute(ATT_XPATH) != null) {
/*     */         try {
/*  93 */           callout.setRequestXPath(SynapseXPathFactory.getSynapseXPath(sourceElt, ATT_XPATH));
/*     */         }
/*  95 */         catch (JaxenException e) {
/*  96 */           handleException(""Invalid source XPath : "" + sourceElt.getAttributeValue(ATT_XPATH));
/*     */         }
/*     */       
/*  99 */       } else if (sourceElt.getAttribute(ATT_KEY) != null) {
/* 100 */         callout.setRequestKey(sourceElt.getAttributeValue(ATT_KEY));
/*     */       } else {
/* 102 */         handleException(""A 'xpath' or 'key' attribute is required for the Callout 'source'"");
/*     */       } 
/*     */     } else {
/*     */       
/* 106 */       handleException(""The message 'source' must be specified for a Callout mediator"");
/*     */     } 
/*     */     
/* 109 */     if (targetElt != null) {
/* 110 */       if (targetElt.getAttribute(ATT_XPATH) != null) {
/*     */         try {
/* 112 */           callout.setTargetXPath(SynapseXPathFactory.getSynapseXPath(targetElt, ATT_XPATH));
/*     */         }
/* 114 */         catch (JaxenException e) {
/* 115 */           handleException(""Invalid target XPath : "" + targetElt.getAttributeValue(ATT_XPATH));
/*     */         }
/*     */       
/* 118 */       } else if (targetElt.getAttribute(ATT_KEY) != null) {
/* 119 */         callout.setTargetKey(targetElt.getAttributeValue(ATT_KEY));
/*     */       } else {
/* 121 */         handleException(""A 'xpath' or 'key' attribute is required for the Callout 'target'"");
/*     */       } 
/*     */     } else {
/*     */       
/* 125 */       handleException(""The message 'target' must be specified for a Callout mediator"");
/*     */     } 
/*     */     
/* 128 */     return (Mediator)callout;
/*     */   }
/*     */ 
/*     */   
/* 132 */   public QName getTagQName() { return TAG_NAME; }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\CalloutMediatorFactory.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.CalloutMediatorSerializer,"/*    */ package org.apache.synapse.config.xml;
/*    */ 
/*    */ import org.apache.axiom.om.OMContainer;
/*    */ import org.apache.axiom.om.OMElement;
/*    */ import org.apache.axiom.om.OMNode;
/*    */ import org.apache.synapse.Mediator;
/*    */ import org.apache.synapse.mediators.builtin.CalloutMediator;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class CalloutMediatorSerializer
/*    */   extends AbstractMediatorSerializer
/*    */ {
/*    */   public OMElement serializeMediator(OMElement parent, Mediator m) {
/* 39 */     if (!(m instanceof CalloutMediator)) {
/* 40 */       handleException(""Unsupported mediator passed in for serialization : "" + m.getType());
/*    */     }
/*    */     
/* 43 */     CalloutMediator mediator = (CalloutMediator)m;
/* 44 */     OMElement callout = fac.createOMElement(""callout"", synNS);
/* 45 */     saveTracingState(callout, (Mediator)mediator);
/*    */     
/* 47 */     callout.addAttribute(fac.createOMAttribute(""serviceURL"", nullNS, mediator.getServiceURL()));
/* 48 */     if (mediator.getAction() != null) {
/* 49 */       callout.addAttribute(fac.createOMAttribute(""action"", nullNS, mediator.getAction()));
/*    */     }
/*    */     
/* 52 */     if (mediator.getClientRepository() != null || mediator.getAxis2xml() != null) {
/* 53 */       OMElement config = fac.createOMElement(""configuration"", synNS);
/* 54 */       if (mediator.getClientRepository() != null) {
/* 55 */         config.addAttribute(fac.createOMAttribute(""repository"", nullNS, mediator.getClientRepository()));
/*    */       }
/*    */       
/* 58 */       if (mediator.getAxis2xml() != null) {
/* 59 */         config.addAttribute(fac.createOMAttribute(""axis2xml"", nullNS, mediator.getAxis2xml()));
/*    */       }
/*    */       
/* 62 */       callout.addChild((OMNode)config);
/*    */     } 
/*    */     
/* 65 */     OMElement source = fac.createOMElement(""source"", synNS, (OMContainer)callout);
/* 66 */     if (mediator.getRequestXPath() != null) {
/* 67 */       SynapseXPathSerializer.serializeXPath(mediator.getRequestXPath(), source, ""xpath"");
/* 68 */     } else if (mediator.getRequestKey() != null) {
/* 69 */       source.addAttribute(fac.createOMAttribute(""key"", nullNS, mediator.getRequestKey()));
/*    */     } 
/*    */ 
/*    */     
/* 73 */     OMElement target = fac.createOMElement(""target"", synNS, (OMContainer)callout);
/* 74 */     if (mediator.getTargetXPath() != null) {
/* 75 */       SynapseXPathSerializer.serializeXPath(mediator.getTargetXPath(), target, ""xpath"");
/* 76 */     } else if (mediator.getTargetKey() != null) {
/* 77 */       target.addAttribute(fac.createOMAttribute(""key"", nullNS, mediator.getTargetKey()));
/*    */     } 
/*    */ 
/*    */     
/* 81 */     if (parent != null) {
/* 82 */       parent.addChild((OMNode)callout);
/*    */     }
/* 84 */     return callout;
/*    */   }
/*    */ 
/*    */   
/* 88 */   public String getMediatorClassName() { return CalloutMediator.class.getName(); }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\CalloutMediatorSerializer.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.ClassMediatorFactory,"/*     */ package org.apache.synapse.config.xml;
/*     */ 
/*     */ import java.util.Iterator;
/*     */ import javax.xml.namespace.QName;
/*     */ import org.apache.axiom.om.OMAttribute;
/*     */ import org.apache.axiom.om.OMElement;
/*     */ import org.apache.synapse.Mediator;
/*     */ import org.apache.synapse.SynapseException;
/*     */ import org.apache.synapse.mediators.ext.ClassMediator;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class ClassMediatorFactory
/*     */   extends AbstractMediatorFactory
/*     */ {
/*  47 */   private static final QName CLASS_Q = new QName(""http://ws.apache.org/ns/synapse"", ""class"");
/*     */ 
/*     */   
/*     */   public Mediator createMediator(OMElement elem) {
/*  51 */     ClassMediator classMediator = new ClassMediator();
/*     */     
/*  53 */     OMAttribute name = elem.getAttribute(ATT_NAME);
/*  54 */     if (name == null) {
/*  55 */       String msg = ""The name of the actual mediator class is a required attribute"";
/*  56 */       log.error(msg);
/*  57 */       throw new SynapseException(msg);
/*     */     } 
/*  59 */     Class<?> clazz = null;
/*  60 */     Mediator m = null;
/*     */     try {
/*  62 */       clazz = getClass().getClassLoader().loadClass(name.getAttributeValue());
/*     */       
/*  64 */       m = (Mediator)clazz.newInstance();
/*  65 */     } catch (Exception e) {
/*  66 */       String msg = ""Error : "" + name.getAttributeValue();
/*  67 */       log.error(msg, e);
/*  68 */       throw new SynapseException(msg, e);
/*     */     } 
/*     */     
/*  71 */     for (Iterator<OMElement> it = elem.getChildrenWithName(PROP_Q); it.hasNext(); ) {
/*  72 */       OMElement child = it.next();
/*     */       
/*  74 */       String propName = child.getAttribute(ATT_NAME).getAttributeValue();
/*  75 */       if (propName == null) {
/*  76 */         handleException(""A Class mediator property must specify the name attribute"");
/*     */         continue;
/*     */       } 
/*  79 */       if (child.getAttribute(ATT_VALUE) != null) {
/*  80 */         String value = child.getAttribute(ATT_VALUE).getAttributeValue();
/*  81 */         classMediator.addProperty(propName, value);
/*  82 */         PropertyHelper.setInstanceProperty(propName, value, m); continue;
/*     */       } 
/*  84 */       OMElement oMElement = child.getFirstElement();
/*  85 */       if (oMElement != null) {
/*  86 */         classMediator.addProperty(propName, oMElement);
/*  87 */         PropertyHelper.setInstanceProperty(propName, oMElement, m); continue;
/*     */       } 
/*  89 */       handleException(""A Class mediator property must specify name and value attributes, or a name and a child XML fragment"");
/*     */     } 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */     
/*  98 */     classMediator.setMediator(m);
/*  99 */     processTraceState((Mediator)classMediator, elem);
/*     */     
/* 101 */     return (Mediator)classMediator;
/*     */   }
/*     */ 
/*     */   
/* 105 */   public QName getTagQName() { return CLASS_Q; }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\ClassMediatorFactory.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.ClassMediatorSerializer,"/*    */ package org.apache.synapse.config.xml;
/*    */ 
/*    */ import java.util.Iterator;
/*    */ import org.apache.axiom.om.OMElement;
/*    */ import org.apache.axiom.om.OMNode;
/*    */ import org.apache.synapse.Mediator;
/*    */ import org.apache.synapse.mediators.ext.ClassMediator;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class ClassMediatorSerializer
/*    */   extends AbstractMediatorSerializer
/*    */ {
/*    */   public OMElement serializeMediator(OMElement parent, Mediator m) {
/* 43 */     if (!(m instanceof ClassMediator)) {
/* 44 */       handleException(""Unsupported mediator passed in for serialization : "" + m.getType());
/*    */     }
/* 46 */     ClassMediator mediator = (ClassMediator)m;
/* 47 */     OMElement clazz = fac.createOMElement(""class"", synNS);
/* 48 */     saveTracingState(clazz, (Mediator)mediator);
/*    */     
/* 50 */     if (mediator.getMediator() != null && mediator.getMediator().getClass().getName() != null) {
/* 51 */       clazz.addAttribute(fac.createOMAttribute(""name"", nullNS, mediator.getMediator().getClass().getName()));
/*    */     } else {
/*    */       
/* 54 */       handleException(""Invalid class mediator. The class name is required"");
/*    */     } 
/*    */     
/* 57 */     Iterator<String> itr = mediator.getProperties().keySet().iterator();
/* 58 */     while (itr.hasNext()) {
/* 59 */       String propName = itr.next();
/* 60 */       Object o = mediator.getProperties().get(propName);
/* 61 */       OMElement prop = fac.createOMElement(PROP_Q);
/* 62 */       prop.addAttribute(fac.createOMAttribute(""name"", nullNS, propName));
/*    */       
/* 64 */       if (o instanceof String) {
/* 65 */         prop.addAttribute(fac.createOMAttribute(""value"", nullNS, (String)o));
/*    */       } else {
/* 67 */         prop.addChild((OMNode)o);
/*    */       } 
/* 69 */       clazz.addChild((OMNode)prop);
/*    */     } 
/*    */     
/* 72 */     if (parent != null) {
/* 73 */       parent.addChild((OMNode)clazz);
/*    */     }
/* 75 */     return clazz;
/*    */   }
/*    */ 
/*    */   
/* 79 */   public String getMediatorClassName() { return ClassMediator.class.getName(); }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\ClassMediatorSerializer.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.CloneMediatorFactory,"/*    */ package org.apache.synapse.config.xml;
/*    */ 
/*    */ import java.util.Iterator;
/*    */ import javax.xml.namespace.QName;
/*    */ import org.apache.axiom.om.OMAttribute;
/*    */ import org.apache.axiom.om.OMElement;
/*    */ import org.apache.synapse.Mediator;
/*    */ import org.apache.synapse.mediators.eip.splitter.CloneMediator;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class CloneMediatorFactory
/*    */   extends AbstractMediatorFactory
/*    */ {
/* 53 */   private static final QName CLONE_Q = new QName(""http://ws.apache.org/ns/synapse"", ""clone"");
/* 54 */   private static final QName ATT_CONTPAR = new QName(""continueParent"");
/* 55 */   private static final QName TARGET_Q = new QName(""http://ws.apache.org/ns/synapse"", ""target"");
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */   
/*    */   public Mediator createMediator(OMElement elem) {
/* 66 */     CloneMediator mediator = new CloneMediator();
/* 67 */     processTraceState((Mediator)mediator, elem);
/*    */     
/* 69 */     OMAttribute continueParent = elem.getAttribute(ATT_CONTPAR);
/* 70 */     if (continueParent != null) {
/* 71 */       mediator.setContinueParent(Boolean.valueOf(continueParent.getAttributeValue()).booleanValue());
/*    */     }
/*    */ 
/*    */     
/* 75 */     Iterator<OMElement> targetElements = elem.getChildrenWithName(TARGET_Q);
/* 76 */     while (targetElements.hasNext()) {
/* 77 */       mediator.addTarget(TargetFactory.createTarget(targetElements.next()));
/*    */     }
/*    */     
/* 80 */     return (Mediator)mediator;
/*    */   }
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */   
/* 89 */   public QName getTagQName() { return CLONE_Q; }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\CloneMediatorFactory.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.CloneMediatorSerializer,"/*    */ package org.apache.synapse.config.xml;
/*    */ 
/*    */ import java.util.Iterator;
/*    */ import org.apache.axiom.om.OMElement;
/*    */ import org.apache.axiom.om.OMNode;
/*    */ import org.apache.synapse.Mediator;
/*    */ import org.apache.synapse.mediators.eip.Target;
/*    */ import org.apache.synapse.mediators.eip.splitter.CloneMediator;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class CloneMediatorSerializer
/*    */   extends AbstractMediatorSerializer
/*    */ {
/*    */   public OMElement serializeMediator(OMElement parent, Mediator m) {
/* 59 */     OMElement cloneElem = fac.createOMElement(""clone"", synNS);
/* 60 */     saveTracingState(cloneElem, m);
/*    */     
/* 62 */     CloneMediator clone = (CloneMediator)m;
/* 63 */     if (clone.isContinueParent()) {
/* 64 */       cloneElem.addAttribute(""continueParent"", Boolean.toString(true), nullNS);
/*    */     }
/*    */     
/* 67 */     for (Iterator itr = clone.getTargets().iterator(); itr.hasNext(); ) {
/* 68 */       Object o = itr.next();
/* 69 */       if (o instanceof Target) {
/* 70 */         cloneElem.addChild((OMNode)TargetSerializer.serializeTarget((Target)o));
/*    */       }
/*    */     } 
/*    */ 
/*    */     
/* 75 */     if (parent != null) {
/* 76 */       parent.addChild((OMNode)cloneElem);
/*    */     }
/*    */     
/* 79 */     return cloneElem;
/*    */   }
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */   
/* 89 */   public String getMediatorClassName() { return CloneMediator.class.getName(); }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\CloneMediatorSerializer.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.ConfigurationFactory,"package org.apache.synapse.config.xml;
import javax.xml.namespace.QName;
import org.apache.axiom.om.OMElement;
import org.apache.synapse.config.SynapseConfiguration;
public interface ConfigurationFactory {
  QName getTagQName();
  SynapseConfiguration getConfiguration(OMElement paramOMElement);
  Class getSerializerClass();
}
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\ConfigurationFactory.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.ConfigurationFactoryAndSerializerFinder,"/*     */ package org.apache.synapse.config.xml;
/*     */ 
/*     */ import java.util.HashMap;
/*     */ import java.util.Iterator;
/*     */ import java.util.Map;
/*     */ import javax.xml.namespace.QName;
/*     */ import org.apache.axiom.om.OMElement;
/*     */ import org.apache.axiom.om.OMNode;
/*     */ import org.apache.commons.logging.Log;
/*     */ import org.apache.commons.logging.LogFactory;
/*     */ import org.apache.synapse.SynapseException;
/*     */ import org.apache.synapse.config.SynapseConfiguration;
/*     */ import org.apache.synapse.config.XMLToObjectMapper;
/*     */ import sun.misc.Service;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class ConfigurationFactoryAndSerializerFinder
/*     */   implements XMLToObjectMapper
/*     */ {
/*  47 */   private static final Log log = LogFactory.getLog(ConfigurationFactoryAndSerializerFinder.class);
/*     */ 
/*     */   
/*  50 */   private static final Class[] configurationFactories = new Class[] { SynapseXMLConfigurationFactory.class };
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  55 */   private static ConfigurationFactoryAndSerializerFinder instance = null;
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  60 */   private static Map factoryMap = new HashMap<Object, Object>();
/*     */   
/*  62 */   private static Map serializerMap = new HashMap<Object, Object>();
/*     */   
/*     */   public static synchronized ConfigurationFactoryAndSerializerFinder getInstance() {
/*  65 */     if (instance == null) {
/*  66 */       instance = new ConfigurationFactoryAndSerializerFinder();
/*     */     }
/*  68 */     return instance;
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public synchronized void reset() {
/*  75 */     factoryMap.clear();
/*  76 */     instance = null;
/*     */   }
/*     */ 
/*     */   
/*     */   private ConfigurationFactoryAndSerializerFinder() {
/*  81 */     factoryMap = new HashMap<Object, Object>();
/*     */     
/*  83 */     for (int i = 0; i < configurationFactories.length; i++) {
/*  84 */       Class<ConfigurationFactory> c = configurationFactories[i];
/*     */       try {
/*  86 */         ConfigurationFactory fac = c.newInstance();
/*  87 */         factoryMap.put(fac.getTagQName(), c);
/*  88 */         serializerMap.put(fac.getTagQName(), fac.getSerializerClass());
/*  89 */       } catch (Exception e) {
/*  90 */         throw new SynapseException(""Error instantiating "" + c.getName(), e);
/*     */       } 
/*     */     } 
/*     */     
/*  94 */     registerExtensions();
/*     */   }
/*     */   
/*     */   private void handleException(String msg, Exception e) {
/*  98 */     log.error(msg, e);
/*  99 */     throw new SynapseException(msg, e);
/*     */   }
/*     */   
/*     */   private void handleException(String msg) {
/* 103 */     log.error(msg);
/* 104 */     throw new SynapseException(msg);
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   private void registerExtensions() {
/* 116 */     Iterator<ConfigurationFactory> it = Service.providers(ConfigurationFactory.class);
/* 117 */     while (it.hasNext()) {
/* 118 */       ConfigurationFactory cf = it.next();
/* 119 */       QName tag = cf.getTagQName();
/* 120 */       factoryMap.put(tag, cf.getClass());
/* 121 */       serializerMap.put(tag, cf.getSerializerClass());
/* 122 */       if (log.isDebugEnabled()) {
/* 123 */         log.debug(""Added MediatorFactory "" + cf.getClass() + "" to handle "" + tag);
/*     */       }
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public SynapseConfiguration getConfiguration(OMElement element) {
/* 138 */     String localName = element.getLocalName();
/* 139 */     QName qName = null;
/* 140 */     if (element.getNamespace() != null) {
/* 141 */       qName = new QName(element.getNamespace().getNamespaceURI(), localName);
/*     */     } else {
/* 143 */       qName = new QName(localName);
/*     */     } 
/* 145 */     if (log.isDebugEnabled()) {
/* 146 */       log.debug(""getConfiguration("" + qName + "")"");
/*     */     }
/* 148 */     Class<ConfigurationFactory> cls = (Class)factoryMap.get(qName);
/*     */ 
/*     */     
/* 151 */     if (cls == null) {
/* 152 */       String msg = ""Unknown Configuration type referenced by configuration element : "" + qName;
/*     */       
/* 154 */       log.error(msg);
/* 155 */       throw new SynapseException(msg);
/*     */     } 
/*     */     
/*     */     try {
/* 159 */       ConfigurationFactory cf = cls.newInstance();
/* 160 */       return cf.getConfiguration(element);
/*     */     }
/* 162 */     catch (InstantiationException e) {
/* 163 */       String msg = ""Error initializing configuration factory : "" + cls;
/* 164 */       log.error(msg);
/* 165 */       throw new SynapseException(msg, e);
/*     */     }
/* 167 */     catch (IllegalAccessException e) {
/* 168 */       String msg = ""Error initializing configuration factory : "" + cls;
/* 169 */       log.error(msg);
/* 170 */       throw new SynapseException(msg, e);
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public static OMElement serializeConfiguration(SynapseConfiguration synCfg) {
/* 179 */     if (synCfg.getDefaultQName() == null) {
/* 180 */       return serializeConfiguration(synCfg, XMLConfigConstants.DEFINITIONS_ELT);
/*     */     }
/* 182 */     return serializeConfiguration(synCfg, synCfg.getDefaultQName());
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public static OMElement serializeConfiguration(SynapseConfiguration synCfg, QName qName) {
/* 196 */     Class<ConfigurationSerializer> cls = (Class)serializerMap.get(qName);
/* 197 */     if (cls == null) {
/* 198 */       String msg = ""Unknown Configuration type referenced by configuration element : "" + qName;
/*     */       
/* 200 */       log.error(msg);
/* 201 */       throw new SynapseException(msg);
/*     */     } 
/*     */     
/*     */     try {
/* 205 */       ConfigurationSerializer cs = cls.newInstance();
/* 206 */       return cs.serializeConfiguration(synCfg);
/*     */     }
/* 208 */     catch (InstantiationException e) {
/* 209 */       String msg = ""Error initializing configuration factory : "" + cls;
/* 210 */       log.error(msg);
/* 211 */       throw new SynapseException(msg, e);
/*     */     }
/* 213 */     catch (IllegalAccessException e) {
/* 214 */       String msg = ""Error initializing configuration factory : "" + cls;
/* 215 */       log.error(msg);
/* 216 */       throw new SynapseException(msg, e);
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 226 */   public Map getFactoryMap() { return factoryMap; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 235 */   public static Map getSerializerMap() { return serializerMap; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public Object getObjectFromOMNode(OMNode om) {
/* 246 */     if (om instanceof OMElement) {
/* 247 */       return getConfiguration((OMElement)om);
/*     */     }
/* 249 */     handleException(""Invalid configuration XML : "" + om);
/*     */     
/* 251 */     return null;
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\ConfigurationFactoryAndSerializerFinder.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.ConfigurationSerializer,"package org.apache.synapse.config.xml;
import javax.xml.namespace.QName;
import org.apache.axiom.om.OMElement;
import org.apache.synapse.config.SynapseConfiguration;
public interface ConfigurationSerializer {
  OMElement serializeConfiguration(SynapseConfiguration paramSynapseConfiguration);
  QName getTagQName();
}
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\ConfigurationSerializer.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.DBLookupMediatorFactory,"/*    */ package org.apache.synapse.config.xml;
/*    */ 
/*    */ import javax.xml.namespace.QName;
/*    */ import org.apache.axiom.om.OMElement;
/*    */ import org.apache.synapse.Mediator;
/*    */ import org.apache.synapse.mediators.db.AbstractDBMediator;
/*    */ import org.apache.synapse.mediators.db.DBLookupMediator;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class DBLookupMediatorFactory
/*    */   extends AbstractDBMediatorFactory
/*    */ {
/* 62 */   private static final QName DBLOOKUP_Q = new QName(""http://ws.apache.org/ns/synapse"", ""dblookup"");
/*    */ 
/*    */ 
/*    */   
/*    */   public Mediator createMediator(OMElement elem) {
/* 67 */     DBLookupMediator mediator = new DBLookupMediator();
/* 68 */     buildDataSource(elem, (AbstractDBMediator)mediator);
/* 69 */     processStatements(elem, (AbstractDBMediator)mediator);
/* 70 */     return (Mediator)mediator;
/*    */   }
/*    */ 
/*    */   
/* 74 */   public QName getTagQName() { return DBLOOKUP_Q; }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\DBLookupMediatorFactory.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.DBLookupMediatorSerializer,"/*    */ package org.apache.synapse.config.xml;
/*    */ 
/*    */ import org.apache.axiom.om.OMElement;
/*    */ import org.apache.axiom.om.OMNode;
/*    */ import org.apache.synapse.Mediator;
/*    */ import org.apache.synapse.mediators.db.AbstractDBMediator;
/*    */ import org.apache.synapse.mediators.db.DBLookupMediator;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class DBLookupMediatorSerializer
/*    */   extends AbstractDBMediatorSerializer
/*    */ {
/*    */   public OMElement serializeMediator(OMElement parent, Mediator m) {
/* 35 */     if (!(m instanceof DBLookupMediator)) {
/* 36 */       handleException(""Unsupported mediator passed in for serialization : "" + m.getType());
/*    */     }
/*    */     
/* 39 */     DBLookupMediator mediator = (DBLookupMediator)m;
/* 40 */     OMElement dbLookup = fac.createOMElement(""dblookup"", synNS);
/* 41 */     saveTracingState(dbLookup, (Mediator)mediator);
/* 42 */     serializeDBInformation((AbstractDBMediator)mediator, dbLookup);
/*    */     
/* 44 */     if (parent != null) {
/* 45 */       parent.addChild((OMNode)dbLookup);
/*    */     }
/* 47 */     return dbLookup;
/*    */   }
/*    */ 
/*    */   
/* 51 */   public String getMediatorClassName() { return DBLookupMediator.class.getName(); }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\DBLookupMediatorSerializer.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.DBReportMediatorFactory,"/*    */ package org.apache.synapse.config.xml;
/*    */ 
/*    */ import javax.xml.namespace.QName;
/*    */ import org.apache.axiom.om.OMElement;
/*    */ import org.apache.synapse.Mediator;
/*    */ import org.apache.synapse.mediators.db.AbstractDBMediator;
/*    */ import org.apache.synapse.mediators.db.DBReportMediator;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class DBReportMediatorFactory
/*    */   extends AbstractDBMediatorFactory
/*    */ {
/* 59 */   private static final QName DBREPORT_Q = new QName(""http://ws.apache.org/ns/synapse"", ""dbreport"");
/*    */ 
/*    */   
/*    */   public Mediator createMediator(OMElement elem) {
/* 63 */     DBReportMediator mediator = new DBReportMediator();
/* 64 */     buildDataSource(elem, (AbstractDBMediator)mediator);
/* 65 */     processStatements(elem, (AbstractDBMediator)mediator);
/* 66 */     return (Mediator)mediator;
/*    */   }
/*    */ 
/*    */   
/* 70 */   public QName getTagQName() { return DBREPORT_Q; }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\DBReportMediatorFactory.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.DBReportMediatorSerializer,"/*    */ package org.apache.synapse.config.xml;
/*    */ 
/*    */ import org.apache.axiom.om.OMElement;
/*    */ import org.apache.axiom.om.OMNode;
/*    */ import org.apache.synapse.Mediator;
/*    */ import org.apache.synapse.mediators.db.AbstractDBMediator;
/*    */ import org.apache.synapse.mediators.db.DBReportMediator;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class DBReportMediatorSerializer
/*    */   extends AbstractDBMediatorSerializer
/*    */ {
/*    */   public OMElement serializeMediator(OMElement parent, Mediator m) {
/* 35 */     if (!(m instanceof DBReportMediator)) {
/* 36 */       handleException(""Unsupported mediator passed in for serialization : "" + m.getType());
/*    */     }
/*    */     
/* 39 */     DBReportMediator mediator = (DBReportMediator)m;
/* 40 */     OMElement dbReport = fac.createOMElement(""dbreport"", synNS);
/* 41 */     saveTracingState(dbReport, (Mediator)mediator);
/* 42 */     serializeDBInformation((AbstractDBMediator)mediator, dbReport);
/*    */     
/* 44 */     if (parent != null) {
/* 45 */       parent.addChild((OMNode)dbReport);
/*    */     }
/* 47 */     return dbReport;
/*    */   }
/*    */ 
/*    */   
/* 51 */   public String getMediatorClassName() { return DBReportMediator.class.getName(); }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\DBReportMediatorSerializer.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.DropMediatorFactory,"/*    */ package org.apache.synapse.config.xml;
/*    */ 
/*    */ import javax.xml.namespace.QName;
/*    */ import org.apache.axiom.om.OMElement;
/*    */ import org.apache.synapse.Mediator;
/*    */ import org.apache.synapse.mediators.builtin.DropMediator;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class DropMediatorFactory
/*    */   extends AbstractMediatorFactory
/*    */ {
/* 38 */   private static final QName DROP_Q = new QName(""http://ws.apache.org/ns/synapse"", ""drop"");
/*    */ 
/*    */   
/*    */   public Mediator createMediator(OMElement el) {
/* 42 */     DropMediator dropMediator1 = new DropMediator();
/*    */ 
/*    */     
/* 45 */     processTraceState((Mediator)dropMediator1, el);
/*    */     
/* 47 */     return (Mediator)dropMediator1;
/*    */   }
/*    */ 
/*    */   
/* 51 */   public QName getTagQName() { return DROP_Q; }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\DropMediatorFactory.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.DropMediatorSerializer,"/*    */ package org.apache.synapse.config.xml;
/*    */ 
/*    */ import org.apache.axiom.om.OMElement;
/*    */ import org.apache.axiom.om.OMNode;
/*    */ import org.apache.synapse.Mediator;
/*    */ import org.apache.synapse.mediators.builtin.DropMediator;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class DropMediatorSerializer
/*    */   extends AbstractMediatorSerializer
/*    */ {
/*    */   public OMElement serializeMediator(OMElement parent, Mediator m) {
/* 35 */     if (!(m instanceof DropMediator)) {
/* 36 */       handleException(""Unsupported mediator passed in for serialization : "" + m.getType());
/*    */     }
/*    */     
/* 39 */     DropMediator mediator = (DropMediator)m;
/* 40 */     OMElement drop = fac.createOMElement(""drop"", synNS);
/* 41 */     saveTracingState(drop, (Mediator)mediator);
/*    */     
/* 43 */     if (parent != null) {
/* 44 */       parent.addChild((OMNode)drop);
/*    */     }
/* 46 */     return drop;
/*    */   }
/*    */ 
/*    */   
/* 50 */   public String getMediatorClassName() { return DropMediator.class.getName(); }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\DropMediatorSerializer.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.EntryFactory,"/*    */ package org.apache.synapse.config.xml;
/*    */ 
/*    */ import java.net.MalformedURLException;
/*    */ import java.net.URL;
/*    */ import javax.xml.namespace.QName;
/*    */ import org.apache.axiom.om.OMAttribute;
/*    */ import org.apache.axiom.om.OMElement;
/*    */ import org.apache.axiom.om.OMNode;
/*    */ import org.apache.axiom.om.OMText;
/*    */ import org.apache.commons.logging.Log;
/*    */ import org.apache.commons.logging.LogFactory;
/*    */ import org.apache.synapse.SynapseException;
/*    */ import org.apache.synapse.config.Entry;
/*    */ import org.apache.synapse.config.SynapseConfigUtils;
/*    */ import org.apache.synapse.config.XMLToObjectMapper;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class EntryFactory
/*    */   implements XMLToObjectMapper
/*    */ {
/* 41 */   private static Log log = LogFactory.getLog(EntryFactory.class);
/*    */ 
/*    */   
/*    */   public static Entry createEntry(OMElement elem) {
/* 45 */     OMAttribute key = elem.getAttribute(new QName("""", ""key""));
/* 46 */     if (key == null) {
/* 47 */       handleException(""The 'key' attribute is required for a local registry entry"");
/* 48 */       return null;
/*    */     } 
/*    */ 
/*    */     
/* 52 */     Entry entry = new Entry(key.getAttributeValue());
/* 53 */     String src = elem.getAttributeValue(new QName("""", ""src""));
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */     
/* 59 */     if (src != null) {
/*    */       try {
/* 61 */         entry.setSrc(new URL(src.trim()));
/* 62 */         entry.setType(2);
/* 63 */         entry.setValue(SynapseConfigUtils.getObject(entry.getSrc()));
/*    */       }
/* 65 */       catch (MalformedURLException e) {
/* 66 */         handleException(""The entry with key : "" + key + "" refers to an invalid URL"");
/*    */       } 
/*    */     } else {
/*    */       
/* 70 */       OMNode nodeValue = elem.getFirstOMChild();
/* 71 */       OMElement elemValue = elem.getFirstElement();
/*    */       
/* 73 */       if (elemValue != null) {
/* 74 */         entry.setType(1);
/* 75 */         entry.setValue(elemValue);
/* 76 */       } else if (nodeValue != null && nodeValue instanceof OMText) {
/* 77 */         entry.setType(0);
/* 78 */         entry.setValue(((OMText)nodeValue).getText().trim());
/*    */       } 
/*    */     } 
/* 81 */     return entry;
/*    */   }
/*    */ 
/*    */   
/*    */   private static void handleException(String msg) {
/* 86 */     log.error(msg);
/* 87 */     throw new SynapseException(msg);
/*    */   }
/*    */   
/*    */   public Object getObjectFromOMNode(OMNode om) {
/* 91 */     if (om instanceof OMElement) {
/* 92 */       return createEntry((OMElement)om);
/*    */     }
/* 94 */     handleException(""Invalid XML configuration for an Entry. OMElement expected"");
/*    */     
/* 96 */     return null;
/*    */   }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\EntryFactory.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.EntrySerializer,"/*    */ package org.apache.synapse.config.xml;
/*    */ 
/*    */ import java.net.URL;
/*    */ import org.apache.axiom.om.OMAbstractFactory;
/*    */ import org.apache.axiom.om.OMElement;
/*    */ import org.apache.axiom.om.OMFactory;
/*    */ import org.apache.axiom.om.OMNamespace;
/*    */ import org.apache.axiom.om.OMNode;
/*    */ import org.apache.axiom.om.impl.llom.OMTextImpl;
/*    */ import org.apache.commons.logging.Log;
/*    */ import org.apache.commons.logging.LogFactory;
/*    */ import org.apache.synapse.SynapseException;
/*    */ import org.apache.synapse.config.Entry;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class EntrySerializer
/*    */ {
/* 39 */   private static Log log = LogFactory.getLog(EntrySerializer.class);
/*    */   
/* 41 */   protected static final OMFactory fac = OMAbstractFactory.getOMFactory();
/* 42 */   protected static final OMNamespace synNS = fac.createOMNamespace(""http://ws.apache.org/ns/synapse"", ""syn"");
/*    */   
/* 44 */   protected static final OMNamespace nullNS = fac.createOMNamespace("""", """");
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */   
/*    */   public static OMElement serializeEntry(Entry entry, OMElement parent) {
/* 53 */     OMElement propertyElement = fac.createOMElement(""localEntry"", synNS);
/* 54 */     propertyElement.addAttribute(fac.createOMAttribute(""key"", nullNS, entry.getKey().trim()));
/*    */     
/* 56 */     int type = entry.getType();
/* 57 */     if (type == 2)
/* 58 */     { URL srcUrl = entry.getSrc();
/* 59 */       if (srcUrl != null) {
/* 60 */         propertyElement.addAttribute(fac.createOMAttribute(""src"", nullNS, srcUrl.toString().trim()));
/*    */       } }
/*    */     
/* 63 */     else if (type == 1)
/* 64 */     { Object value = entry.getValue();
/* 65 */       if (value != null && value instanceof OMElement) {
/* 66 */         propertyElement.addChild((OMNode)value);
/*    */       } }
/* 68 */     else if (type == 0)
/* 69 */     { Object value = entry.getValue();
/* 70 */       if (value != null && value instanceof String) {
/* 71 */         OMTextImpl textData = (OMTextImpl)fac.createOMText(((String)value).trim());
/* 72 */         textData.setType(12);
/* 73 */         propertyElement.addChild((OMNode)textData);
/*    */       }  }
/* 75 */     else { if (type == 3)
/*    */       {
/* 77 */         return null;
/*    */       }
/* 79 */       handleException(""Entry type undefined""); }
/*    */     
/* 81 */     if (parent != null) {
/* 82 */       parent.addChild((OMNode)propertyElement);
/*    */     }
/* 84 */     return propertyElement;
/*    */   }
/*    */   
/*    */   private static void handleException(String msg) {
/* 88 */     log.error(msg);
/* 89 */     throw new SynapseException(msg);
/*    */   }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\EntrySerializer.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.FaultMediatorFactory,"/*     */ package org.apache.synapse.config.xml;
/*     */ 
/*     */ import java.net.URI;
/*     */ import java.net.URISyntaxException;
/*     */ import javax.xml.namespace.QName;
/*     */ import org.apache.axiom.om.OMAttribute;
/*     */ import org.apache.axiom.om.OMElement;
/*     */ import org.apache.synapse.Mediator;
/*     */ import org.apache.synapse.mediators.transform.FaultMediator;
/*     */ import org.jaxen.JaxenException;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class FaultMediatorFactory
/*     */   extends AbstractMediatorFactory
/*     */ {
/*  49 */   private static final QName FAULT_Q = new QName(""http://ws.apache.org/ns/synapse"", ""makefault"");
/*     */ 
/*     */   
/*  52 */   private static final QName ATT_VERSION_Q = new QName("""", ""version"");
/*     */   
/*  54 */   private static final QName CODE_Q = new QName(""http://ws.apache.org/ns/synapse"", ""code"");
/*     */   
/*  56 */   private static final QName REASON_Q = new QName(""http://ws.apache.org/ns/synapse"", ""reason"");
/*     */   
/*  58 */   private static final QName NODE_Q = new QName(""http://ws.apache.org/ns/synapse"", ""node"");
/*     */   
/*  60 */   private static final QName ROLE_Q = new QName(""http://ws.apache.org/ns/synapse"", ""role"");
/*     */   
/*  62 */   private static final QName DETAIL_Q = new QName(""http://ws.apache.org/ns/synapse"", ""detail"");
/*     */   
/*     */   private static final String SOAP11 = ""soap11"";
/*     */   
/*     */   private static final String SOAP12 = ""soap12"";
/*     */   
/*     */   private static final String POX = ""pox"";
/*     */   
/*     */   public Mediator createMediator(OMElement elem) {
/*  71 */     FaultMediator faultMediator = new FaultMediator();
/*     */     
/*  73 */     OMAttribute version = elem.getAttribute(ATT_VERSION_Q);
/*  74 */     if (version != null) {
/*  75 */       if (""soap11"".equals(version.getAttributeValue())) {
/*  76 */         faultMediator.setSoapVersion(1);
/*  77 */       } else if (""soap12"".equals(version.getAttributeValue())) {
/*  78 */         faultMediator.setSoapVersion(2);
/*  79 */       } else if (""pox"".equals(version.getAttributeValue())) {
/*  80 */         faultMediator.setSoapVersion(3);
/*     */       } else {
/*  82 */         handleException(""Invalid SOAP version"");
/*     */       } 
/*     */     }
/*     */     
/*  86 */     OMElement code = elem.getFirstChildWithName(CODE_Q);
/*  87 */     if (code != null) {
/*  88 */       OMAttribute value = code.getAttribute(ATT_VALUE);
/*  89 */       OMAttribute expression = code.getAttribute(ATT_EXPRN);
/*     */       
/*  91 */       if (value != null) {
/*  92 */         String strValue = value.getAttributeValue();
/*  93 */         String prefix = null;
/*  94 */         String name = null;
/*  95 */         if (strValue.indexOf("":"") != -1) {
/*  96 */           prefix = strValue.substring(0, strValue.indexOf("":""));
/*  97 */           name = strValue.substring(strValue.indexOf("":"") + 1);
/*     */         } else {
/*  99 */           handleException(""A QName is expected for fault code as prefix:name"");
/*     */         } 
/* 101 */         String namespaceURI = OMElementUtils.getNameSpaceWithPrefix(prefix, code);
/* 102 */         if (namespaceURI == null) {
/* 103 */           handleException(""Invalid namespace prefix '"" + prefix + ""' in code attribute"");
/*     */         }
/* 105 */         faultMediator.setFaultCodeValue(new QName(namespaceURI, name, prefix));
/* 106 */       } else if (expression != null) {
/*     */         try {
/* 108 */           faultMediator.setFaultCodeExpr(SynapseXPathFactory.getSynapseXPath(code, ATT_EXPRN));
/*     */         }
/* 110 */         catch (JaxenException je) {
/* 111 */           handleException(""Invalid fault code expression : "" + je.getMessage(), (Exception)je);
/*     */         } 
/*     */       } else {
/* 114 */         handleException(""A 'value' or 'expression' attribute must specify the fault code"");
/*     */       }
/*     */     
/* 117 */     } else if (faultMediator.getSoapVersion() != 3) {
/* 118 */       handleException(""The fault code is a required attribute for the makefault mediator unless it is a pox fault"");
/*     */     } 
/*     */ 
/*     */     
/* 122 */     OMElement reason = elem.getFirstChildWithName(REASON_Q);
/* 123 */     if (reason != null) {
/* 124 */       OMAttribute value = reason.getAttribute(ATT_VALUE);
/* 125 */       OMAttribute expression = reason.getAttribute(ATT_EXPRN);
/*     */       
/* 127 */       if (value != null) {
/* 128 */         faultMediator.setFaultReasonValue(value.getAttributeValue());
/* 129 */       } else if (expression != null) {
/*     */         try {
/* 131 */           faultMediator.setFaultReasonExpr(SynapseXPathFactory.getSynapseXPath(reason, ATT_EXPRN));
/*     */         }
/* 133 */         catch (JaxenException je) {
/* 134 */           handleException(""Invalid fault reason expression : "" + je.getMessage(), (Exception)je);
/*     */         } 
/*     */       } else {
/* 137 */         handleException(""A 'value' or 'expression' attribute must specify the fault code"");
/*     */       }
/*     */     
/* 140 */     } else if (faultMediator.getSoapVersion() != 3) {
/* 141 */       handleException(""The fault reason is a required attribute for the makefault mediator unless it is a pox fault"");
/*     */     } 
/*     */ 
/*     */ 
/*     */ 
/*     */     
/* 147 */     processTraceState((Mediator)faultMediator, elem);
/*     */     
/* 149 */     OMElement node = elem.getFirstChildWithName(NODE_Q);
/* 150 */     if (node != null && node.getText() != null) {
/*     */       try {
/* 152 */         faultMediator.setFaultNode(new URI(node.getText()));
/* 153 */       } catch (URISyntaxException e) {
/* 154 */         handleException(""Invalid URI specified for fault node : "" + node.getText(), e);
/*     */       } 
/*     */     }
/*     */     
/* 158 */     OMElement role = elem.getFirstChildWithName(ROLE_Q);
/* 159 */     if (role != null && role.getText() != null) {
/*     */       try {
/* 161 */         faultMediator.setFaultRole(new URI(role.getText()));
/* 162 */       } catch (URISyntaxException e) {
/* 163 */         handleException(""Invalid URI specified for fault role : "" + role.getText(), e);
/*     */       } 
/*     */     }
/*     */     
/* 167 */     OMElement detail = elem.getFirstChildWithName(DETAIL_Q);
/* 168 */     if (detail != null) {
/* 169 */       OMAttribute detailExpr = detail.getAttribute(ATT_EXPRN);
/* 170 */       if (detailExpr != null && detailExpr.getAttributeValue() != null) {
/*     */         try {
/* 172 */           faultMediator.setFaultDetailExpr(SynapseXPathFactory.getSynapseXPath(detail, ATT_EXPRN));
/*     */         }
/* 174 */         catch (JaxenException e) {
/* 175 */           handleException(""Unable to build the XPath for fault detail from the expression : "" + detailExpr.getAttributeValue(), (Exception)e);
/*     */         }
/*     */       
/* 178 */       } else if (detail.getText() != null) {
/* 179 */         faultMediator.setFaultDetail(detail.getText());
/*     */       } 
/*     */     } 
/*     */     
/* 183 */     return (Mediator)faultMediator;
/*     */   }
/*     */ 
/*     */   
/* 187 */   public QName getTagQName() { return FAULT_Q; }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\FaultMediatorFactory.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.FaultMediatorSerializer,"/*     */ package org.apache.synapse.config.xml;
/*     */ 
/*     */ import org.apache.axiom.om.OMContainer;
/*     */ import org.apache.axiom.om.OMElement;
/*     */ import org.apache.axiom.om.OMNode;
/*     */ import org.apache.synapse.Mediator;
/*     */ import org.apache.synapse.mediators.transform.FaultMediator;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class FaultMediatorSerializer
/*     */   extends AbstractMediatorSerializer
/*     */ {
/*     */   private static final String SOAP11 = ""soap11"";
/*     */   private static final String SOAP12 = ""soap12"";
/*     */   private static final String POX = ""pox"";
/*     */   
/*     */   public OMElement serializeMediator(OMElement parent, Mediator m) {
/*  41 */     if (!(m instanceof FaultMediator)) {
/*  42 */       handleException(""Unsupported mediator passed in for serialization : "" + m.getType());
/*     */     }
/*     */     
/*  45 */     FaultMediator mediator = (FaultMediator)m;
/*  46 */     OMElement fault = fac.createOMElement(""makefault"", synNS);
/*  47 */     saveTracingState(fault, (Mediator)mediator);
/*     */     
/*  49 */     if (mediator.getSoapVersion() == 1) {
/*  50 */       fault.addAttribute(fac.createOMAttribute(""version"", nullNS, ""soap11""));
/*     */     }
/*  52 */     else if (mediator.getSoapVersion() == 2) {
/*  53 */       fault.addAttribute(fac.createOMAttribute(""version"", nullNS, ""soap12""));
/*     */     }
/*  55 */     else if (mediator.getSoapVersion() == 3) {
/*  56 */       fault.addAttribute(fac.createOMAttribute(""version"", nullNS, ""pox""));
/*     */     } 
/*     */ 
/*     */     
/*  60 */     OMElement code = fac.createOMElement(""code"", synNS, (OMContainer)fault);
/*  61 */     if (mediator.getFaultCodeValue() != null) {
/*  62 */       code.addAttribute(fac.createOMAttribute(""value"", nullNS, mediator.getFaultCodeValue().getPrefix() + "":"" + mediator.getFaultCodeValue().getLocalPart()));
/*     */ 
/*     */       
/*  65 */       code.declareNamespace(mediator.getFaultCodeValue().getNamespaceURI(), mediator.getFaultCodeValue().getPrefix());
/*     */     
/*     */     }
/*  68 */     else if (mediator.getFaultCodeExpr() != null) {
/*  69 */       SynapseXPathSerializer.serializeXPath(mediator.getFaultCodeExpr(), code, ""expression"");
/*     */     }
/*  71 */     else if (mediator.getSoapVersion() != 3) {
/*  72 */       handleException(""Fault code is required for a fault mediator unless it is a pox fault"");
/*     */     } 
/*     */ 
/*     */     
/*  76 */     OMElement reason = fac.createOMElement(""reason"", synNS, (OMContainer)fault);
/*  77 */     if (mediator.getFaultReasonValue() != null) {
/*  78 */       reason.addAttribute(fac.createOMAttribute(""value"", nullNS, mediator.getFaultReasonValue()));
/*     */     
/*     */     }
/*  81 */     else if (mediator.getFaultReasonExpr() != null) {
/*     */       
/*  83 */       SynapseXPathSerializer.serializeXPath(mediator.getFaultReasonExpr(), reason, ""expression"");
/*     */     
/*     */     }
/*  86 */     else if (mediator.getSoapVersion() != 3) {
/*  87 */       handleException(""Fault reason is required for a fault mediator unless it is a pox fault"");
/*     */     } 
/*     */ 
/*     */ 
/*     */     
/*  92 */     if (mediator.getFaultNode() != null) {
/*  93 */       OMElement node = fac.createOMElement(""node"", synNS, (OMContainer)fault);
/*  94 */       node.setText(mediator.getFaultNode().toString());
/*     */     } 
/*     */     
/*  97 */     if (mediator.getFaultRole() != null) {
/*  98 */       OMElement role = fac.createOMElement(""role"", synNS, (OMContainer)fault);
/*  99 */       role.setText(mediator.getFaultRole().toString());
/*     */     } 
/*     */     
/* 102 */     if (mediator.getFaultDetailExpr() != null) {
/* 103 */       OMElement detail = fac.createOMElement(""detail"", synNS, (OMContainer)fault);
/* 104 */       SynapseXPathSerializer.serializeXPath(mediator.getFaultDetailExpr(), detail, ""expression"");
/*     */     }
/* 106 */     else if (mediator.getFaultDetail() != null) {
/* 107 */       OMElement detail = fac.createOMElement(""detail"", synNS, (OMContainer)fault);
/* 108 */       detail.setText(mediator.getFaultDetail());
/*     */     } 
/*     */     
/* 111 */     if (parent != null) {
/* 112 */       parent.addChild((OMNode)fault);
/*     */     }
/* 114 */     return fault;
/*     */   }
/*     */ 
/*     */   
/* 118 */   public String getMediatorClassName() { return FaultMediator.class.getName(); }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\FaultMediatorSerializer.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.FilterMediatorFactory,"/*     */ package org.apache.synapse.config.xml;
/*     */ 
/*     */ import java.util.regex.Pattern;
/*     */ import java.util.regex.PatternSyntaxException;
/*     */ import javax.xml.namespace.QName;
/*     */ import org.apache.axiom.om.OMAttribute;
/*     */ import org.apache.axiom.om.OMElement;
/*     */ import org.apache.synapse.Mediator;
/*     */ import org.apache.synapse.mediators.ListMediator;
/*     */ import org.apache.synapse.mediators.filters.FilterMediator;
/*     */ import org.jaxen.JaxenException;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class FilterMediatorFactory
/*     */   extends AbstractListMediatorFactory
/*     */ {
/*  58 */   private static final QName FILTER_Q = new QName(""http://ws.apache.org/ns/synapse"", ""filter"");
/*  59 */   private static final QName THEN_Q = new QName(""http://ws.apache.org/ns/synapse"", ""then"");
/*  60 */   private static final QName ELSE_Q = new QName(""http://ws.apache.org/ns/synapse"", ""else"");
/*     */ 
/*     */   
/*     */   public Mediator createMediator(OMElement elem) {
/*  64 */     FilterMediator filter = new FilterMediator();
/*     */     
/*  66 */     OMAttribute attXpath = elem.getAttribute(ATT_XPATH);
/*  67 */     OMAttribute attSource = elem.getAttribute(ATT_SOURCE);
/*  68 */     OMAttribute attRegex = elem.getAttribute(ATT_REGEX);
/*     */     
/*  70 */     if (attXpath != null) {
/*  71 */       if (attXpath.getAttributeValue() != null && attXpath.getAttributeValue().trim().length() == 0) {
/*     */ 
/*     */         
/*  74 */         handleException(""Invalid attribute value specified for xpath"");
/*     */       } else {
/*     */ 
/*     */         
/*     */         try {
/*  79 */           filter.setXpath(SynapseXPathFactory.getSynapseXPath(elem, ATT_XPATH));
/*  80 */         } catch (JaxenException e) {
/*  81 */           handleException(""Invalid XPath expression for attribute xpath : "" + attXpath.getAttributeValue(), (Exception)e);
/*     */         }
/*     */       
/*     */       }
/*     */     
/*     */     }
/*  87 */     else if (attSource != null && attRegex != null) {
/*     */       
/*  89 */       if ((attSource.getAttributeValue() != null && attSource.getAttributeValue().trim().length() == 0) || (attRegex.getAttributeValue() != null && attRegex.getAttributeValue().trim().length() == 0)) {
/*     */ 
/*     */ 
/*     */         
/*  93 */         handleException(""Invalid attribute values for source and/or regex specified"");
/*     */       } else {
/*     */ 
/*     */         
/*     */         try {
/*  98 */           filter.setSource(SynapseXPathFactory.getSynapseXPath(elem, ATT_SOURCE));
/*  99 */         } catch (JaxenException e) {
/*     */           
/* 101 */           handleException(""Invalid XPath expression for attribute source : "" + attSource.getAttributeValue(), (Exception)e);
/*     */         } 
/*     */ 
/*     */         
/*     */         try {
/* 106 */           filter.setRegex(Pattern.compile(attRegex.getAttributeValue()));
/* 107 */         } catch (PatternSyntaxException pse) {
/*     */           
/* 109 */           handleException(""Invalid Regular Expression for attribute regex : "" + attRegex.getAttributeValue(), pse);
/*     */         }
/*     */       
/*     */       }
/*     */     
/*     */     } else {
/*     */       
/* 116 */       handleException(""An xpath or (source, regex) attributes are required for a filter"");
/*     */     } 
/*     */ 
/*     */ 
/*     */     
/* 121 */     processTraceState((Mediator)filter, elem);
/*     */     
/* 123 */     OMElement thenElem = elem.getFirstChildWithName(THEN_Q);
/*     */     
/* 125 */     if (thenElem != null) {
/*     */       
/* 127 */       filter.setThenElementPresent(true);
/* 128 */       OMAttribute sequenceAttr = thenElem.getAttribute(ATT_SEQUENCE);
/*     */       
/* 130 */       if (sequenceAttr != null && sequenceAttr.getAttributeValue() != null) {
/*     */         
/* 132 */         filter.setThenKey(sequenceAttr.getAttributeValue());
/*     */       } else {
/*     */         
/* 135 */         addChildren(thenElem, (ListMediator)filter);
/*     */       } 
/*     */       
/* 138 */       OMElement elseElem = elem.getFirstChildWithName(ELSE_Q);
/*     */       
/* 140 */       if (elseElem != null) {
/*     */         
/* 142 */         sequenceAttr = elseElem.getAttribute(ATT_SEQUENCE);
/*     */         
/* 144 */         if (sequenceAttr != null && sequenceAttr.getAttributeValue() != null)
/*     */         {
/* 146 */           filter.setElseKey(sequenceAttr.getAttributeValue());
/*     */         }
/*     */         else
/*     */         {
/* 150 */           AnonymousListMediator listMediator = AnonymousListMediatorFactory.createAnonymousListMediator(elseElem);
/*     */           
/* 152 */           filter.setElseMediator((ListMediator)listMediator);
/*     */         }
/*     */       
/*     */       } 
/*     */     } else {
/*     */       
/* 158 */       filter.setThenElementPresent(false);
/* 159 */       addChildren(elem, (ListMediator)filter);
/*     */     } 
/*     */     
/* 162 */     return (Mediator)filter;
/*     */   }
/*     */ 
/*     */   
/* 166 */   public QName getTagQName() { return FILTER_Q; }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\FilterMediatorFactory.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.FilterMediatorSerializer,"/*     */ package org.apache.synapse.config.xml;
/*     */ 
/*     */ import org.apache.axiom.om.OMElement;
/*     */ import org.apache.axiom.om.OMNode;
/*     */ import org.apache.synapse.Mediator;
/*     */ import org.apache.synapse.mediators.filters.FilterMediator;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class FilterMediatorSerializer
/*     */   extends AbstractListMediatorSerializer
/*     */ {
/*     */   public OMElement serializeMediator(OMElement parent, Mediator m) {
/*  51 */     if (!(m instanceof FilterMediator)) {
/*  52 */       handleException(""Unsupported mediator passed in for serialization : "" + m.getType());
/*     */     }
/*     */     
/*  55 */     FilterMediator mediator = (FilterMediator)m;
/*  56 */     OMElement filter = fac.createOMElement(""filter"", synNS);
/*     */     
/*  58 */     if (mediator.getSource() != null && mediator.getRegex() != null) {
/*     */       
/*  60 */       SynapseXPathSerializer.serializeXPath(mediator.getSource(), filter, ""source"");
/*     */       
/*  62 */       filter.addAttribute(fac.createOMAttribute(""regex"", nullNS, mediator.getRegex().pattern()));
/*     */     
/*     */     }
/*  65 */     else if (mediator.getXpath() != null) {
/*     */       
/*  67 */       SynapseXPathSerializer.serializeXPath(mediator.getXpath(), filter, ""xpath"");
/*     */     } else {
/*     */       
/*  70 */       handleException(""Invalid filter mediator. Should have either a 'source' and a 'regex' OR an 'xpath' "");
/*     */     } 
/*     */ 
/*     */     
/*  74 */     saveTracingState(filter, (Mediator)mediator);
/*     */     
/*  76 */     if (mediator.isThenElementPresent()) {
/*     */       
/*  78 */       OMElement thenElem = fac.createOMElement(""then"", synNS);
/*  79 */       filter.addChild((OMNode)thenElem);
/*     */       
/*  81 */       if (mediator.getThenKey() != null) {
/*  82 */         thenElem.addAttribute(fac.createOMAttribute(""sequence"", nullNS, mediator.getThenKey()));
/*     */       } else {
/*     */         
/*  85 */         serializeChildren(thenElem, mediator.getList());
/*     */       } 
/*     */       
/*  88 */       if (mediator.getElseMediator() != null || mediator.getElseKey() != null) {
/*     */         
/*  90 */         OMElement elseElem = fac.createOMElement(""else"", synNS);
/*  91 */         filter.addChild((OMNode)elseElem);
/*     */         
/*  93 */         if (mediator.getElseKey() != null) {
/*  94 */           elseElem.addAttribute(fac.createOMAttribute(""sequence"", nullNS, mediator.getElseKey()));
/*     */         } else {
/*     */           
/*  97 */           serializeChildren(elseElem, mediator.getElseMediator().getList());
/*     */         } 
/*     */       } 
/*     */     } else {
/*     */       
/* 102 */       serializeChildren(filter, mediator.getList());
/*     */     } 
/*     */     
/* 105 */     if (parent != null) {
/* 106 */       parent.addChild((OMNode)filter);
/*     */     }
/* 108 */     return filter;
/*     */   }
/*     */ 
/*     */   
/* 112 */   public String getMediatorClassName() { return FilterMediator.class.getName(); }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\FilterMediatorSerializer.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.HeaderMediatorFactory,"/*     */ package org.apache.synapse.config.xml;
/*     */ 
/*     */ import javax.xml.namespace.QName;
/*     */ import org.apache.axiom.om.OMAttribute;
/*     */ import org.apache.axiom.om.OMElement;
/*     */ import org.apache.synapse.Mediator;
/*     */ import org.apache.synapse.SynapseException;
/*     */ import org.apache.synapse.mediators.transform.HeaderMediator;
/*     */ import org.jaxen.JaxenException;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class HeaderMediatorFactory
/*     */   extends AbstractMediatorFactory
/*     */ {
/*  46 */   private static final QName HEADER_Q = new QName(""http://ws.apache.org/ns/synapse"", ""header"");
/*  47 */   private static final QName ATT_ACTION = new QName(""action"");
/*     */ 
/*     */   
/*     */   public Mediator createMediator(OMElement elem) {
/*  51 */     HeaderMediator headerMediator = new HeaderMediator();
/*  52 */     OMAttribute name = elem.getAttribute(ATT_NAME);
/*  53 */     OMAttribute value = elem.getAttribute(ATT_VALUE);
/*  54 */     OMAttribute exprn = elem.getAttribute(ATT_EXPRN);
/*  55 */     OMAttribute action = elem.getAttribute(ATT_ACTION);
/*     */     
/*  57 */     if (name == null || name.getAttributeValue() == null) {
/*  58 */       String msg = ""A valid name attribute is required for the header mediator"";
/*  59 */       log.error(msg);
/*  60 */       throw new SynapseException(msg);
/*     */     } 
/*  62 */     String nameAtt = name.getAttributeValue();
/*  63 */     int colonPos = nameAtt.indexOf("":"");
/*  64 */     if (colonPos != -1) {
/*     */       
/*  66 */       String prefix = nameAtt.substring(0, colonPos);
/*  67 */       String namespaceURI = OMElementUtils.getNameSpaceWithPrefix(prefix, elem);
/*  68 */       if (namespaceURI == null) {
/*  69 */         String msg = ""Invalid namespace prefix '"" + prefix + ""' in name attribute"";
/*  70 */         log.error(msg);
/*  71 */         throw new SynapseException(msg);
/*     */       } 
/*  73 */       headerMediator.setQName(new QName(namespaceURI, nameAtt.substring(colonPos + 1), prefix));
/*     */     }
/*     */     else {
/*     */       
/*  77 */       headerMediator.setQName(new QName(nameAtt));
/*     */     } 
/*     */ 
/*     */ 
/*     */ 
/*     */     
/*  83 */     processTraceState((Mediator)headerMediator, elem);
/*     */ 
/*     */ 
/*     */     
/*  87 */     if (action != null && ""remove"".equals(action.getAttributeValue())) {
/*  88 */       headerMediator.setAction(1);
/*     */     }
/*     */     
/*  91 */     if (headerMediator.getAction() == 0 && value == null && exprn == null) {
/*     */       
/*  93 */       String msg = ""A 'value' or 'expression' attribute is required for a [set] header mediator"";
/*  94 */       log.error(msg);
/*  95 */       throw new SynapseException(msg);
/*     */     } 
/*     */     
/*  98 */     if (value != null && value.getAttributeValue() != null) {
/*  99 */       headerMediator.setValue(value.getAttributeValue());
/*     */     }
/* 101 */     else if (exprn != null && exprn.getAttributeValue() != null) {
/*     */       try {
/* 103 */         headerMediator.setExpression(SynapseXPathFactory.getSynapseXPath(elem, ATT_EXPRN));
/* 104 */       } catch (JaxenException je) {
/* 105 */         String msg = ""Invalid XPath expression : "" + exprn.getAttributeValue();
/* 106 */         log.error(msg);
/* 107 */         throw new SynapseException(msg, (Throwable)je);
/*     */       } 
/*     */     } 
/*     */     
/* 111 */     return (Mediator)headerMediator;
/*     */   }
/*     */ 
/*     */   
/* 115 */   public QName getTagQName() { return HEADER_Q; }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\HeaderMediatorFactory.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.HeaderMediatorSerializer,"/*    */ package org.apache.synapse.config.xml;
/*    */ 
/*    */ import javax.xml.namespace.QName;
/*    */ import org.apache.axiom.om.OMElement;
/*    */ import org.apache.axiom.om.OMNode;
/*    */ import org.apache.synapse.Mediator;
/*    */ import org.apache.synapse.mediators.transform.HeaderMediator;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class HeaderMediatorSerializer
/*    */   extends AbstractMediatorSerializer
/*    */ {
/*    */   public OMElement serializeMediator(OMElement parent, Mediator m) {
/* 37 */     if (!(m instanceof HeaderMediator)) {
/* 38 */       handleException(""Unsupported mediator passed in for serialization : "" + m.getType());
/*    */     }
/*    */     
/* 41 */     HeaderMediator mediator = (HeaderMediator)m;
/* 42 */     OMElement header = fac.createOMElement(""header"", synNS);
/* 43 */     saveTracingState(header, (Mediator)mediator);
/*    */     
/* 45 */     QName qName = mediator.getQName();
/* 46 */     if (qName != null) {
/* 47 */       if (qName.getNamespaceURI() != null) {
/* 48 */         header.addAttribute(fac.createOMAttribute(""name"", nullNS, ((qName.getPrefix() != null && !"""".equals(qName.getPrefix())) ? (qName.getPrefix() + "":"") : """") + qName.getLocalPart()));
/*    */ 
/*    */ 
/*    */ 
/*    */         
/* 53 */         header.declareNamespace(qName.getNamespaceURI(), qName.getPrefix());
/*    */       } else {
/* 55 */         header.addAttribute(fac.createOMAttribute(""name"", nullNS, qName.getLocalPart()));
/*    */       } 
/*    */     }
/*    */ 
/*    */     
/* 60 */     if (mediator.getAction() == 1) {
/* 61 */       header.addAttribute(fac.createOMAttribute(""action"", nullNS, ""remove""));
/*    */     
/*    */     }
/* 64 */     else if (mediator.getValue() != null) {
/* 65 */       header.addAttribute(fac.createOMAttribute(""value"", nullNS, mediator.getValue()));
/*    */     
/*    */     }
/* 68 */     else if (mediator.getExpression() != null) {
/*    */       
/* 70 */       SynapseXPathSerializer.serializeXPath(mediator.getExpression(), header, ""expression"");
/*    */     }
/*    */     else {
/*    */       
/* 74 */       handleException(""Value or expression required for a set header mediator"");
/*    */     } 
/*    */ 
/*    */     
/* 78 */     if (parent != null) {
/* 79 */       parent.addChild((OMNode)header);
/*    */     }
/* 81 */     return header;
/*    */   }
/*    */ 
/*    */   
/* 85 */   public String getMediatorClassName() { return HeaderMediator.class.getName(); }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\HeaderMediatorSerializer.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.InMediatorFactory,"/*    */ package org.apache.synapse.config.xml;
/*    */ 
/*    */ import javax.xml.namespace.QName;
/*    */ import org.apache.axiom.om.OMElement;
/*    */ import org.apache.synapse.Mediator;
/*    */ import org.apache.synapse.mediators.ListMediator;
/*    */ import org.apache.synapse.mediators.filters.InMediator;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class InMediatorFactory
/*    */   extends AbstractListMediatorFactory
/*    */ {
/* 40 */   private static final QName IN_Q = new QName(""http://ws.apache.org/ns/synapse"", ""in"");
/*    */   
/*    */   public Mediator createMediator(OMElement elem) {
/* 43 */     InMediator filter = new InMediator();
/*    */ 
/*    */     
/* 46 */     processTraceState((Mediator)filter, elem);
/* 47 */     addChildren(elem, (ListMediator)filter);
/* 48 */     return (Mediator)filter;
/*    */   }
/*    */ 
/*    */   
/* 52 */   public QName getTagQName() { return IN_Q; }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\InMediatorFactory.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.InMediatorSerializer,"/*    */ package org.apache.synapse.config.xml;
/*    */ 
/*    */ import org.apache.axiom.om.OMElement;
/*    */ import org.apache.axiom.om.OMNode;
/*    */ import org.apache.synapse.Mediator;
/*    */ import org.apache.synapse.mediators.filters.InMediator;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class InMediatorSerializer
/*    */   extends AbstractListMediatorSerializer
/*    */ {
/*    */   public OMElement serializeMediator(OMElement parent, Mediator m) {
/* 35 */     if (!(m instanceof InMediator)) {
/* 36 */       handleException(""Unsupported mediator passed in for serialization : "" + m.getType());
/*    */     }
/*    */     
/* 39 */     InMediator mediator = (InMediator)m;
/* 40 */     OMElement in = fac.createOMElement(""in"", synNS);
/* 41 */     saveTracingState(in, (Mediator)mediator);
/*    */     
/* 43 */     serializeChildren(in, mediator.getList());
/*    */     
/* 45 */     if (parent != null) {
/* 46 */       parent.addChild((OMNode)in);
/*    */     }
/* 48 */     return in;
/*    */   }
/*    */ 
/*    */   
/* 52 */   public String getMediatorClassName() { return InMediator.class.getName(); }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\InMediatorSerializer.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.IterateMediatorFactory,"/*     */ package org.apache.synapse.config.xml;
/*     */ 
/*     */ import javax.xml.namespace.QName;
/*     */ import org.apache.axiom.om.OMAttribute;
/*     */ import org.apache.axiom.om.OMElement;
/*     */ import org.apache.commons.logging.Log;
/*     */ import org.apache.commons.logging.LogFactory;
/*     */ import org.apache.synapse.Mediator;
/*     */ import org.apache.synapse.mediators.eip.splitter.IterateMediator;
/*     */ import org.apache.synapse.util.xpath.SynapseXPath;
/*     */ import org.jaxen.JaxenException;
/*     */ import org.jaxen.XPath;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class IterateMediatorFactory
/*     */   extends AbstractMediatorFactory
/*     */ {
/*  55 */   private static final Log log = LogFactory.getLog(IterateMediatorFactory.class);
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  60 */   private static final QName ITERATE_Q = new QName(""http://ws.apache.org/ns/synapse"", ""iterate"");
/*  61 */   private static final QName ATT_CONTPAR = new QName(""continueParent"");
/*  62 */   private static final QName ATT_PREPLD = new QName(""preservePayload"");
/*  63 */   private static final QName ATT_ATTACHPATH = new QName(""attachPath"");
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public Mediator createMediator(OMElement elem) {
/*  73 */     IterateMediator mediator = new IterateMediator();
/*  74 */     processTraceState((Mediator)mediator, elem);
/*     */     
/*  76 */     OMAttribute continueParent = elem.getAttribute(ATT_CONTPAR);
/*  77 */     if (continueParent != null) {
/*  78 */       mediator.setContinueParent(Boolean.valueOf(continueParent.getAttributeValue()).booleanValue());
/*     */     }
/*     */ 
/*     */     
/*  82 */     OMAttribute preservePayload = elem.getAttribute(ATT_PREPLD);
/*  83 */     if (preservePayload != null) {
/*  84 */       mediator.setPreservePayload(Boolean.valueOf(preservePayload.getAttributeValue()).booleanValue());
/*     */     }
/*     */ 
/*     */     
/*  88 */     OMAttribute expression = elem.getAttribute(ATT_EXPRN);
/*  89 */     if (expression != null) {
/*     */       try {
/*  91 */         mediator.setExpression(SynapseXPathFactory.getSynapseXPath(elem, ATT_EXPRN));
/*  92 */       } catch (JaxenException e) {
/*  93 */         handleException(""Unable to build the IterateMediator. Invalid XPATH "" + expression.getAttributeValue(), (Exception)e);
/*     */       } 
/*     */     } else {
/*     */       
/*  97 */       handleException(""XPATH expression is required for an IterateMediator under the \""expression\"" attribute"");
/*     */     } 
/*     */ 
/*     */     
/* 101 */     OMAttribute attachPath = elem.getAttribute(ATT_ATTACHPATH);
/* 102 */     String attachPathValue = ""."";
/* 103 */     if (attachPath != null && !mediator.isPreservePayload()) {
/* 104 */       handleException(""Wrong configuration for the iterate mediator :: if the iterator should not preserve payload, then attachPath can not be present"");
/*     */     }
/* 106 */     else if (attachPath != null) {
/* 107 */       attachPathValue = attachPath.getAttributeValue();
/*     */     } 
/*     */     
/*     */     try {
/* 111 */       SynapseXPath xp = new SynapseXPath(attachPathValue);
/* 112 */       OMElementUtils.addNameSpaces((XPath)xp, elem, log);
/* 113 */       mediator.setAttachPath(xp);
/* 114 */     } catch (JaxenException e) {
/* 115 */       handleException(""Unable to build the IterateMediator. Invalid XPATH "" + attachPathValue, (Exception)e);
/*     */     } 
/*     */ 
/*     */     
/* 119 */     OMElement targetElement = elem.getFirstChildWithName(TARGET_Q);
/* 120 */     if (targetElement != null) {
/* 121 */       mediator.setTarget(TargetFactory.createTarget(targetElement));
/*     */     } else {
/* 123 */       handleException(""Target for an iterate mediator is required :: missing target"");
/*     */     } 
/*     */     
/* 126 */     return (Mediator)mediator;
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 135 */   public QName getTagQName() { return ITERATE_Q; }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\IterateMediatorFactory.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.IterateMediatorSerializer,"/*     */ package org.apache.synapse.config.xml;
/*     */ 
/*     */ import org.apache.axiom.om.OMElement;
/*     */ import org.apache.axiom.om.OMNode;
/*     */ import org.apache.synapse.Mediator;
/*     */ import org.apache.synapse.mediators.eip.splitter.IterateMediator;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class IterateMediatorSerializer
/*     */   extends AbstractMediatorSerializer
/*     */ {
/*     */   public OMElement serializeMediator(OMElement parent, Mediator m) {
/*  62 */     if (!(m instanceof IterateMediator)) {
/*  63 */       handleException(""Unsupported mediator passed in for serialization : "" + m.getType());
/*     */     }
/*     */     
/*  66 */     OMElement itrElem = fac.createOMElement(""iterate"", synNS);
/*  67 */     saveTracingState(itrElem, m);
/*     */     
/*  69 */     IterateMediator itrMed = (IterateMediator)m;
/*  70 */     if (itrMed.isContinueParent()) {
/*  71 */       itrElem.addAttribute(""continueParent"", Boolean.toString(true), nullNS);
/*     */     }
/*     */     
/*  74 */     if (itrMed.isPreservePayload()) {
/*  75 */       itrElem.addAttribute(""preservePayload"", Boolean.toString(true), nullNS);
/*     */     }
/*     */     
/*  78 */     if (itrMed.getAttachPath() != null && !""."".equals(itrMed.getAttachPath().toString())) {
/*  79 */       SynapseXPathSerializer.serializeXPath(itrMed.getAttachPath(), itrElem, ""attachPath"");
/*     */     }
/*     */     
/*  82 */     if (itrMed.getExpression() != null) {
/*  83 */       SynapseXPathSerializer.serializeXPath(itrMed.getExpression(), itrElem, ""expression"");
/*     */     } else {
/*  85 */       handleException(""Missing expression of the IterateMediator which is required."");
/*     */     } 
/*     */     
/*  88 */     itrElem.addChild((OMNode)TargetSerializer.serializeTarget(itrMed.getTarget()));
/*     */ 
/*     */     
/*  91 */     if (parent != null) {
/*  92 */       parent.addChild((OMNode)itrElem);
/*     */     }
/*     */     
/*  95 */     return itrElem;
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 105 */   public String getMediatorClassName() { return IterateMediator.class.getName(); }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\IterateMediatorSerializer.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.LogMediatorFactory,"/*    */ package org.apache.synapse.config.xml;
/*    */ 
/*    */ import javax.xml.namespace.QName;
/*    */ import org.apache.axiom.om.OMAttribute;
/*    */ import org.apache.axiom.om.OMElement;
/*    */ import org.apache.synapse.Mediator;
/*    */ import org.apache.synapse.mediators.builtin.LogMediator;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class LogMediatorFactory
/*    */   extends AbstractMediatorFactory
/*    */ {
/* 42 */   private static final QName LOG_Q = new QName(""http://ws.apache.org/ns/synapse"", ""log"");
/*    */   private static final String SIMPLE = ""simple"";
/*    */   private static final String HEADERS = ""headers"";
/*    */   private static final String FULL = ""full"";
/*    */   private static final String CUSTOM = ""custom"";
/* 47 */   private static final QName ATT_LEVEL = new QName(""level"");
/* 48 */   private static final QName ATT_SEPERATOR = new QName(""separator"");
/*    */ 
/*    */   
/* 51 */   public QName getTagQName() { return LOG_Q; }
/*    */ 
/*    */ 
/*    */   
/*    */   public Mediator createMediator(OMElement elem) {
/* 56 */     LogMediator logMediator = new LogMediator();
/*    */ 
/*    */ 
/*    */     
/* 60 */     processTraceState((Mediator)logMediator, elem);
/*    */ 
/*    */     
/* 63 */     OMAttribute level = elem.getAttribute(ATT_LEVEL);
/* 64 */     if (level != null) {
/* 65 */       String levelstr = level.getAttributeValue();
/* 66 */       if (""simple"".equals(levelstr)) {
/* 67 */         logMediator.setLogLevel(1);
/* 68 */       } else if (""headers"".equals(levelstr)) {
/* 69 */         logMediator.setLogLevel(2);
/* 70 */       } else if (""full"".equals(levelstr)) {
/* 71 */         logMediator.setLogLevel(3);
/* 72 */       } else if (""custom"".equals(levelstr)) {
/* 73 */         logMediator.setLogLevel(0);
/*    */       } 
/*    */     } 
/*    */ 
/*    */     
/* 78 */     OMAttribute separator = elem.getAttribute(ATT_SEPERATOR);
/* 79 */     if (separator != null) {
/* 80 */       logMediator.setSeparator(separator.getAttributeValue());
/*    */     }
/*    */     
/* 83 */     logMediator.addAllProperties(MediatorPropertyFactory.getMediatorProperties(elem));
/*    */     
/* 85 */     return (Mediator)logMediator;
/*    */   }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\LogMediatorFactory.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.LogMediatorSerializer,"/*    */ package org.apache.synapse.config.xml;
/*    */ 
/*    */ import org.apache.axiom.om.OMElement;
/*    */ import org.apache.axiom.om.OMNode;
/*    */ import org.apache.synapse.Mediator;
/*    */ import org.apache.synapse.mediators.builtin.LogMediator;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class LogMediatorSerializer
/*    */   extends AbstractMediatorSerializer
/*    */ {
/*    */   public OMElement serializeMediator(OMElement parent, Mediator m) {
/* 39 */     if (!(m instanceof LogMediator)) {
/* 40 */       handleException(""Unsupported mediator passed in for serialization : "" + m.getType());
/*    */     }
/*    */     
/* 43 */     LogMediator mediator = (LogMediator)m;
/* 44 */     OMElement log = fac.createOMElement(""log"", synNS);
/* 45 */     saveTracingState(log, (Mediator)mediator);
/*    */     
/* 47 */     if (mediator.getLogLevel() != 1) {
/* 48 */       log.addAttribute(fac.createOMAttribute(""level"", nullNS, (mediator.getLogLevel() == 2) ? ""headers"" : ((mediator.getLogLevel() == 3) ? ""full"" : ((mediator.getLogLevel() == 0) ? ""custom"" : ""simple""))));
/*    */     }
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */     
/* 56 */     if (mediator.getSeparator() != "", "") {
/* 57 */       log.addAttribute(fac.createOMAttribute(""separator"", nullNS, mediator.getSeparator()));
/*    */     }
/*    */ 
/*    */     
/* 61 */     serializeProperties(log, mediator.getProperties());
/*    */     
/* 63 */     if (parent != null) {
/* 64 */       parent.addChild((OMNode)log);
/*    */     }
/* 66 */     return log;
/*    */   }
/*    */ 
/*    */   
/* 70 */   public String getMediatorClassName() { return LogMediator.class.getName(); }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\LogMediatorSerializer.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.MediatorFactory,"package org.apache.synapse.config.xml;
import javax.xml.namespace.QName;
import org.apache.axiom.om.OMElement;
import org.apache.synapse.Mediator;
public interface MediatorFactory {
  Mediator createMediator(OMElement paramOMElement);
  QName getTagQName();
}
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\MediatorFactory.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.MediatorFactoryFinder,"/*     */ package org.apache.synapse.config.xml;
/*     */ 
/*     */ import java.util.HashMap;
/*     */ import java.util.Iterator;
/*     */ import java.util.Map;
/*     */ import javax.xml.namespace.QName;
/*     */ import org.apache.axiom.om.OMElement;
/*     */ import org.apache.axiom.om.OMNode;
/*     */ import org.apache.commons.logging.Log;
/*     */ import org.apache.commons.logging.LogFactory;
/*     */ import org.apache.synapse.Mediator;
/*     */ import org.apache.synapse.SynapseException;
/*     */ import org.apache.synapse.config.XMLToObjectMapper;
/*     */ import sun.misc.Service;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class MediatorFactoryFinder
/*     */   implements XMLToObjectMapper
/*     */ {
/*  46 */   private static final Log log = LogFactory.getLog(MediatorFactoryFinder.class);
/*     */   
/*  48 */   private static final Class[] mediatorFactories = new Class[] { SequenceMediatorFactory.class, LogMediatorFactory.class, SendMediatorFactory.class, FilterMediatorFactory.class, SynapseMediatorFactory.class, DropMediatorFactory.class, HeaderMediatorFactory.class, FaultMediatorFactory.class, PropertyMediatorFactory.class, SwitchMediatorFactory.class, InMediatorFactory.class, OutMediatorFactory.class, RMSequenceMediatorFactory.class, ClassMediatorFactory.class, ValidateMediatorFactory.class, XSLTMediatorFactory.class, AnnotatedCommandMediatorFactory.class, POJOCommandMediatorFactory.class, CloneMediatorFactory.class, IterateMediatorFactory.class, AggregateMediatorFactory.class, DBReportMediatorFactory.class, DBLookupMediatorFactory.class, CacheMediatorFactory.class, CalloutMediatorFactory.class };
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  76 */   private static MediatorFactoryFinder instance = null;
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  81 */   private static Map<QName, Class> factoryMap = (Map)new HashMap<QName, Class<?>>();
/*     */   
/*     */   public static synchronized MediatorFactoryFinder getInstance() {
/*  84 */     if (instance == null) {
/*  85 */       instance = new MediatorFactoryFinder();
/*     */     }
/*  87 */     return instance;
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public synchronized void reset() {
/*  94 */     factoryMap.clear();
/*  95 */     instance = null;
/*     */   }
/*     */ 
/*     */   
/*     */   private MediatorFactoryFinder() {
/* 100 */     factoryMap = (Map)new HashMap<QName, Class<?>>();
/*     */     
/* 102 */     for (Class<MediatorFactory> c : mediatorFactories) {
/*     */       try {
/* 104 */         MediatorFactory fac = c.newInstance();
/* 105 */         factoryMap.put(fac.getTagQName(), c);
/* 106 */       } catch (Exception e) {
/* 107 */         throw new SynapseException(""Error instantiating "" + c.getName(), e);
/*     */       } 
/*     */     } 
/*     */     
/* 111 */     registerExtensions();
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   private void registerExtensions() {
/* 123 */     Iterator<MediatorFactory> it = Service.providers(MediatorFactory.class);
/* 124 */     while (it.hasNext()) {
/* 125 */       MediatorFactory mf = it.next();
/* 126 */       QName tag = mf.getTagQName();
/* 127 */       factoryMap.put(tag, mf.getClass());
/* 128 */       if (log.isDebugEnabled()) {
/* 129 */         log.debug(""Added MediatorFactory "" + mf.getClass() + "" to handle "" + tag);
/*     */       }
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public Mediator getMediator(OMElement element) {
/*     */     QName qName;
/* 144 */     String localName = element.getLocalName();
/*     */     
/* 146 */     if (element.getNamespace() != null) {
/* 147 */       qName = new QName(element.getNamespace().getNamespaceURI(), localName);
/*     */     } else {
/* 149 */       qName = new QName(localName);
/*     */     } 
/* 151 */     if (log.isDebugEnabled()) {
/* 152 */       log.debug(""getMediator("" + qName + "")"");
/*     */     }
/* 154 */     Class<MediatorFactory> cls = factoryMap.get(qName);
/*     */     
/* 156 */     if (cls == null && localName.indexOf('.') > -1) {
/* 157 */       String newLocalName = localName.substring(0, localName.indexOf('.'));
/* 158 */       qName = new QName(element.getNamespace().getNamespaceURI(), newLocalName);
/* 159 */       if (log.isDebugEnabled()) {
/* 160 */         log.debug(""getMediator.2("" + qName + "")"");
/*     */       }
/* 162 */       cls = factoryMap.get(qName);
/*     */     } 
/*     */     
/* 165 */     if (cls == null) {
/* 166 */       String msg = ""Unknown mediator referenced by configuration element : "" + qName;
/* 167 */       log.error(msg);
/* 168 */       throw new SynapseException(msg);
/*     */     } 
/*     */     
/*     */     try {
/* 172 */       MediatorFactory mf = cls.newInstance();
/* 173 */       return mf.createMediator(element);
/*     */     }
/* 175 */     catch (InstantiationException e) {
/* 176 */       String msg = ""Error initializing mediator factory : "" + cls;
/* 177 */       log.error(msg);
/* 178 */       throw new SynapseException(msg, e);
/*     */     }
/* 180 */     catch (IllegalAccessException e) {
/* 181 */       String msg = ""Error initializing mediator factory : "" + cls;
/* 182 */       log.error(msg);
/* 183 */       throw new SynapseException(msg, e);
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 192 */   public Map<QName, Class> getFactoryMap() { return factoryMap; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public Object getObjectFromOMNode(OMNode om) {
/* 202 */     if (om instanceof OMElement) {
/* 203 */       return getMediator((OMElement)om);
/*     */     }
/* 205 */     handleException(""Invalid mediator configuration XML : "" + om);
/*     */     
/* 207 */     return null;
/*     */   }
/*     */   
/*     */   private void handleException(String msg) {
/* 211 */     log.error(msg);
/* 212 */     throw new SynapseException(msg);
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\MediatorFactoryFinder.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.MediatorPropertyFactory,"/*     */ package org.apache.synapse.config.xml;
/*     */ 
/*     */ import java.util.ArrayList;
/*     */ import java.util.Iterator;
/*     */ import java.util.List;
/*     */ import javax.xml.namespace.QName;
/*     */ import org.apache.axiom.om.OMAttribute;
/*     */ import org.apache.axiom.om.OMElement;
/*     */ import org.apache.commons.logging.Log;
/*     */ import org.apache.commons.logging.LogFactory;
/*     */ import org.apache.synapse.SynapseException;
/*     */ import org.apache.synapse.mediators.MediatorProperty;
/*     */ import org.jaxen.JaxenException;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class MediatorPropertyFactory
/*     */ {
/*  47 */   private static final Log log = LogFactory.getLog(MediatorPropertyFactory.class);
/*     */ 
/*     */   
/*     */   public static List<MediatorProperty> getMediatorProperties(OMElement elem) {
/*  51 */     List<MediatorProperty> propertyList = new ArrayList<MediatorProperty>();
/*     */     
/*  53 */     Iterator<OMElement> iter = elem.getChildrenWithName(new QName(""http://ws.apache.org/ns/synapse"", ""property""));
/*     */ 
/*     */     
/*  56 */     while (iter.hasNext()) {
/*     */       
/*  58 */       OMElement propEle = iter.next();
/*  59 */       OMAttribute attName = propEle.getAttribute(MediatorProperty.ATT_NAME_Q);
/*  60 */       OMAttribute attValue = propEle.getAttribute(MediatorProperty.ATT_VALUE_Q);
/*  61 */       OMAttribute attExpr = propEle.getAttribute(MediatorProperty.ATT_EXPR_Q);
/*     */       
/*  63 */       MediatorProperty prop = new MediatorProperty();
/*     */       
/*  65 */       if (attName == null || attName.getAttributeValue() == null || attName.getAttributeValue().trim().length() == 0) {
/*     */         
/*  67 */         String msg = ""Entry name is a required attribute for a Log property"";
/*  68 */         log.error(msg);
/*  69 */         throw new SynapseException(msg);
/*     */       } 
/*  71 */       prop.setName(attName.getAttributeValue());
/*     */ 
/*     */ 
/*     */       
/*  75 */       if (attValue != null) {
/*     */         
/*  77 */         if (attValue.getAttributeValue() == null || attValue.getAttributeValue().trim().length() == 0) {
/*     */ 
/*     */           
/*  80 */           String msg = ""Entry attribute value (if specified) is required for a Log property"";
/*     */           
/*  82 */           log.error(msg);
/*  83 */           throw new SynapseException(msg);
/*     */         } 
/*     */         
/*  86 */         prop.setValue(attValue.getAttributeValue());
/*     */       
/*     */       }
/*  89 */       else if (attExpr != null) {
/*     */         
/*  91 */         if (attExpr.getAttributeValue() == null || attExpr.getAttributeValue().trim().length() == 0) {
/*     */ 
/*     */           
/*  94 */           String msg = ""Entry attribute expression (if specified) is required for a mediator property"";
/*     */           
/*  96 */           log.error(msg);
/*  97 */           throw new SynapseException(msg);
/*     */         } 
/*     */         
/*     */         try {
/* 101 */           prop.setExpression(SynapseXPathFactory.getSynapseXPath(propEle, MediatorProperty.ATT_EXPR_Q));
/*     */         
/*     */         }
/* 104 */         catch (JaxenException e) {
/* 105 */           String msg = ""Invalid XPapth expression : "" + attExpr.getAttributeValue();
/* 106 */           log.error(msg);
/* 107 */           throw new SynapseException(msg, (Throwable)e);
/*     */         }
/*     */       
/*     */       } else {
/*     */         
/* 112 */         String msg = ""Entry attribute value OR expression must be specified for a mediator property"";
/*     */         
/* 114 */         log.error(msg);
/* 115 */         throw new SynapseException(msg);
/*     */       } 
/*     */       
/* 118 */       propertyList.add(prop);
/*     */     } 
/*     */     
/* 121 */     return propertyList;
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\MediatorPropertyFactory.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.MediatorSerializer,"package org.apache.synapse.config.xml;
import org.apache.axiom.om.OMElement;
import org.apache.synapse.Mediator;
public interface MediatorSerializer {
  OMElement serializeMediator(OMElement paramOMElement, Mediator paramMediator);
  String getMediatorClassName();
}
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\MediatorSerializer.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.MediatorSerializerFinder,"/*     */ package org.apache.synapse.config.xml;
/*     */ 
/*     */ import java.util.HashMap;
/*     */ import java.util.Iterator;
/*     */ import java.util.Map;
/*     */ import org.apache.commons.logging.Log;
/*     */ import org.apache.commons.logging.LogFactory;
/*     */ import org.apache.synapse.Mediator;
/*     */ import org.apache.synapse.SynapseException;
/*     */ import sun.misc.Service;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class MediatorSerializerFinder
/*     */ {
/*  34 */   private static final Log log = LogFactory.getLog(MediatorSerializerFinder.class);
/*     */   
/*  36 */   private static final Class[] mediatorSerializers = new Class[] { SequenceMediatorSerializer.class, LogMediatorSerializer.class, SendMediatorSerializer.class, FilterMediatorSerializer.class, SynapseMediatorSerializer.class, DropMediatorSerializer.class, HeaderMediatorSerializer.class, FaultMediatorSerializer.class, PropertyMediatorSerializer.class, SwitchMediatorSerializer.class, InMediatorSerializer.class, OutMediatorSerializer.class, RMSequenceMediatorSerializer.class, ClassMediatorSerializer.class, ValidateMediatorSerializer.class, XSLTMediatorSerializer.class, POJOCommandMediatorSerializer.class, CloneMediatorSerializer.class, IterateMediatorSerializer.class, AggregateMediatorSerializer.class, DBLookupMediatorSerializer.class, DBReportMediatorSerializer.class, CacheMediatorSerializer.class, CalloutMediatorSerializer.class };
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  63 */   private static MediatorSerializerFinder instance = null;
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  68 */   private static Map<String, MediatorSerializer> serializerMap = new HashMap<String, MediatorSerializer>();
/*     */ 
/*     */   
/*     */   public static synchronized MediatorSerializerFinder getInstance() {
/*  72 */     if (instance == null) {
/*  73 */       instance = new MediatorSerializerFinder();
/*     */     }
/*  75 */     return instance;
/*     */   }
/*     */ 
/*     */   
/*  79 */   public MediatorSerializer getSerializer(Mediator mediator) { return serializerMap.get(mediator.getClass().getName()); }
/*     */ 
/*     */ 
/*     */   
/*     */   private MediatorSerializerFinder() {
/*  84 */     serializerMap = new HashMap<String, MediatorSerializer>();
/*     */     
/*  86 */     for (Class<MediatorSerializer> c : mediatorSerializers) {
/*     */       try {
/*  88 */         MediatorSerializer ser = c.newInstance();
/*  89 */         serializerMap.put(ser.getMediatorClassName(), ser);
/*  90 */       } catch (Exception e) {
/*  91 */         throw new SynapseException(""Error instantiating "" + c.getName(), e);
/*     */       } 
/*     */     } 
/*     */     
/*  95 */     registerExtensions();
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   private void registerExtensions() {
/* 105 */     if (log.isDebugEnabled()) {
/* 106 */       log.debug(""Registering mediator extensions found in the classpath.. "");
/*     */     }
/*     */     
/* 109 */     Iterator<MediatorSerializer> it = Service.providers(MediatorSerializer.class);
/* 110 */     while (it.hasNext()) {
/* 111 */       MediatorSerializer ms = it.next();
/* 112 */       String name = ms.getMediatorClassName();
/*     */       try {
/* 114 */         serializerMap.put(name, (MediatorSerializer)ms.getClass().newInstance());
/* 115 */       } catch (InstantiationException e) {
/* 116 */         handleException(""Error instantiating mediator serializer : "" + ms);
/* 117 */       } catch (IllegalAccessException e) {
/* 118 */         handleException(""Error instantiating mediator serializer : "" + ms);
/*     */       } 
/* 120 */       if (log.isDebugEnabled()) {
/* 121 */         log.debug(""Added MediatorSerializer "" + ms.getClass().getName() + "" to handle "" + name);
/*     */       }
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 132 */   public Map<String, MediatorSerializer> getSerializerMap() { return serializerMap; }
/*     */ 
/*     */   
/*     */   private static void handleException(String msg) {
/* 136 */     log.error(msg);
/* 137 */     throw new SynapseException(msg);
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\MediatorSerializerFinder.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.OMElementUtils,"/*     */ package org.apache.synapse.config.xml;
/*     */ 
/*     */ import java.util.Iterator;
/*     */ import org.apache.axiom.om.OMContainer;
/*     */ import org.apache.axiom.om.OMElement;
/*     */ import org.apache.axiom.om.OMNamespace;
/*     */ import org.apache.commons.logging.Log;
/*     */ import org.apache.commons.logging.LogFactory;
/*     */ import org.apache.synapse.SynapseException;
/*     */ import org.jaxen.JaxenException;
/*     */ import org.jaxen.XPath;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class OMElementUtils
/*     */ {
/*  39 */   private static final Log log = LogFactory.getLog(OMElementUtils.class);
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public static String getNameSpaceWithPrefix(String prefix, OMElement elem) {
/*  48 */     if (prefix == null || elem == null) {
/*  49 */       log.warn(""Searching for null NS prefix and/or using null OMElement"");
/*  50 */       return null;
/*     */     } 
/*     */     
/*  53 */     OMElement currentElem = elem;
/*     */     while (true) {
/*  55 */       Iterator<OMNamespace> iter = currentElem.getAllDeclaredNamespaces();
/*  56 */       while (iter.hasNext()) {
/*  57 */         OMNamespace ns = iter.next();
/*  58 */         if (prefix.equals(ns.getPrefix())) {
/*  59 */           return ns.getNamespaceURI();
/*     */         }
/*     */       } 
/*  62 */       OMContainer parent = currentElem.getParent();
/*  63 */       if (parent != null && parent instanceof OMElement) {
/*  64 */         currentElem = (OMElement)parent; continue;
/*     */       }  break;
/*  66 */     }  return null;
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public static void addNameSpaces(XPath xpath, OMElement elem, Log log) {
/*  93 */     OMElement currentElem = elem;
/*     */     
/*  95 */     while (currentElem != null) {
/*  96 */       Iterator<OMNamespace> it = currentElem.getAllDeclaredNamespaces();
/*  97 */       while (it.hasNext()) {
/*     */         
/*  99 */         OMNamespace n = it.next();
/*     */         
/* 101 */         if (n != null && !"""".equals(n.getPrefix())) {
/*     */           
/*     */           try {
/* 104 */             xpath.addNamespace(n.getPrefix(), n.getNamespaceURI());
/* 105 */           } catch (JaxenException je) {
/* 106 */             String msg = ""Error adding declared name space with prefix : "" + n.getPrefix() + ""and uri : "" + n.getNamespaceURI() + "" to the XPath : "" + xpath;
/*     */ 
/*     */             
/* 109 */             log.error(msg);
/* 110 */             throw new SynapseException(msg, (Throwable)je);
/*     */           } 
/*     */         }
/*     */       } 
/*     */       
/* 115 */       OMContainer parent = currentElem.getParent();
/*     */       
/* 117 */       if (parent == null || parent instanceof org.apache.axiom.om.OMDocument) {
/*     */         return;
/*     */       }
/* 120 */       if (parent instanceof OMElement)
/* 121 */         currentElem = (OMElement)parent; 
/*     */     } 
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\OMElementUtils.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.OutMediatorFactory,"/*    */ package org.apache.synapse.config.xml;
/*    */ 
/*    */ import javax.xml.namespace.QName;
/*    */ import org.apache.axiom.om.OMElement;
/*    */ import org.apache.synapse.Mediator;
/*    */ import org.apache.synapse.mediators.ListMediator;
/*    */ import org.apache.synapse.mediators.filters.OutMediator;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class OutMediatorFactory
/*    */   extends AbstractListMediatorFactory
/*    */ {
/* 39 */   private static final QName OUT_Q = new QName(""http://ws.apache.org/ns/synapse"", ""out"");
/*    */   
/*    */   public Mediator createMediator(OMElement elem) {
/* 42 */     OutMediator filter = new OutMediator();
/*    */ 
/*    */ 
/*    */     
/* 46 */     processTraceState((Mediator)filter, elem);
/*    */     
/* 48 */     addChildren(elem, (ListMediator)filter);
/* 49 */     return (Mediator)filter;
/*    */   }
/*    */ 
/*    */   
/* 53 */   public QName getTagQName() { return OUT_Q; }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\OutMediatorFactory.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.OutMediatorSerializer,"/*    */ package org.apache.synapse.config.xml;
/*    */ 
/*    */ import org.apache.axiom.om.OMElement;
/*    */ import org.apache.axiom.om.OMNode;
/*    */ import org.apache.synapse.Mediator;
/*    */ import org.apache.synapse.mediators.filters.OutMediator;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class OutMediatorSerializer
/*    */   extends AbstractListMediatorSerializer
/*    */ {
/*    */   public OMElement serializeMediator(OMElement parent, Mediator m) {
/* 32 */     if (!(m instanceof OutMediator)) {
/* 33 */       handleException(""Unsupported mediator passed out for serialization : "" + m.getType());
/*    */     }
/*    */     
/* 36 */     OutMediator mediator = (OutMediator)m;
/* 37 */     OMElement out = fac.createOMElement(""out"", synNS);
/* 38 */     saveTracingState(out, (Mediator)mediator);
/* 39 */     serializeChildren(out, mediator.getList());
/*    */     
/* 41 */     if (parent != null) {
/* 42 */       parent.addChild((OMNode)out);
/*    */     }
/* 44 */     return out;
/*    */   }
/*    */ 
/*    */   
/* 48 */   public String getMediatorClassName() { return OutMediator.class.getName(); }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\OutMediatorSerializer.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.POJOCommandMediatorFactory,"/*     */ package org.apache.synapse.config.xml;
/*     */ 
/*     */ import java.util.Iterator;
/*     */ import javax.xml.namespace.QName;
/*     */ import org.apache.axiom.om.OMAttribute;
/*     */ import org.apache.axiom.om.OMElement;
/*     */ import org.apache.synapse.Mediator;
/*     */ import org.apache.synapse.SynapseException;
/*     */ import org.apache.synapse.mediators.ext.POJOCommandMediator;
/*     */ import org.apache.synapse.util.xpath.SynapseXPath;
/*     */ import org.jaxen.JaxenException;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class POJOCommandMediatorFactory
/*     */   extends AbstractMediatorFactory
/*     */ {
/*  54 */   private static final QName POJO_COMMAND_Q = new QName(""http://ws.apache.org/ns/synapse"", ""pojoCommand"");
/*     */   
/*  56 */   protected static final QName ATT_ACTION = new QName(""action"");
/*  57 */   protected static final QName ATT_CTXNAME = new QName(""context-name"");
/*     */   
/*     */   protected static final String RM_ACTION = ""ReadMessage"";
/*     */   
/*     */   protected static final String UM_ACTION = ""UpdateMessage"";
/*     */   protected static final String RC_ACTION = ""ReadContext"";
/*     */   protected static final String UC_ACTION = ""UpdateContext"";
/*     */   protected static final String RAUM_ACTION = ""ReadAndUpdateMessage"";
/*     */   protected static final String RAUC_ACTION = ""ReadAndUpdateContext"";
/*     */   
/*     */   public Mediator createMediator(OMElement elem) {
/*  68 */     POJOCommandMediator pojoMediator = new POJOCommandMediator();
/*     */ 
/*     */     
/*  71 */     OMAttribute name = elem.getAttribute(ATT_NAME);
/*  72 */     if (name == null) {
/*  73 */       String msg = ""The name of the actual POJO command implementation class is a required attribute"";
/*     */       
/*  75 */       log.error(msg);
/*  76 */       throw new SynapseException(msg);
/*     */     } 
/*     */ 
/*     */     
/*     */     try {
/*  81 */       pojoMediator.setCommand(getClass().getClassLoader().loadClass(name.getAttributeValue()));
/*     */     }
/*  83 */     catch (ClassNotFoundException e) {
/*  84 */       handleException(""Unable to load the class specified as the command "" + name.getAttributeValue(), e);
/*     */     } 
/*     */ 
/*     */ 
/*     */ 
/*     */     
/*  90 */     for (Iterator<OMElement> it = elem.getChildElements(); it.hasNext(); ) {
/*  91 */       OMElement child = it.next();
/*  92 */       if (""property"".equals(child.getLocalName())) {
/*     */         
/*  94 */         OMAttribute nameAttr = child.getAttribute(ATT_NAME);
/*  95 */         if (nameAttr != null && nameAttr.getAttributeValue() != null && !"""".equals(nameAttr.getAttributeValue())) {
/*     */ 
/*     */           
/*  98 */           handlePropertyAction(nameAttr.getAttributeValue(), child, pojoMediator); continue;
/*     */         } 
/* 100 */         handleException(""A POJO command mediator property must specify the name attribute"");
/*     */       } 
/*     */     } 
/*     */ 
/*     */ 
/*     */     
/* 106 */     return (Mediator)pojoMediator;
/*     */   }
/*     */ 
/*     */   
/*     */   private void handlePropertyAction(String name, OMElement propElem, POJOCommandMediator m) {
/* 111 */     OMAttribute valueAttr = propElem.getAttribute(ATT_VALUE);
/* 112 */     OMAttribute exprAttr = propElem.getAttribute(ATT_EXPRN);
/* 113 */     OMAttribute ctxNameAttr = propElem.getAttribute(ATT_CTXNAME);
/* 114 */     OMAttribute actionAttr = propElem.getAttribute(ATT_ACTION);
/*     */     
/* 116 */     SynapseXPath xpath = null;
/*     */     try {
/* 118 */       if (exprAttr != null) {
/* 119 */         xpath = SynapseXPathFactory.getSynapseXPath(propElem, ATT_EXPRN);
/*     */       }
/* 121 */     } catch (JaxenException e) {
/* 122 */       handleException(""Error in building the expression as an SynapseXPath"" + e);
/*     */     } 
/*     */ 
/*     */     
/* 126 */     if (valueAttr != null) {
/* 127 */       String value = valueAttr.getAttributeValue();
/*     */       
/* 129 */       if (exprAttr != null && ctxNameAttr != null) {
/* 130 */         handleException(""Command properties can not contain all three 'value', 'expression' and 'context-name' attributes. Only one or combination of two can be there."");
/*     */       }
/*     */       else {
/*     */         
/* 134 */         m.addStaticSetterProperty(name, value);
/* 135 */         if (exprAttr != null) {
/*     */           
/* 137 */           m.addMessageGetterProperty(name, xpath);
/* 138 */         } else if (ctxNameAttr != null) {
/*     */           
/* 140 */           m.addContextGetterProperty(name, ctxNameAttr.getAttributeValue());
/*     */         } 
/*     */       } 
/* 143 */     } else if (propElem.getFirstElement() != null) {
/*     */       
/* 145 */       if (exprAttr != null && ctxNameAttr != null) {
/* 146 */         handleException(""Command properties can not contain all the 'expression' and 'context-name' attributes with a child. Only one attribute of those can co-exists with a child"");
/*     */       }
/*     */       else {
/*     */         
/* 150 */         m.addStaticSetterProperty(name, propElem.getFirstElement());
/* 151 */         if (exprAttr != null) {
/*     */           
/* 153 */           m.addMessageGetterProperty(name, xpath);
/* 154 */         } else if (ctxNameAttr != null) {
/*     */           
/* 156 */           m.addContextGetterProperty(name, ctxNameAttr.getAttributeValue());
/*     */         }
/*     */       
/*     */       }
/*     */     
/* 161 */     } else if (exprAttr != null && ctxNameAttr != null) {
/* 162 */       if (actionAttr != null && actionAttr.getAttributeValue() != null) {
/* 163 */         String action = actionAttr.getAttributeValue();
/* 164 */         if (""ReadMessage"".equals(action) || ""UpdateContext"".equals(action)) {
/*     */           
/* 166 */           m.addMessageSetterProperty(name, xpath);
/* 167 */           m.addContextGetterProperty(name, ctxNameAttr.getAttributeValue());
/* 168 */         } else if (""ReadContext"".equals(action) || ""UpdateMessage"".equals(action)) {
/*     */           
/* 170 */           m.addContextSetterProperty(name, ctxNameAttr.getAttributeValue());
/* 171 */           m.addMessageGetterProperty(name, xpath);
/*     */         } else {
/* 173 */           handleException(""Invalid action for the command property with the name "" + name);
/*     */         } 
/*     */       } else {
/*     */         
/* 177 */         handleException(""Action attribute is required for the command property with name "" + name);
/*     */       
/*     */       }
/*     */     
/*     */     }
/* 182 */     else if (actionAttr != null && actionAttr.getAttributeValue() != null) {
/* 183 */       String action = actionAttr.getAttributeValue();
/* 184 */       if (exprAttr != null) {
/* 185 */         if (""ReadMessage"".equals(action)) {
/*     */           
/* 187 */           m.addMessageSetterProperty(name, xpath);
/* 188 */         } else if (""UpdateMessage"".equals(action)) {
/*     */           
/* 190 */           m.addMessageGetterProperty(name, xpath);
/* 191 */         } else if (""ReadAndUpdateMessage"".equals(action)) {
/*     */           
/* 193 */           m.addMessageSetterProperty(name, xpath);
/* 194 */           m.addMessageGetterProperty(name, xpath);
/*     */         } else {
/* 196 */           handleException(""Invalid action for the command property with the name "" + name);
/*     */         }
/*     */       
/* 199 */       } else if (ctxNameAttr != null) {
/* 200 */         String ctxName = ctxNameAttr.getAttributeValue();
/* 201 */         if (""ReadContext"".equals(action)) {
/*     */           
/* 203 */           m.addContextSetterProperty(name, ctxName);
/* 204 */         } else if (""UpdateContext"".equals(action)) {
/*     */           
/* 206 */           m.addContextGetterProperty(name, ctxName);
/* 207 */         } else if (""ReadAndUpdateContext"".equals(action)) {
/*     */           
/* 209 */           m.addContextSetterProperty(name, ctxName);
/* 210 */           m.addContextGetterProperty(name, ctxName);
/*     */         } else {
/* 212 */           handleException(""Invalid action for the command property with the name "" + name);
/*     */         } 
/*     */       } else {
/*     */         
/* 216 */         handleException(""Unrecognized command property with the name "" + name);
/*     */       }
/*     */     
/*     */     }
/* 220 */     else if (exprAttr != null) {
/* 221 */       m.addMessageSetterProperty(name, xpath);
/* 222 */       m.addMessageGetterProperty(name, xpath);
/* 223 */     } else if (ctxNameAttr != null) {
/* 224 */       String ctxName = ctxNameAttr.getAttributeValue();
/* 225 */       m.addContextSetterProperty(name, ctxName);
/* 226 */       m.addContextGetterProperty(name, ctxName);
/*     */     } else {
/* 228 */       handleException(""Unrecognized command property with the name "" + name);
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 236 */   public QName getTagQName() { return POJO_COMMAND_Q; }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\POJOCommandMediatorFactory.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.POJOCommandMediatorSerializer,"/*     */ package org.apache.synapse.config.xml;
/*     */ 
/*     */ import org.apache.axiom.om.OMElement;
/*     */ import org.apache.axiom.om.OMNode;
/*     */ import org.apache.synapse.Mediator;
/*     */ import org.apache.synapse.mediators.ext.POJOCommandMediator;
/*     */ import org.apache.synapse.util.xpath.SynapseXPath;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class POJOCommandMediatorSerializer
/*     */   extends AbstractMediatorSerializer
/*     */ {
/*     */   public OMElement serializeMediator(OMElement parent, Mediator m) {
/*  35 */     if (!(m instanceof POJOCommandMediator)) {
/*  36 */       handleException(""Unsupported mediator passed in for serialization : "" + m.getType());
/*     */     }
/*     */     
/*  39 */     POJOCommandMediator mediator = (POJOCommandMediator)m;
/*     */     
/*  41 */     OMElement pojoCommand = fac.createOMElement(""pojoCommand"", synNS);
/*  42 */     saveTracingState(pojoCommand, (Mediator)mediator);
/*     */     
/*  44 */     if (mediator.getCommand() != null && mediator.getCommand().getClass().getName() != null) {
/*  45 */       pojoCommand.addAttribute(fac.createOMAttribute(""name"", nullNS, mediator.getCommand().getName()));
/*     */     } else {
/*     */       
/*  48 */       handleException(""Invalid POJO Command mediator. The command class name is required"");
/*     */     } 
/*     */     
/*  51 */     for (String propName : mediator.getStaticSetterProperties().keySet()) {
/*  52 */       Object value = mediator.getStaticSetterProperties().get(propName);
/*  53 */       OMElement prop = fac.createOMElement(PROP_Q);
/*  54 */       prop.addAttribute(fac.createOMAttribute(""name"", nullNS, propName));
/*     */       
/*  56 */       if (value instanceof String) {
/*  57 */         prop.addAttribute(fac.createOMAttribute(""value"", nullNS, (String)value));
/*  58 */       } else if (value instanceof OMElement) {
/*  59 */         prop.addChild((OMNode)value);
/*     */       } else {
/*  61 */         handleException(""Unable to serialize the command mediator property with the naem "" + propName + "" : Unknown type"");
/*     */       } 
/*     */ 
/*     */       
/*  65 */       if (mediator.getContextGetterProperties().containsKey(propName)) {
/*  66 */         prop.addAttribute(fac.createOMAttribute(""context-name"", nullNS, (String)mediator.getContextGetterProperties().get(propName)));
/*     */       }
/*  68 */       else if (mediator.getMessageGetterProperties().containsKey(propName)) {
/*  69 */         SynapseXPathSerializer.serializeXPath((SynapseXPath)mediator.getMessageGetterProperties().get(propName), prop, ""expression"");
/*     */       } 
/*     */       
/*  72 */       pojoCommand.addChild((OMNode)prop);
/*     */     } 
/*     */     
/*  75 */     for (String propName : mediator.getMessageSetterProperties().keySet()) {
/*  76 */       OMElement prop = fac.createOMElement(PROP_Q);
/*  77 */       prop.addAttribute(fac.createOMAttribute(""name"", nullNS, propName));
/*  78 */       SynapseXPathSerializer.serializeXPath((SynapseXPath)mediator.getMessageSetterProperties().get(propName), prop, ""expression"");
/*     */ 
/*     */       
/*  81 */       if (mediator.getMessageGetterProperties().containsKey(propName)) {
/*  82 */         prop.addAttribute(fac.createOMAttribute(""action"", nullNS, ""ReadAndUpdateMessage""));
/*  83 */       } else if (mediator.getContextGetterProperties().containsKey(propName)) {
/*  84 */         prop.addAttribute(fac.createOMAttribute(""context-name"", nullNS, (String)mediator.getContextGetterProperties().get(propName)));
/*     */         
/*  86 */         prop.addAttribute(fac.createOMAttribute(""action"", nullNS, ""ReadMessage""));
/*     */       } else {
/*  88 */         prop.addAttribute(fac.createOMAttribute(""action"", nullNS, ""ReadMessage""));
/*     */       } 
/*  90 */       pojoCommand.addChild((OMNode)prop);
/*     */     } 
/*     */     
/*  93 */     for (String propName : mediator.getContextSetterProperties().keySet()) {
/*  94 */       OMElement prop = fac.createOMElement(PROP_Q);
/*  95 */       prop.addAttribute(fac.createOMAttribute(""name"", nullNS, propName));
/*  96 */       prop.addAttribute(fac.createOMAttribute(""context-name"", nullNS, (String)mediator.getContextSetterProperties().get(propName)));
/*     */ 
/*     */       
/*  99 */       if (mediator.getContextGetterProperties().containsKey(propName)) {
/* 100 */         prop.addAttribute(fac.createOMAttribute(""action"", nullNS, ""ReadAndUpdateContext""));
/* 101 */       } else if (mediator.getMessageGetterProperties().containsKey(propName)) {
/* 102 */         SynapseXPathSerializer.serializeXPath((SynapseXPath)mediator.getMessageGetterProperties().get(propName), prop, ""expression"");
/*     */         
/* 104 */         prop.addAttribute(fac.createOMAttribute(""action"", nullNS, ""ReadContext""));
/*     */       } else {
/* 106 */         prop.addAttribute(fac.createOMAttribute(""action"", nullNS, ""ReadContext""));
/*     */       } 
/* 108 */       pojoCommand.addChild((OMNode)prop);
/*     */     } 
/*     */     
/* 111 */     for (String propName : mediator.getContextGetterProperties().keySet()) {
/* 112 */       if (!isSerialized(propName, mediator)) {
/* 113 */         String value = (String)mediator.getContextGetterProperties().get(propName);
/* 114 */         OMElement prop = fac.createOMElement(PROP_Q);
/* 115 */         prop.addAttribute(fac.createOMAttribute(""name"", nullNS, propName));
/* 116 */         prop.addAttribute(fac.createOMAttribute(""context-name"", nullNS, value));
/* 117 */         prop.addAttribute(fac.createOMAttribute(""action"", nullNS, ""UpdateContext""));
/* 118 */         pojoCommand.addChild((OMNode)prop);
/*     */       } 
/*     */     } 
/*     */     
/* 122 */     for (String propName : mediator.getMessageGetterProperties().keySet()) {
/* 123 */       if (!isSerialized(propName, mediator)) {
/* 124 */         OMElement prop = fac.createOMElement(PROP_Q);
/* 125 */         prop.addAttribute(fac.createOMAttribute(""name"", nullNS, propName));
/* 126 */         SynapseXPathSerializer.serializeXPath((SynapseXPath)mediator.getMessageGetterProperties().get(propName), prop, ""expression"");
/*     */         
/* 128 */         prop.addAttribute(fac.createOMAttribute(""action"", nullNS, ""UpdateMessage""));
/* 129 */         pojoCommand.addChild((OMNode)prop);
/*     */       } 
/*     */     } 
/*     */     
/* 133 */     if (parent != null) {
/* 134 */       parent.addChild((OMNode)pojoCommand);
/*     */     }
/* 136 */     return pojoCommand;
/*     */   }
/*     */ 
/*     */   
/* 140 */   private boolean isSerialized(String propName, POJOCommandMediator m) { return (m.getContextSetterProperties().containsKey(propName) || m.getStaticSetterProperties().containsKey(propName) || m.getMessageSetterProperties().containsKey(propName)); }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 146 */   public String getMediatorClassName() { return POJOCommandMediator.class.getName(); }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\POJOCommandMediatorSerializer.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.PropertyHelper,"/*     */ package org.apache.synapse.config.xml;
/*     */ 
/*     */ import java.lang.reflect.Method;
/*     */ import javax.xml.namespace.QName;
/*     */ import org.apache.axiom.om.OMElement;
/*     */ import org.apache.commons.logging.Log;
/*     */ import org.apache.commons.logging.LogFactory;
/*     */ import org.apache.synapse.SynapseException;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class PropertyHelper
/*     */ {
/*  39 */   private static final Log log = LogFactory.getLog(PropertyHelper.class);
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public static void setInstanceProperty(String name, Object val, Object obj) {
/*  50 */     String mName = ""set"" + Character.toUpperCase(name.charAt(0)) + name.substring(1);
/*  51 */     Method method = null;
/*     */     
/*     */     try {
/*  54 */       Method[] methods = obj.getClass().getMethods();
/*  55 */       boolean invoked = false;
/*     */       
/*  57 */       for (int i = 0; i < methods.length; i++) {
/*  58 */         if (mName.equals(methods[i].getName())) {
/*  59 */           Class[] params = methods[i].getParameterTypes();
/*  60 */           if (params.length != 1) {
/*  61 */             handleException(""Did not find a setter method named : "" + mName + ""() that takes a single String, int, long, float, double "" + ""or boolean parameter"");
/*     */           
/*     */           }
/*  64 */           else if (val instanceof String) {
/*  65 */             String value = (String)val;
/*  66 */             if (params[0].equals(String.class)) {
/*  67 */               method = obj.getClass().getMethod(mName, new Class[] { String.class });
/*  68 */               method.invoke(obj, (Object[])new String[] { value });
/*  69 */             } else if (params[0].equals(int.class)) {
/*  70 */               method = obj.getClass().getMethod(mName, new Class[] { int.class });
/*  71 */               method.invoke(obj, (Object[])new Integer[] { new Integer(value) });
/*  72 */             } else if (params[0].equals(long.class)) {
/*  73 */               method = obj.getClass().getMethod(mName, new Class[] { long.class });
/*  74 */               method.invoke(obj, (Object[])new Long[] { new Long(value) });
/*  75 */             } else if (params[0].equals(float.class)) {
/*  76 */               method = obj.getClass().getMethod(mName, new Class[] { float.class });
/*  77 */               method.invoke(obj, (Object[])new Float[] { new Float(value) });
/*  78 */             } else if (params[0].equals(double.class)) {
/*  79 */               method = obj.getClass().getMethod(mName, new Class[] { double.class });
/*  80 */               method.invoke(obj, (Object[])new Double[] { new Double(value) });
/*  81 */             } else if (params[0].equals(boolean.class)) {
/*  82 */               method = obj.getClass().getMethod(mName, new Class[] { boolean.class });
/*  83 */               method.invoke(obj, (Object[])new Boolean[] { new Boolean(value) });
/*     */             } else {
/*  85 */               handleException(""Did not find a setter method named : "" + mName + ""() that takes a single String, int, long, float, double "" + ""or boolean parameter"");
/*     */             
/*     */             }
/*     */           
/*     */           }
/*  90 */           else if (params[0].equals(OMElement.class)) {
/*  91 */             method = obj.getClass().getMethod(mName, new Class[] { OMElement.class });
/*  92 */             method.invoke(obj, (Object[])new OMElement[] { (OMElement)val });
/*     */           } 
/*     */           
/*  95 */           invoked = true;
/*     */         } 
/*     */       } 
/*     */       
/*  99 */       if (!invoked) {
/* 100 */         handleException(""Did not find a setter method named : "" + mName + ""() that takes a single String, int, long, float, double "" + ""or boolean parameter"");
/*     */       
/*     */       }
/*     */     
/*     */     }
/* 105 */     catch (Exception e) {
/* 106 */       handleException(""Error invoking setter method named : "" + mName + ""() that takes a single String, int, long, float, double "" + ""or boolean parameter"", e);
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public static void setStaticProperty(OMElement property, Object o) {
/* 121 */     if (property.getLocalName().toLowerCase().equals(""property"")) {
/*     */       
/* 123 */       String propertyName = property.getAttributeValue(new QName(""name""));
/* 124 */       String mName = ""set"" + Character.toUpperCase(propertyName.charAt(0)) + propertyName.substring(1);
/*     */ 
/*     */ 
/*     */ 
/*     */       
/* 129 */       if (property.getAttributeValue(new QName(""value"")) != null) {
/* 130 */         String value = property.getAttributeValue(new QName(""value""));
/*     */         
/*     */         try {
/* 133 */           Method method = o.getClass().getMethod(mName, new Class[] { String.class });
/* 134 */           if (log.isDebugEnabled()) {
/* 135 */             log.debug(""Setting property :: invoking method "" + mName + ""("" + value + "")"");
/*     */           }
/*     */           
/* 138 */           method.invoke(o, new Object[] { value });
/*     */         }
/* 140 */         catch (Exception e) {
/* 141 */           handleException(""Error setting property : "" + propertyName + "" as a String property into class mediator : "" + o.getClass() + "" : "" + e.getMessage(), e);
/*     */         
/*     */         }
/*     */       
/*     */       }
/*     */       else {
/*     */         
/* 148 */         OMElement value = property.getFirstElement();
/* 149 */         if (value != null) {
/*     */           
/*     */           try {
/* 152 */             Method method = o.getClass().getMethod(mName, new Class[] { OMElement.class });
/* 153 */             if (log.isDebugEnabled()) {
/* 154 */               log.debug(""Setting property :: invoking method "" + mName + ""("" + value + "")"");
/*     */             }
/*     */             
/* 157 */             method.invoke(o, new Object[] { value });
/*     */           }
/* 159 */           catch (Exception e) {
/* 160 */             handleException(""Error setting property : "" + propertyName + "" as an OMElement property into class mediator : "" + o.getClass() + "" : "" + e.getMessage(), e);
/*     */           } 
/*     */         }
/*     */       } 
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 178 */   public static boolean isStaticProperty(OMElement property) { return (""property"".equals(property.getLocalName().toLowerCase()) && property.getAttributeValue(new QName(""expression"")) == null); }
/*     */ 
/*     */ 
/*     */   
/*     */   private static void handleException(String message, Throwable e) {
/* 183 */     log.error(message + e.getMessage());
/* 184 */     throw new SynapseException(message, e);
/*     */   }
/*     */   
/*     */   private static void handleException(String message) {
/* 188 */     log.error(message);
/* 189 */     throw new SynapseException(message);
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\PropertyHelper.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.PropertyMediatorFactory,"/*    */ package org.apache.synapse.config.xml;
/*    */ 
/*    */ import javax.xml.namespace.QName;
/*    */ import org.apache.axiom.om.OMAttribute;
/*    */ import org.apache.axiom.om.OMElement;
/*    */ import org.apache.synapse.Mediator;
/*    */ import org.apache.synapse.SynapseException;
/*    */ import org.apache.synapse.mediators.builtin.PropertyMediator;
/*    */ import org.jaxen.JaxenException;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class PropertyMediatorFactory
/*    */   extends AbstractMediatorFactory
/*    */ {
/* 39 */   private static final QName ATT_SCOPE = new QName(""scope"");
/* 40 */   private static final QName ATT_ACTION = new QName(""action"");
/*    */ 
/*    */   
/*    */   public Mediator createMediator(OMElement elem) {
/* 44 */     PropertyMediator propMediator = new PropertyMediator();
/* 45 */     OMAttribute name = elem.getAttribute(ATT_NAME);
/* 46 */     OMAttribute value = elem.getAttribute(ATT_VALUE);
/* 47 */     OMAttribute expression = elem.getAttribute(ATT_EXPRN);
/* 48 */     OMAttribute scope = elem.getAttribute(ATT_SCOPE);
/* 49 */     OMAttribute action = elem.getAttribute(ATT_ACTION);
/*    */     
/* 51 */     if (name == null) {
/* 52 */       String msg = ""The 'name' attribute is required for the configuration of a property mediator"";
/* 53 */       log.error(msg);
/* 54 */       throw new SynapseException(msg);
/* 55 */     }  if (value == null && expression == null && (action == null || !""remove"".equals(action.getAttributeValue()))) {
/* 56 */       String msg = ""Either an 'value' or 'expression' attribute is required for a property mediator when action is SET"";
/* 57 */       log.error(msg);
/* 58 */       throw new SynapseException(msg);
/*    */     } 
/* 60 */     propMediator.setName(name.getAttributeValue());
/* 61 */     if (value != null) {
/* 62 */       propMediator.setValue(value.getAttributeValue());
/* 63 */     } else if (expression != null) {
/*    */       try {
/* 65 */         propMediator.setExpression(SynapseXPathFactory.getSynapseXPath(elem, ATT_EXPRN));
/*    */       }
/* 67 */       catch (JaxenException e) {
/* 68 */         String msg = ""Invalid XPath expression for attribute 'expression' : "" + expression.getAttributeValue();
/* 69 */         log.error(msg);
/* 70 */         throw new SynapseException(msg);
/*    */       } 
/*    */     } 
/* 73 */     if (scope != null) {
/* 74 */       String valueStr = scope.getAttributeValue();
/* 75 */       if (!""axis2"".equals(valueStr) && !""transport"".equals(valueStr) && !""default"".equals(valueStr) && !""axis2-client"".equals(valueStr)) {
/*    */         
/* 77 */         String msg = ""Only 'axis2' or 'transport' or 'axis2-client' values are allowed for attribute scope for a property mediator, Unsupported scope "" + valueStr;
/*    */ 
/*    */         
/* 80 */         log.error(msg);
/* 81 */         throw new SynapseException(msg);
/*    */       } 
/* 83 */       propMediator.setScope(valueStr);
/*    */     } 
/*    */ 
/*    */     
/* 87 */     processTraceState((Mediator)propMediator, elem);
/*    */ 
/*    */     
/* 90 */     if (action != null && ""remove"".equals(action.getAttributeValue())) {
/* 91 */       propMediator.setAction(1);
/*    */     }
/* 93 */     return (Mediator)propMediator;
/*    */   }
/*    */ 
/*    */   
/* 97 */   public QName getTagQName() { return PROP_Q; }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\PropertyMediatorFactory.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.PropertyMediatorSerializer,"/*    */ package org.apache.synapse.config.xml;
/*    */ 
/*    */ import org.apache.axiom.om.OMElement;
/*    */ import org.apache.axiom.om.OMNode;
/*    */ import org.apache.synapse.Mediator;
/*    */ import org.apache.synapse.mediators.builtin.PropertyMediator;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class PropertyMediatorSerializer
/*    */   extends AbstractMediatorSerializer
/*    */ {
/*    */   public OMElement serializeMediator(OMElement parent, Mediator m) {
/* 37 */     if (!(m instanceof PropertyMediator)) {
/* 38 */       handleException(""Unsupported mediator passed in for serialization : "" + m.getType());
/*    */     }
/*    */     
/* 41 */     PropertyMediator mediator = (PropertyMediator)m;
/* 42 */     OMElement property = fac.createOMElement(""property"", synNS);
/* 43 */     saveTracingState(property, (Mediator)mediator);
/*    */     
/* 45 */     if (mediator.getName() != null) {
/* 46 */       property.addAttribute(fac.createOMAttribute(""name"", nullNS, mediator.getName()));
/*    */     } else {
/*    */       
/* 49 */       handleException(""Invalid property mediator. Name is required"");
/*    */     } 
/*    */     
/* 52 */     if (mediator.getValue() != null) {
/* 53 */       property.addAttribute(fac.createOMAttribute(""value"", nullNS, mediator.getValue()));
/*    */     
/*    */     }
/* 56 */     else if (mediator.getExpression() != null) {
/* 57 */       SynapseXPathSerializer.serializeXPath(mediator.getExpression(), property, ""expression"");
/*    */     }
/* 59 */     else if (mediator.getAction() == 0) {
/* 60 */       handleException(""Invalid property mediator. Value or expression is required if action is SET"");
/*    */     } 
/* 62 */     if (mediator.getScope() != null)
/*    */     {
/* 64 */       property.addAttribute(fac.createOMAttribute(""scope"", nullNS, mediator.getScope()));
/*    */     }
/* 66 */     if (mediator.getAction() == 1) {
/* 67 */       property.addAttribute(fac.createOMAttribute(""action"", nullNS, ""remove""));
/*    */     }
/*    */     
/* 70 */     if (parent != null) {
/* 71 */       parent.addChild((OMNode)property);
/*    */     }
/* 73 */     return property;
/*    */   }
/*    */ 
/*    */   
/* 77 */   public String getMediatorClassName() { return PropertyMediator.class.getName(); }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\PropertyMediatorSerializer.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.ProxyServiceFactory,"/*     */ package org.apache.synapse.config.xml;
/*     */ 
/*     */ import java.net.URI;
/*     */ import java.net.URISyntaxException;
/*     */ import java.util.ArrayList;
/*     */ import java.util.Iterator;
/*     */ import java.util.List;
/*     */ import java.util.StringTokenizer;
/*     */ import javax.xml.namespace.QName;
/*     */ import org.apache.axiom.om.OMAttribute;
/*     */ import org.apache.axiom.om.OMElement;
/*     */ import org.apache.commons.logging.Log;
/*     */ import org.apache.commons.logging.LogFactory;
/*     */ import org.apache.synapse.SynapseException;
/*     */ import org.apache.synapse.config.xml.endpoints.EndpointFactory;
/*     */ import org.apache.synapse.core.axis2.ProxyService;
/*     */ import org.apache.synapse.util.PolicyInfo;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class ProxyServiceFactory
/*     */ {
/*  71 */   private static final Log log = LogFactory.getLog(ProxyServiceFactory.class);
/*     */ 
/*     */   
/*     */   public static ProxyService createProxy(OMElement elem) {
/*  75 */     ProxyService proxy = null;
/*     */     
/*  77 */     OMAttribute name = elem.getAttribute(new QName("""", ""name""));
/*  78 */     if (name == null) {
/*  79 */       handleException(""The 'name' attribute is required for a Proxy service definition"");
/*     */     } else {
/*  81 */       proxy = new ProxyService(name.getAttributeValue());
/*     */     } 
/*     */     
/*  84 */     OMAttribute statistics = elem.getAttribute(new QName("""", ""statistics""));
/*     */     
/*  86 */     if (statistics != null) {
/*  87 */       String statisticsValue = statistics.getAttributeValue();
/*  88 */       if (statisticsValue != null) {
/*  89 */         if (""enable"".equals(statisticsValue)) {
/*  90 */           proxy.setStatisticsState(1);
/*  91 */         } else if (""disable"".equals(statisticsValue)) {
/*  92 */           proxy.setStatisticsState(0);
/*     */         } 
/*     */       }
/*     */     } 
/*     */     
/*  97 */     OMAttribute trans = elem.getAttribute(new QName("""", ""transports""));
/*     */     
/*  99 */     if (trans != null) {
/* 100 */       String transports = trans.getAttributeValue();
/* 101 */       if (transports != null && !""all"".equals(transports)) {
/*     */ 
/*     */         
/* 104 */         StringTokenizer st = new StringTokenizer(transports, "" ,"");
/* 105 */         ArrayList<String> transportList = new ArrayList();
/* 106 */         while (st.hasMoreTokens()) {
/* 107 */           String token = st.nextToken();
/* 108 */           if (token.length() != 0) {
/* 109 */             transportList.add(token);
/*     */           }
/*     */         } 
/* 112 */         proxy.setTransports(transportList);
/*     */       } 
/*     */     } 
/*     */     
/* 116 */     OMAttribute pinnedServers = elem.getAttribute(new QName("""", ""pinnedServers""));
/*     */     
/* 118 */     if (pinnedServers != null) {
/* 119 */       String pinnedServersValue = pinnedServers.getAttributeValue();
/* 120 */       if (pinnedServersValue != null) {
/*     */ 
/*     */         
/* 123 */         StringTokenizer st = new StringTokenizer(pinnedServersValue, "" ,"");
/* 124 */         List<String> pinnedServersList = new ArrayList();
/* 125 */         while (st.hasMoreTokens()) {
/* 126 */           String token = st.nextToken();
/* 127 */           if (token.length() != 0) {
/* 128 */             pinnedServersList.add(token);
/*     */           }
/*     */         } 
/* 131 */         proxy.setPinnedServers(pinnedServersList);
/*     */       } 
/*     */     } 
/*     */     
/* 135 */     OMAttribute trace = elem.getAttribute(new QName("""", ""trace""));
/*     */     
/* 137 */     if (trace != null) {
/* 138 */       String traceValue = trace.getAttributeValue();
/* 139 */       if (traceValue != null) {
/* 140 */         if (traceValue.equals(""enable"")) {
/* 141 */           proxy.setTraceState(1);
/* 142 */         } else if (traceValue.equals(""disable"")) {
/* 143 */           proxy.setTraceState(0);
/*     */         } 
/*     */       }
/*     */     } 
/* 147 */     OMAttribute startOnLoad = elem.getAttribute(new QName("""", ""startOnLoad""));
/*     */     
/* 149 */     if (startOnLoad != null) {
/* 150 */       proxy.setStartOnLoad(Boolean.valueOf(startOnLoad.getAttributeValue()).booleanValue());
/*     */     } else {
/* 152 */       proxy.setStartOnLoad(true);
/*     */     } 
/*     */ 
/*     */     
/* 156 */     OMElement descriptionElement = elem.getFirstChildWithName(new QName(""http://ws.apache.org/ns/synapse"", ""description""));
/*     */     
/* 158 */     if (descriptionElement != null) {
/* 159 */       proxy.setDescription(descriptionElement.getText().trim());
/*     */     }
/*     */ 
/*     */ 
/*     */ 
/*     */     
/* 165 */     OMElement target = elem.getFirstChildWithName(new QName(""http://ws.apache.org/ns/synapse"", ""target""));
/*     */     
/* 167 */     if (target != null) {
/* 168 */       boolean isTargetOk = false;
/* 169 */       SequenceMediatorFactory mediatorFactory = new SequenceMediatorFactory();
/* 170 */       OMAttribute inSequence = target.getAttribute(new QName("""", ""inSequence""));
/*     */       
/* 172 */       if (inSequence != null) {
/* 173 */         proxy.setTargetInSequence(inSequence.getAttributeValue());
/* 174 */         isTargetOk = true;
/*     */       } else {
/* 176 */         OMElement inSequenceElement = target.getFirstChildWithName(new QName(""http://ws.apache.org/ns/synapse"", ""inSequence""));
/*     */         
/* 178 */         if (inSequenceElement != null) {
/* 179 */           proxy.setTargetInLineInSequence(mediatorFactory.createAnonymousSequence(inSequenceElement));
/*     */           
/* 181 */           isTargetOk = true;
/*     */         } 
/*     */       } 
/* 184 */       OMAttribute outSequence = target.getAttribute(new QName("""", ""outSequence""));
/*     */       
/* 186 */       if (outSequence != null) {
/* 187 */         proxy.setTargetOutSequence(outSequence.getAttributeValue());
/*     */       } else {
/* 189 */         OMElement outSequenceElement = target.getFirstChildWithName(new QName(""http://ws.apache.org/ns/synapse"", ""outSequence""));
/*     */         
/* 191 */         if (outSequenceElement != null) {
/* 192 */           proxy.setTargetInLineOutSequence(mediatorFactory.createAnonymousSequence(outSequenceElement));
/*     */         }
/*     */       } 
/*     */       
/* 196 */       OMAttribute faultSequence = target.getAttribute(new QName("""", ""faultSequence""));
/*     */       
/* 198 */       if (faultSequence != null) {
/* 199 */         proxy.setTargetFaultSequence(faultSequence.getAttributeValue());
/*     */       } else {
/* 201 */         OMElement faultSequenceElement = target.getFirstChildWithName(new QName(""http://ws.apache.org/ns/synapse"", ""faultSequence""));
/*     */         
/* 203 */         if (faultSequenceElement != null) {
/* 204 */           proxy.setTargetInLineFaultSequence(mediatorFactory.createAnonymousSequence(faultSequenceElement));
/*     */         }
/*     */       } 
/*     */       
/* 208 */       OMAttribute tgtEndpt = target.getAttribute(new QName("""", ""endpoint""));
/*     */       
/* 210 */       if (tgtEndpt != null) {
/* 211 */         proxy.setTargetEndpoint(tgtEndpt.getAttributeValue());
/* 212 */         isTargetOk = true;
/*     */       } else {
/* 214 */         OMElement endpointElement = target.getFirstChildWithName(new QName(""http://ws.apache.org/ns/synapse"", ""endpoint""));
/*     */         
/* 216 */         if (endpointElement != null) {
/* 217 */           proxy.setTargetInLineEndpoint(EndpointFactory.getEndpointFromElement(endpointElement, true));
/*     */           
/* 219 */           isTargetOk = true;
/*     */         } 
/*     */       } 
/* 222 */       if (!isTargetOk) {
/* 223 */         handleException(""Target of the proxy service must declare either an inSequence or endpoint or both"");
/*     */       }
/*     */     } else {
/*     */       
/* 227 */       handleException(""Target is required for a Proxy service definition"");
/*     */     } 
/*     */ 
/*     */     
/* 231 */     OMElement wsdl = elem.getFirstChildWithName(new QName(""http://ws.apache.org/ns/synapse"", ""publishWSDL""));
/*     */     
/* 233 */     if (wsdl != null) {
/* 234 */       OMAttribute wsdlkey = wsdl.getAttribute(new QName("""", ""key""));
/*     */       
/* 236 */       if (wsdlkey != null) {
/* 237 */         proxy.setWSDLKey(wsdlkey.getAttributeValue());
/*     */       } else {
/* 239 */         OMAttribute wsdlURI = wsdl.getAttribute(new QName("""", ""uri""));
/*     */         
/* 241 */         if (wsdlURI != null) {
/*     */           try {
/* 243 */             proxy.setWsdlURI(new URI(wsdlURI.getAttributeValue()));
/* 244 */           } catch (URISyntaxException e) {
/* 245 */             String msg = ""Error creating uri for proxy service wsdl"";
/* 246 */             log.error(msg);
/* 247 */             handleException(msg, e);
/*     */           } 
/*     */         } else {
/* 250 */           OMElement wsdl11 = wsdl.getFirstChildWithName(new QName(""http://schemas.xmlsoap.org/wsdl/"", ""definitions""));
/*     */           
/* 252 */           if (wsdl11 != null) {
/* 253 */             proxy.setInLineWSDL(wsdl11);
/*     */           } else {
/* 255 */             OMElement wsdl20 = wsdl.getFirstChildWithName(new QName(""http://www.w3.org/ns/wsdl"", ""description""));
/*     */             
/* 257 */             if (wsdl20 != null) {
/* 258 */               proxy.setInLineWSDL(wsdl20);
/*     */             }
/*     */           } 
/*     */         } 
/*     */       } 
/* 263 */       proxy.setResourceMap(ResourceMapFactory.createResourceMap(wsdl));
/*     */     } 
/*     */     
/* 266 */     Iterator policies = elem.getChildrenWithName(new QName(""http://ws.apache.org/ns/synapse"", ""policy""));
/*     */     
/* 268 */     while (policies.hasNext()) {
/* 269 */       Object o = policies.next();
/* 270 */       if (o instanceof OMElement) {
/* 271 */         OMElement policy = (OMElement)o;
/* 272 */         OMAttribute key = policy.getAttribute(new QName("""", ""key""));
/*     */         
/* 274 */         OMAttribute type = policy.getAttribute(new QName("""", ""type""));
/*     */         
/* 276 */         OMAttribute operationName = policy.getAttribute(new QName("""", ""operationName""));
/*     */         
/* 278 */         OMAttribute operationNS = policy.getAttribute(new QName("""", ""operationNamespace""));
/*     */ 
/*     */         
/* 281 */         if (key != null) {
/*     */           
/* 283 */           PolicyInfo pi = new PolicyInfo(key.getAttributeValue());
/*     */           
/* 285 */           if (type != null && type.getAttributeValue() != null) {
/* 286 */             if (""in"".equals(type.getAttributeValue())) {
/* 287 */               pi.setType(1);
/* 288 */             } else if (""out"".equals(type.getAttributeValue())) {
/* 289 */               pi.setType(2);
/*     */             } else {
/* 291 */               handleException(""Undefined policy type for the policy with key : "" + key.getAttributeValue());
/*     */             } 
/*     */           }
/*     */ 
/*     */           
/* 296 */           if (operationName != null && operationName.getAttributeValue() != null) {
/* 297 */             if (operationNS != null && operationNS.getAttributeValue() != null) {
/* 298 */               pi.setOperation(new QName(operationNS.getAttributeValue(), operationName.getAttributeValue()));
/*     */             } else {
/*     */               
/* 301 */               pi.setOperation(new QName(operationName.getAttributeValue()));
/*     */             } 
/*     */           }
/*     */           
/* 305 */           proxy.addPolicyInfo(pi);
/*     */           continue;
/*     */         } 
/* 308 */         handleException(""Policy element does not specify the policy key"");
/*     */         continue;
/*     */       } 
/* 311 */       handleException(""Invalid 'policy' element found under element 'policies'"");
/*     */     } 
/*     */ 
/*     */     
/* 315 */     Iterator props = elem.getChildrenWithName(new QName(""http://ws.apache.org/ns/synapse"", ""parameter""));
/*     */     
/* 317 */     while (props.hasNext()) {
/* 318 */       Object o = props.next();
/* 319 */       if (o instanceof OMElement) {
/* 320 */         OMElement prop = (OMElement)o;
/* 321 */         OMAttribute pname = prop.getAttribute(new QName("""", ""name""));
/*     */         
/* 323 */         OMElement propertyValue = prop.getFirstElement();
/* 324 */         if (pname != null) {
/* 325 */           if (propertyValue != null) {
/* 326 */             proxy.addParameter(pname.getAttributeValue(), propertyValue); continue;
/*     */           } 
/* 328 */           proxy.addParameter(pname.getAttributeValue(), prop.getText().trim());
/*     */           continue;
/*     */         } 
/* 331 */         handleException(""Invalid property specified for proxy service : "" + name);
/*     */         continue;
/*     */       } 
/* 334 */       handleException(""Invalid property specified for proxy service : "" + name);
/*     */     } 
/*     */ 
/*     */     
/* 338 */     if (elem.getFirstChildWithName(new QName(""http://ws.apache.org/ns/synapse"", ""enableRM"")) != null)
/*     */     {
/* 340 */       proxy.setWsRMEnabled(true);
/*     */     }
/*     */     
/* 343 */     if (elem.getFirstChildWithName(new QName(""http://ws.apache.org/ns/synapse"", ""enableSec"")) != null)
/*     */     {
/* 345 */       proxy.setWsSecEnabled(true);
/*     */     }
/*     */     
/* 348 */     return proxy;
/*     */   }
/*     */   
/*     */   private static void handleException(String msg) {
/* 352 */     log.error(msg);
/* 353 */     throw new SynapseException(msg);
/*     */   }
/*     */   
/*     */   private static void handleException(String msg, Exception e) {
/* 357 */     log.error(msg, e);
/* 358 */     throw new SynapseException(msg, e);
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\ProxyServiceFactory.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.ProxyServiceSerializer,"/*     */ package org.apache.synapse.config.xml;
/*     */ 
/*     */ import java.net.URI;
/*     */ import java.util.ArrayList;
/*     */ import java.util.List;
/*     */ import org.apache.axiom.om.OMAbstractFactory;
/*     */ import org.apache.axiom.om.OMElement;
/*     */ import org.apache.axiom.om.OMFactory;
/*     */ import org.apache.axiom.om.OMNamespace;
/*     */ import org.apache.axiom.om.OMNode;
/*     */ import org.apache.commons.logging.Log;
/*     */ import org.apache.commons.logging.LogFactory;
/*     */ import org.apache.synapse.SynapseException;
/*     */ import org.apache.synapse.config.xml.endpoints.EndpointSerializer;
/*     */ import org.apache.synapse.core.axis2.ProxyService;
/*     */ import org.apache.synapse.endpoints.Endpoint;
/*     */ import org.apache.synapse.mediators.base.SequenceMediator;
/*     */ import org.apache.synapse.util.PolicyInfo;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class ProxyServiceSerializer
/*     */ {
/*  43 */   private static final Log log = LogFactory.getLog(PropertyMediatorSerializer.class);
/*     */   
/*  45 */   protected static final OMFactory fac = OMAbstractFactory.getOMFactory();
/*  46 */   protected static final OMNamespace synNS = fac.createOMNamespace(""http://ws.apache.org/ns/synapse"", ""syn"");
/*  47 */   protected static final OMNamespace nullNS = fac.createOMNamespace("""", """");
/*     */ 
/*     */   
/*     */   public static OMElement serializeProxy(OMElement parent, ProxyService service) {
/*  51 */     OMElement proxy = fac.createOMElement(""proxy"", synNS);
/*  52 */     if (service.getName() != null) {
/*  53 */       proxy.addAttribute(fac.createOMAttribute(""name"", nullNS, service.getName()));
/*     */     } else {
/*     */       
/*  56 */       handleException(""Invalid proxy service. Service name is required"");
/*     */     } 
/*  58 */     String descriptionStr = service.getDescription();
/*  59 */     if (descriptionStr != null) {
/*  60 */       OMElement description = fac.createOMElement(""description"", synNS);
/*  61 */       description.addChild((OMNode)fac.createOMText(descriptionStr));
/*  62 */       proxy.addChild((OMNode)description);
/*     */     } 
/*  64 */     ArrayList<String> transports = service.getTransports();
/*  65 */     if (transports != null && !transports.isEmpty()) {
/*  66 */       String transportStr = """" + transports.get(0);
/*  67 */       for (int i = 1; i < transports.size(); i++) {
/*  68 */         transportStr = transportStr + "" "" + transports.get(i);
/*     */       }
/*  70 */       proxy.addAttribute(fac.createOMAttribute(""transports"", nullNS, transportStr));
/*     */     } 
/*     */     
/*  73 */     List<String> pinnedServers = service.getPinnedServers();
/*  74 */     if (pinnedServers != null && !pinnedServers.isEmpty()) {
/*  75 */       String pinnedServersStr = """" + pinnedServers.get(0);
/*  76 */       for (int i = 1; i < pinnedServers.size(); i++) {
/*  77 */         pinnedServersStr = pinnedServersStr + "" "" + pinnedServers.get(i);
/*     */       }
/*  79 */       proxy.addAttribute(fac.createOMAttribute(""pinnedServers"", nullNS, pinnedServersStr));
/*     */     } 
/*     */     
/*  82 */     if (service.isStartOnLoad()) {
/*  83 */       proxy.addAttribute(fac.createOMAttribute(""startOnLoad"", nullNS, ""true""));
/*     */     } else {
/*     */       
/*  86 */       proxy.addAttribute(fac.createOMAttribute(""startOnLoad"", nullNS, ""false""));
/*     */     } 
/*     */     
/*  89 */     String endpoint = service.getTargetEndpoint();
/*     */     
/*  91 */     OMElement target = fac.createOMElement(""target"", synNS);
/*  92 */     Endpoint inLineEndpoint = service.getTargetInLineEndpoint();
/*  93 */     if (endpoint != null) {
/*  94 */       target.addAttribute(fac.createOMAttribute(""endpoint"", nullNS, endpoint));
/*     */       
/*  96 */       proxy.addChild((OMNode)target);
/*  97 */     } else if (inLineEndpoint != null) {
/*  98 */       OMElement epElement = EndpointSerializer.getElementFromEndpoint(inLineEndpoint);
/*  99 */       target.addChild((OMNode)epElement);
/* 100 */       proxy.addChild((OMNode)target);
/*     */     } 
/* 102 */     String inSeq = service.getTargetInSequence();
/* 103 */     String outSeq = service.getTargetOutSequence();
/* 104 */     String faultSeq = service.getTargetFaultSequence();
/* 105 */     SequenceMediatorSerializer serializer = new SequenceMediatorSerializer();
/* 106 */     if (inSeq != null) {
/* 107 */       target.addAttribute(fac.createOMAttribute(""inSequence"", nullNS, inSeq));
/* 108 */       proxy.addChild((OMNode)target);
/*     */     } else {
/* 110 */       SequenceMediator inLineInSeq = service.getTargetInLineInSequence();
/* 111 */       if (inLineInSeq != null) {
/* 112 */         OMElement inSeqElement = serializer.serializeAnonymousSequence(null, inLineInSeq);
/* 113 */         inSeqElement.setLocalName(""inSequence"");
/* 114 */         target.addChild((OMNode)inSeqElement);
/* 115 */         proxy.addChild((OMNode)target);
/*     */       } 
/*     */     } 
/* 118 */     if (outSeq != null) {
/* 119 */       target.addAttribute(fac.createOMAttribute(""outSequence"", nullNS, outSeq));
/* 120 */       proxy.addChild((OMNode)target);
/*     */     } else {
/* 122 */       SequenceMediator inLineOutSeq = service.getTargetInLineOutSequence();
/* 123 */       if (inLineOutSeq != null) {
/* 124 */         OMElement outSeqElement = serializer.serializeAnonymousSequence(null, inLineOutSeq);
/* 125 */         outSeqElement.setLocalName(""outSequence"");
/* 126 */         target.addChild((OMNode)outSeqElement);
/* 127 */         proxy.addChild((OMNode)target);
/*     */       } 
/*     */     } 
/* 130 */     if (faultSeq != null) {
/* 131 */       target.addAttribute(fac.createOMAttribute(""faultSequence"", nullNS, faultSeq));
/* 132 */       proxy.addChild((OMNode)target);
/*     */     } else {
/* 134 */       SequenceMediator inLineFaultSeq = service.getTargetInLineFaultSequence();
/* 135 */       if (inLineFaultSeq != null) {
/* 136 */         OMElement faultSeqElement = serializer.serializeAnonymousSequence(null, inLineFaultSeq);
/* 137 */         faultSeqElement.setLocalName(""faultSequence"");
/* 138 */         target.addChild((OMNode)faultSeqElement);
/* 139 */         proxy.addChild((OMNode)target);
/*     */       } 
/*     */     } 
/*     */ 
/*     */ 
/*     */     
/* 145 */     String wsdlKey = service.getWSDLKey();
/* 146 */     URI wsdlUri = service.getWsdlURI();
/* 147 */     Object inLineWSDL = service.getInLineWSDL();
/* 148 */     if (wsdlKey != null || wsdlUri != null || inLineWSDL != null) {
/* 149 */       OMElement wsdl = fac.createOMElement(""publishWSDL"", synNS);
/* 150 */       if (wsdlKey != null) {
/* 151 */         wsdl.addAttribute(fac.createOMAttribute(""key"", nullNS, wsdlKey));
/*     */       }
/* 153 */       else if (inLineWSDL != null) {
/* 154 */         wsdl.addChild((OMNode)inLineWSDL);
/* 155 */       } else if (wsdlUri != null) {
/* 156 */         wsdl.addAttribute(fac.createOMAttribute(""uri"", nullNS, wsdlUri.toString()));
/*     */       } 
/*     */       
/* 159 */       ResourceMapSerializer.serializeResourceMap(wsdl, service.getResourceMap());
/* 160 */       proxy.addChild((OMNode)wsdl);
/*     */     } 
/*     */     
/* 163 */     for (PolicyInfo pi : service.getPolicies()) {
/* 164 */       OMElement policy = fac.createOMElement(""policy"", synNS);
/* 165 */       if (pi.getPolicyKey() != null) {
/* 166 */         policy.addAttribute(fac.createOMAttribute(""key"", nullNS, pi.getPolicyKey()));
/*     */       } else {
/* 168 */         handleException(""Policy without a key has been found"");
/*     */       } 
/*     */       
/* 171 */       if (pi.getOperation() != null) {
/* 172 */         policy.addAttribute(fac.createOMAttribute(""operationName"", nullNS, pi.getOperation().getLocalPart()));
/* 173 */         if (pi.getOperation().getNamespaceURI() != null) {
/* 174 */           policy.addAttribute(fac.createOMAttribute(""operationNamespace"", nullNS, pi.getOperation().getNamespaceURI()));
/*     */         }
/*     */       } 
/*     */ 
/*     */       
/* 179 */       if (pi.getType() != 0) {
/* 180 */         policy.addAttribute(fac.createOMAttribute(""type"", nullNS, pi.getMessageLable().toLowerCase()));
/*     */       }
/*     */       
/* 183 */       proxy.addChild((OMNode)policy);
/*     */     } 
/*     */     
/* 186 */     for (String propertyName : service.getParameterMap().keySet()) {
/* 187 */       OMElement property = fac.createOMElement(""parameter"", synNS);
/* 188 */       property.addAttribute(fac.createOMAttribute(""name"", nullNS, propertyName));
/*     */       
/* 190 */       Object value = service.getParameterMap().get(propertyName);
/* 191 */       if (value != null) {
/* 192 */         if (value instanceof String) {
/* 193 */           property.setText(((String)value).trim());
/* 194 */           proxy.addChild((OMNode)property); continue;
/* 195 */         }  if (value instanceof OMNode) {
/* 196 */           property.addChild((OMNode)value);
/* 197 */           proxy.addChild((OMNode)property);
/*     */         } 
/*     */       } 
/*     */     } 
/*     */     
/* 202 */     if (service.isWsRMEnabled()) {
/* 203 */       proxy.addChild((OMNode)fac.createOMElement(""enableRM"", synNS));
/*     */     }
/* 205 */     if (service.isWsSecEnabled()) {
/* 206 */       proxy.addChild((OMNode)fac.createOMElement(""enableSec"", synNS));
/*     */     }
/*     */     
/* 209 */     int isEnableStatistics = service.getStatisticsState();
/* 210 */     String statisticsValue = null;
/* 211 */     if (isEnableStatistics == 1) {
/* 212 */       statisticsValue = ""enable"";
/* 213 */     } else if (isEnableStatistics == 0) {
/* 214 */       statisticsValue = ""disable"";
/*     */     } 
/* 216 */     if (statisticsValue != null) {
/* 217 */       proxy.addAttribute(fac.createOMAttribute(""statistics"", nullNS, statisticsValue));
/*     */     }
/*     */ 
/*     */     
/* 221 */     int traceState = service.getTraceState();
/* 222 */     String traceValue = null;
/* 223 */     if (traceState == 1) {
/* 224 */       traceValue = ""enable"";
/* 225 */     } else if (traceState == 0) {
/* 226 */       traceValue = ""disable"";
/*     */     } 
/* 228 */     if (traceValue != null) {
/* 229 */       proxy.addAttribute(fac.createOMAttribute(""trace"", nullNS, traceValue));
/*     */     }
/*     */     
/* 232 */     if (parent != null) {
/* 233 */       parent.addChild((OMNode)proxy);
/*     */     }
/* 235 */     return proxy;
/*     */   }
/*     */   
/*     */   private static void handleException(String msg) {
/* 239 */     log.error(msg);
/* 240 */     throw new SynapseException(msg);
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\ProxyServiceSerializer.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.RegistryFactory,"/*     */ package org.apache.synapse.config.xml;
/*     */ 
/*     */ import java.util.Iterator;
/*     */ import java.util.Properties;
/*     */ import javax.xml.namespace.QName;
/*     */ import org.apache.axiom.om.OMAttribute;
/*     */ import org.apache.axiom.om.OMElement;
/*     */ import org.apache.commons.logging.Log;
/*     */ import org.apache.commons.logging.LogFactory;
/*     */ import org.apache.synapse.SynapseException;
/*     */ import org.apache.synapse.registry.Registry;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class RegistryFactory
/*     */ {
/*  42 */   private static final Log log = LogFactory.getLog(RegistryFactory.class);
/*     */   
/*  44 */   public static final QName PROVIDER_Q = new QName("""", ""provider"");
/*  45 */   public static final QName PARAMETER_Q = new QName(""http://ws.apache.org/ns/synapse"", ""parameter"");
/*  46 */   public static final QName NAME_Q = new QName("""", ""name"");
/*     */ 
/*     */   
/*     */   public static Registry createRegistry(OMElement elem) {
/*  50 */     OMAttribute prov = elem.getAttribute(PROVIDER_Q);
/*  51 */     if (prov != null) {
/*     */       try {
/*  53 */         Class<?> provider = Class.forName(prov.getAttributeValue());
/*  54 */         Registry registry = (Registry)provider.newInstance();
/*  55 */         registry.init(getProperties(elem));
/*  56 */         return registry;
/*     */       }
/*  58 */       catch (ClassNotFoundException e) {
/*  59 */         handleException(""Cannot locate registry provider class : "" + prov.getAttributeValue(), e);
/*     */       }
/*  61 */       catch (IllegalAccessException e) {
/*  62 */         handleException(""Error instantiating registry provider : "" + prov.getAttributeValue(), e);
/*     */       }
/*  64 */       catch (InstantiationException e) {
/*  65 */         handleException(""Error instantiating registry provider : "" + prov.getAttributeValue(), e);
/*     */       } 
/*     */     } else {
/*     */       
/*  69 */       handleException(""The registry 'provider' attribute is required for a registry definition"");
/*     */     } 
/*     */     
/*  72 */     return null;
/*     */   }
/*     */   
/*     */   private static Properties getProperties(OMElement elem) {
/*  76 */     Iterator params = elem.getChildrenWithName(PARAMETER_Q);
/*  77 */     Properties props = new Properties();
/*  78 */     while (params.hasNext()) {
/*  79 */       Object o = params.next();
/*  80 */       if (o instanceof OMElement) {
/*  81 */         OMElement prop = (OMElement)o;
/*  82 */         OMAttribute pname = prop.getAttribute(NAME_Q);
/*  83 */         String propertyValue = prop.getText();
/*  84 */         if (pname != null) {
/*  85 */           if (propertyValue != null)
/*  86 */             props.setProperty(pname.getAttributeValue(), propertyValue.trim()); 
/*     */           continue;
/*     */         } 
/*  89 */         handleException(""Invalid registry property - property should have a name "");
/*     */         continue;
/*     */       } 
/*  92 */       handleException(""Invalid registry property"");
/*     */     } 
/*     */     
/*  95 */     return props;
/*     */   }
/*     */   
/*     */   private static void handleException(String msg) {
/*  99 */     log.error(msg);
/* 100 */     throw new SynapseException(msg);
/*     */   }
/*     */   
/*     */   private static void handleException(String msg, Exception e) {
/* 104 */     log.error(msg, e);
/* 105 */     throw new SynapseException(msg, e);
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\RegistryFactory.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.RegistrySerializer,"/*    */ package org.apache.synapse.config.xml;
/*    */ 
/*    */ import java.util.Iterator;
/*    */ import org.apache.axiom.om.OMAbstractFactory;
/*    */ import org.apache.axiom.om.OMElement;
/*    */ import org.apache.axiom.om.OMFactory;
/*    */ import org.apache.axiom.om.OMNamespace;
/*    */ import org.apache.axiom.om.OMNode;
/*    */ import org.apache.commons.logging.Log;
/*    */ import org.apache.commons.logging.LogFactory;
/*    */ import org.apache.synapse.SynapseException;
/*    */ import org.apache.synapse.registry.Registry;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class RegistrySerializer
/*    */ {
/* 40 */   private static final Log log = LogFactory.getLog(RegistrySerializer.class);
/*    */   
/* 42 */   protected static final OMFactory fac = OMAbstractFactory.getOMFactory();
/* 43 */   protected static final OMNamespace synNS = fac.createOMNamespace(""http://ws.apache.org/ns/synapse"", ""syn"");
/* 44 */   protected static final OMNamespace nullNS = fac.createOMNamespace("""", """");
/*    */ 
/*    */   
/*    */   public static OMElement serializeRegistry(OMElement parent, Registry registry) {
/* 48 */     OMElement reg = fac.createOMElement(""registry"", synNS);
/*    */     
/* 50 */     if (registry.getProviderClass() != null) {
/* 51 */       reg.addAttribute(fac.createOMAttribute(""provider"", nullNS, registry.getProviderClass()));
/*    */     } else {
/*    */       
/* 54 */       handleException(""Invalid registry. Provider is required"");
/*    */     } 
/*    */     
/* 57 */     Iterator<String> iter = registry.getConfigurationProperties().keySet().iterator();
/* 58 */     while (iter.hasNext()) {
/* 59 */       String name = iter.next();
/* 60 */       String value = (String)registry.getConfigurationProperties().get(name);
/* 61 */       OMElement property = fac.createOMElement(""parameter"", synNS);
/* 62 */       property.addAttribute(fac.createOMAttribute(""name"", nullNS, name));
/*    */       
/* 64 */       property.setText(value.trim());
/* 65 */       reg.addChild((OMNode)property);
/*    */     } 
/*    */     
/* 68 */     if (parent != null) {
/* 69 */       parent.addChild((OMNode)reg);
/*    */     }
/* 71 */     return reg;
/*    */   }
/*    */   
/*    */   private static void handleException(String msg) {
/* 75 */     log.error(msg);
/* 76 */     throw new SynapseException(msg);
/*    */   }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\RegistrySerializer.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.ResourceMapFactory,"/*    */ package org.apache.synapse.config.xml;
/*    */ 
/*    */ import java.util.Iterator;
/*    */ import javax.xml.namespace.QName;
/*    */ import org.apache.axiom.om.OMAttribute;
/*    */ import org.apache.axiom.om.OMElement;
/*    */ import org.apache.commons.logging.Log;
/*    */ import org.apache.commons.logging.LogFactory;
/*    */ import org.apache.synapse.SynapseException;
/*    */ import org.apache.synapse.core.axis2.ResourceMap;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class ResourceMapFactory
/*    */ {
/* 40 */   private static final Log log = LogFactory.getLog(ResourceMapFactory.class);
/*    */   
/*    */   public static ResourceMap createResourceMap(OMElement elem) {
/* 43 */     ResourceMap resourceMap = null;
/* 44 */     Iterator<OMElement> it = elem.getChildrenWithName(new QName(""http://ws.apache.org/ns/synapse"", ""resource""));
/*    */     
/* 46 */     while (it.hasNext()) {
/*    */ 
/*    */       
/* 49 */       if (resourceMap == null) {
/* 50 */         resourceMap = new ResourceMap();
/*    */       }
/* 52 */       OMElement resourceElem = it.next();
/* 53 */       OMAttribute location = resourceElem.getAttribute(new QName("""", ""location""));
/*    */       
/* 55 */       if (location == null) {
/* 56 */         handleException(""The 'location' attribute is required for a resource definition"");
/*    */       }
/* 58 */       OMAttribute key = resourceElem.getAttribute(new QName("""", ""key""));
/*    */       
/* 60 */       if (key == null) {
/* 61 */         handleException(""The 'key' attribute is required for a resource definition"");
/*    */       }
/* 63 */       resourceMap.addResource(location.getAttributeValue(), key.getAttributeValue());
/*    */     } 
/* 65 */     return resourceMap;
/*    */   }
/*    */   
/*    */   private static void handleException(String msg) {
/* 69 */     log.error(msg);
/* 70 */     throw new SynapseException(msg);
/*    */   }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\ResourceMapFactory.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.ResourceMapSerializer,"/*    */ package org.apache.synapse.config.xml;
/*    */ 
/*    */ import java.util.Map;
/*    */ import org.apache.axiom.om.OMAbstractFactory;
/*    */ import org.apache.axiom.om.OMElement;
/*    */ import org.apache.axiom.om.OMFactory;
/*    */ import org.apache.axiom.om.OMNode;
/*    */ import org.apache.synapse.SynapseConstants;
/*    */ import org.apache.synapse.core.axis2.ResourceMap;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class ResourceMapSerializer
/*    */ {
/* 37 */   private static final OMFactory fac = OMAbstractFactory.getOMFactory();
/*    */   
/*    */   public static void serializeResourceMap(OMElement parent, ResourceMap resourceMap) {
/* 40 */     if (resourceMap != null)
/* 41 */       for (Map.Entry<String, String> entry : (Iterable<Map.Entry<String, String>>)resourceMap.getResources().entrySet()) {
/* 42 */         OMElement resource = fac.createOMElement(""resource"", SynapseConstants.SYNAPSE_OMNAMESPACE);
/*    */         
/* 44 */         resource.addAttribute(""location"", entry.getKey(), null);
/* 45 */         resource.addAttribute(""key"", entry.getValue(), null);
/* 46 */         parent.addChild((OMNode)resource);
/*    */       }  
/*    */   }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\ResourceMapSerializer.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.RMSequenceMediatorFactory,"/*     */ package org.apache.synapse.config.xml;
/*     */ 
/*     */ import javax.xml.namespace.QName;
/*     */ import org.apache.axiom.om.OMAttribute;
/*     */ import org.apache.axiom.om.OMElement;
/*     */ import org.apache.synapse.Mediator;
/*     */ import org.apache.synapse.SynapseException;
/*     */ import org.apache.synapse.mediators.builtin.RMSequenceMediator;
/*     */ import org.jaxen.JaxenException;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class RMSequenceMediatorFactory
/*     */   extends AbstractMediatorFactory
/*     */ {
/*  41 */   private static final QName SEQUENCE_Q = new QName(""http://ws.apache.org/ns/synapse"", ""RMSequence"");
/*  42 */   private static final QName ATT_CORR = new QName(""correlation"");
/*  43 */   private static final QName ATT_LASTMSG = new QName(""last-message"");
/*  44 */   private static final QName ATT_VERSION = new QName(""version"");
/*  45 */   private static final QName ATT_SINGLE = new QName(""single"");
/*     */ 
/*     */   
/*     */   public Mediator createMediator(OMElement elem) {
/*  49 */     RMSequenceMediator sequenceMediator = new RMSequenceMediator();
/*  50 */     OMAttribute correlation = elem.getAttribute(ATT_CORR);
/*  51 */     OMAttribute lastMessage = elem.getAttribute(ATT_LASTMSG);
/*  52 */     OMAttribute single = elem.getAttribute(ATT_SINGLE);
/*  53 */     OMAttribute version = elem.getAttribute(ATT_VERSION);
/*     */     
/*  55 */     if (single == null && correlation == null) {
/*  56 */       String msg = ""The 'single' attribute value of true or a 'correlation' attribute is required for the configuration of a RMSequence mediator"";
/*     */       
/*  58 */       log.error(msg);
/*  59 */       throw new SynapseException(msg);
/*     */     } 
/*     */     
/*  62 */     if (correlation != null) {
/*  63 */       if (correlation.getAttributeValue() != null && correlation.getAttributeValue().trim().length() == 0) {
/*     */         
/*  65 */         String msg = ""Invalid attribute value specified for correlation"";
/*  66 */         log.error(msg);
/*  67 */         throw new SynapseException(msg);
/*     */       } 
/*     */       
/*     */       try {
/*  71 */         sequenceMediator.setCorrelation(SynapseXPathFactory.getSynapseXPath(elem, ATT_CORR));
/*     */       }
/*  73 */       catch (JaxenException e) {
/*  74 */         String msg = ""Invalid XPath expression for attribute correlation : "" + correlation.getAttributeValue();
/*     */         
/*  76 */         log.error(msg);
/*  77 */         throw new SynapseException(msg);
/*     */       } 
/*     */     } 
/*     */ 
/*     */     
/*  82 */     if (single != null) {
/*  83 */       sequenceMediator.setSingle(Boolean.valueOf(single.getAttributeValue()));
/*     */     }
/*     */     
/*  86 */     if (sequenceMediator.isSingle() && sequenceMediator.getCorrelation() != null) {
/*  87 */       String msg = ""Invalid RMSequence mediator. A RMSequence can't have both a single attribute value of true and a correlation attribute specified."";
/*     */       
/*  89 */       log.error(msg);
/*  90 */       throw new SynapseException(msg);
/*     */     } 
/*  92 */     if (!sequenceMediator.isSingle() && sequenceMediator.getCorrelation() == null) {
/*  93 */       String msg = ""Invalid RMSequence mediator. A RMSequence must have a single attribute value of true or a correlation attribute specified."";
/*     */       
/*  95 */       log.error(msg);
/*  96 */       throw new SynapseException(msg);
/*     */     } 
/*     */     
/*  99 */     if (lastMessage != null) {
/* 100 */       if (lastMessage.getAttributeValue() != null && lastMessage.getAttributeValue().trim().length() == 0) {
/*     */         
/* 102 */         String msg = ""Invalid attribute value specified for last-message"";
/* 103 */         log.error(msg);
/* 104 */         throw new SynapseException(msg);
/*     */       } 
/*     */       
/*     */       try {
/* 108 */         sequenceMediator.setLastMessage(SynapseXPathFactory.getSynapseXPath(elem, ATT_LASTMSG));
/*     */       }
/* 110 */       catch (JaxenException e) {
/* 111 */         String msg = ""Invalid XPath expression for attribute last-message : "" + lastMessage.getAttributeValue();
/*     */         
/* 113 */         log.error(msg);
/* 114 */         throw new SynapseException(msg);
/*     */       } 
/*     */     } 
/*     */ 
/*     */     
/* 119 */     if (sequenceMediator.isSingle() && sequenceMediator.getLastMessage() != null) {
/* 120 */       String msg = ""Invalid RMSequence mediator. A RMSequence can't have both a single attribute value of true and a last-message attribute specified."";
/*     */       
/* 122 */       log.error(msg);
/* 123 */       throw new SynapseException(msg);
/*     */     } 
/*     */     
/* 126 */     if (version != null) {
/* 127 */       if (!""1.0"".equals(version.getAttributeValue()) && !""1.1"".equals(version.getAttributeValue())) {
/*     */         
/* 129 */         String msg = ""Only '1.0' or '1.1' values are allowed for attribute version for a RMSequence mediator, Unsupported version "" + version.getAttributeValue();
/*     */ 
/*     */ 
/*     */         
/* 133 */         log.error(msg);
/* 134 */         throw new SynapseException(msg);
/*     */       } 
/* 136 */       sequenceMediator.setVersion(version.getAttributeValue());
/*     */     } 
/*     */ 
/*     */ 
/*     */     
/* 141 */     processTraceState((Mediator)sequenceMediator, elem);
/*     */     
/* 143 */     return (Mediator)sequenceMediator;
/*     */   }
/*     */ 
/*     */   
/* 147 */   public QName getTagQName() { return SEQUENCE_Q; }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\RMSequenceMediatorFactory.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.RMSequenceMediatorSerializer,"/*    */ package org.apache.synapse.config.xml;
/*    */ 
/*    */ import org.apache.axiom.om.OMElement;
/*    */ import org.apache.axiom.om.OMNode;
/*    */ import org.apache.synapse.Mediator;
/*    */ import org.apache.synapse.mediators.builtin.RMSequenceMediator;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class RMSequenceMediatorSerializer
/*    */   extends AbstractMediatorSerializer
/*    */ {
/*    */   public OMElement serializeMediator(OMElement parent, Mediator m) {
/* 35 */     if (!(m instanceof RMSequenceMediator)) {
/* 36 */       handleException(""Unsupported mediator passed in for serialization : "" + m.getType());
/*    */     }
/*    */     
/* 39 */     RMSequenceMediator mediator = (RMSequenceMediator)m;
/* 40 */     OMElement sequence = fac.createOMElement(""RMSequence"", synNS);
/* 41 */     saveTracingState(sequence, (Mediator)mediator);
/*    */     
/* 43 */     if (mediator.isSingle() && mediator.getCorrelation() != null) {
/* 44 */       handleException(""Invalid RMSequence mediator. A RMSequence can't have both a single attribute value of true and a correlation attribute specified."");
/*    */     }
/*    */     
/* 47 */     if (mediator.isSingle() && mediator.getLastMessage() != null) {
/* 48 */       handleException(""Invalid RMSequence mediator. A RMSequence can't have both a single attribute value of true and a last-message attribute specified."");
/*    */     }
/*    */ 
/*    */     
/* 52 */     if (mediator.isSingle()) {
/* 53 */       sequence.addAttribute(fac.createOMAttribute(""single"", nullNS, String.valueOf(mediator.isSingle())));
/* 54 */     } else if (mediator.getCorrelation() != null) {
/* 55 */       SynapseXPathSerializer.serializeXPath(mediator.getCorrelation(), sequence, ""correlation"");
/*    */     } else {
/*    */       
/* 58 */       handleException(""Invalid RMSequence mediator. Specify a single message sequence or a correlation attribute."");
/*    */     } 
/*    */ 
/*    */     
/* 62 */     if (mediator.getLastMessage() != null) {
/* 63 */       SynapseXPathSerializer.serializeXPath(mediator.getLastMessage(), sequence, ""last-message"");
/*    */     }
/*    */ 
/*    */     
/* 67 */     if (mediator.getVersion() != null) {
/* 68 */       sequence.addAttribute(fac.createOMAttribute(""version"", nullNS, mediator.getVersion()));
/*    */     }
/*    */     
/* 71 */     if (parent != null) {
/* 72 */       parent.addChild((OMNode)sequence);
/*    */     }
/* 74 */     return sequence;
/*    */   }
/*    */ 
/*    */   
/* 78 */   public String getMediatorClassName() { return RMSequenceMediator.class.getName(); }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\RMSequenceMediatorSerializer.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.SendMediatorFactory,"/*     */ package org.apache.synapse.config.xml;
/*     */ 
/*     */ import javax.xml.namespace.QName;
/*     */ import org.apache.axiom.om.OMElement;
/*     */ import org.apache.synapse.Mediator;
/*     */ import org.apache.synapse.config.xml.endpoints.EndpointFactory;
/*     */ import org.apache.synapse.endpoints.Endpoint;
/*     */ import org.apache.synapse.mediators.builtin.SendMediator;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class SendMediatorFactory
/*     */   extends AbstractMediatorFactory
/*     */ {
/*  77 */   private static final QName SEND_Q = new QName(""http://ws.apache.org/ns/synapse"", ""send"");
/*  78 */   private static final QName ENDPOINT_Q = new QName(""http://ws.apache.org/ns/synapse"", ""endpoint"");
/*     */ 
/*     */   
/*     */   public Mediator createMediator(OMElement elem) {
/*  82 */     SendMediator sm = new SendMediator();
/*     */ 
/*     */ 
/*     */     
/*  86 */     processTraceState((Mediator)sm, elem);
/*     */     
/*  88 */     OMElement epElement = elem.getFirstChildWithName(ENDPOINT_Q);
/*  89 */     if (epElement != null) {
/*     */       
/*  91 */       Endpoint endpoint = EndpointFactory.getEndpointFromElement(epElement, true);
/*  92 */       if (endpoint != null) {
/*  93 */         sm.setEndpoint(endpoint);
/*     */       }
/*     */     } 
/*     */     
/*  97 */     return (Mediator)sm;
/*     */   }
/*     */ 
/*     */   
/* 101 */   public QName getTagQName() { return SEND_Q; }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\SendMediatorFactory.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.SendMediatorSerializer,"/*    */ package org.apache.synapse.config.xml;
/*    */ 
/*    */ import org.apache.axiom.om.OMElement;
/*    */ import org.apache.axiom.om.OMNode;
/*    */ import org.apache.synapse.Mediator;
/*    */ import org.apache.synapse.config.xml.endpoints.EndpointSerializer;
/*    */ import org.apache.synapse.endpoints.Endpoint;
/*    */ import org.apache.synapse.mediators.builtin.SendMediator;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class SendMediatorSerializer
/*    */   extends AbstractMediatorSerializer
/*    */ {
/*    */   public OMElement serializeMediator(OMElement parent, Mediator m) {
/* 37 */     if (!(m instanceof SendMediator)) {
/* 38 */       handleException(""Unsupported mediator passed in for serialization : "" + m.getType());
/*    */     }
/*    */     
/* 41 */     SendMediator mediator = (SendMediator)m;
/* 42 */     OMElement send = fac.createOMElement(""send"", synNS);
/* 43 */     saveTracingState(send, (Mediator)mediator);
/*    */     
/* 45 */     Endpoint activeEndpoint = mediator.getEndpoint();
/* 46 */     if (activeEndpoint != null) {
/* 47 */       send.addChild((OMNode)EndpointSerializer.getElementFromEndpoint(activeEndpoint));
/*    */     }
/*    */     
/* 50 */     if (parent != null) {
/* 51 */       parent.addChild((OMNode)send);
/*    */     }
/* 53 */     return send;
/*    */   }
/*    */ 
/*    */   
/* 57 */   public String getMediatorClassName() { return SendMediator.class.getName(); }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\SendMediatorSerializer.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.SequenceMediatorFactory,"/*     */ package org.apache.synapse.config.xml;
/*     */ 
/*     */ import javax.xml.namespace.QName;
/*     */ import org.apache.axiom.om.OMAttribute;
/*     */ import org.apache.axiom.om.OMElement;
/*     */ import org.apache.synapse.Mediator;
/*     */ import org.apache.synapse.SynapseException;
/*     */ import org.apache.synapse.mediators.ListMediator;
/*     */ import org.apache.synapse.mediators.base.SequenceMediator;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class SequenceMediatorFactory
/*     */   extends AbstractListMediatorFactory
/*     */ {
/*  49 */   private static final QName SEQUENCE_Q = new QName(""http://ws.apache.org/ns/synapse"", ""sequence"");
/*     */ 
/*     */ 
/*     */   
/*  53 */   public QName getTagQName() { return SEQUENCE_Q; }
/*     */ 
/*     */   
/*     */   public SequenceMediator createAnonymousSequence(OMElement elem) {
/*  57 */     SequenceMediator seqMediator = new SequenceMediator();
/*  58 */     OMAttribute e = elem.getAttribute(ATT_ONERROR);
/*  59 */     if (e != null) {
/*  60 */       seqMediator.setErrorHandler(e.getAttributeValue());
/*     */     }
/*  62 */     processTraceState((Mediator)seqMediator, elem);
/*  63 */     addChildren(elem, (ListMediator)seqMediator);
/*  64 */     OMAttribute statistics = elem.getAttribute(ATT_STATS);
/*  65 */     if (statistics != null) {
/*  66 */       String statisticsValue = statistics.getAttributeValue();
/*  67 */       if (statisticsValue != null) {
/*  68 */         if (""enable"".equals(statisticsValue)) {
/*  69 */           seqMediator.setStatisticsState(1);
/*     */         }
/*  71 */         else if (""disable"".equals(statisticsValue)) {
/*  72 */           seqMediator.setStatisticsState(0);
/*     */         } 
/*     */       }
/*     */     } 
/*     */     
/*  77 */     return seqMediator;
/*     */   }
/*     */ 
/*     */   
/*     */   public Mediator createMediator(OMElement elem) {
/*  82 */     SequenceMediator seqMediator = new SequenceMediator();
/*     */     
/*  84 */     OMAttribute n = elem.getAttribute(ATT_NAME);
/*  85 */     OMAttribute e = elem.getAttribute(ATT_ONERROR);
/*  86 */     if (n != null) {
/*  87 */       seqMediator.setName(n.getAttributeValue());
/*  88 */       if (e != null) {
/*  89 */         seqMediator.setErrorHandler(e.getAttributeValue());
/*     */       }
/*  91 */       processTraceState((Mediator)seqMediator, elem);
/*  92 */       addChildren(elem, (ListMediator)seqMediator);
/*     */     } else {
/*     */       
/*  95 */       n = elem.getAttribute(ATT_KEY);
/*  96 */       if (n != null) {
/*  97 */         seqMediator.setKey(n.getAttributeValue());
/*  98 */         if (e != null) {
/*  99 */           String msg = ""A sequence mediator with a reference to another sequence can not have 'ErrorHandler'"";
/*     */           
/* 101 */           log.error(msg);
/* 102 */           throw new SynapseException(msg);
/*     */         } 
/*     */       } else {
/* 105 */         String msg = ""A sequence mediator should be a named sequence or a reference to another sequence (i.e. a name attribute or key attribute is required)"";
/*     */         
/* 107 */         log.error(msg);
/* 108 */         throw new SynapseException(msg);
/*     */       } 
/*     */     } 
/*     */     
/* 112 */     OMAttribute statistics = elem.getAttribute(ATT_STATS);
/* 113 */     if (statistics != null) {
/* 114 */       String statisticsValue = statistics.getAttributeValue();
/* 115 */       if (statisticsValue != null) {
/* 116 */         if (""enable"".equals(statisticsValue)) {
/* 117 */           seqMediator.setStatisticsState(1);
/*     */         }
/* 119 */         else if (""disable"".equals(statisticsValue)) {
/* 120 */           seqMediator.setStatisticsState(0);
/*     */         } 
/*     */       }
/*     */     } 
/*     */ 
/*     */     
/* 126 */     return (Mediator)seqMediator;
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\SequenceMediatorFactory.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.SequenceMediatorSerializer,"/*     */ package org.apache.synapse.config.xml;
/*     */ 
/*     */ import org.apache.axiom.om.OMElement;
/*     */ import org.apache.axiom.om.OMNode;
/*     */ import org.apache.synapse.Mediator;
/*     */ import org.apache.synapse.mediators.base.SequenceMediator;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class SequenceMediatorSerializer
/*     */   extends AbstractListMediatorSerializer
/*     */ {
/*     */   public OMElement serializeAnonymousSequence(OMElement parent, SequenceMediator mediator) {
/*  34 */     OMElement sequence = fac.createOMElement(""sequence"", synNS);
/*  35 */     int isEnableStatistics = mediator.getStatisticsState();
/*  36 */     String statisticsValue = null;
/*  37 */     if (isEnableStatistics == 1) {
/*  38 */       statisticsValue = ""enable"";
/*  39 */     } else if (isEnableStatistics == 0) {
/*  40 */       statisticsValue = ""disable"";
/*     */     } 
/*  42 */     if (statisticsValue != null) {
/*  43 */       sequence.addAttribute(fac.createOMAttribute(""statistics"", nullNS, statisticsValue));
/*     */     }
/*     */     
/*  46 */     if (mediator.getErrorHandler() != null) {
/*  47 */       sequence.addAttribute(fac.createOMAttribute(""onError"", nullNS, mediator.getErrorHandler()));
/*     */     }
/*     */     
/*  50 */     saveTracingState(sequence, (Mediator)mediator);
/*  51 */     serializeChildren(sequence, mediator.getList());
/*  52 */     if (parent != null) {
/*  53 */       parent.addChild((OMNode)sequence);
/*     */     }
/*  55 */     return sequence;
/*     */   }
/*     */ 
/*     */   
/*     */   public OMElement serializeMediator(OMElement parent, Mediator m) {
/*  60 */     if (!(m instanceof SequenceMediator)) {
/*  61 */       handleException(""Unsupported mediator passed in for serialization : "" + m.getType());
/*     */     }
/*     */     
/*  64 */     SequenceMediator mediator = (SequenceMediator)m;
/*  65 */     OMElement sequence = fac.createOMElement(""sequence"", synNS);
/*     */ 
/*     */ 
/*     */     
/*  69 */     if (mediator.isDynamic()) {
/*  70 */       sequence.addAttribute(fac.createOMAttribute(""name"", nullNS, mediator.getName()));
/*     */       
/*  72 */       sequence.addAttribute(fac.createOMAttribute(""key"", nullNS, mediator.getRegistryKey()));
/*     */     
/*     */     }
/*     */     else {
/*     */       
/*  77 */       int isEnableStatistics = mediator.getStatisticsState();
/*  78 */       String statisticsValue = null;
/*  79 */       if (isEnableStatistics == 1) {
/*  80 */         statisticsValue = ""enable"";
/*  81 */       } else if (isEnableStatistics == 0) {
/*  82 */         statisticsValue = ""disable"";
/*     */       } 
/*  84 */       if (statisticsValue != null) {
/*  85 */         sequence.addAttribute(fac.createOMAttribute(""statistics"", nullNS, statisticsValue));
/*     */       }
/*     */ 
/*     */       
/*  89 */       if (mediator.getKey() != null) {
/*  90 */         sequence.addAttribute(fac.createOMAttribute(""key"", nullNS, mediator.getKey()));
/*     */       }
/*  92 */       else if (mediator.getName() != null) {
/*  93 */         sequence.addAttribute(fac.createOMAttribute(""name"", nullNS, mediator.getName()));
/*     */ 
/*     */         
/*  96 */         if (mediator.getErrorHandler() != null) {
/*  97 */           sequence.addAttribute(fac.createOMAttribute(""onError"", nullNS, mediator.getErrorHandler()));
/*     */         }
/*     */         
/* 100 */         saveTracingState(sequence, (Mediator)mediator);
/* 101 */         serializeChildren(sequence, mediator.getList());
/*     */       } 
/*     */     } 
/*     */     
/* 105 */     if (parent != null) {
/* 106 */       parent.addChild((OMNode)sequence);
/*     */     }
/* 108 */     return sequence;
/*     */   }
/*     */ 
/*     */   
/* 112 */   public String getMediatorClassName() { return SequenceMediator.class.getName(); }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\SequenceMediatorSerializer.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.StartupFactory,"package org.apache.synapse.config.xml;
import javax.xml.namespace.QName;
import org.apache.axiom.om.OMElement;
import org.apache.synapse.Startup;
public interface StartupFactory {
  Startup createStartup(OMElement paramOMElement);
  QName getTagQName();
  Class getSerializerClass();
}
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\StartupFactory.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.StartupFinder,"/*     */ package org.apache.synapse.config.xml;
/*     */ 
/*     */ import java.util.HashMap;
/*     */ import java.util.Iterator;
/*     */ import java.util.Map;
/*     */ import javax.xml.namespace.QName;
/*     */ import org.apache.axiom.om.OMElement;
/*     */ import org.apache.axiom.om.OMNode;
/*     */ import org.apache.commons.logging.Log;
/*     */ import org.apache.commons.logging.LogFactory;
/*     */ import org.apache.synapse.Startup;
/*     */ import org.apache.synapse.SynapseException;
/*     */ import org.apache.synapse.startup.quartz.SimpleQuartzFactory;
/*     */ import sun.misc.Service;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class StartupFinder
/*     */ {
/*  39 */   private static final Log log = LogFactory.getLog(ConfigurationFactoryAndSerializerFinder.class);
/*     */ 
/*     */   
/*  42 */   private static StartupFinder instance = null;
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  47 */   private static Map factoryMap = new HashMap<Object, Object>();
/*  48 */   private static Map serializerMap = new HashMap<Object, Object>();
/*     */   
/*     */   public static synchronized StartupFinder getInstance() {
/*  51 */     if (instance == null) {
/*  52 */       instance = new StartupFinder();
/*     */     }
/*  54 */     return instance;
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public synchronized void reset() {
/*  61 */     factoryMap.clear();
/*  62 */     instance = null;
/*     */   }
/*     */   
/*  65 */   private static final Class[] builtins = new Class[] { SimpleQuartzFactory.class };
/*     */ 
/*     */   
/*     */   private StartupFinder() {
/*  69 */     for (int i = 0; i < builtins.length; i++) {
/*  70 */       StartupFactory sf; Class<StartupFactory> b = builtins[i];
/*     */       
/*     */       try {
/*  73 */         sf = b.newInstance();
/*  74 */       } catch (Exception e) {
/*  75 */         throw new SynapseException(""cannot instantiate "" + b.getName(), e);
/*     */       } 
/*     */       
/*  78 */       factoryMap.put(sf.getTagQName(), b);
/*  79 */       serializerMap.put(sf.getTagQName(), sf.getSerializerClass());
/*     */     } 
/*     */ 
/*     */     
/*  83 */     registerExtensions();
/*     */   }
/*     */   
/*     */   private void handleException(String msg) {
/*  87 */     log.error(msg);
/*  88 */     throw new SynapseException(msg);
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   private void registerExtensions() {
/* 104 */     Iterator<StartupFactory> it = Service.providers(StartupFactory.class);
/* 105 */     while (it.hasNext()) {
/* 106 */       StartupFactory sf = it.next();
/* 107 */       QName tag = sf.getTagQName();
/* 108 */       factoryMap.put(tag, sf.getClass());
/* 109 */       serializerMap.put(tag, sf.getSerializerClass());
/* 110 */       if (log.isDebugEnabled()) {
/* 111 */         log.debug(""Added StartupFactory "" + sf.getClass() + "" to handle "" + tag);
/*     */       }
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public Startup getStartup(OMElement element) {
/* 127 */     QName qName = element.getQName();
/* 128 */     if (log.isDebugEnabled()) {
/* 129 */       log.debug(""Creating the Startup for : "" + qName);
/*     */     }
/*     */     
/* 132 */     Class<StartupFactory> cls = (Class)factoryMap.get(qName);
/* 133 */     if (cls == null) {
/* 134 */       String msg = ""Unknown Startup type referenced by startup element : "" + qName;
/* 135 */       log.error(msg);
/* 136 */       throw new SynapseException(msg);
/*     */     } 
/*     */     
/*     */     try {
/* 140 */       StartupFactory sf = cls.newInstance();
/* 141 */       return sf.createStartup(element);
/*     */     }
/* 143 */     catch (InstantiationException e) {
/* 144 */       String msg = ""Error initializing configuration factory : "" + cls;
/* 145 */       log.error(msg);
/* 146 */       throw new SynapseException(msg, e);
/*     */     }
/* 148 */     catch (IllegalAccessException e) {
/* 149 */       String msg = ""Error initializing configuration factory : "" + cls;
/* 150 */       log.error(msg);
/* 151 */       throw new SynapseException(msg, e);
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public OMElement serializeStartup(OMElement parent, Startup startup) {
/* 168 */     Class<StartupSerializer> cls = (Class)serializerMap.get(startup.getTagQName());
/* 169 */     if (cls == null) {
/* 170 */       String msg = ""Unknown startup type referenced by startup element : "" + startup.getTagQName();
/*     */       
/* 172 */       log.error(msg);
/* 173 */       throw new SynapseException(msg);
/*     */     } 
/*     */     
/*     */     try {
/* 177 */       StartupSerializer ss = cls.newInstance();
/* 178 */       return ss.serializeStartup(parent, startup);
/*     */     }
/* 180 */     catch (InstantiationException e) {
/* 181 */       String msg = ""Error initializing startup serializer: "" + cls;
/* 182 */       log.error(msg);
/* 183 */       throw new SynapseException(msg, e);
/*     */     }
/* 185 */     catch (IllegalAccessException e) {
/* 186 */       String msg = ""Error initializing startup ser: "" + cls;
/* 187 */       log.error(msg);
/* 188 */       throw new SynapseException(msg, e);
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 196 */   public Map getFactoryMap() { return factoryMap; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 203 */   public Map getSerializerMap() { return serializerMap; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public Startup getObjectFromOMNode(OMNode om) {
/* 214 */     if (om instanceof OMElement) {
/* 215 */       return getStartup((OMElement)om);
/*     */     }
/* 217 */     handleException(""Invalid configuration XML : "" + om);
/*     */     
/* 219 */     return null;
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\StartupFinder.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.StartupSerializer,"package org.apache.synapse.config.xml;
import org.apache.axiom.om.OMElement;
import org.apache.synapse.Startup;
public interface StartupSerializer {
  OMElement serializeStartup(OMElement paramOMElement, Startup paramStartup);
}
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\StartupSerializer.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.SwitchCase,"/*     */ package org.apache.synapse.config.xml;
/*     */ 
/*     */ import java.util.regex.Matcher;
/*     */ import java.util.regex.Pattern;
/*     */ import org.apache.commons.logging.Log;
/*     */ import org.apache.commons.logging.LogFactory;
/*     */ import org.apache.synapse.MessageContext;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class SwitchCase
/*     */ {
/*  37 */   private static final Log log = LogFactory.getLog(SwitchCase.class);
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  42 */   private Pattern regex = null;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   private AnonymousListMediator caseMediator;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  56 */   public boolean mediate(MessageContext synCtx) { return (this.caseMediator != null) ? this.caseMediator.mediate(synCtx) : true; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  65 */   public AnonymousListMediator getCaseMediator() { return this.caseMediator; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  74 */   public void setCaseMediator(AnonymousListMediator caseMediator) { this.caseMediator = caseMediator; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  83 */   public Pattern getRegex() { return this.regex; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  92 */   public void setRegex(Pattern regex) { this.regex = regex; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public boolean matches(String value) {
/* 103 */     if (value == null) {
/*     */       
/* 105 */       log.warn(""Provided character sequence for switch case condition is 'null'. Switch case will not be executed."");
/*     */ 
/*     */       
/* 108 */       return false;
/*     */     } 
/*     */     
/* 111 */     Matcher matcher = this.regex.matcher(value);
/* 112 */     if (matcher == null) {
/*     */       
/* 114 */       log.warn(""Matcher for the provided character sequence and the pattern ' "" + this.regex + "" '"" + "" cannot be found. Switch case will not be executed."");
/*     */ 
/*     */       
/* 117 */       return false;
/*     */     } 
/*     */     
/* 120 */     return matcher.matches();
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\SwitchCase.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.SwitchMediatorFactory,"/*     */ package org.apache.synapse.config.xml;
/*     */ 
/*     */ import java.util.Iterator;
/*     */ import java.util.regex.Pattern;
/*     */ import java.util.regex.PatternSyntaxException;
/*     */ import javax.xml.namespace.QName;
/*     */ import org.apache.axiom.om.OMAttribute;
/*     */ import org.apache.axiom.om.OMElement;
/*     */ import org.apache.synapse.Mediator;
/*     */ import org.apache.synapse.SynapseException;
/*     */ import org.apache.synapse.mediators.filters.SwitchMediator;
/*     */ import org.jaxen.JaxenException;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class SwitchMediatorFactory
/*     */   extends AbstractMediatorFactory
/*     */ {
/*  51 */   private static final QName SWITCH_Q = new QName(""http://ws.apache.org/ns/synapse"", ""switch"");
/*  52 */   private static final QName CASE_Q = new QName(""http://ws.apache.org/ns/synapse"", ""case"");
/*  53 */   private static final QName DEFAULT_Q = new QName(""http://ws.apache.org/ns/synapse"", ""default"");
/*     */ 
/*     */   
/*     */   public Mediator createMediator(OMElement elem) {
/*  57 */     SwitchMediator switchMediator = new SwitchMediator();
/*  58 */     OMAttribute source = elem.getAttribute(ATT_SOURCE);
/*  59 */     if (source == null) {
/*  60 */       String msg = ""A 'source' XPath attribute is required for a switch mediator"";
/*  61 */       log.error(msg);
/*  62 */       throw new SynapseException(msg);
/*     */     } 
/*     */     
/*     */     try {
/*  66 */       switchMediator.setSource(SynapseXPathFactory.getSynapseXPath(elem, ATT_SOURCE));
/*     */     }
/*  68 */     catch (JaxenException e) {
/*  69 */       String msg = ""Invalid XPath for attribute 'source' : "" + source.getAttributeValue();
/*  70 */       log.error(msg);
/*  71 */       throw new SynapseException(msg);
/*     */     } 
/*     */ 
/*     */ 
/*     */     
/*  76 */     processTraceState((Mediator)switchMediator, elem);
/*  77 */     Iterator<OMElement> iter = elem.getChildrenWithName(CASE_Q);
/*  78 */     while (iter.hasNext()) {
/*  79 */       OMElement caseElem = iter.next();
/*  80 */       SwitchCase aCase = new SwitchCase();
/*  81 */       OMAttribute regex = caseElem.getAttribute(ATT_REGEX);
/*  82 */       if (regex == null) {
/*  83 */         String msg = ""The 'regex' attribute is required for a switch case definition"";
/*  84 */         log.error(msg);
/*  85 */         throw new SynapseException(msg);
/*     */       } 
/*     */       try {
/*  88 */         aCase.setRegex(Pattern.compile(regex.getAttributeValue()));
/*  89 */       } catch (PatternSyntaxException pse) {
/*  90 */         String msg = ""Invalid Regular Expression for attribute 'regex' : "" + regex.getAttributeValue();
/*  91 */         log.error(msg);
/*  92 */         throw new SynapseException(msg);
/*     */       } 
/*  94 */       aCase.setCaseMediator(AnonymousListMediatorFactory.createAnonymousListMediator(caseElem));
/*  95 */       switchMediator.addCase(aCase);
/*     */     } 
/*  97 */     iter = elem.getChildrenWithName(DEFAULT_Q);
/*  98 */     if (iter.hasNext()) {
/*  99 */       SwitchCase aCase = new SwitchCase();
/* 100 */       aCase.setCaseMediator(AnonymousListMediatorFactory.createAnonymousListMediator(iter.next()));
/* 101 */       switchMediator.setDefaultCase(aCase);
/*     */     } 
/*     */     
/* 104 */     return (Mediator)switchMediator;
/*     */   }
/*     */ 
/*     */   
/* 108 */   public QName getTagQName() { return SWITCH_Q; }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\SwitchMediatorFactory.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.SwitchMediatorSerializer,"/*    */ package org.apache.synapse.config.xml;
/*    */ 
/*    */ import java.util.Iterator;
/*    */ import org.apache.axiom.om.OMElement;
/*    */ import org.apache.axiom.om.OMNode;
/*    */ import org.apache.synapse.Mediator;
/*    */ import org.apache.synapse.mediators.filters.SwitchMediator;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class SwitchMediatorSerializer
/*    */   extends AbstractMediatorSerializer
/*    */ {
/*    */   public OMElement serializeMediator(OMElement parent, Mediator m) {
/* 37 */     if (!(m instanceof SwitchMediator)) {
/* 38 */       handleException(""Unsupported mediator passed in for serialization : "" + m.getType());
/*    */     }
/*    */     
/* 41 */     SwitchMediator mediator = (SwitchMediator)m;
/* 42 */     OMElement switchMed = fac.createOMElement(""switch"", synNS);
/* 43 */     saveTracingState(switchMed, (Mediator)mediator);
/*    */     
/* 45 */     if (mediator.getSource() != null) {
/* 46 */       SynapseXPathSerializer.serializeXPath(mediator.getSource(), switchMed, ""source"");
/*    */     } else {
/*    */       
/* 49 */       handleException(""Invalid switch mediator. Source required"");
/*    */     } 
/*    */     
/* 52 */     Iterator<SwitchCase> iter = mediator.getCases().iterator();
/* 53 */     while (iter.hasNext()) {
/* 54 */       OMElement caseElem = fac.createOMElement(""case"", synNS);
/* 55 */       SwitchCase aCase = iter.next();
/* 56 */       if (aCase.getRegex() != null) {
/* 57 */         caseElem.addAttribute(fac.createOMAttribute(""regex"", nullNS, aCase.getRegex().pattern()));
/*    */       } else {
/*    */         
/* 60 */         handleException(""Invalid switch case. Regex required"");
/*    */       } 
/* 62 */       AnonymousListMediator caseMediator = aCase.getCaseMediator();
/* 63 */       if (caseMediator != null) {
/* 64 */         (new AnonymousListMediatorSerializer()).serializeMediator(caseElem, (Mediator)caseMediator);
/*    */         
/* 66 */         switchMed.addChild((OMNode)caseElem);
/*    */       } 
/*    */     } 
/* 69 */     SwitchCase defaultCase = mediator.getDefaultCase();
/* 70 */     if (defaultCase != null) {
/* 71 */       OMElement caseDefaultElem = fac.createOMElement(""default"", synNS);
/* 72 */       AnonymousListMediator caseDefaultMediator = defaultCase.getCaseMediator();
/* 73 */       if (caseDefaultMediator != null) {
/* 74 */         (new AnonymousListMediatorSerializer()).serializeMediator(caseDefaultElem, (Mediator)caseDefaultMediator);
/*    */         
/* 76 */         switchMed.addChild((OMNode)caseDefaultElem);
/*    */       } 
/*    */     } 
/* 79 */     if (parent != null) {
/* 80 */       parent.addChild((OMNode)switchMed);
/*    */     }
/* 82 */     return switchMed;
/*    */   }
/*    */ 
/*    */   
/* 86 */   public String getMediatorClassName() { return SwitchMediator.class.getName(); }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\SwitchMediatorSerializer.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.SynapseMediatorFactory,"/*    */ package org.apache.synapse.config.xml;
/*    */ 
/*    */ import javax.xml.namespace.QName;
/*    */ import org.apache.axiom.om.OMElement;
/*    */ import org.apache.synapse.Mediator;
/*    */ import org.apache.synapse.mediators.ListMediator;
/*    */ import org.apache.synapse.mediators.base.SynapseMediator;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class SynapseMediatorFactory
/*    */   extends AbstractListMediatorFactory
/*    */ {
/* 40 */   private static final QName RULES_Q = new QName(""http://ws.apache.org/ns/synapse"", ""rules"");
/*    */ 
/*    */   
/* 43 */   public QName getTagQName() { return RULES_Q; }
/*    */ 
/*    */   
/*    */   public Mediator createMediator(OMElement elem) {
/* 47 */     SynapseMediator sm = new SynapseMediator();
/*    */ 
/*    */ 
/*    */     
/* 51 */     processTraceState((Mediator)sm, elem);
/*    */     
/* 53 */     addChildren(elem, (ListMediator)sm);
/* 54 */     return (Mediator)sm;
/*    */   }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\SynapseMediatorFactory.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.SynapseMediatorSerializer,"/*    */ package org.apache.synapse.config.xml;
/*    */ 
/*    */ import org.apache.axiom.om.OMElement;
/*    */ import org.apache.axiom.om.OMNode;
/*    */ import org.apache.synapse.Mediator;
/*    */ import org.apache.synapse.mediators.base.SynapseMediator;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class SynapseMediatorSerializer
/*    */   extends AbstractListMediatorSerializer
/*    */ {
/*    */   public OMElement serializeMediator(OMElement parent, Mediator m) {
/* 39 */     if (!(m instanceof SynapseMediator)) {
/* 40 */       handleException(""Unsupported mediator passed in for serialization : "" + m.getType());
/*    */     }
/*    */     
/* 43 */     SynapseMediator mediator = (SynapseMediator)m;
/* 44 */     OMElement rules = fac.createOMElement(""rules"", synNS);
/* 45 */     saveTracingState(rules, (Mediator)mediator);
/*    */     
/* 47 */     serializeChildren(rules, mediator.getList());
/*    */     
/* 49 */     if (parent != null) {
/* 50 */       parent.addChild((OMNode)rules);
/*    */     }
/* 52 */     return rules;
/*    */   }
/*    */ 
/*    */   
/* 56 */   public String getMediatorClassName() { return SynapseMediator.class.getName(); }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\SynapseMediatorSerializer.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.SynapseXMLConfigurationFactory,"/*     */ package org.apache.synapse.config.xml;
/*     */ 
/*     */ import java.util.Iterator;
/*     */ import javax.xml.namespace.QName;
/*     */ import javax.xml.stream.XMLStreamException;
/*     */ import org.apache.axiom.om.OMElement;
/*     */ import org.apache.axiom.om.OMNode;
/*     */ import org.apache.commons.logging.Log;
/*     */ import org.apache.commons.logging.LogFactory;
/*     */ import org.apache.synapse.Mediator;
/*     */ import org.apache.synapse.Startup;
/*     */ import org.apache.synapse.SynapseException;
/*     */ import org.apache.synapse.config.Entry;
/*     */ import org.apache.synapse.config.SynapseConfigUtils;
/*     */ import org.apache.synapse.config.SynapseConfiguration;
/*     */ import org.apache.synapse.config.xml.endpoints.EndpointFactory;
/*     */ import org.apache.synapse.core.axis2.ProxyService;
/*     */ import org.apache.synapse.endpoints.Endpoint;
/*     */ import org.apache.synapse.mediators.MediatorProperty;
/*     */ import org.apache.synapse.mediators.base.SequenceMediator;
/*     */ import org.apache.synapse.mediators.builtin.DropMediator;
/*     */ import org.apache.synapse.mediators.builtin.LogMediator;
/*     */ import org.apache.synapse.util.xpath.SynapseXPath;
/*     */ import org.jaxen.JaxenException;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class SynapseXMLConfigurationFactory
/*     */   implements ConfigurationFactory
/*     */ {
/*  49 */   private static Log log = LogFactory.getLog(SynapseXMLConfigurationFactory.class);
/*     */ 
/*     */   
/*     */   public SynapseConfiguration getConfiguration(OMElement definitions) {
/*  53 */     if (!definitions.getQName().equals(XMLConfigConstants.DEFINITIONS_ELT)) {
/*  54 */       throw new SynapseException(""Wrong QName for this config factory "" + definitions.getQName());
/*     */     }
/*     */ 
/*     */     
/*  58 */     SynapseConfiguration config = new SynapseConfiguration();
/*  59 */     config.setDefaultQName(definitions.getQName());
/*     */     
/*  61 */     SequenceMediator rootSequence = new SequenceMediator();
/*  62 */     rootSequence.setName(""main"");
/*     */     
/*  64 */     Iterator iter = definitions.getChildren();
/*     */     
/*  66 */     while (iter.hasNext()) {
/*  67 */       Object o = iter.next();
/*  68 */       if (o instanceof OMElement) {
/*  69 */         OMElement elt = (OMElement)o;
/*  70 */         if (XMLConfigConstants.SEQUENCE_ELT.equals(elt.getQName())) {
/*  71 */           String key = elt.getAttributeValue(new QName("""", ""key""));
/*     */ 
/*     */           
/*  74 */           if (key != null) {
/*  75 */             Mediator m = MediatorFactoryFinder.getInstance().getMediator(elt);
/*  76 */             rootSequence.addChild(m); continue;
/*     */           } 
/*  78 */           defineSequence(config, elt); continue;
/*     */         } 
/*  80 */         if (XMLConfigConstants.ENDPOINT_ELT.equals(elt.getQName())) {
/*  81 */           defineEndpoint(config, elt); continue;
/*  82 */         }  if (XMLConfigConstants.ENTRY_ELT.equals(elt.getQName())) {
/*  83 */           defineEntry(config, elt); continue;
/*  84 */         }  if (XMLConfigConstants.PROXY_ELT.equals(elt.getQName())) {
/*  85 */           defineProxy(config, elt); continue;
/*  86 */         }  if (XMLConfigConstants.REGISTRY_ELT.equals(elt.getQName())) {
/*  87 */           defineRegistry(config, elt); continue;
/*  88 */         }  if (XMLConfigConstants.TASK_ELT.equals(elt.getQName())) {
/*  89 */           defineStartup(config, elt); continue;
/*     */         } 
/*  91 */         Mediator m = MediatorFactoryFinder.getInstance().getMediator(elt);
/*  92 */         rootSequence.addChild(m);
/*     */       } 
/*     */     } 
/*     */ 
/*     */     
/*  97 */     if (config.getLocalRegistry().isEmpty() && config.getProxyServices().isEmpty() && rootSequence.getList().isEmpty() && config.getRegistry() != null) {
/*     */       
/*  99 */       OMNode remoteConfigNode = config.getRegistry().lookup(""synapse.xml"");
/*     */       try {
/* 101 */         config = XMLConfigurationBuilder.getConfiguration(SynapseConfigUtils.getStreamSource(remoteConfigNode).getInputStream());
/*     */       }
/* 103 */       catch (XMLStreamException xse) {
/* 104 */         throw new SynapseException(""Problem loading remote synapse.xml "", xse);
/*     */       } 
/*     */     } 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */     
/* 112 */     if (!config.getLocalRegistry().containsKey(""main"")) {
/*     */ 
/*     */       
/* 115 */       if (rootSequence.getList().isEmpty() && config.getMainSequence() == null) {
/* 116 */         setDefaultMainSequence(config);
/*     */       } else {
/* 118 */         config.addSequence(rootSequence.getName(), (Mediator)rootSequence);
/*     */       } 
/* 120 */     } else if (!rootSequence.getList().isEmpty()) {
/* 121 */       handleException(""Invalid Synapse Configuration : Conflict in resolving the \""main\"" mediator\n\tSynapse Configuration cannot have sequence named \""main\"" and toplevel mediators simultaniously"");
/*     */     } 
/*     */ 
/*     */ 
/*     */     
/* 126 */     if (config.getFaultSequence() == null) {
/* 127 */       setDefaultFaultSequence(config);
/*     */     }
/*     */     
/* 130 */     return config;
/*     */   }
/*     */   
/*     */   private static void defineRegistry(SynapseConfiguration config, OMElement elem) {
/* 134 */     if (config.getRegistry() != null) {
/* 135 */       handleException(""Only one remote registry can be defined within a configuration"");
/*     */     }
/* 137 */     config.setRegistry(RegistryFactory.createRegistry(elem));
/*     */   }
/*     */   
/*     */   private static void defineStartup(SynapseConfiguration config, OMElement elem) {
/* 141 */     Startup startup = StartupFinder.getInstance().getStartup(elem);
/* 142 */     if (config.getStartup(startup.getName()) != null) {
/* 143 */       handleException(""Duplicate startup with name : "" + startup.getName());
/*     */     }
/* 145 */     config.addStartup(startup);
/*     */   }
/*     */   
/*     */   private static void defineProxy(SynapseConfiguration config, OMElement elem) {
/* 149 */     ProxyService proxy = ProxyServiceFactory.createProxy(elem);
/* 150 */     if (config.getProxyService(proxy.getName()) != null) {
/* 151 */       handleException(""Duplicate proxy service with name : "" + proxy.getName());
/*     */     }
/* 153 */     config.addProxyService(proxy.getName(), proxy);
/*     */   }
/*     */   
/*     */   private static void defineEntry(SynapseConfiguration config, OMElement elem) {
/* 157 */     Entry entry = EntryFactory.createEntry(elem);
/* 158 */     if (config.getLocalRegistry().get(entry.getKey()) != null) {
/* 159 */       handleException(""Duplicate registry entry definition for key : "" + entry.getKey());
/*     */     }
/* 161 */     config.addEntry(entry.getKey(), entry);
/*     */   }
/*     */ 
/*     */   
/*     */   public static void defineSequence(SynapseConfiguration config, OMElement ele) {
/* 166 */     String name = ele.getAttributeValue(new QName("""", ""name""));
/* 167 */     if (name != null) {
/* 168 */       if (config.getLocalRegistry().get(name) != null) {
/* 169 */         handleException(""Duplicate sequence definition : "" + name);
/*     */       }
/* 171 */       Mediator mediator = MediatorFactoryFinder.getInstance().getMediator(ele);
/* 172 */       config.addSequence(name, mediator);
/*     */ 
/*     */ 
/*     */       
/* 176 */       if (""pre-mediate"".equals(name)) {
/* 177 */         config.setMandatorySequence(mediator);
/*     */       }
/*     */     } else {
/* 180 */       handleException(""Invalid sequence definition without a name"");
/*     */     } 
/*     */   }
/*     */ 
/*     */   
/*     */   public static void defineEndpoint(SynapseConfiguration config, OMElement ele) {
/* 186 */     String name = ele.getAttributeValue(new QName("""", ""name""));
/* 187 */     if (name != null) {
/* 188 */       if (config.getLocalRegistry().get(name.trim()) != null) {
/* 189 */         handleException(""Duplicate endpoint definition : "" + name);
/*     */       }
/* 191 */       Endpoint endpoint = EndpointFactory.getEndpointFromElement(ele, false);
/* 192 */       config.addEndpoint(name.trim(), endpoint);
/*     */     } else {
/* 194 */       handleException(""Invalid endpoint definition without a name"");
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   private static void setDefaultMainSequence(SynapseConfiguration config) {
/* 205 */     SequenceMediator main = new SequenceMediator();
/* 206 */     main.setName(""main"");
/* 207 */     main.addChild((Mediator)new LogMediator());
/* 208 */     main.addChild((Mediator)new DropMediator());
/* 209 */     config.addSequence(""main"", (Mediator)main);
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   private static void setDefaultFaultSequence(SynapseConfiguration config) {
/* 225 */     SequenceMediator fault = new SequenceMediator();
/* 226 */     fault.setName(""fault"");
/* 227 */     LogMediator log = new LogMediator();
/* 228 */     log.setLogLevel(3);
/*     */     
/* 230 */     MediatorProperty mp = new MediatorProperty();
/* 231 */     mp.setName(""MESSAGE"");
/* 232 */     mp.setValue(""Executing default \""fault\"" sequence"");
/* 233 */     log.addProperty(mp);
/*     */     
/* 235 */     mp = new MediatorProperty();
/* 236 */     mp.setName(""ERROR_CODE"");
/*     */     try {
/* 238 */       mp.setExpression(new SynapseXPath(""get-property('ERROR_CODE')""));
/* 239 */     } catch (JaxenException ignore) {}
/* 240 */     log.addProperty(mp);
/*     */     
/* 242 */     mp = new MediatorProperty();
/* 243 */     mp.setName(""ERROR_MESSAGE"");
/*     */     try {
/* 245 */       mp.setExpression(new SynapseXPath(""get-property('ERROR_MESSAGE')""));
/* 246 */     } catch (JaxenException ignore) {}
/* 247 */     log.addProperty(mp);
/*     */     
/* 249 */     fault.addChild((Mediator)log);
/* 250 */     fault.addChild((Mediator)new DropMediator());
/* 251 */     config.addSequence(""fault"", (Mediator)fault);
/*     */   }
/*     */   
/*     */   private static void handleException(String msg) {
/* 255 */     log.error(msg);
/* 256 */     throw new SynapseException(msg);
/*     */   }
/*     */   
/*     */   private static void handleException(String msg, Exception e) {
/* 260 */     log.error(msg, e);
/* 261 */     throw new SynapseException(msg, e);
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 267 */   public QName getTagQName() { return XMLConfigConstants.DEFINITIONS_ELT; }
/*     */ 
/*     */ 
/*     */   
/* 271 */   public Class getSerializerClass() { return SynapseXMLConfigurationSerializer.class; }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\SynapseXMLConfigurationFactory.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.SynapseXMLConfigurationSerializer,"/*     */ package org.apache.synapse.config.xml;
/*     */ 
/*     */ import java.util.Collection;
/*     */ import java.util.HashMap;
/*     */ import java.util.Iterator;
/*     */ import java.util.Map;
/*     */ import javax.xml.namespace.QName;
/*     */ import org.apache.axiom.om.OMAbstractFactory;
/*     */ import org.apache.axiom.om.OMElement;
/*     */ import org.apache.axiom.om.OMFactory;
/*     */ import org.apache.axiom.om.OMNamespace;
/*     */ import org.apache.axiom.om.OMNode;
/*     */ import org.apache.commons.logging.Log;
/*     */ import org.apache.commons.logging.LogFactory;
/*     */ import org.apache.synapse.Mediator;
/*     */ import org.apache.synapse.Startup;
/*     */ import org.apache.synapse.SynapseException;
/*     */ import org.apache.synapse.config.Entry;
/*     */ import org.apache.synapse.config.SynapseConfiguration;
/*     */ import org.apache.synapse.config.xml.endpoints.EndpointSerializer;
/*     */ import org.apache.synapse.core.axis2.ProxyService;
/*     */ import org.apache.synapse.endpoints.Endpoint;
/*     */ 
/*     */ 
/*     */ public class SynapseXMLConfigurationSerializer
/*     */   implements ConfigurationSerializer
/*     */ {
/*  28 */   private static final Log log = LogFactory.getLog(XMLConfigurationSerializer.class);
/*     */ 
/*     */   
/*  31 */   private static final OMFactory fac = OMAbstractFactory.getOMFactory();
/*     */   
/*  33 */   private static final OMNamespace synNS = fac.createOMNamespace(""http://ws.apache.org/ns/synapse"", ""syn"");
/*     */ 
/*     */   
/*  36 */   private static final OMNamespace nullNS = fac.createOMNamespace("""", """");
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public OMElement serializeConfiguration(SynapseConfiguration synCfg) {
/*  48 */     OMElement definitions = fac.createOMElement(""definitions"", synNS);
/*     */ 
/*     */     
/*  51 */     if (synCfg.getRegistry() != null) {
/*  52 */       RegistrySerializer.serializeRegistry(definitions, synCfg.getRegistry());
/*     */     }
/*     */ 
/*     */ 
/*     */     
/*  57 */     Iterator<ProxyService> iter = synCfg.getProxyServices().iterator();
/*  58 */     while (iter.hasNext()) {
/*  59 */       ProxyService service = iter.next();
/*  60 */       ProxyServiceSerializer.serializeProxy(definitions, service);
/*     */     } 
/*     */     
/*  63 */     Map<Object, Object> entries = new HashMap<Object, Object>();
/*  64 */     Map<String, Endpoint> endpoints = new HashMap<String, Endpoint>();
/*  65 */     Map<Object, Object> sequences = new HashMap<Object, Object>();
/*     */     
/*  67 */     iter = synCfg.getLocalRegistry().keySet().iterator();
/*  68 */     while (iter.hasNext()) {
/*  69 */       Object key = iter.next();
/*  70 */       Object o = synCfg.getLocalRegistry().get(key);
/*  71 */       if (o instanceof Mediator) {
/*  72 */         sequences.put(key, o); continue;
/*  73 */       }  if (o instanceof Endpoint) {
/*  74 */         endpoints.put(key.toString(), (Endpoint)o); continue;
/*  75 */       }  if (o instanceof Entry) {
/*  76 */         entries.put(key, o); continue;
/*     */       } 
/*  78 */       handleException(""Unknown object : "" + o.getClass() + "" for serialization into Synapse configuration"");
/*     */     } 
/*     */ 
/*     */ 
/*     */ 
/*     */     
/*  84 */     serializeEntries(definitions, entries);
/*     */ 
/*     */     
/*  87 */     serializeEndpoints(definitions, endpoints);
/*     */ 
/*     */     
/*  90 */     serializeSequences(definitions, sequences);
/*     */ 
/*     */     
/*  93 */     serializeStartups(definitions, synCfg.getStartups());
/*     */     
/*  95 */     return definitions;
/*     */   }
/*     */   
/*     */   private static void serializeEntries(OMElement definitions, Map entries) {
/*  99 */     Iterator<String> iter = entries.keySet().iterator();
/* 100 */     while (iter.hasNext()) {
/* 101 */       String key = iter.next();
/* 102 */       EntrySerializer.serializeEntry((Entry)entries.get(key), definitions);
/*     */     } 
/*     */   }
/*     */ 
/*     */   
/*     */   private static void serializeStartups(OMElement definitions, Collection startups) {
/* 108 */     Iterator<Startup> it = startups.iterator();
/* 109 */     while (it.hasNext()) {
/* 110 */       Startup s = it.next();
/* 111 */       StartupFinder.getInstance().serializeStartup(definitions, s);
/*     */     } 
/*     */   }
/*     */   
/*     */   private static void serializeEndpoints(OMElement definitions, Map<String, Endpoint> endpoints) {
/* 116 */     for (Endpoint endpoint : endpoints.values()) {
/* 117 */       definitions.addChild((OMNode)EndpointSerializer.getElementFromEndpoint(endpoint));
/*     */     }
/*     */   }
/*     */   
/*     */   private static void serializeSequences(OMElement definitions, Map sequences) {
/* 122 */     Iterator<String> iter = sequences.keySet().iterator();
/* 123 */     while (iter.hasNext()) {
/* 124 */       String key = iter.next();
/* 125 */       Mediator mediator = (Mediator)sequences.get(key);
/* 126 */       MediatorSerializerFinder.getInstance().getSerializer(mediator).serializeMediator(definitions, mediator);
/*     */     } 
/*     */   }
/*     */ 
/*     */   
/*     */   private static void handleException(String msg) {
/* 132 */     log.error(msg);
/* 133 */     throw new SynapseException(msg);
/*     */   }
/*     */ 
/*     */   
/* 137 */   public QName getTagQName() { return XMLConfigConstants.DEFINITIONS_ELT; }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\SynapseXMLConfigurationSerializer.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.SynapseXPathFactory,"/*    */ package org.apache.synapse.config.xml;
/*    */ 
/*    */ import javax.xml.namespace.QName;
/*    */ import org.apache.axiom.om.OMAttribute;
/*    */ import org.apache.axiom.om.OMElement;
/*    */ import org.apache.commons.logging.Log;
/*    */ import org.apache.commons.logging.LogFactory;
/*    */ import org.apache.synapse.SynapseException;
/*    */ import org.apache.synapse.util.xpath.SynapseXPath;
/*    */ import org.jaxen.JaxenException;
/*    */ import org.jaxen.XPath;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class SynapseXPathFactory
/*    */ {
/* 37 */   private static final Log log = LogFactory.getLog(SynapseXPathFactory.class);
/*    */ 
/*    */ 
/*    */   
/*    */   public static SynapseXPath getSynapseXPath(OMElement elem, QName attribName) throws JaxenException {
/* 42 */     SynapseXPath xpath = null;
/* 43 */     OMAttribute xpathAttrib = elem.getAttribute(attribName);
/*    */     
/* 45 */     if (xpathAttrib != null && xpathAttrib.getAttributeValue() != null) {
/*    */       
/* 47 */       xpath = new SynapseXPath(xpathAttrib.getAttributeValue());
/* 48 */       OMElementUtils.addNameSpaces((XPath)xpath, elem, log);
/*    */     } else {
/*    */       
/* 51 */       handleException(""Couldn't find the XPath attribute with the QName : "" + attribName.toString() + "" in the element : "" + elem.toString());
/*    */     } 
/*    */ 
/*    */     
/* 55 */     return xpath;
/*    */   }
/*    */   
/*    */   private static void handleException(String message) {
/* 59 */     log.error(message);
/* 60 */     throw new SynapseException(message);
/*    */   }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\SynapseXPathFactory.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.SynapseXPathSerializer,"/*    */ package org.apache.synapse.config.xml;
/*    */ 
/*    */ import org.apache.axiom.om.OMElement;
/*    */ import org.apache.axiom.om.OMNamespace;
/*    */ import org.apache.commons.logging.Log;
/*    */ import org.apache.commons.logging.LogFactory;
/*    */ import org.apache.synapse.SynapseException;
/*    */ import org.apache.synapse.util.xpath.SynapseXPath;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class SynapseXPathSerializer
/*    */ {
/* 34 */   private static final Log log = LogFactory.getLog(SynapseXPathSerializer.class);
/*    */ 
/*    */   
/*    */   public static OMElement serializeXPath(SynapseXPath xpath, OMElement elem, String attribName) {
/* 38 */     OMNamespace nullNS = elem.getOMFactory().createOMNamespace("""", """");
/*    */ 
/*    */     
/* 41 */     if (xpath != null) {
/*    */       
/* 43 */       elem.addAttribute(elem.getOMFactory().createOMAttribute(attribName, nullNS, xpath.toString()));
/*    */ 
/*    */       
/* 46 */       serializeNamespaces(elem, xpath);
/*    */     } else {
/*    */       
/* 49 */       handleException(""Couldn't find the xpath in the SynapseXPath"");
/*    */     } 
/*    */     
/* 52 */     return elem;
/*    */   }
/*    */ 
/*    */   
/*    */   private static void serializeNamespaces(OMElement elem, SynapseXPath xpath) {
/* 57 */     for (Object o : xpath.getNamespaces().keySet()) {
/* 58 */       String prefix = (String)o;
/* 59 */       String uri = xpath.getNamespaceContext().translateNamespacePrefixToUri(prefix);
/* 60 */       if (!""http://ws.apache.org/ns/synapse"".equals(uri)) {
/* 61 */         elem.declareNamespace(uri, prefix);
/*    */       }
/*    */     } 
/*    */   }
/*    */   
/*    */   private static void handleException(String message) {
/* 67 */     log.error(message);
/* 68 */     throw new SynapseException(message);
/*    */   }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\SynapseXPathSerializer.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.TargetFactory,"/*     */ package org.apache.synapse.config.xml;
/*     */ 
/*     */ import javax.xml.namespace.QName;
/*     */ import org.apache.axiom.om.OMAttribute;
/*     */ import org.apache.axiom.om.OMElement;
/*     */ import org.apache.commons.logging.Log;
/*     */ import org.apache.commons.logging.LogFactory;
/*     */ import org.apache.synapse.SynapseException;
/*     */ import org.apache.synapse.config.xml.endpoints.EndpointFactory;
/*     */ import org.apache.synapse.mediators.eip.Target;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class TargetFactory
/*     */ {
/*  47 */   private static final Log log = LogFactory.getLog(TargetFactory.class);
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  52 */   private static final QName TARGET_Q = new QName(""http://ws.apache.org/ns/synapse"", ""target"");
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public static Target createTarget(OMElement elem) {
/*  62 */     if (!TARGET_Q.equals(elem.getQName())) {
/*  63 */       handleException(""Element does not match with the target QName"");
/*     */     }
/*     */     
/*  66 */     Target target = new Target();
/*  67 */     OMAttribute toAttr = elem.getAttribute(new QName("""", ""to""));
/*  68 */     if (toAttr != null && toAttr.getAttributeValue() != null) {
/*  69 */       target.setToAddress(toAttr.getAttributeValue());
/*     */     }
/*     */     
/*  72 */     OMAttribute soapAction = elem.getAttribute(new QName("""", ""soapAction""));
/*     */     
/*  74 */     if (soapAction != null && soapAction.getAttributeValue() != null) {
/*  75 */       target.setSoapAction(soapAction.getAttributeValue());
/*     */     }
/*     */     
/*  78 */     OMAttribute sequenceAttr = elem.getAttribute(new QName("""", ""sequence""));
/*     */     
/*  80 */     if (sequenceAttr != null && sequenceAttr.getAttributeValue() != null) {
/*  81 */       target.setSequenceRef(sequenceAttr.getAttributeValue());
/*     */     }
/*     */     
/*  84 */     OMAttribute endpointAttr = elem.getAttribute(new QName("""", ""endpoint""));
/*     */     
/*  86 */     if (endpointAttr != null && endpointAttr.getAttributeValue() != null) {
/*  87 */       target.setEndpointRef(endpointAttr.getAttributeValue());
/*     */     }
/*     */     
/*  90 */     OMElement sequence = elem.getFirstChildWithName(new QName(""http://ws.apache.org/ns/synapse"", ""sequence""));
/*     */     
/*  92 */     if (sequence != null) {
/*  93 */       SequenceMediatorFactory fac = new SequenceMediatorFactory();
/*  94 */       target.setSequence(fac.createAnonymousSequence(sequence));
/*     */     } 
/*     */     
/*  97 */     OMElement endpoint = elem.getFirstChildWithName(new QName(""http://ws.apache.org/ns/synapse"", ""endpoint""));
/*     */     
/*  99 */     if (endpoint != null) {
/* 100 */       target.setEndpoint(EndpointFactory.getEndpointFromElement(endpoint, true));
/*     */     }
/*     */     
/* 103 */     return target;
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   private static void handleException(String message) {
/* 112 */     if (log.isDebugEnabled()) {
/* 113 */       log.debug(message);
/*     */     }
/* 115 */     throw new SynapseException(message);
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\TargetFactory.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.TargetSerializer,"/*    */ package org.apache.synapse.config.xml;
/*    */ 
/*    */ import org.apache.axiom.om.OMAbstractFactory;
/*    */ import org.apache.axiom.om.OMElement;
/*    */ import org.apache.axiom.om.OMFactory;
/*    */ import org.apache.axiom.om.OMNamespace;
/*    */ import org.apache.axiom.om.OMNode;
/*    */ import org.apache.synapse.config.xml.endpoints.EndpointSerializer;
/*    */ import org.apache.synapse.mediators.eip.Target;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class TargetSerializer
/*    */ {
/* 39 */   private static final OMFactory fac = OMAbstractFactory.getOMFactory();
/*    */ 
/*    */ 
/*    */ 
/*    */   
/* 44 */   private static final OMNamespace synNS = fac.createOMNamespace(""http://ws.apache.org/ns/synapse"", ""syn"");
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */   
/* 50 */   private static final OMNamespace nullNS = fac.createOMNamespace("""", """");
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */   
/*    */   public static OMElement serializeTarget(Target target) {
/* 60 */     OMElement targetElem = fac.createOMElement(""target"", synNS);
/* 61 */     if (target.getToAddress() != null) {
/* 62 */       targetElem.addAttribute(""to"", target.getToAddress(), nullNS);
/*    */     }
/*    */     
/* 65 */     if (target.getSoapAction() != null) {
/* 66 */       targetElem.addAttribute(""soapAction"", target.getSoapAction(), nullNS);
/*    */     }
/*    */     
/* 69 */     if (target.getSequenceRef() != null) {
/* 70 */       targetElem.addAttribute(""sequence"", target.getSequenceRef(), nullNS);
/*    */     }
/*    */     
/* 73 */     if (target.getEndpointRef() != null) {
/* 74 */       targetElem.addAttribute(""endpoint"", target.getEndpointRef(), nullNS);
/*    */     }
/*    */     
/* 77 */     if (target.getSequence() != null) {
/* 78 */       SequenceMediatorSerializer serializer = new SequenceMediatorSerializer();
/* 79 */       serializer.serializeAnonymousSequence(targetElem, target.getSequence());
/*    */     } 
/*    */     
/* 82 */     if (target.getEndpoint() != null) {
/* 83 */       targetElem.addChild((OMNode)EndpointSerializer.getElementFromEndpoint(target.getEndpoint()));
/*    */     }
/*    */     
/* 86 */     return targetElem;
/*    */   }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\TargetSerializer.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.ValidateMediatorFactory,"/*     */ package org.apache.synapse.config.xml;
/*     */ 
/*     */ import java.util.ArrayList;
/*     */ import java.util.Iterator;
/*     */ import java.util.List;
/*     */ import javax.xml.namespace.QName;
/*     */ import org.apache.axiom.om.OMAttribute;
/*     */ import org.apache.axiom.om.OMElement;
/*     */ import org.apache.synapse.Mediator;
/*     */ import org.apache.synapse.mediators.ListMediator;
/*     */ import org.apache.synapse.mediators.builtin.ValidateMediator;
/*     */ import org.jaxen.JaxenException;
/*     */ import org.xml.sax.SAXException;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class ValidateMediatorFactory
/*     */   extends AbstractListMediatorFactory
/*     */ {
/*  50 */   private static final QName VALIDATE_Q = new QName(""http://ws.apache.org/ns/synapse"", ""validate"");
/*  51 */   private static final QName ON_FAIL_Q = new QName(""http://ws.apache.org/ns/synapse"", ""on-fail"");
/*  52 */   private static final QName SCHEMA_Q = new QName(""http://ws.apache.org/ns/synapse"", ""schema"");
/*     */ 
/*     */   
/*     */   public Mediator createMediator(OMElement elem) {
/*  56 */     ValidateMediator validateMediator = new ValidateMediator();
/*     */ 
/*     */     
/*  59 */     List<String> schemaKeys = new ArrayList<String>();
/*  60 */     Iterator schemas = elem.getChildrenWithName(SCHEMA_Q);
/*     */     
/*  62 */     while (schemas.hasNext()) {
/*  63 */       Object o = schemas.next();
/*  64 */       if (o instanceof OMElement) {
/*  65 */         OMElement omElem = (OMElement)o;
/*  66 */         OMAttribute keyAtt = omElem.getAttribute(ATT_KEY);
/*  67 */         if (keyAtt != null) {
/*  68 */           schemaKeys.add(keyAtt.getAttributeValue()); continue;
/*     */         } 
/*  70 */         handleException(""A 'schema' definition must contain a local property 'key'"");
/*     */         continue;
/*     */       } 
/*  73 */       handleException(""Invalid 'schema' declaration for validate mediator"");
/*     */     } 
/*     */ 
/*     */     
/*  77 */     if (schemaKeys.size() == 0) {
/*  78 */       handleException(""No schemas specified for the validate mediator"");
/*     */     } else {
/*  80 */       validateMediator.setSchemaKeys(schemaKeys);
/*     */     } 
/*     */ 
/*     */     
/*  84 */     OMAttribute attSource = elem.getAttribute(ATT_SOURCE);
/*     */     
/*  86 */     if (attSource != null) {
/*     */       try {
/*  88 */         validateMediator.setSource(SynapseXPathFactory.getSynapseXPath(elem, ATT_SOURCE));
/*  89 */       } catch (JaxenException e) {
/*  90 */         handleException(""Invalid XPath expression specified for attribute 'source'"", (Exception)e);
/*     */       } 
/*     */     }
/*     */ 
/*     */     
/*  95 */     OMElement onFail = null;
/*  96 */     Iterator<OMElement> iterator = elem.getChildrenWithName(ON_FAIL_Q);
/*  97 */     if (iterator.hasNext()) {
/*  98 */       onFail = iterator.next();
/*     */     }
/*     */     
/* 101 */     if (onFail != null && onFail.getChildElements().hasNext()) {
/* 102 */       addChildren(onFail, (ListMediator)validateMediator);
/*     */     } else {
/* 104 */       handleException(""A non-empty <on-fail> child element is required for the <validate> mediator"");
/*     */     } 
/*     */ 
/*     */ 
/*     */ 
/*     */     
/* 110 */     processTraceState((Mediator)validateMediator, elem);
/*     */     
/* 112 */     Iterator<OMElement> iter = elem.getChildrenWithName(FEATURE_Q);
/* 113 */     while (iter.hasNext()) {
/* 114 */       OMElement featureElem = iter.next();
/* 115 */       OMAttribute attName = featureElem.getAttribute(ATT_NAME);
/* 116 */       OMAttribute attValue = featureElem.getAttribute(ATT_VALUE);
/* 117 */       if (attName != null && attValue != null) {
/* 118 */         String name = attName.getAttributeValue();
/* 119 */         String value = attValue.getAttributeValue();
/* 120 */         if (name != null && value != null)
/*     */           try {
/* 122 */             if (""true"".equals(value.trim())) {
/* 123 */               validateMediator.addFeature(name.trim(), true); continue;
/* 124 */             }  if (""false"".equals(value.trim())) {
/* 125 */               validateMediator.addFeature(name.trim(), false); continue;
/*     */             } 
/* 127 */             handleException(""The feature must have value true or false"");
/*     */             continue;
/* 129 */           } catch (SAXException e) {
/* 130 */             handleException(""Error setting validation feature : "" + name + "" to : "" + value, e);
/*     */             continue;
/*     */           }  
/* 133 */         handleException(""The valid values for both of the name and value are need"");
/*     */         continue;
/*     */       } 
/* 136 */       handleException(""Both of the name and value attribute are required for a feature"");
/*     */     } 
/*     */     
/* 139 */     return (Mediator)validateMediator;
/*     */   }
/*     */ 
/*     */   
/* 143 */   public QName getTagQName() { return VALIDATE_Q; }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\ValidateMediatorFactory.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.ValidateMediatorSerializer,"/*    */ package org.apache.synapse.config.xml;
/*    */ 
/*    */ import java.util.List;
/*    */ import org.apache.axiom.om.OMContainer;
/*    */ import org.apache.axiom.om.OMElement;
/*    */ import org.apache.axiom.om.OMNode;
/*    */ import org.apache.synapse.Mediator;
/*    */ import org.apache.synapse.mediators.MediatorProperty;
/*    */ import org.apache.synapse.mediators.builtin.ValidateMediator;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class ValidateMediatorSerializer
/*    */   extends AbstractListMediatorSerializer
/*    */   implements MediatorSerializer
/*    */ {
/*    */   public OMElement serializeMediator(OMElement parent, Mediator m) {
/* 39 */     if (!(m instanceof ValidateMediator)) {
/* 40 */       handleException(""Unsupported mediator passed in for serialization : "" + m.getType());
/*    */     }
/*    */     
/* 43 */     ValidateMediator mediator = (ValidateMediator)m;
/* 44 */     OMElement validate = fac.createOMElement(""validate"", synNS);
/* 45 */     saveTracingState(validate, (Mediator)mediator);
/*    */     
/* 47 */     if (mediator.getSource() != null) {
/* 48 */       SynapseXPathSerializer.serializeXPath(mediator.getSource(), validate, ""source"");
/*    */     }
/*    */     
/* 51 */     for (String key : mediator.getSchemaKeys()) {
/* 52 */       OMElement schema = fac.createOMElement(""schema"", synNS, (OMContainer)validate);
/* 53 */       schema.addAttribute(fac.createOMAttribute(""key"", nullNS, key));
/*    */     } 
/*    */     
/* 56 */     List<MediatorProperty> features = mediator.getFeatures();
/* 57 */     if (!features.isEmpty()) {
/* 58 */       for (MediatorProperty mp : features) {
/* 59 */         OMElement feature = fac.createOMElement(""feature"", synNS, (OMContainer)validate);
/* 60 */         if (mp.getName() != null) {
/* 61 */           feature.addAttribute(fac.createOMAttribute(""name"", nullNS, mp.getName()));
/*    */         } else {
/* 63 */           handleException(""The Feature name is missing"");
/*    */         } 
/* 65 */         if (mp.getValue() != null) {
/* 66 */           feature.addAttribute(fac.createOMAttribute(""value"", nullNS, mp.getValue())); continue;
/*    */         } 
/* 68 */         handleException(""The Feature value is missing"");
/*    */       } 
/*    */     }
/*    */     
/* 72 */     OMElement onFail = fac.createOMElement(""on-fail"", synNS, (OMContainer)validate);
/* 73 */     serializeChildren(onFail, mediator.getList());
/*    */     
/* 75 */     if (parent != null) {
/* 76 */       parent.addChild((OMNode)validate);
/*    */     }
/* 78 */     return validate;
/*    */   }
/*    */ 
/*    */   
/* 82 */   public String getMediatorClassName() { return ValidateMediator.class.getName(); }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\ValidateMediatorSerializer.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.XMLConfigConstants,"/*    */ package org.apache.synapse.config.xml;
/*    */ 
/*    */ import javax.xml.namespace.QName;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class XMLConfigConstants
/*    */ {
/*    */   public static final String SYNAPSE_NAMESPACE = ""http://ws.apache.org/ns/synapse"";
/*    */   public static final String SCOPE_DEFAULT = ""default"";
/*    */   public static final String SCOPE_AXIS2 = ""axis2"";
/*    */   public static final String SCOPE_CLIENT = ""axis2-client"";
/*    */   public static final String SCOPE_TRANSPORT = ""transport"";
/*    */   public static final String SEQUENCE_VERSION_1_0 = ""1.0"";
/*    */   public static final String SEQUENCE_VERSION_1_1 = ""1.1"";
/* 51 */   public static final QName DEFINITIONS_ELT = new QName(""http://ws.apache.org/ns/synapse"", ""definitions"");
/* 52 */   public static final QName SEQUENCE_ELT = new QName(""http://ws.apache.org/ns/synapse"", ""sequence"");
/* 53 */   public static final QName ENDPOINT_ELT = new QName(""http://ws.apache.org/ns/synapse"", ""endpoint"");
/* 54 */   public static final QName ENTRY_ELT = new QName(""http://ws.apache.org/ns/synapse"", ""localEntry"");
/* 55 */   public static final QName REGISTRY_ELT = new QName(""http://ws.apache.org/ns/synapse"", ""registry"");
/* 56 */   public static final QName TASK_ELT = new QName(""http://ws.apache.org/ns/synapse"", ""task"");
/* 57 */   public static final QName PROXY_ELT = new QName(""http://ws.apache.org/ns/synapse"", ""proxy"");
/*    */   public static final String NULL_NAMESPACE = """";
/* 59 */   public static final Object QUARTZ_QNAME = new QName(""http://www.opensymphony.com/quartz/JobSchedulingData"", ""quartz"");
/*    */ 
/*    */   
/*    */   public static final String TRACE_ATTRIB_NAME = ""trace"";
/*    */   
/*    */   public static final String TRACE_ENABLE = ""enable"";
/*    */   
/*    */   public static final String TRACE_DISABLE = ""disable"";
/*    */   
/*    */   public static final String STATISTICS_ATTRIB_NAME = ""statistics"";
/*    */   
/*    */   public static final String STATISTICS_ENABLE = ""enable"";
/*    */   
/*    */   public static final String STATISTICS_DISABLE = ""disable"";
/*    */   
/*    */   public static final String SUSPEND_DURATION_ON_FAILURE = ""suspendDurationOnFailure"";
/*    */   
/*    */   public static final String ALGORITHM_NAME = ""policy"";
/*    */   
/*    */   public static final String ONREJECT = ""onReject"";
/*    */   
/*    */   public static final String ONACCEPT = ""onAccept"";
/*    */   
/* 82 */   public static final QName ATT_XPATH_RELATIVE = new QName(""relative"");
/*    */   public static final String XPATH_BODY_RELATIVE = ""body"";
/*    */   public static final String XPATH_ENVELOPE_RELATIVE = ""envelope"";
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\XMLConfigConstants.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.XMLConfigurationBuilder,"/*    */ package org.apache.synapse.config.xml;
/*    */ 
/*    */ import java.io.InputStream;
/*    */ import javax.xml.stream.XMLStreamException;
/*    */ import org.apache.axiom.om.OMElement;
/*    */ import org.apache.axiom.om.impl.builder.StAXOMBuilder;
/*    */ import org.apache.commons.logging.Log;
/*    */ import org.apache.commons.logging.LogFactory;
/*    */ import org.apache.synapse.config.SynapseConfiguration;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class XMLConfigurationBuilder
/*    */ {
/* 37 */   private static Log log = LogFactory.getLog(XMLConfigurationBuilder.class);
/*    */ 
/*    */   
/*    */   public static SynapseConfiguration getConfiguration(InputStream is) throws XMLStreamException {
/* 41 */     log.info(""Generating the Synapse configuration model by parsing the XML configuration"");
/*    */     
/* 43 */     OMElement definitions = (new StAXOMBuilder(is)).getDocumentElement();
/* 44 */     definitions.build();
/*    */     
/* 46 */     return ConfigurationFactoryAndSerializerFinder.getInstance().getConfiguration(definitions);
/*    */   }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\XMLConfigurationBuilder.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.XMLConfigurationSerializer,"/*    */ package org.apache.synapse.config.xml;
/*    */ 
/*    */ import java.io.OutputStream;
/*    */ import javax.xml.stream.XMLStreamException;
/*    */ import org.apache.axiom.om.OMElement;
/*    */ import org.apache.commons.logging.Log;
/*    */ import org.apache.commons.logging.LogFactory;
/*    */ import org.apache.synapse.config.SynapseConfiguration;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class XMLConfigurationSerializer
/*    */ {
/* 35 */   private static final Log log = LogFactory.getLog(XMLConfigurationSerializer.class);
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */   
/*    */   public static void serializeConfiguration(SynapseConfiguration synCfg, OutputStream outputStream) throws XMLStreamException {
/* 46 */     log.info(""Serializing the XML Configuration to the output stream"");
/*    */     
/* 48 */     OMElement definitions = ConfigurationFactoryAndSerializerFinder.serializeConfiguration(synCfg);
/*    */     
/* 50 */     definitions.serialize(outputStream);
/*    */   }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\XMLConfigurationSerializer.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.XSLTMediatorFactory,"/*     */ package org.apache.synapse.config.xml;
/*     */ 
/*     */ import java.util.Iterator;
/*     */ import javax.xml.namespace.QName;
/*     */ import org.apache.axiom.om.OMAttribute;
/*     */ import org.apache.axiom.om.OMElement;
/*     */ import org.apache.synapse.Mediator;
/*     */ import org.apache.synapse.mediators.transform.XSLTMediator;
/*     */ import org.jaxen.JaxenException;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class XSLTMediatorFactory
/*     */   extends AbstractMediatorFactory
/*     */ {
/*  44 */   private static final QName TAG_NAME = new QName(""http://ws.apache.org/ns/synapse"", ""xslt"");
/*     */ 
/*     */   
/*  47 */   public QName getTagQName() { return TAG_NAME; }
/*     */ 
/*     */ 
/*     */   
/*     */   public Mediator createMediator(OMElement elem) {
/*  52 */     XSLTMediator transformMediator = new XSLTMediator();
/*     */     
/*  54 */     OMAttribute attXslt = elem.getAttribute(ATT_KEY);
/*  55 */     OMAttribute attSource = elem.getAttribute(ATT_SOURCE);
/*  56 */     OMAttribute attTarget = elem.getAttribute(ATT_TARGET);
/*     */     
/*  58 */     if (attXslt != null) {
/*  59 */       transformMediator.setXsltKey(attXslt.getAttributeValue());
/*     */     } else {
/*  61 */       handleException(""The 'key' attribute is required for the XSLT mediator"");
/*     */     } 
/*     */     
/*  64 */     if (attSource != null) {
/*     */       try {
/*  66 */         transformMediator.setSourceXPathString(attSource.getAttributeValue());
/*  67 */         transformMediator.setSource(SynapseXPathFactory.getSynapseXPath(elem, ATT_SOURCE));
/*     */       }
/*  69 */       catch (JaxenException e) {
/*  70 */         handleException(""Invalid XPath specified for the source attribute : "" + attSource.getAttributeValue());
/*     */       } 
/*     */     }
/*     */ 
/*     */     
/*  75 */     if (attTarget != null) {
/*  76 */       transformMediator.setTargetPropertyName(attTarget.getAttributeValue());
/*     */     }
/*     */ 
/*     */ 
/*     */     
/*  81 */     processTraceState((Mediator)transformMediator, elem);
/*     */     
/*  83 */     Iterator<OMElement> iter = elem.getChildrenWithName(FEATURE_Q);
/*  84 */     while (iter.hasNext()) {
/*  85 */       OMElement featureElem = iter.next();
/*  86 */       OMAttribute attName = featureElem.getAttribute(ATT_NAME);
/*  87 */       OMAttribute attValue = featureElem.getAttribute(ATT_VALUE);
/*  88 */       if (attName != null && attValue != null) {
/*  89 */         String name = attName.getAttributeValue();
/*  90 */         String value = attValue.getAttributeValue();
/*  91 */         if (name != null && value != null) {
/*  92 */           if (""true"".equals(value.trim())) {
/*  93 */             transformMediator.addFeature(name.trim(), true); continue;
/*     */           } 
/*  95 */           if (""false"".equals(value.trim())) {
/*  96 */             transformMediator.addFeature(name.trim(), false);
/*     */             continue;
/*     */           } 
/*  99 */           handleException(""The feature must have value true or false"");
/*     */           continue;
/*     */         } 
/* 102 */         handleException(""The valid values for both of the name and value are need"");
/*     */         continue;
/*     */       } 
/* 105 */       handleException(""Both of the name and value attribute are required for a feature"");
/*     */     } 
/*     */     
/* 108 */     transformMediator.addAllProperties(MediatorPropertyFactory.getMediatorProperties(elem));
/*     */ 
/*     */     
/* 111 */     return (Mediator)transformMediator;
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\XSLTMediatorFactory.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.XSLTMediatorSerializer,"/*    */ package org.apache.synapse.config.xml;
/*    */ 
/*    */ import java.util.List;
/*    */ import org.apache.axiom.om.OMContainer;
/*    */ import org.apache.axiom.om.OMElement;
/*    */ import org.apache.axiom.om.OMNode;
/*    */ import org.apache.synapse.Mediator;
/*    */ import org.apache.synapse.mediators.MediatorProperty;
/*    */ import org.apache.synapse.mediators.transform.XSLTMediator;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class XSLTMediatorSerializer
/*    */   extends AbstractMediatorSerializer
/*    */ {
/*    */   public OMElement serializeMediator(OMElement parent, Mediator m) {
/* 39 */     if (!(m instanceof XSLTMediator)) {
/* 40 */       handleException(""Unsupported mediator passed in for serialization : "" + m.getType());
/*    */     }
/*    */     
/* 43 */     XSLTMediator mediator = (XSLTMediator)m;
/* 44 */     OMElement xslt = fac.createOMElement(""xslt"", synNS);
/*    */     
/* 46 */     if (mediator.getXsltKey() != null) {
/* 47 */       xslt.addAttribute(fac.createOMAttribute(""key"", nullNS, mediator.getXsltKey()));
/*    */     } else {
/*    */       
/* 50 */       handleException(""Invalid XSLT mediator. XSLT registry key is required"");
/*    */     } 
/* 52 */     saveTracingState(xslt, (Mediator)mediator);
/*    */     
/* 54 */     if (mediator.getSource() != null && !""s11:Body/child::*[position()=1] | s12:Body/child::*[position()=1]"".equals(mediator.getSource().toString()))
/*    */     {
/*    */       
/* 57 */       SynapseXPathSerializer.serializeXPath(mediator.getSource(), xslt, ""source"");
/*    */     }
/* 59 */     if (mediator.getTargetPropertyName() != null) {
/* 60 */       xslt.addAttribute(fac.createOMAttribute(""target"", nullNS, mediator.getTargetPropertyName()));
/*    */     }
/*    */     
/* 63 */     serializeProperties(xslt, mediator.getProperties());
/* 64 */     List<MediatorProperty> features = mediator.getFeatures();
/* 65 */     if (!features.isEmpty()) {
/* 66 */       for (MediatorProperty mp : features) {
/* 67 */         OMElement prop = fac.createOMElement(""feature"", synNS, (OMContainer)xslt);
/* 68 */         if (mp.getName() != null) {
/* 69 */           prop.addAttribute(fac.createOMAttribute(""name"", nullNS, mp.getName()));
/*    */         } else {
/* 71 */           handleException(""The Feature name is missing"");
/*    */         } 
/* 73 */         if (mp.getValue() != null) {
/* 74 */           prop.addAttribute(fac.createOMAttribute(""value"", nullNS, mp.getValue())); continue;
/*    */         } 
/* 76 */         handleException(""The Feature value is missing"");
/*    */       } 
/*    */     }
/*    */     
/* 80 */     if (parent != null) {
/* 81 */       parent.addChild((OMNode)xslt);
/*    */     }
/* 83 */     return xslt;
/*    */   }
/*    */ 
/*    */   
/* 87 */   public String getMediatorClassName() { return XSLTMediator.class.getName(); }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\XSLTMediatorSerializer.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.endpoints.AddressEndpointFactory,"/*     */ package org.apache.synapse.config.xml.endpoints;
/*     */ 
/*     */ import javax.xml.namespace.QName;
/*     */ import org.apache.axiom.om.OMAttribute;
/*     */ import org.apache.axiom.om.OMElement;
/*     */ import org.apache.synapse.endpoints.AddressEndpoint;
/*     */ import org.apache.synapse.endpoints.Endpoint;
/*     */ import org.apache.synapse.endpoints.utils.EndpointDefinition;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class AddressEndpointFactory
/*     */   extends DefaultEndpointFactory
/*     */ {
/*  61 */   private static AddressEndpointFactory instance = new AddressEndpointFactory();
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  67 */   public static AddressEndpointFactory getInstance() { return instance; }
/*     */ 
/*     */ 
/*     */   
/*     */   protected Endpoint createEndpoint(OMElement epConfig, boolean anonymousEndpoint) {
/*  72 */     AddressEndpoint addressEndpoint = new AddressEndpoint();
/*  73 */     OMAttribute name = epConfig.getAttribute(new QName("""", ""name""));
/*     */ 
/*     */     
/*  76 */     if (name != null) {
/*  77 */       addressEndpoint.setName(name.getAttributeValue());
/*     */     }
/*     */     
/*  80 */     OMElement addressElement = epConfig.getFirstChildWithName(new QName(""http://ws.apache.org/ns/synapse"", ""address""));
/*     */     
/*  82 */     if (addressElement != null) {
/*  83 */       EndpointDefinition endpoint = createEndpointDefinition(addressElement);
/*  84 */       addressEndpoint.setEndpoint(endpoint);
/*     */     } 
/*     */     
/*  87 */     return (Endpoint)addressEndpoint;
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public EndpointDefinition createEndpointDefinition(OMElement elem) {
/* 100 */     OMAttribute address = elem.getAttribute(new QName(""uri""));
/* 101 */     EndpointDefinition endpointDefinition = new EndpointDefinition();
/*     */     
/* 103 */     if (address != null) {
/* 104 */       endpointDefinition.setAddress(address.getAttributeValue());
/*     */     }
/*     */     
/* 107 */     extractCommonEndpointProperties(endpointDefinition, elem);
/* 108 */     extractSpecificEndpointProperties(endpointDefinition, elem);
/* 109 */     return endpointDefinition;
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\endpoints\AddressEndpointFactory.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.endpoints.AddressEndpointSerializer,"/*    */ package org.apache.synapse.config.xml.endpoints;
/*    */ 
/*    */ import org.apache.axiom.om.OMAbstractFactory;
/*    */ import org.apache.axiom.om.OMElement;
/*    */ import org.apache.axiom.om.OMNode;
/*    */ import org.apache.synapse.SynapseConstants;
/*    */ import org.apache.synapse.SynapseException;
/*    */ import org.apache.synapse.endpoints.AddressEndpoint;
/*    */ import org.apache.synapse.endpoints.Endpoint;
/*    */ import org.apache.synapse.endpoints.utils.EndpointDefinition;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class AddressEndpointSerializer
/*    */   extends DefaultEndpointSerializer
/*    */ {
/*    */   protected OMElement serializeEndpoint(Endpoint endpoint) {
/* 39 */     if (!(endpoint instanceof AddressEndpoint)) {
/* 40 */       throw new SynapseException(""Invalid endpoint type."");
/*    */     }
/*    */     
/* 43 */     this.fac = OMAbstractFactory.getOMFactory();
/* 44 */     OMElement endpointElement = this.fac.createOMElement(""endpoint"", SynapseConstants.SYNAPSE_OMNAMESPACE);
/*    */ 
/*    */     
/* 47 */     AddressEndpoint addressEndpoint = (AddressEndpoint)endpoint;
/* 48 */     String name = addressEndpoint.getName();
/* 49 */     if (name != null) {
/* 50 */       endpointElement.addAttribute(""name"", name, null);
/*    */     }
/*    */     
/* 53 */     EndpointDefinition epAddress = addressEndpoint.getEndpoint();
/* 54 */     OMElement addressElement = serializeEndpointDefinition(epAddress);
/* 55 */     endpointElement.addChild((OMNode)addressElement);
/*    */     
/* 57 */     return endpointElement;
/*    */   }
/*    */ 
/*    */   
/*    */   public OMElement serializeEndpointDefinition(EndpointDefinition endpointDefinition) {
/* 62 */     OMElement element = this.fac.createOMElement(""address"", SynapseConstants.SYNAPSE_OMNAMESPACE);
/*    */     
/* 64 */     if (endpointDefinition.getAddress() != null) {
/* 65 */       element.addAttribute(this.fac.createOMAttribute(""uri"", null, endpointDefinition.getAddress()));
/*    */     } else {
/*    */       
/* 68 */       handleException(""Invalid Endpoint. Address is required"");
/*    */     } 
/*    */     
/* 71 */     serializeCommonEndpointProperties(endpointDefinition, element);
/* 72 */     serializeSpecificEndpointProperties(endpointDefinition, element);
/*    */     
/* 74 */     return element;
/*    */   }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\endpoints\AddressEndpointSerializer.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.endpoints.DefaultEndpointFactory,"/*     */ package org.apache.synapse.config.xml.endpoints;
/*     */ 
/*     */ import javax.xml.namespace.QName;
/*     */ import org.apache.axiom.om.OMAttribute;
/*     */ import org.apache.axiom.om.OMElement;
/*     */ import org.apache.synapse.endpoints.DefaultEndpoint;
/*     */ import org.apache.synapse.endpoints.Endpoint;
/*     */ import org.apache.synapse.endpoints.utils.EndpointDefinition;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class DefaultEndpointFactory
/*     */   extends EndpointFactory
/*     */ {
/*  61 */   private static DefaultEndpointFactory instance = new DefaultEndpointFactory();
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  67 */   public static DefaultEndpointFactory getInstance() { return instance; }
/*     */ 
/*     */ 
/*     */   
/*     */   protected Endpoint createEndpoint(OMElement epConfig, boolean anonymousEndpoint) {
/*  72 */     DefaultEndpoint defaultEndpoint = new DefaultEndpoint();
/*  73 */     OMAttribute name = epConfig.getAttribute(new QName("""", ""name""));
/*     */ 
/*     */     
/*  76 */     if (name != null) {
/*  77 */       defaultEndpoint.setName(name.getAttributeValue());
/*     */     }
/*     */     
/*  80 */     OMElement defaultElement = epConfig.getFirstChildWithName(new QName(""http://ws.apache.org/ns/synapse"", ""default""));
/*     */     
/*  82 */     if (defaultElement != null) {
/*  83 */       EndpointDefinition endpoint = createEndpointDefinition(defaultElement);
/*  84 */       defaultEndpoint.setEndpoint(endpoint);
/*     */     } 
/*     */     
/*  87 */     return (Endpoint)defaultEndpoint;
/*     */   }
/*     */ 
/*     */   
/*     */   protected void extractSpecificEndpointProperties(EndpointDefinition definition, OMElement elem) {
/*  92 */     OMAttribute format = elem.getAttribute(new QName("""", ""format""));
/*     */     
/*  94 */     if (format != null) {
/*  95 */       String forceValue = format.getAttributeValue().trim().toLowerCase();
/*  96 */       if (""pox"".equals(forceValue)) {
/*  97 */         definition.setForcePOX(true);
/*  98 */         definition.setFormat(""pox"");
/*     */       }
/* 100 */       else if (""get"".equals(forceValue)) {
/* 101 */         definition.setForceGET(true);
/* 102 */         definition.setFormat(""get"");
/*     */       }
/* 104 */       else if (""soap11"".equals(forceValue)) {
/* 105 */         definition.setForceSOAP11(true);
/* 106 */         definition.setFormat(""soap11"");
/*     */       }
/* 108 */       else if (""soap12"".equals(forceValue)) {
/* 109 */         definition.setForceSOAP12(true);
/* 110 */         definition.setFormat(""soap12"");
/*     */       } else {
/*     */         
/* 113 */         handleException(""force value -\"""" + forceValue + ""\"" not yet implemented"");
/*     */       } 
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public EndpointDefinition createEndpointDefinition(OMElement elem) {
/* 128 */     EndpointDefinition endpointDefinition = new EndpointDefinition();
/* 129 */     extractCommonEndpointProperties(endpointDefinition, elem);
/* 130 */     extractSpecificEndpointProperties(endpointDefinition, elem);
/* 131 */     return endpointDefinition;
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\endpoints\DefaultEndpointFactory.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.endpoints.DefaultEndpointSerializer,"/*    */ package org.apache.synapse.config.xml.endpoints;
/*    */ 
/*    */ import org.apache.axiom.om.OMAbstractFactory;
/*    */ import org.apache.axiom.om.OMElement;
/*    */ import org.apache.axiom.om.OMNode;
/*    */ import org.apache.synapse.SynapseConstants;
/*    */ import org.apache.synapse.SynapseException;
/*    */ import org.apache.synapse.endpoints.DefaultEndpoint;
/*    */ import org.apache.synapse.endpoints.Endpoint;
/*    */ import org.apache.synapse.endpoints.utils.EndpointDefinition;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class DefaultEndpointSerializer
/*    */   extends EndpointSerializer
/*    */ {
/*    */   protected OMElement serializeEndpoint(Endpoint endpoint) {
/* 39 */     if (!(endpoint instanceof DefaultEndpoint)) {
/* 40 */       throw new SynapseException(""Invalid endpoint type."");
/*    */     }
/*    */     
/* 43 */     this.fac = OMAbstractFactory.getOMFactory();
/* 44 */     OMElement endpointElement = this.fac.createOMElement(""endpoint"", SynapseConstants.SYNAPSE_OMNAMESPACE);
/*    */ 
/*    */     
/* 47 */     DefaultEndpoint defaultEndpoint = (DefaultEndpoint)endpoint;
/* 48 */     String name = defaultEndpoint.getName();
/* 49 */     if (name != null) {
/* 50 */       endpointElement.addAttribute(""name"", name, null);
/*    */     }
/*    */     
/* 53 */     EndpointDefinition epAddress = defaultEndpoint.getEndpoint();
/* 54 */     OMElement defaultElement = serializeEndpointDefinition(epAddress);
/* 55 */     endpointElement.addChild((OMNode)defaultElement);
/*    */     
/* 57 */     return endpointElement;
/*    */   }
/*    */ 
/*    */   
/*    */   protected void serializeSpecificEndpointProperties(EndpointDefinition endpointDefinition, OMElement element) {
/* 62 */     if (""pox"".equals(endpointDefinition.getFormat())) {
/* 63 */       element.addAttribute(this.fac.createOMAttribute(""format"", null, ""pox""));
/* 64 */     } else if (""get"".equals(endpointDefinition.getFormat())) {
/* 65 */       element.addAttribute(this.fac.createOMAttribute(""format"", null, ""get""));
/* 66 */     } else if (""soap11"".equals(endpointDefinition.getFormat())) {
/* 67 */       element.addAttribute(this.fac.createOMAttribute(""format"", null, ""soap11""));
/* 68 */     } else if (""soap12"".equals(endpointDefinition.getFormat())) {
/* 69 */       element.addAttribute(this.fac.createOMAttribute(""format"", null, ""soap12""));
/*    */     
/*    */     }
/* 72 */     else if (endpointDefinition.isForcePOX()) {
/* 73 */       element.addAttribute(this.fac.createOMAttribute(""format"", null, ""pox""));
/* 74 */     } else if (endpointDefinition.isForceGET()) {
/* 75 */       element.addAttribute(this.fac.createOMAttribute(""format"", null, ""get""));
/* 76 */     } else if (endpointDefinition.isForceSOAP11()) {
/* 77 */       element.addAttribute(this.fac.createOMAttribute(""format"", null, ""soap11""));
/* 78 */     } else if (endpointDefinition.isForceSOAP12()) {
/* 79 */       element.addAttribute(this.fac.createOMAttribute(""format"", null, ""soap12""));
/*    */     } 
/*    */   }
/*    */ 
/*    */   
/*    */   public OMElement serializeEndpointDefinition(EndpointDefinition endpointDefinition) {
/* 85 */     OMElement element = this.fac.createOMElement(""default"", SynapseConstants.SYNAPSE_OMNAMESPACE);
/* 86 */     serializeCommonEndpointProperties(endpointDefinition, element);
/* 87 */     serializeSpecificEndpointProperties(endpointDefinition, element);
/* 88 */     return element;
/*    */   }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\endpoints\DefaultEndpointSerializer.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.endpoints.EndpointFactory,"/*     */ package org.apache.synapse.config.xml.endpoints;
/*     */ 
/*     */ import java.util.ArrayList;
/*     */ import java.util.Iterator;
/*     */ import javax.xml.namespace.QName;
/*     */ import org.apache.axiom.om.OMAttribute;
/*     */ import org.apache.axiom.om.OMElement;
/*     */ import org.apache.axiom.om.OMNode;
/*     */ import org.apache.commons.logging.Log;
/*     */ import org.apache.commons.logging.LogFactory;
/*     */ import org.apache.synapse.SynapseException;
/*     */ import org.apache.synapse.config.XMLToObjectMapper;
/*     */ import org.apache.synapse.config.xml.XMLConfigConstants;
/*     */ import org.apache.synapse.endpoints.Endpoint;
/*     */ import org.apache.synapse.endpoints.IndirectEndpoint;
/*     */ import org.apache.synapse.endpoints.utils.EndpointDefinition;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public abstract class EndpointFactory
/*     */   implements XMLToObjectMapper
/*     */ {
/*  51 */   private static Log log = LogFactory.getLog(EndpointFactory.class);
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  62 */   public static Endpoint getEndpointFromElement(OMElement elem, boolean isAnonymous) { return getEndpointFactory(elem).createEndpoint(elem, isAnonymous); }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public Object getObjectFromOMNode(OMNode om) {
/*  72 */     if (om instanceof OMElement) {
/*  73 */       return createEndpoint((OMElement)om, false);
/*     */     }
/*  75 */     handleException(""Invalid XML configuration for an Endpoint. OMElement expected"");
/*     */     
/*  77 */     return null;
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   protected abstract Endpoint createEndpoint(OMElement paramOMElement, boolean paramBoolean);
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   protected void extractCommonEndpointProperties(EndpointDefinition definition, OMElement elem) {
/* 100 */     OMAttribute optimize = elem.getAttribute(new QName("""", ""optimize""));
/*     */     
/* 102 */     OMAttribute encoding = elem.getAttribute(new QName("""", ""encoding""));
/*     */ 
/*     */     
/* 105 */     OMAttribute statistics = elem.getAttribute(new QName("""", ""statistics""));
/*     */     
/* 107 */     if (statistics != null && statistics.getAttributeValue() != null) {
/* 108 */       String statisticsValue = statistics.getAttributeValue();
/* 109 */       if (""enable"".equals(statisticsValue)) {
/* 110 */         definition.setStatisticsState(1);
/* 111 */       } else if (""disable"".equals(statisticsValue)) {
/* 112 */         definition.setStatisticsState(0);
/*     */       } 
/*     */     } else {
/* 115 */       definition.setStatisticsState(2);
/*     */     } 
/*     */     
/* 118 */     OMAttribute trace = elem.getAttribute(new QName("""", ""trace""));
/*     */     
/* 120 */     if (trace != null && trace.getAttributeValue() != null) {
/* 121 */       String traceValue = trace.getAttributeValue();
/* 122 */       if (""enable"".equals(traceValue)) {
/* 123 */         definition.setTraceState(1);
/* 124 */       } else if (""disable"".equals(traceValue)) {
/* 125 */         definition.setTraceState(0);
/*     */       } 
/*     */     } else {
/* 128 */       definition.setTraceState(2);
/*     */     } 
/*     */ 
/*     */     
/* 132 */     if (optimize != null && optimize.getAttributeValue().length() > 0) {
/* 133 */       String method = optimize.getAttributeValue().trim();
/* 134 */       if (""mtom"".equalsIgnoreCase(method)) {
/* 135 */         definition.setUseMTOM(true);
/* 136 */       } else if (""swa"".equalsIgnoreCase(method)) {
/* 137 */         definition.setUseSwa(true);
/*     */       } 
/*     */     } 
/*     */     
/* 141 */     if (encoding != null && encoding.getAttributeValue() != null) {
/* 142 */       definition.setCharSetEncoding(encoding.getAttributeValue());
/*     */     }
/*     */     
/* 145 */     OMElement wsAddr = elem.getFirstChildWithName(new QName(""http://ws.apache.org/ns/synapse"", ""enableAddressing""));
/*     */     
/* 147 */     if (wsAddr != null) {
/*     */       
/* 149 */       definition.setAddressingOn(true);
/*     */       
/* 151 */       OMAttribute version = wsAddr.getAttribute(new QName(""version""));
/* 152 */       if (version != null && version.getAttributeValue() != null) {
/* 153 */         String versionValue = version.getAttributeValue().trim().toLowerCase();
/* 154 */         if (""final"".equals(versionValue) || ""submission"".equals(versionValue)) {
/*     */           
/* 156 */           definition.setAddressingVersion(version.getAttributeValue());
/*     */         } else {
/* 158 */           handleException(""Unknown value for the addressing version. Possible values for the addressing version are 'final' and 'submission' only."");
/*     */         } 
/*     */       } 
/*     */ 
/*     */       
/* 163 */       String useSepList = wsAddr.getAttributeValue(new QName(""separateListener""));
/* 164 */       if (useSepList != null && 
/* 165 */         ""true"".equals(useSepList.trim().toLowerCase())) {
/* 166 */         definition.setUseSeparateListener(true);
/*     */       }
/*     */     } 
/*     */ 
/*     */     
/* 171 */     OMElement wsSec = elem.getFirstChildWithName(new QName(""http://ws.apache.org/ns/synapse"", ""enableSec""));
/*     */     
/* 173 */     if (wsSec != null) {
/*     */       
/* 175 */       definition.setSecurityOn(true);
/*     */       
/* 177 */       OMAttribute policy = wsSec.getAttribute(new QName("""", ""policy""));
/*     */       
/* 179 */       if (policy != null) {
/* 180 */         definition.setWsSecPolicyKey(policy.getAttributeValue());
/*     */       }
/*     */     } 
/*     */     
/* 184 */     OMElement wsRm = elem.getFirstChildWithName(new QName(""http://ws.apache.org/ns/synapse"", ""enableRM""));
/*     */     
/* 186 */     if (wsRm != null) {
/*     */       
/* 188 */       definition.setReliableMessagingOn(true);
/*     */       
/* 190 */       OMAttribute policy = wsRm.getAttribute(new QName("""", ""policy""));
/*     */       
/* 192 */       if (policy != null) {
/* 193 */         definition.setWsRMPolicyKey(policy.getAttributeValue());
/*     */       }
/*     */     } 
/*     */ 
/*     */     
/* 198 */     OMElement timeout = elem.getFirstChildWithName(new QName(""http://ws.apache.org/ns/synapse"", ""timeout""));
/*     */     
/* 200 */     if (timeout != null) {
/* 201 */       OMElement duration = timeout.getFirstChildWithName(new QName(""http://ws.apache.org/ns/synapse"", ""duration""));
/*     */ 
/*     */       
/* 204 */       if (duration != null) {
/* 205 */         String d = duration.getText();
/* 206 */         if (d != null) {
/*     */           try {
/* 208 */             long timeoutSeconds = Long.parseLong(d.trim());
/* 209 */             definition.setTimeoutDuration(timeoutSeconds * 1000L);
/* 210 */           } catch (NumberFormatException e) {
/* 211 */             handleException(""Endpoint timeout duration expected as a number but was not a number"");
/*     */           } 
/*     */         }
/*     */       } 
/*     */ 
/*     */       
/* 217 */       OMElement action = timeout.getFirstChildWithName(new QName(""http://ws.apache.org/ns/synapse"", ""action""));
/*     */       
/* 219 */       if (action != null && action.getText() != null) {
/* 220 */         String actionString = action.getText();
/* 221 */         if (""discard"".equalsIgnoreCase(actionString.trim())) {
/*     */           
/* 223 */           definition.setTimeoutAction(101);
/*     */ 
/*     */           
/* 226 */           if (definition.getTimeoutDuration() == 0L) {
/* 227 */             definition.setTimeoutDuration(30000L);
/*     */           }
/* 229 */         } else if (""fault"".equalsIgnoreCase(actionString.trim())) {
/*     */           
/* 231 */           definition.setTimeoutAction(102);
/*     */ 
/*     */           
/* 234 */           if (definition.getTimeoutDuration() == 0L) {
/* 235 */             definition.setTimeoutDuration(30000L);
/*     */           }
/*     */         } else {
/* 238 */           handleException(""Invalid timeout action, action : "" + actionString + "" is not supported"");
/*     */         } 
/*     */       } 
/*     */     } 
/*     */ 
/*     */ 
/*     */     
/* 245 */     OMElement suspendElement = elem.getFirstChildWithName(new QName(""http://ws.apache.org/ns/synapse"", ""suspendDurationOnFailure""));
/*     */ 
/*     */     
/* 248 */     if (suspendElement != null && suspendElement.getText() != null) {
/*     */       try {
/* 250 */         long suspendDuration = Long.parseLong(suspendElement.getText().trim());
/* 251 */         definition.setSuspendOnFailDuration(suspendDuration * 1000L);
/* 252 */       } catch (NumberFormatException e) {
/* 253 */         handleException(""The suspend duration should be specified as a valid number :: "" + e.getMessage(), e);
/*     */       } 
/*     */     }
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   protected void extractSpecificEndpointProperties(EndpointDefinition definition, OMElement elem) {}
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   private static EndpointFactory getEndpointFactory(OMElement configElement) {
/* 272 */     if (configElement.getAttribute(new QName(""key"")) != null) {
/* 273 */       return IndirectEndpointFactory.getInstance();
/*     */     }
/*     */     
/* 276 */     OMElement addressElement = configElement.getFirstChildWithName(new QName(""http://ws.apache.org/ns/synapse"", ""address""));
/*     */     
/* 278 */     if (addressElement != null) {
/* 279 */       return AddressEndpointFactory.getInstance();
/*     */     }
/*     */     
/* 282 */     OMElement wsdlElement = configElement.getFirstChildWithName(new QName(""http://ws.apache.org/ns/synapse"", ""wsdl""));
/*     */     
/* 284 */     if (wsdlElement != null) {
/* 285 */       return WSDLEndpointFactory.getInstance();
/*     */     }
/*     */     
/* 288 */     OMElement defaultElement = configElement.getFirstChildWithName(new QName(""http://ws.apache.org/ns/synapse"", ""default""));
/*     */     
/* 290 */     if (defaultElement != null) {
/* 291 */       return DefaultEndpointFactory.getInstance();
/*     */     }
/*     */     
/* 294 */     OMElement lbElement = configElement.getFirstChildWithName(new QName(""http://ws.apache.org/ns/synapse"", ""loadbalance""));
/*     */     
/* 296 */     if (lbElement != null) {
/* 297 */       OMElement sessionElement = configElement.getFirstChildWithName(new QName(""http://ws.apache.org/ns/synapse"", ""session""));
/*     */       
/* 299 */       if (sessionElement != null) {
/* 300 */         return SALoadbalanceEndpointFactory.getInstance();
/*     */       }
/* 302 */       return LoadbalanceEndpointFactory.getInstance();
/*     */     } 
/*     */ 
/*     */     
/* 306 */     OMElement foElement = configElement.getFirstChildWithName(new QName(""http://ws.apache.org/ns/synapse"", ""failover""));
/*     */     
/* 308 */     if (foElement != null) {
/* 309 */       return FailoverEndpointFactory.getInstance();
/*     */     }
/*     */     
/* 312 */     handleException(""Invalid endpoint configuration."");
/*     */     
/* 314 */     return null;
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   protected ArrayList<Endpoint> getEndpoints(OMElement listEndpointElement, Endpoint parent) {
/* 326 */     ArrayList<Endpoint> endpoints = new ArrayList<Endpoint>();
/* 327 */     ArrayList<String> keys = new ArrayList<String>();
/* 328 */     Iterator<OMElement> iter = listEndpointElement.getChildrenWithName(XMLConfigConstants.ENDPOINT_ELT);
/* 329 */     while (iter.hasNext()) {
/* 330 */       OMElement endptElem = iter.next();
/* 331 */       Endpoint endpoint = getEndpointFromElement(endptElem, true);
/* 332 */       if (endpoint instanceof IndirectEndpoint) {
/* 333 */         String key = ((IndirectEndpoint)endpoint).getKey();
/* 334 */         if (!keys.contains(key)) {
/* 335 */           keys.add(key);
/*     */         } else {
/* 337 */           handleException(""Same endpoint definition cannot be used with in the siblings"");
/*     */         } 
/*     */       } 
/* 340 */       endpoint.setParentEndpoint(parent);
/* 341 */       endpoints.add(endpoint);
/*     */     } 
/*     */     
/* 344 */     return endpoints;
/*     */   }
/*     */   
/*     */   protected static void handleException(String msg) {
/* 348 */     log.error(msg);
/* 349 */     throw new SynapseException(msg);
/*     */   }
/*     */   
/*     */   protected static void handleException(String msg, Exception e) {
/* 353 */     log.error(msg, e);
/* 354 */     throw new SynapseException(msg, e);
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\endpoints\EndpointFactory.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.endpoints.EndpointSerializer,"/*     */ package org.apache.synapse.config.xml.endpoints;
/*     */ 
/*     */ import org.apache.axiom.om.OMElement;
/*     */ import org.apache.axiom.om.OMFactory;
/*     */ import org.apache.axiom.om.OMNode;
/*     */ import org.apache.commons.logging.Log;
/*     */ import org.apache.commons.logging.LogFactory;
/*     */ import org.apache.synapse.SynapseConstants;
/*     */ import org.apache.synapse.SynapseException;
/*     */ import org.apache.synapse.endpoints.Endpoint;
/*     */ import org.apache.synapse.endpoints.utils.EndpointDefinition;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public abstract class EndpointSerializer
/*     */ {
/*  40 */   private static Log log = LogFactory.getLog(EndpointSerializer.class);
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   protected OMFactory fac;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  52 */   public static OMElement getElementFromEndpoint(Endpoint endpoint) { return getEndpointSerializer(endpoint).serializeEndpoint(endpoint); }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   protected abstract OMElement serializeEndpoint(Endpoint paramEndpoint);
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   protected void serializeCommonEndpointProperties(EndpointDefinition endpointDefinition, OMElement element) {
/*  72 */     if (endpointDefinition.getStatisticsState() == 1) {
/*  73 */       element.addAttribute(this.fac.createOMAttribute(""statistics"", null, ""enable""));
/*     */     }
/*  75 */     else if (endpointDefinition.getStatisticsState() == 0) {
/*  76 */       element.addAttribute(this.fac.createOMAttribute(""statistics"", null, ""disable""));
/*     */     } 
/*     */ 
/*     */     
/*  80 */     if (endpointDefinition.getTraceState() == 1) {
/*  81 */       element.addAttribute(this.fac.createOMAttribute(""trace"", null, ""enable""));
/*     */     }
/*  83 */     else if (endpointDefinition.getStatisticsState() == 0) {
/*  84 */       element.addAttribute(this.fac.createOMAttribute(""trace"", null, ""disable""));
/*     */     } 
/*     */ 
/*     */     
/*  88 */     if (endpointDefinition.isUseSwa()) {
/*  89 */       element.addAttribute(this.fac.createOMAttribute(""optimize"", null, ""swa""));
/*  90 */     } else if (endpointDefinition.isUseMTOM()) {
/*  91 */       element.addAttribute(this.fac.createOMAttribute(""optimize"", null, ""mtom""));
/*     */     } 
/*     */     
/*  94 */     if (endpointDefinition.getCharSetEncoding() != null) {
/*  95 */       element.addAttribute(this.fac.createOMAttribute(""encoding"", null, endpointDefinition.getCharSetEncoding()));
/*     */     }
/*     */ 
/*     */     
/*  99 */     if (endpointDefinition.isAddressingOn()) {
/* 100 */       OMElement addressing = this.fac.createOMElement(""enableAddressing"", SynapseConstants.SYNAPSE_OMNAMESPACE);
/*     */ 
/*     */       
/* 103 */       if (endpointDefinition.getAddressingVersion() != null) {
/* 104 */         addressing.addAttribute(this.fac.createOMAttribute(""version"", null, endpointDefinition.getAddressingVersion()));
/*     */       }
/*     */ 
/*     */       
/* 108 */       if (endpointDefinition.isUseSeparateListener()) {
/* 109 */         addressing.addAttribute(this.fac.createOMAttribute(""separateListener"", null, ""true""));
/*     */       }
/* 111 */       element.addChild((OMNode)addressing);
/*     */     } 
/*     */     
/* 114 */     if (endpointDefinition.isReliableMessagingOn()) {
/* 115 */       OMElement rm = this.fac.createOMElement(""enableRM"", SynapseConstants.SYNAPSE_OMNAMESPACE);
/*     */       
/* 117 */       if (endpointDefinition.getWsRMPolicyKey() != null) {
/* 118 */         rm.addAttribute(this.fac.createOMAttribute(""policy"", null, endpointDefinition.getWsRMPolicyKey()));
/*     */       }
/*     */       
/* 121 */       element.addChild((OMNode)rm);
/*     */     } 
/*     */     
/* 124 */     if (endpointDefinition.isSecurityOn()) {
/* 125 */       OMElement sec = this.fac.createOMElement(""enableSec"", SynapseConstants.SYNAPSE_OMNAMESPACE);
/*     */       
/* 127 */       if (endpointDefinition.getWsSecPolicyKey() != null) {
/* 128 */         sec.addAttribute(this.fac.createOMAttribute(""policy"", null, endpointDefinition.getWsSecPolicyKey()));
/*     */       }
/*     */       
/* 131 */       element.addChild((OMNode)sec);
/*     */     } 
/*     */     
/* 134 */     if (endpointDefinition.getTimeoutAction() != 100) {
/*     */       
/* 136 */       OMElement timeout = this.fac.createOMElement(""timeout"", SynapseConstants.SYNAPSE_OMNAMESPACE);
/*     */       
/* 138 */       element.addChild((OMNode)timeout);
/*     */       
/* 140 */       OMElement duration = this.fac.createOMElement(""duration"", SynapseConstants.SYNAPSE_OMNAMESPACE);
/*     */       
/* 142 */       duration.setText(Long.toString(endpointDefinition.getTimeoutDuration() / 1000L));
/* 143 */       timeout.addChild((OMNode)duration);
/*     */       
/* 145 */       OMElement action = this.fac.createOMElement(""action"", SynapseConstants.SYNAPSE_OMNAMESPACE);
/* 146 */       if (endpointDefinition.getTimeoutAction() == 101) {
/* 147 */         action.setText(""discard"");
/* 148 */       } else if (endpointDefinition.getTimeoutAction() == 102) {
/*     */         
/* 150 */         action.setText(""fault"");
/*     */       } 
/* 152 */       timeout.addChild((OMNode)action);
/*     */     } 
/*     */     
/* 155 */     long suspendDuration = endpointDefinition.getSuspendOnFailDuration();
/* 156 */     if (suspendDuration != -1L) {
/*     */       
/* 158 */       OMElement suspendElement = this.fac.createOMElement(""suspendDurationOnFailure"", SynapseConstants.SYNAPSE_OMNAMESPACE);
/*     */ 
/*     */ 
/*     */       
/* 162 */       suspendElement.setText(Long.toString(suspendDuration / 1000L));
/* 163 */       element.addChild((OMNode)suspendElement);
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */   
/*     */   protected void serializeSpecificEndpointProperties(EndpointDefinition endpointDefinition, OMElement element) {}
/*     */ 
/*     */   
/*     */   protected void handleException(String message) {
/* 173 */     log.error(message);
/* 174 */     throw new SynapseException(message);
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public static EndpointSerializer getEndpointSerializer(Endpoint endpoint) {
/* 186 */     if (endpoint instanceof org.apache.synapse.endpoints.AddressEndpoint)
/* 187 */       return new AddressEndpointSerializer(); 
/* 188 */     if (endpoint instanceof org.apache.synapse.endpoints.WSDLEndpoint)
/* 189 */       return new WSDLEndpointSerializer(); 
/* 190 */     if (endpoint instanceof org.apache.synapse.endpoints.IndirectEndpoint)
/* 191 */       return new IndirectEndpointSerializer(); 
/* 192 */     if (endpoint instanceof org.apache.synapse.endpoints.LoadbalanceEndpoint)
/* 193 */       return new LoadbalanceEndpointSerializer(); 
/* 194 */     if (endpoint instanceof org.apache.synapse.endpoints.SALoadbalanceEndpoint)
/* 195 */       return new SALoadbalanceEndpointSerializer(); 
/* 196 */     if (endpoint instanceof org.apache.synapse.endpoints.FailoverEndpoint) {
/* 197 */       return new FailoverEndpointSerializer();
/*     */     }
/*     */     
/* 200 */     throw new SynapseException(""Serializer for endpoint "" + endpoint.getClass().toString() + "" is not defined."");
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\endpoints\EndpointSerializer.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.endpoints.FailoverEndpointFactory,"/*    */ package org.apache.synapse.config.xml.endpoints;
/*    */ 
/*    */ import javax.xml.namespace.QName;
/*    */ import org.apache.axiom.om.OMElement;
/*    */ import org.apache.synapse.endpoints.Endpoint;
/*    */ import org.apache.synapse.endpoints.FailoverEndpoint;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class FailoverEndpointFactory
/*    */   extends EndpointFactory
/*    */ {
/* 45 */   private static FailoverEndpointFactory instance = new FailoverEndpointFactory();
/*    */ 
/*    */ 
/*    */ 
/*    */   
/* 50 */   public static FailoverEndpointFactory getInstance() { return instance; }
/*    */ 
/*    */ 
/*    */   
/*    */   protected Endpoint createEndpoint(OMElement epConfig, boolean anonymousEndpoint) {
/* 55 */     OMElement failoverElement = epConfig.getFirstChildWithName(new QName(""http://ws.apache.org/ns/synapse"", ""failover""));
/*    */     
/* 57 */     if (failoverElement != null) {
/*    */       
/* 59 */       FailoverEndpoint failoverEndpoint = new FailoverEndpoint();
/*    */       
/* 61 */       String name = epConfig.getAttributeValue(new QName(""name""));
/* 62 */       if (name != null) {
/* 63 */         failoverEndpoint.setName(name);
/*    */       }
/*    */       
/* 66 */       failoverEndpoint.setEndpoints(getEndpoints(failoverElement, (Endpoint)failoverEndpoint));
/* 67 */       return (Endpoint)failoverEndpoint;
/*    */     } 
/* 69 */     return null;
/*    */   }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\endpoints\FailoverEndpointFactory.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.endpoints.FailoverEndpointSerializer,"/*    */ package org.apache.synapse.config.xml.endpoints;
/*    */ 
/*    */ import org.apache.axiom.om.OMAbstractFactory;
/*    */ import org.apache.axiom.om.OMElement;
/*    */ import org.apache.axiom.om.OMNode;
/*    */ import org.apache.synapse.SynapseConstants;
/*    */ import org.apache.synapse.SynapseException;
/*    */ import org.apache.synapse.endpoints.Endpoint;
/*    */ import org.apache.synapse.endpoints.FailoverEndpoint;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class FailoverEndpointSerializer
/*    */   extends EndpointSerializer
/*    */ {
/*    */   protected OMElement serializeEndpoint(Endpoint endpoint) {
/* 44 */     if (!(endpoint instanceof FailoverEndpoint)) {
/* 45 */       throw new SynapseException(""Invalid endpoint type."");
/*    */     }
/*    */     
/* 48 */     FailoverEndpoint failoverEndpoint = (FailoverEndpoint)endpoint;
/*    */     
/* 50 */     this.fac = OMAbstractFactory.getOMFactory();
/* 51 */     OMElement endpointElement = this.fac.createOMElement(""endpoint"", SynapseConstants.SYNAPSE_OMNAMESPACE);
/*    */     
/* 53 */     OMElement failoverElement = this.fac.createOMElement(""failover"", SynapseConstants.SYNAPSE_OMNAMESPACE);
/* 54 */     endpointElement.addChild((OMNode)failoverElement);
/*    */     
/* 56 */     String name = failoverEndpoint.getName();
/* 57 */     if (name != null) {
/* 58 */       endpointElement.addAttribute(""name"", name, null);
/*    */     }
/*    */     
/* 61 */     for (Endpoint childEndpoint : failoverEndpoint.getEndpoints()) {
/* 62 */       failoverElement.addChild((OMNode)EndpointSerializer.getElementFromEndpoint(childEndpoint));
/*    */     }
/*    */     
/* 65 */     return endpointElement;
/*    */   }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\endpoints\FailoverEndpointSerializer.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.endpoints.IndirectEndpointFactory,"/*    */ package org.apache.synapse.config.xml.endpoints;
/*    */ 
/*    */ import javax.xml.namespace.QName;
/*    */ import org.apache.axiom.om.OMElement;
/*    */ import org.apache.synapse.endpoints.Endpoint;
/*    */ import org.apache.synapse.endpoints.IndirectEndpoint;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class IndirectEndpointFactory
/*    */   extends EndpointFactory
/*    */ {
/* 41 */   private static IndirectEndpointFactory instance = new IndirectEndpointFactory();
/*    */ 
/*    */ 
/*    */ 
/*    */   
/* 46 */   public static IndirectEndpointFactory getInstance() { return instance; }
/*    */ 
/*    */ 
/*    */   
/*    */   protected Endpoint createEndpoint(OMElement epConfig, boolean anonymousEndpoint) {
/* 51 */     IndirectEndpoint indirectEndpoint = new IndirectEndpoint();
/* 52 */     String ref = epConfig.getAttributeValue(new QName(""key""));
/* 53 */     String name = epConfig.getAttributeValue(new QName(""name""));
/* 54 */     if (name != null) {
/* 55 */       indirectEndpoint.setName(name);
/*    */     }
/* 57 */     indirectEndpoint.setKey(ref);
/* 58 */     return (Endpoint)indirectEndpoint;
/*    */   }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\endpoints\IndirectEndpointFactory.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.endpoints.IndirectEndpointSerializer,"/*    */ package org.apache.synapse.config.xml.endpoints;
/*    */ 
/*    */ import org.apache.axiom.om.OMAbstractFactory;
/*    */ import org.apache.axiom.om.OMElement;
/*    */ import org.apache.synapse.SynapseConstants;
/*    */ import org.apache.synapse.SynapseException;
/*    */ import org.apache.synapse.endpoints.Endpoint;
/*    */ import org.apache.synapse.endpoints.IndirectEndpoint;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class IndirectEndpointSerializer
/*    */   extends EndpointSerializer
/*    */ {
/*    */   protected OMElement serializeEndpoint(Endpoint endpoint) {
/* 39 */     if (!(endpoint instanceof IndirectEndpoint)) {
/* 40 */       throw new SynapseException(""Invalid endpoint type."");
/*    */     }
/*    */     
/* 43 */     this.fac = OMAbstractFactory.getOMFactory();
/* 44 */     OMElement endpointElement = this.fac.createOMElement(""endpoint"", SynapseConstants.SYNAPSE_OMNAMESPACE);
/*    */     
/* 46 */     IndirectEndpoint indirectEndpoint = (IndirectEndpoint)endpoint;
/* 47 */     String ref = indirectEndpoint.getKey();
/* 48 */     if (ref != null) {
/* 49 */       endpointElement.addAttribute(""key"", ref, null);
/*    */     }
/*    */     
/* 52 */     return endpointElement;
/*    */   }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\endpoints\IndirectEndpointSerializer.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.endpoints.LoadbalanceEndpointFactory,"/*    */ package org.apache.synapse.config.xml.endpoints;
/*    */ 
/*    */ import java.util.ArrayList;
/*    */ import javax.xml.namespace.QName;
/*    */ import org.apache.axiom.om.OMAttribute;
/*    */ import org.apache.axiom.om.OMElement;
/*    */ import org.apache.synapse.config.xml.endpoints.utils.LoadbalanceAlgorithmFactory;
/*    */ import org.apache.synapse.endpoints.Endpoint;
/*    */ import org.apache.synapse.endpoints.LoadbalanceEndpoint;
/*    */ import org.apache.synapse.endpoints.algorithms.LoadbalanceAlgorithm;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class LoadbalanceEndpointFactory
/*    */   extends EndpointFactory
/*    */ {
/* 46 */   private static LoadbalanceEndpointFactory instance = new LoadbalanceEndpointFactory();
/*    */ 
/*    */ 
/*    */ 
/*    */   
/* 51 */   public static LoadbalanceEndpointFactory getInstance() { return instance; }
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */   
/*    */   protected Endpoint createEndpoint(OMElement epConfig, boolean anonymousEndpoint) {
/* 58 */     OMElement loadbalanceElement = epConfig.getFirstChildWithName(new QName(""http://ws.apache.org/ns/synapse"", ""loadbalance""));
/*    */ 
/*    */     
/* 61 */     if (loadbalanceElement != null) {
/*    */       
/* 63 */       LoadbalanceEndpoint loadbalanceEndpoint = new LoadbalanceEndpoint();
/*    */ 
/*    */       
/* 66 */       OMAttribute name = epConfig.getAttribute(new QName("""", ""name""));
/*    */ 
/*    */       
/* 69 */       if (name != null) {
/* 70 */         loadbalanceEndpoint.setName(name.getAttributeValue());
/*    */       }
/*    */ 
/*    */       
/* 74 */       ArrayList<Endpoint> endpoints = getEndpoints(loadbalanceElement, (Endpoint)loadbalanceEndpoint);
/* 75 */       loadbalanceEndpoint.setEndpoints(endpoints);
/*    */ 
/*    */       
/* 78 */       LoadbalanceAlgorithm algorithm = LoadbalanceAlgorithmFactory.createLoadbalanceAlgorithm(loadbalanceElement, endpoints);
/*    */       
/* 80 */       loadbalanceEndpoint.setAlgorithm(algorithm);
/*    */ 
/*    */       
/* 83 */       String failover = loadbalanceElement.getAttributeValue(new QName(""failover""));
/* 84 */       if (failover != null && failover.equalsIgnoreCase(""false"")) {
/* 85 */         loadbalanceEndpoint.setFailover(false);
/*    */       }
/*    */       
/* 88 */       return (Endpoint)loadbalanceEndpoint;
/*    */     } 
/*    */     
/* 91 */     return null;
/*    */   }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\endpoints\LoadbalanceEndpointFactory.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.endpoints.LoadbalanceEndpointSerializer,"/*    */ package org.apache.synapse.config.xml.endpoints;
/*    */ 
/*    */ import org.apache.axiom.om.OMAbstractFactory;
/*    */ import org.apache.axiom.om.OMElement;
/*    */ import org.apache.axiom.om.OMNode;
/*    */ import org.apache.synapse.SynapseConstants;
/*    */ import org.apache.synapse.SynapseException;
/*    */ import org.apache.synapse.endpoints.Endpoint;
/*    */ import org.apache.synapse.endpoints.LoadbalanceEndpoint;
/*    */ import org.apache.synapse.endpoints.algorithms.LoadbalanceAlgorithm;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class LoadbalanceEndpointSerializer
/*    */   extends EndpointSerializer
/*    */ {
/*    */   protected OMElement serializeEndpoint(Endpoint endpoint) {
/* 47 */     if (!(endpoint instanceof LoadbalanceEndpoint)) {
/* 48 */       throw new SynapseException(""Invalid endpoint type."");
/*    */     }
/*    */     
/* 51 */     this.fac = OMAbstractFactory.getOMFactory();
/* 52 */     OMElement endpointElement = this.fac.createOMElement(""endpoint"", SynapseConstants.SYNAPSE_OMNAMESPACE);
/*    */ 
/*    */     
/* 55 */     LoadbalanceEndpoint loadbalanceEndpoint = (LoadbalanceEndpoint)endpoint;
/*    */     
/* 57 */     String name = loadbalanceEndpoint.getName();
/* 58 */     if (name != null) {
/* 59 */       endpointElement.addAttribute(""name"", name, null);
/*    */     }
/*    */     
/* 62 */     OMElement loadbalanceElement = this.fac.createOMElement(""loadbalance"", SynapseConstants.SYNAPSE_OMNAMESPACE);
/*    */     
/* 64 */     endpointElement.addChild((OMNode)loadbalanceElement);
/*    */     
/* 66 */     LoadbalanceAlgorithm algorithm = loadbalanceEndpoint.getAlgorithm();
/* 67 */     String algorithmName = ""roundRobin"";
/* 68 */     if (algorithm instanceof org.apache.synapse.endpoints.algorithms.RoundRobin) {
/* 69 */       algorithmName = ""roundRobin"";
/*    */     }
/* 71 */     loadbalanceElement.addAttribute(""policy"", algorithmName, null);
/*    */ 
/*    */     
/* 74 */     if (!loadbalanceEndpoint.isFailover()) {
/* 75 */       loadbalanceElement.addAttribute(""failover"", ""false"", null);
/*    */     }
/*    */     
/* 78 */     for (Endpoint childEndpoint : loadbalanceEndpoint.getEndpoints()) {
/* 79 */       loadbalanceElement.addChild((OMNode)EndpointSerializer.getElementFromEndpoint(childEndpoint));
/*    */     }
/*    */     
/* 82 */     return endpointElement;
/*    */   }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\endpoints\LoadbalanceEndpointSerializer.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.endpoints.SALoadbalanceEndpointFactory,"/*     */ package org.apache.synapse.config.xml.endpoints;
/*     */ 
/*     */ import java.util.ArrayList;
/*     */ import javax.xml.namespace.QName;
/*     */ import org.apache.axiom.om.OMAttribute;
/*     */ import org.apache.axiom.om.OMElement;
/*     */ import org.apache.synapse.config.xml.endpoints.utils.LoadbalanceAlgorithmFactory;
/*     */ import org.apache.synapse.endpoints.Endpoint;
/*     */ import org.apache.synapse.endpoints.SALoadbalanceEndpoint;
/*     */ import org.apache.synapse.endpoints.algorithms.LoadbalanceAlgorithm;
/*     */ import org.apache.synapse.endpoints.dispatch.Dispatcher;
/*     */ import org.apache.synapse.endpoints.dispatch.HttpSessionDispatcher;
/*     */ import org.apache.synapse.endpoints.dispatch.SimpleClientSessionDispatcher;
/*     */ import org.apache.synapse.endpoints.dispatch.SoapSessionDispatcher;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class SALoadbalanceEndpointFactory
/*     */   extends EndpointFactory
/*     */ {
/*  51 */   private static SALoadbalanceEndpointFactory instance = new SALoadbalanceEndpointFactory();
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  56 */   public static SALoadbalanceEndpointFactory getInstance() { return instance; }
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   protected Endpoint createEndpoint(OMElement epConfig, boolean anonymousEndpoint) {
/*  62 */     SALoadbalanceEndpoint loadbalanceEndpoint = new SALoadbalanceEndpoint();
/*     */ 
/*     */     
/*  65 */     OMElement sessionElement = epConfig.getFirstChildWithName(new QName(""http://ws.apache.org/ns/synapse"", ""session""));
/*     */     
/*  67 */     if (sessionElement != null) {
/*     */       
/*  69 */       String type = sessionElement.getAttributeValue(new QName(""type""));
/*     */       
/*  71 */       if (type.equalsIgnoreCase(""soap"")) {
/*  72 */         SoapSessionDispatcher soapSessionDispatcher = new SoapSessionDispatcher();
/*  73 */         loadbalanceEndpoint.setDispatcher((Dispatcher)soapSessionDispatcher);
/*     */       }
/*  75 */       else if (type.equalsIgnoreCase(""http"")) {
/*  76 */         HttpSessionDispatcher httpSessionDispatcher = new HttpSessionDispatcher();
/*  77 */         loadbalanceEndpoint.setDispatcher((Dispatcher)httpSessionDispatcher);
/*     */       }
/*  79 */       else if (type.equalsIgnoreCase(""simpleClientSession"")) {
/*  80 */         SimpleClientSessionDispatcher simpleClientSessionDispatcher = new SimpleClientSessionDispatcher();
/*  81 */         loadbalanceEndpoint.setDispatcher((Dispatcher)simpleClientSessionDispatcher);
/*     */       } 
/*     */     } else {
/*  84 */       handleException(""Session affinity endpoints should have a session element in the configuration."");
/*     */     } 
/*     */ 
/*     */ 
/*     */     
/*  89 */     OMAttribute name = epConfig.getAttribute(new QName("""", ""name""));
/*     */ 
/*     */     
/*  92 */     if (name != null) {
/*  93 */       loadbalanceEndpoint.setName(name.getAttributeValue());
/*     */     }
/*     */ 
/*     */     
/*  97 */     OMElement loadbalanceElement = epConfig.getFirstChildWithName(new QName(""http://ws.apache.org/ns/synapse"", ""loadbalance""));
/*     */ 
/*     */     
/* 100 */     if (loadbalanceElement != null) {
/*     */ 
/*     */       
/* 103 */       ArrayList<Endpoint> endpoints = getEndpoints(loadbalanceElement, (Endpoint)loadbalanceEndpoint);
/* 104 */       loadbalanceEndpoint.setEndpoints(endpoints);
/*     */ 
/*     */       
/* 107 */       LoadbalanceAlgorithm algorithm = LoadbalanceAlgorithmFactory.createLoadbalanceAlgorithm(loadbalanceElement, endpoints);
/*     */       
/* 109 */       loadbalanceEndpoint.setAlgorithm(algorithm);
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */       
/* 139 */       return (Endpoint)loadbalanceEndpoint;
/*     */     } 
/*     */     
/* 142 */     return null;
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\endpoints\SALoadbalanceEndpointFactory.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.endpoints.SALoadbalanceEndpointSerializer,"/*    */ package org.apache.synapse.config.xml.endpoints;
/*    */ 
/*    */ import org.apache.axiom.om.OMAbstractFactory;
/*    */ import org.apache.axiom.om.OMElement;
/*    */ import org.apache.axiom.om.OMNode;
/*    */ import org.apache.synapse.SynapseConstants;
/*    */ import org.apache.synapse.endpoints.Endpoint;
/*    */ import org.apache.synapse.endpoints.SALoadbalanceEndpoint;
/*    */ import org.apache.synapse.endpoints.algorithms.LoadbalanceAlgorithm;
/*    */ import org.apache.synapse.endpoints.dispatch.Dispatcher;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class SALoadbalanceEndpointSerializer
/*    */   extends EndpointSerializer
/*    */ {
/*    */   protected OMElement serializeEndpoint(Endpoint endpoint) {
/* 38 */     if (!(endpoint instanceof SALoadbalanceEndpoint)) {
/* 39 */       handleException(""Invalid endpoint type for serializing. Expected: SALoadbalanceEndpoint Found: "" + endpoint.getClass().getName());
/*    */     }
/*    */ 
/*    */     
/* 43 */     SALoadbalanceEndpoint loadbalanceEndpoint = (SALoadbalanceEndpoint)endpoint;
/*    */     
/* 45 */     this.fac = OMAbstractFactory.getOMFactory();
/* 46 */     OMElement endpointElement = this.fac.createOMElement(""endpoint"", SynapseConstants.SYNAPSE_OMNAMESPACE);
/*    */     
/* 48 */     String name = loadbalanceEndpoint.getName();
/* 49 */     if (name != null) {
/* 50 */       endpointElement.addAttribute(""name"", name, null);
/*    */     }
/*    */     
/* 53 */     Dispatcher dispatcher = loadbalanceEndpoint.getDispatcher();
/*    */     
/* 55 */     if (dispatcher instanceof org.apache.synapse.endpoints.dispatch.SoapSessionDispatcher) {
/* 56 */       OMElement sessionElement = this.fac.createOMElement(""session"", SynapseConstants.SYNAPSE_OMNAMESPACE);
/* 57 */       sessionElement.addAttribute(""type"", ""soap"", null);
/* 58 */       endpointElement.addChild((OMNode)sessionElement);
/*    */     }
/* 60 */     else if (dispatcher instanceof org.apache.synapse.endpoints.dispatch.HttpSessionDispatcher) {
/* 61 */       OMElement sessionElement = this.fac.createOMElement(""session"", SynapseConstants.SYNAPSE_OMNAMESPACE);
/* 62 */       sessionElement.addAttribute(""type"", ""http"", null);
/* 63 */       endpointElement.addChild((OMNode)sessionElement);
/*    */     }
/* 65 */     else if (dispatcher instanceof org.apache.synapse.endpoints.dispatch.SimpleClientSessionDispatcher) {
/* 66 */       OMElement sessionElement = this.fac.createOMElement(""session"", SynapseConstants.SYNAPSE_OMNAMESPACE);
/* 67 */       sessionElement.addAttribute(""type"", ""simpleClientSession"", null);
/* 68 */       endpointElement.addChild((OMNode)sessionElement);
/*    */     } 
/*    */     
/* 71 */     OMElement loadbalanceElement = this.fac.createOMElement(""loadbalance"", SynapseConstants.SYNAPSE_OMNAMESPACE);
/* 72 */     endpointElement.addChild((OMNode)loadbalanceElement);
/*    */     
/* 74 */     LoadbalanceAlgorithm algorithm = loadbalanceEndpoint.getAlgorithm();
/* 75 */     String algorithmName = ""roundRobin"";
/* 76 */     if (algorithm instanceof org.apache.synapse.endpoints.algorithms.RoundRobin) {
/* 77 */       algorithmName = ""roundRobin"";
/*    */     }
/* 79 */     loadbalanceElement.addAttribute(""algorithm"", algorithmName, null);
/*    */     
/* 81 */     for (Endpoint childEndpoint : loadbalanceEndpoint.getEndpoints()) {
/* 82 */       loadbalanceElement.addChild((OMNode)EndpointSerializer.getElementFromEndpoint(childEndpoint));
/*    */     }
/*    */     
/* 85 */     return endpointElement;
/*    */   }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\endpoints\SALoadbalanceEndpointSerializer.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.endpoints.WSDLEndpointFactory,"/*     */ package org.apache.synapse.config.xml.endpoints;
/*     */ 
/*     */ import java.io.File;
/*     */ import java.net.URL;
/*     */ import javax.xml.namespace.QName;
/*     */ import org.apache.axiom.om.OMAttribute;
/*     */ import org.apache.axiom.om.OMElement;
/*     */ import org.apache.axiom.om.OMNamespace;
/*     */ import org.apache.axiom.om.OMNode;
/*     */ import org.apache.synapse.ServerManager;
/*     */ import org.apache.synapse.config.SynapseConfigUtils;
/*     */ import org.apache.synapse.config.xml.endpoints.utils.WSDL11EndpointBuilder;
/*     */ import org.apache.synapse.endpoints.Endpoint;
/*     */ import org.apache.synapse.endpoints.WSDLEndpoint;
/*     */ import org.apache.synapse.endpoints.utils.EndpointDefinition;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class WSDLEndpointFactory
/*     */   extends EndpointFactory
/*     */ {
/*  71 */   private static WSDLEndpointFactory instance = new WSDLEndpointFactory();
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  77 */   public static WSDLEndpointFactory getInstance() { return instance; }
/*     */ 
/*     */ 
/*     */   
/*     */   protected Endpoint createEndpoint(OMElement epConfig, boolean anonymousEndpoint) {
/*  82 */     WSDLEndpoint wsdlEndpoint = new WSDLEndpoint();
/*  83 */     OMAttribute name = epConfig.getAttribute(new QName("""", ""name""));
/*     */ 
/*     */     
/*  86 */     if (name != null) {
/*  87 */       wsdlEndpoint.setName(name.getAttributeValue());
/*     */     }
/*     */     
/*  90 */     OMElement wsdlElement = epConfig.getFirstChildWithName(new QName(""http://ws.apache.org/ns/synapse"", ""wsdl""));
/*     */     
/*  92 */     if (wsdlElement != null) {
/*     */       
/*  94 */       EndpointDefinition endpoint = null;
/*     */ 
/*     */ 
/*     */       
/*  98 */       String serviceName = wsdlElement.getAttributeValue(new QName(""service""));
/*  99 */       String portName = wsdlElement.getAttributeValue(new QName(""port""));
/*     */       
/* 101 */       String wsdlURI = wsdlElement.getAttributeValue(new QName(""uri""));
/*     */ 
/*     */ 
/*     */       
/* 105 */       wsdlEndpoint.setServiceName(serviceName);
/* 106 */       wsdlEndpoint.setPortName(portName);
/*     */       
/* 108 */       if (wsdlURI != null) {
/*     */         
/* 110 */         wsdlEndpoint.setWsdlURI(wsdlURI.trim());
/*     */         try {
/* 112 */           OMNode wsdlOM = SynapseConfigUtils.getOMElementFromURL((new URL(wsdlURI)).toString());
/*     */           
/* 114 */           if (wsdlOM != null && wsdlOM instanceof OMElement) {
/* 115 */             OMElement omElement = (OMElement)wsdlOM;
/* 116 */             OMNamespace ns = omElement.getNamespace();
/* 117 */             if (ns != null) {
/* 118 */               String nsUri = omElement.getNamespace().getNamespaceURI();
/* 119 */               if (""http://schemas.xmlsoap.org/wsdl/"".equals(nsUri)) {
/*     */                 
/* 121 */                 endpoint = (new WSDL11EndpointBuilder()).createEndpointDefinitionFromWSDL(wsdlURI.trim(), omElement, serviceName, portName);
/*     */ 
/*     */               
/*     */               }
/* 125 */               else if (""http://www.w3.org/ns/wsdl"".equals(nsUri)) {
/*     */ 
/*     */ 
/*     */                 
/* 129 */                 handleException(""WSDL 2.0 Endpoints are currently not supported"");
/*     */               } 
/*     */             } 
/*     */           } 
/* 133 */         } catch (Exception e) {
/* 134 */           handleException(""Couldn't create endpoint from the given WSDL URI : "" + e.getMessage(), e);
/*     */         } 
/*     */       } 
/*     */ 
/*     */ 
/*     */       
/* 140 */       OMElement definitionElement = wsdlElement.getFirstChildWithName(new QName(""http://schemas.xmlsoap.org/wsdl/"", ""definitions""));
/*     */       
/* 142 */       if (endpoint == null && definitionElement != null) {
/* 143 */         wsdlEndpoint.setWsdlDoc(definitionElement);
/* 144 */         String resolveRoot = ServerManager.getInstance().getResolveRoot();
/* 145 */         String baseUri = ""file:./"";
/* 146 */         if (resolveRoot != null) {
/* 147 */           baseUri = resolveRoot.trim();
/*     */         }
/* 149 */         if (!baseUri.endsWith(File.separator)) {
/* 150 */           baseUri = baseUri + File.separator;
/*     */         }
/* 152 */         endpoint = (new WSDL11EndpointBuilder()).createEndpointDefinitionFromWSDL(baseUri, definitionElement, serviceName, portName);
/*     */       } 
/*     */ 
/*     */ 
/*     */       
/* 157 */       OMElement descriptionElement = wsdlElement.getFirstChildWithName(new QName(""http://schemas.xmlsoap.org/wsdl/"", ""description""));
/*     */       
/* 159 */       if (endpoint == null && descriptionElement != null) {
/* 160 */         wsdlEndpoint.setWsdlDoc(descriptionElement);
/* 161 */         handleException(""WSDL 2.0 Endpoints are currently not supported."");
/*     */       } 
/*     */       
/* 164 */       if (endpoint != null) {
/*     */         
/* 166 */         extractCommonEndpointProperties(endpoint, wsdlElement);
/* 167 */         extractSpecificEndpointProperties(endpoint, wsdlElement);
/* 168 */         wsdlEndpoint.setEndpoint(endpoint);
/*     */       } else {
/* 170 */         handleException(""WSDL is not specified for WSDL endpoint."");
/*     */       } 
/*     */     } 
/*     */     
/* 174 */     return (Endpoint)wsdlEndpoint;
/*     */   }
/*     */   
/*     */   protected void extractSpecificEndpointProperties(EndpointDefinition definition, OMElement elem) {}
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\endpoints\WSDLEndpointFactory.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.endpoints.WSDLEndpointSerializer,"/*    */ package org.apache.synapse.config.xml.endpoints;
/*    */ 
/*    */ import org.apache.axiom.om.OMAbstractFactory;
/*    */ import org.apache.axiom.om.OMElement;
/*    */ import org.apache.axiom.om.OMNode;
/*    */ import org.apache.synapse.SynapseConstants;
/*    */ import org.apache.synapse.SynapseException;
/*    */ import org.apache.synapse.endpoints.Endpoint;
/*    */ import org.apache.synapse.endpoints.WSDLEndpoint;
/*    */ import org.apache.synapse.endpoints.utils.EndpointDefinition;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class WSDLEndpointSerializer
/*    */   extends EndpointSerializer
/*    */ {
/*    */   protected OMElement serializeEndpoint(Endpoint endpoint) {
/* 39 */     if (!(endpoint instanceof WSDLEndpoint)) {
/* 40 */       throw new SynapseException(""Invalid endpoint type."");
/*    */     }
/*    */     
/* 43 */     this.fac = OMAbstractFactory.getOMFactory();
/* 44 */     OMElement endpointElement = this.fac.createOMElement(""endpoint"", SynapseConstants.SYNAPSE_OMNAMESPACE);
/*    */ 
/*    */     
/* 47 */     WSDLEndpoint wsdlEndpoint = (WSDLEndpoint)endpoint;
/* 48 */     String name = wsdlEndpoint.getName();
/* 49 */     if (name != null) {
/* 50 */       endpointElement.addAttribute(""name"", name, null);
/*    */     }
/*    */     
/* 53 */     OMElement wsdlElement = this.fac.createOMElement(""wsdl"", SynapseConstants.SYNAPSE_OMNAMESPACE);
/* 54 */     String serviceName = wsdlEndpoint.getServiceName();
/* 55 */     if (serviceName != null) {
/* 56 */       wsdlElement.addAttribute(""service"", serviceName, null);
/*    */     }
/*    */     
/* 59 */     String portName = wsdlEndpoint.getPortName();
/* 60 */     if (portName != null) {
/* 61 */       wsdlElement.addAttribute(""port"", portName, null);
/*    */     }
/*    */     
/* 64 */     String uri = wsdlEndpoint.getWsdlURI();
/* 65 */     if (uri != null) {
/* 66 */       wsdlElement.addAttribute(""uri"", uri, null);
/*    */     }
/*    */     
/* 69 */     OMElement wsdlDoc = wsdlEndpoint.getWsdlDoc();
/* 70 */     if (wsdlDoc != null) {
/* 71 */       wsdlElement.addChild((OMNode)wsdlDoc);
/*    */     }
/*    */ 
/*    */ 
/*    */ 
/*    */     
/* 77 */     EndpointDefinition epDefinition = wsdlEndpoint.getEndpoint();
/* 78 */     serializeCommonEndpointProperties(epDefinition, wsdlElement);
/* 79 */     serializeSpecificEndpointProperties(epDefinition, wsdlElement);
/* 80 */     endpointElement.addChild((OMNode)wsdlElement);
/*    */     
/* 82 */     return endpointElement;
/*    */   }
/*    */   
/*    */   protected void serializeSpecificEndpointProperties(EndpointDefinition endpointDefinition, OMElement element) {}
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\endpoints\WSDLEndpointSerializer.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.endpoints.XMLToEndpointMapper,"/*    */ package org.apache.synapse.config.xml.endpoints;
/*    */ 
/*    */ import org.apache.axiom.om.OMElement;
/*    */ import org.apache.axiom.om.OMNode;
/*    */ import org.apache.synapse.SynapseException;
/*    */ import org.apache.synapse.config.XMLToObjectMapper;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class XMLToEndpointMapper
/*    */   implements XMLToObjectMapper
/*    */ {
/* 34 */   private static XMLToEndpointMapper instance = new XMLToEndpointMapper();
/*    */ 
/*    */ 
/*    */ 
/*    */   
/* 39 */   public static XMLToEndpointMapper getInstance() { return instance; }
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */   
/*    */   public Object getObjectFromOMNode(OMNode om) {
/* 49 */     if (om instanceof OMElement) {
/* 50 */       OMElement epElement = (OMElement)om;
/* 51 */       return EndpointFactory.getEndpointFromElement(epElement, false);
/*    */     } 
/* 53 */     throw new SynapseException(""Configuration is not in proper format."");
/*    */   }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\endpoints\XMLToEndpointMapper.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.endpoints.utils.LoadbalanceAlgorithmFactory,"/*    */ package org.apache.synapse.config.xml.endpoints.utils;
/*    */ 
/*    */ import java.util.ArrayList;
/*    */ import javax.xml.namespace.QName;
/*    */ import org.apache.axiom.om.OMAttribute;
/*    */ import org.apache.axiom.om.OMElement;
/*    */ import org.apache.synapse.endpoints.algorithms.LoadbalanceAlgorithm;
/*    */ import org.apache.synapse.endpoints.algorithms.RoundRobin;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class LoadbalanceAlgorithmFactory
/*    */ {
/*    */   public static LoadbalanceAlgorithm createLoadbalanceAlgorithm(OMElement loadbalanceElement, ArrayList endpoints) {
/* 39 */     Object object = null;
/*    */     
/* 41 */     String algorithmName = ""roundRobin"";
/* 42 */     OMAttribute algoAttribute = loadbalanceElement.getAttribute(new QName(null, ""policy""));
/* 43 */     if (algoAttribute != null) {
/* 44 */       algorithmName = algoAttribute.getAttributeValue();
/*    */     }
/*    */     
/* 47 */     if (algorithmName.equalsIgnoreCase(""roundRobin"")) {
/* 48 */       object = new RoundRobin(endpoints);
/*    */     }
/*    */     
/* 51 */     return (LoadbalanceAlgorithm)object;
/*    */   }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\endpoint\\utils\LoadbalanceAlgorithmFactory.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.endpoints.utils.WSDL11EndpointBuilder,"/*     */ package org.apache.synapse.config.xml.endpoints.utils;
/*     */ 
/*     */ import java.io.ByteArrayInputStream;
/*     */ import java.io.ByteArrayOutputStream;
/*     */ import java.io.IOException;
/*     */ import java.io.InputStream;
/*     */ import java.util.List;
/*     */ import javax.wsdl.Definition;
/*     */ import javax.wsdl.Port;
/*     */ import javax.wsdl.Service;
/*     */ import javax.wsdl.WSDLException;
/*     */ import javax.wsdl.extensions.soap.SOAPAddress;
/*     */ import javax.wsdl.extensions.soap12.SOAP12Address;
/*     */ import javax.wsdl.factory.WSDLFactory;
/*     */ import javax.wsdl.xml.WSDLLocator;
/*     */ import javax.wsdl.xml.WSDLReader;
/*     */ import javax.xml.namespace.QName;
/*     */ import javax.xml.parsers.ParserConfigurationException;
/*     */ import javax.xml.stream.XMLStreamException;
/*     */ import org.apache.axiom.om.OMElement;
/*     */ import org.apache.axis2.util.XMLUtils;
/*     */ import org.apache.commons.logging.Log;
/*     */ import org.apache.commons.logging.LogFactory;
/*     */ import org.apache.synapse.SynapseException;
/*     */ import org.apache.synapse.core.axis2.CustomWSDLLocator;
/*     */ import org.apache.synapse.endpoints.utils.EndpointDefinition;
/*     */ import org.w3c.dom.Document;
/*     */ import org.xml.sax.InputSource;
/*     */ import org.xml.sax.SAXException;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class WSDL11EndpointBuilder
/*     */ {
/*  57 */   private static Log log = LogFactory.getLog(WSDL11EndpointBuilder.class);
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public EndpointDefinition createEndpointDefinitionFromWSDL(String baseUri, OMElement wsdl, String service, String port) {
/*  73 */     ByteArrayOutputStream baos = new ByteArrayOutputStream();
/*     */     try {
/*  75 */       wsdl.serialize(baos);
/*  76 */       InputStream in = new ByteArrayInputStream(baos.toByteArray());
/*  77 */       InputSource inputSource = new InputSource(in);
/*  78 */       CustomWSDLLocator customWSDLLocator = new CustomWSDLLocator(inputSource, baseUri);
/*  79 */       Document doc = null;
/*     */       try {
/*  81 */         doc = XMLUtils.newDocument(inputSource);
/*  82 */       } catch (ParserConfigurationException e) {
/*  83 */         handleException(""Parser Configuration Error"", e);
/*  84 */       } catch (SAXException e) {
/*  85 */         handleException(""Parser SAX Error"", e);
/*  86 */       } catch (IOException e) {
/*  87 */         handleException(""INVALID_WSDLIO Error"", e);
/*     */       } 
/*  89 */       if (doc != null) {
/*  90 */         WSDLFactory fac = WSDLFactory.newInstance();
/*  91 */         WSDLReader reader = fac.newWSDLReader();
/*  92 */         Definition definition = reader.readWSDL((WSDLLocator)customWSDLLocator, doc.getDocumentElement());
/*  93 */         return createEndpointDefinitionFromWSDL(definition, service, port);
/*     */       } 
/*  95 */     } catch (XMLStreamException e) {
/*  96 */       handleException(""Error retrieving the WSDL definition from the inline WSDL."");
/*  97 */     } catch (WSDLException e) {
/*  98 */       handleException(""Error retrieving the WSDL definition from the inline WSDL."");
/*     */     } 
/*     */     
/* 101 */     return null;
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   private EndpointDefinition createEndpointDefinitionFromWSDL(String wsdlURI, String service, String port) {
/*     */     try {
/* 117 */       WSDLFactory fac = WSDLFactory.newInstance();
/* 118 */       WSDLReader reader = fac.newWSDLReader();
/* 119 */       Definition definition = reader.readWSDL(wsdlURI);
/*     */       
/* 121 */       return createEndpointDefinitionFromWSDL(definition, service, port);
/*     */     }
/* 123 */     catch (WSDLException e) {
/* 124 */       handleException(""Error retrieving the WSDL definition from the WSDL URI."");
/*     */ 
/*     */       
/* 127 */       return null;
/*     */     } 
/*     */   }
/*     */ 
/*     */   
/*     */   private EndpointDefinition createEndpointDefinitionFromWSDL(Definition definition, String serviceName, String portName) {
/* 133 */     if (definition == null) {
/* 134 */       handleException(""WSDL is not specified."");
/*     */     }
/*     */     
/* 137 */     if (serviceName == null) {
/* 138 */       handleException(""Service of the WSDL document is not specified."");
/*     */     }
/*     */     
/* 141 */     if (portName == null) {
/* 142 */       handleException(""Port of the WSDL document is not specified."");
/*     */     }
/*     */ 
/*     */     
/* 146 */     String serviceURL = null;
/*     */ 
/*     */     
/* 149 */     String format = null;
/* 150 */     String tns = definition.getTargetNamespace();
/* 151 */     Service service = definition.getService(new QName(tns, serviceName));
/* 152 */     if (service != null) {
/* 153 */       Port port = service.getPort(portName);
/* 154 */       if (port != null) {
/* 155 */         List ext = port.getExtensibilityElements();
/* 156 */         for (int i = 0; i < ext.size(); i++) {
/* 157 */           Object o = ext.get(i);
/* 158 */           if (o instanceof SOAPAddress) {
/* 159 */             SOAPAddress address = (SOAPAddress)o;
/* 160 */             serviceURL = address.getLocationURI();
/* 161 */             format = ""soap11""; break;
/*     */           } 
/* 163 */           if (o instanceof SOAP12Address) {
/* 164 */             SOAP12Address address = (SOAP12Address)o;
/* 165 */             serviceURL = address.getLocationURI();
/* 166 */             format = ""soap12"";
/*     */             
/*     */             break;
/*     */           } 
/*     */         } 
/*     */       } 
/*     */     } 
/* 173 */     if (serviceURL != null) {
/* 174 */       EndpointDefinition endpointDefinition = new EndpointDefinition();
/* 175 */       endpointDefinition.setAddress(serviceURL);
/* 176 */       if (""soap11"".equals(format)) {
/* 177 */         endpointDefinition.setForceSOAP11(true);
/* 178 */       } else if (""soap12"".equals(format)) {
/* 179 */         endpointDefinition.setForceSOAP12(true);
/*     */       } else {
/* 181 */         handleException(""format value -\"""" + format + ""\"" not yet implemented"");
/*     */       } 
/* 183 */       endpointDefinition.setFormat(format);
/*     */ 
/*     */ 
/*     */       
/* 187 */       return endpointDefinition;
/*     */     } 
/*     */     
/* 190 */     handleException(""Couldn't retrieve endpoint information from the WSDL."");
/*     */ 
/*     */     
/* 193 */     return null;
/*     */   }
/*     */   
/*     */   private static void handleException(String msg) {
/* 197 */     log.error(msg);
/* 198 */     throw new SynapseException(msg);
/*     */   }
/*     */   
/*     */   private static void handleException(String msg, Exception e) {
/* 202 */     log.error(msg, e);
/* 203 */     throw new SynapseException(msg, e);
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\endpoint\\utils\WSDL11EndpointBuilder.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.config.xml.endpoints.utils.WSDL20EndpointBuilder,"package org.apache.synapse.config.xml.endpoints.utils;
public class WSDL20EndpointBuilder {}
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\config\xml\endpoint\\utils\WSDL20EndpointBuilder.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.core.SynapseEnvironment,"package org.apache.synapse.core;
import java.util.concurrent.ExecutorService;
import org.apache.synapse.MessageContext;
import org.apache.synapse.endpoints.utils.EndpointDefinition;
import org.apache.synapse.mediators.base.SequenceMediator;
import org.apache.synapse.statistics.StatisticsCollector;
import org.apache.synapse.util.TemporaryData;
public interface SynapseEnvironment {
  boolean injectMessage(MessageContext paramMessageContext);
  void injectAsync(MessageContext paramMessageContext, SequenceMediator paramSequenceMediator);
  void send(EndpointDefinition paramEndpointDefinition, MessageContext paramMessageContext);
  MessageContext createMessageContext();
  TemporaryData createTemporaryData();
  StatisticsCollector getStatisticsCollector();
  void setStatisticsCollector(StatisticsCollector paramStatisticsCollector);
  ExecutorService getExecutorService();
  boolean isInitialized();
  void setInitialized(boolean paramBoolean);
}
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\core\SynapseEnvironment.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.core.axis2.AnonymousServiceFactory,"/*     */ package org.apache.synapse.core.axis2;
/*     */ 
/*     */ import javax.xml.namespace.QName;
/*     */ import org.apache.axis2.AxisFault;
/*     */ import org.apache.axis2.description.AxisDescription;
/*     */ import org.apache.axis2.description.AxisMessage;
/*     */ import org.apache.axis2.description.AxisOperation;
/*     */ import org.apache.axis2.description.AxisService;
/*     */ import org.apache.axis2.description.OutOnlyAxisOperation;
/*     */ import org.apache.axis2.engine.AxisConfiguration;
/*     */ import org.apache.commons.logging.Log;
/*     */ import org.apache.commons.logging.LogFactory;
/*     */ import org.apache.synapse.SynapseException;
/*     */ import org.apache.synapse.config.SynapseConfiguration;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class AnonymousServiceFactory
/*     */ {
/*  42 */   private static final Log log = LogFactory.getLog(AnonymousServiceFactory.class);
/*     */   
/*     */   private static final String NONE = ""__NONE__"";
/*     */   
/*     */   private static final String ADDR_ONLY = ""__ADDR_ONLY__"";
/*     */   
/*     */   private static final String RM_AND_ADDR = ""__RM_AND_ADDR__"";
/*     */   private static final String SEC_AND_ADDR = ""__SEC_AND_ADDR__"";
/*     */   private static final String RM_SEC_AND_ADDR = ""__RM_SEC_AND_ADDR__"";
/*     */   public static final String OUT_IN_OPERATION = ""anonOutInOp"";
/*     */   public static final String OUT_ONLY_OPERATION = ""anonOutonlyOp"";
/*  53 */   private static SynapseCallbackReceiver synapseCallbackReceiver = null;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public static AxisService getAnonymousService(SynapseConfiguration synCfg, AxisConfiguration axisCfg, boolean wsAddrOn, boolean wsRMOn, boolean wsSecOn) {
/*     */     String servicekey;
/*  70 */     if (!wsAddrOn) {
/*  71 */       servicekey = ""__NONE__"";
/*     */     }
/*  73 */     else if (!wsSecOn && !wsRMOn) {
/*  74 */       servicekey = ""__ADDR_ONLY__"";
/*  75 */     } else if (wsRMOn && !wsSecOn) {
/*  76 */       servicekey = ""__RM_AND_ADDR__"";
/*  77 */     } else if (wsSecOn && !wsRMOn) {
/*  78 */       servicekey = ""__SEC_AND_ADDR__"";
/*     */     } else {
/*  80 */       servicekey = ""__RM_SEC_AND_ADDR__"";
/*     */     } 
/*     */ 
/*     */     
/*     */     try {
/*  85 */       AxisService service = axisCfg.getService(servicekey);
/*  86 */       if (service == null) {
/*  87 */         synchronized (AnonymousServiceFactory.class) {
/*     */ 
/*     */           
/*  90 */           service = axisCfg.getService(servicekey);
/*  91 */           if (service != null) {
/*  92 */             return service;
/*     */           }
/*     */           
/*  95 */           service = createAnonymousService(synCfg, axisCfg, servicekey);
/*     */           
/*  97 */           if (wsAddrOn) {
/*  98 */             service.engageModule(axisCfg.getModule(""addressing""), (AxisDescription)axisCfg);
/*     */ 
/*     */             
/* 101 */             if (wsRMOn) {
/* 102 */               service.engageModule(axisCfg.getModule(""Mercury""), (AxisDescription)axisCfg);
/*     */             }
/*     */             
/* 105 */             if (wsSecOn) {
/* 106 */               service.engageModule(axisCfg.getModule(""rampart""), (AxisDescription)axisCfg);
/*     */             }
/*     */           } 
/*     */         } 
/*     */       }
/*     */ 
/*     */       
/* 113 */       return service;
/* 114 */     } catch (AxisFault e) {
/* 115 */       handleException(""Error retrieving anonymous service for QoS : "" + servicekey, (Exception)e);
/*     */       
/* 117 */       return null;
/*     */     } 
/*     */   }
/*     */   private static void handleException(String msg, Exception e) {
/* 121 */     log.error(msg, e);
/* 122 */     throw new SynapseException(msg, e);
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   private static AxisService createAnonymousService(SynapseConfiguration synCfg, AxisConfiguration axisCfg, String serviceKey) {
/*     */     try {
/* 136 */       DynamicAxisOperation dynamicOperation = new DynamicAxisOperation(new QName(""anonOutInOp""));
/*     */       
/* 138 */       dynamicOperation.setMessageReceiver(getCallbackReceiver(synCfg));
/* 139 */       AxisMessage inMsg = new AxisMessage();
/* 140 */       inMsg.setName(""in-message"");
/* 141 */       inMsg.setParent((AxisDescription)dynamicOperation);
/* 142 */       AxisMessage outMsg = new AxisMessage();
/* 143 */       outMsg.setName(""out-message"");
/* 144 */       outMsg.setParent((AxisDescription)dynamicOperation);
/* 145 */       dynamicOperation.addMessage(inMsg, ""Out"");
/* 146 */       dynamicOperation.addMessage(outMsg, ""In"");
/*     */       
/* 148 */       OutOnlyAxisOperation asyncOperation = new OutOnlyAxisOperation(new QName(""anonOutonlyOp""));
/*     */       
/* 150 */       asyncOperation.setMessageReceiver(getCallbackReceiver(synCfg));
/* 151 */       AxisMessage outOnlyMsg = new AxisMessage();
/* 152 */       outOnlyMsg.setName(""out-message"");
/* 153 */       outOnlyMsg.setParent((AxisDescription)asyncOperation);
/* 154 */       asyncOperation.addMessage(outMsg, ""Out"");
/*     */       
/* 156 */       AxisService axisAnonymousService = new AxisService(serviceKey);
/* 157 */       axisAnonymousService.addOperation((AxisOperation)dynamicOperation);
/* 158 */       axisAnonymousService.addOperation((AxisOperation)asyncOperation);
/* 159 */       axisCfg.addService(axisAnonymousService);
/* 160 */       axisCfg.getPhasesInfo().setOperationPhases((AxisOperation)dynamicOperation);
/* 161 */       return axisAnonymousService;
/*     */     }
/* 163 */     catch (AxisFault e) {
/* 164 */       handleException(""Error occured while creating an anonymous service for QoS : "" + serviceKey, (Exception)e);
/*     */ 
/*     */ 
/*     */       
/* 168 */       return null;
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   private static synchronized SynapseCallbackReceiver getCallbackReceiver(SynapseConfiguration synCfg) {
/* 179 */     if (synapseCallbackReceiver == null) {
/* 180 */       synapseCallbackReceiver = new SynapseCallbackReceiver(synCfg);
/*     */     }
/* 182 */     return synapseCallbackReceiver;
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\core\axis2\AnonymousServiceFactory.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.core.axis2.AsyncCallback,"/*    */ package org.apache.synapse.core.axis2;
/*    */ 
/*    */ import org.apache.axis2.client.async.AxisCallback;
/*    */ import org.apache.axis2.context.MessageContext;
/*    */ import org.apache.synapse.MessageContext;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class AsyncCallback
/*    */   implements AxisCallback
/*    */ {
/* 33 */   MessageContext synapseOutMsgCtx = null;
/*    */ 
/*    */   
/*    */   private long timeOutOn;
/*    */ 
/*    */   
/* 39 */   private int timeOutAction = 100;
/*    */ 
/*    */   
/* 42 */   public AsyncCallback(MessageContext synapseOutMsgCtx) { this.synapseOutMsgCtx = synapseOutMsgCtx; }
/*    */ 
/*    */   
/*    */   public void onMessage(MessageContext messageContext) {}
/*    */ 
/*    */   
/*    */   public void onFault(MessageContext messageContext) {}
/*    */   
/*    */   public void onError(Exception e) {}
/*    */   
/*    */   public void onComplete() {}
/*    */   
/* 54 */   public MessageContext getSynapseOutMsgCtx() { return this.synapseOutMsgCtx; }
/*    */ 
/*    */ 
/*    */   
/* 58 */   public long getTimeOutOn() { return this.timeOutOn; }
/*    */ 
/*    */ 
/*    */   
/* 62 */   public void setTimeOutOn(long timeOutOn) { this.timeOutOn = timeOutOn; }
/*    */ 
/*    */ 
/*    */   
/* 66 */   public int getTimeOutAction() { return this.timeOutAction; }
/*    */ 
/*    */ 
/*    */   
/* 70 */   public void setTimeOutAction(int timeOutAction) { this.timeOutAction = timeOutAction; }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\core\axis2\AsyncCallback.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.core.axis2.Axis2FlexibleMEPClient,"/*     */ package org.apache.synapse.core.axis2;
/*     */ 
/*     */ import java.util.ArrayList;
/*     */ import javax.xml.namespace.QName;
/*     */ import org.apache.axiom.om.OMAbstractFactory;
/*     */ import org.apache.axiom.om.OMElement;
/*     */ import org.apache.axiom.om.OMNamespace;
/*     */ import org.apache.axiom.soap.SOAPEnvelope;
/*     */ import org.apache.axiom.soap.SOAPFactory;
/*     */ import org.apache.axiom.soap.SOAPHeader;
/*     */ import org.apache.axiom.soap.SOAPHeaderBlock;
/*     */ import org.apache.axis2.AxisFault;
/*     */ import org.apache.axis2.addressing.EndpointReference;
/*     */ import org.apache.axis2.client.OperationClient;
/*     */ import org.apache.axis2.client.Options;
/*     */ import org.apache.axis2.context.ConfigurationContext;
/*     */ import org.apache.axis2.context.MessageContext;
/*     */ import org.apache.axis2.context.ServiceContext;
/*     */ import org.apache.axis2.context.ServiceGroupContext;
/*     */ import org.apache.axis2.description.AxisOperation;
/*     */ import org.apache.axis2.description.AxisService;
/*     */ import org.apache.axis2.description.AxisServiceGroup;
/*     */ import org.apache.axis2.engine.AxisConfiguration;
/*     */ import org.apache.commons.logging.Log;
/*     */ import org.apache.commons.logging.LogFactory;
/*     */ import org.apache.neethi.Policy;
/*     */ import org.apache.neethi.PolicyEngine;
/*     */ import org.apache.synapse.MessageContext;
/*     */ import org.apache.synapse.SynapseException;
/*     */ import org.apache.synapse.endpoints.utils.EndpointDefinition;
/*     */ import org.apache.synapse.util.MessageHelper;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class Axis2FlexibleMEPClient
/*     */ {
/*  62 */   private static final Log log = LogFactory.getLog(Axis2FlexibleMEPClient.class);
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public static void send(EndpointDefinition endpoint, MessageContext synapseOutMessageContext) throws AxisFault {
/*  80 */     boolean separateListener = false;
/*  81 */     boolean wsSecurityEnabled = false;
/*  82 */     String wsSecPolicyKey = null;
/*  83 */     boolean wsRMEnabled = false;
/*  84 */     String wsRMPolicyKey = null;
/*  85 */     boolean wsAddressingEnabled = false;
/*  86 */     String wsAddressingVersion = null;
/*     */     
/*  88 */     if (endpoint != null) {
/*  89 */       separateListener = endpoint.isUseSeparateListener();
/*  90 */       wsSecurityEnabled = endpoint.isSecurityOn();
/*  91 */       wsSecPolicyKey = endpoint.getWsSecPolicyKey();
/*  92 */       wsRMEnabled = endpoint.isReliableMessagingOn();
/*  93 */       wsRMPolicyKey = endpoint.getWsRMPolicyKey();
/*  94 */       wsAddressingEnabled = (endpoint.isAddressingOn() || wsSecurityEnabled || wsRMEnabled);
/*  95 */       wsAddressingVersion = endpoint.getAddressingVersion();
/*     */     } 
/*     */     
/*  98 */     if (log.isDebugEnabled()) {
/*  99 */       log.debug(""Sending [add = "" + wsAddressingEnabled + ""] [sec = "" + wsSecurityEnabled + ""] [rm = "" + wsRMEnabled + ((endpoint != null) ? (""] [mtom = "" + endpoint.isUseMTOM() + ""] [swa = "" + endpoint.isUseSwa() + ""] [format = "" + endpoint.getFormat() + ""] [force soap11="" + endpoint.isForceSOAP11() + ""] [force soap12="" + endpoint.isForceSOAP12() + ""] [pox="" + endpoint.isForcePOX() + ""] [get="" + endpoint.isForceGET() + ""] [encoding="" + endpoint.getCharSetEncoding()) : """") + ""] [to "" + synapseOutMessageContext.getTo() + ""]"");
/*     */     }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */     
/* 116 */     MessageContext originalInMsgCtx = ((Axis2MessageContext)synapseOutMessageContext).getAxis2MessageContext();
/*     */ 
/*     */ 
/*     */ 
/*     */     
/* 121 */     MessageContext axisOutMsgCtx = cloneForSend(originalInMsgCtx);
/*     */ 
/*     */ 
/*     */     
/* 125 */     if (endpoint != null) {
/*     */       
/* 127 */       if (""pox"".equals(endpoint.getFormat())) {
/* 128 */         axisOutMsgCtx.setDoingREST(true);
/*     */       }
/* 130 */       else if (""get"".equals(endpoint.getFormat())) {
/* 131 */         axisOutMsgCtx.setDoingREST(true);
/* 132 */         axisOutMsgCtx.setProperty(""HTTP_METHOD"", ""GET"");
/*     */       
/*     */       }
/* 135 */       else if (""soap11"".equals(endpoint.getFormat())) {
/* 136 */         axisOutMsgCtx.setDoingREST(false);
/* 137 */         axisOutMsgCtx.removeProperty(""messageType"");
/* 138 */         if (axisOutMsgCtx.getSoapAction() == null && axisOutMsgCtx.getWSAAction() != null) {
/* 139 */           axisOutMsgCtx.setSoapAction(axisOutMsgCtx.getWSAAction());
/*     */         }
/* 141 */         if (!axisOutMsgCtx.isSOAP11()) {
/* 142 */           SOAPUtils.convertSOAP12toSOAP11(axisOutMsgCtx);
/*     */         }
/*     */       }
/* 145 */       else if (""soap12"".equals(endpoint.getFormat())) {
/* 146 */         axisOutMsgCtx.setDoingREST(false);
/* 147 */         axisOutMsgCtx.removeProperty(""messageType"");
/* 148 */         if (axisOutMsgCtx.getSoapAction() == null && axisOutMsgCtx.getWSAAction() != null) {
/* 149 */           axisOutMsgCtx.setSoapAction(axisOutMsgCtx.getWSAAction());
/*     */         }
/* 151 */         if (axisOutMsgCtx.isSOAP11()) {
/* 152 */           SOAPUtils.convertSOAP11toSOAP12(axisOutMsgCtx);
/*     */         }
/*     */       } 
/*     */ 
/*     */       
/* 157 */       if (endpoint.isUseMTOM()) {
/* 158 */         axisOutMsgCtx.setDoingMTOM(true);
/*     */         
/* 160 */         axisOutMsgCtx.setProperty(""enableMTOM"", ""true"");
/*     */ 
/*     */         
/* 163 */         axisOutMsgCtx.setDoingMTOM(true);
/*     */       }
/* 165 */       else if (endpoint.isUseSwa()) {
/* 166 */         axisOutMsgCtx.setDoingSwA(true);
/*     */         
/* 168 */         axisOutMsgCtx.setProperty(""enableSwA"", ""true"");
/*     */ 
/*     */         
/* 171 */         axisOutMsgCtx.setDoingSwA(true);
/*     */       } 
/*     */       
/* 174 */       if (endpoint.getCharSetEncoding() != null) {
/* 175 */         axisOutMsgCtx.setProperty(""CHARACTER_SET_ENCODING"", endpoint.getCharSetEncoding());
/*     */       }
/*     */ 
/*     */       
/* 179 */       if (endpoint.getAddress() != null) {
/* 180 */         axisOutMsgCtx.setTo(new EndpointReference(endpoint.getAddress()));
/*     */       }
/*     */       
/* 183 */       if (endpoint.isUseSeparateListener()) {
/* 184 */         axisOutMsgCtx.getOptions().setUseSeparateListener(true);
/*     */       }
/*     */     } 
/*     */     
/* 188 */     if (wsAddressingEnabled) {
/*     */       
/* 190 */       if (wsAddressingVersion != null && ""submission"".equals(wsAddressingVersion)) {
/*     */ 
/*     */         
/* 193 */         axisOutMsgCtx.setProperty(""WSAddressingVersion"", ""http://schemas.xmlsoap.org/ws/2004/08/addressing"");
/*     */       
/*     */       }
/* 196 */       else if (wsAddressingVersion != null && ""final"".equals(wsAddressingVersion)) {
/*     */ 
/*     */         
/* 199 */         axisOutMsgCtx.setProperty(""WSAddressingVersion"", ""http://www.w3.org/2005/08/addressing"");
/*     */       } 
/*     */ 
/*     */       
/* 203 */       axisOutMsgCtx.setProperty(""disableAddressingForOutMessages"", Boolean.FALSE);
/*     */     } else {
/*     */       
/* 206 */       axisOutMsgCtx.setProperty(""disableAddressingForOutMessages"", Boolean.TRUE);
/*     */     } 
/*     */ 
/*     */     
/* 210 */     ConfigurationContext axisCfgCtx = axisOutMsgCtx.getConfigurationContext();
/* 211 */     AxisConfiguration axisCfg = axisCfgCtx.getAxisConfiguration();
/*     */     
/* 213 */     AxisService anoymousService = AnonymousServiceFactory.getAnonymousService(synapseOutMessageContext.getConfiguration(), axisCfg, wsAddressingEnabled, wsRMEnabled, wsSecurityEnabled);
/*     */ 
/*     */     
/* 216 */     ServiceGroupContext sgc = new ServiceGroupContext(axisCfgCtx, (AxisServiceGroup)anoymousService.getParent());
/*     */     
/* 218 */     ServiceContext serviceCtx = sgc.getServiceContext(anoymousService);
/*     */     
/* 220 */     boolean outOnlyMessage = (""true"".equals(synapseOutMessageContext.getProperty(""OUT_ONLY"")) || ""http://www.w3.org/ns/wsdl/in-only"".equals(originalInMsgCtx.getOperationContext().getAxisOperation().getMessageExchangePattern()));
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */     
/* 226 */     AxisOperation axisAnonymousOperation = anoymousService.getOperation(outOnlyMessage ? new QName(""anonOutonlyOp"") : new QName(""anonOutInOp""));
/*     */ 
/*     */ 
/*     */ 
/*     */     
/* 231 */     Options clientOptions = new Options();
/* 232 */     clientOptions.setUseSeparateListener(separateListener);
/*     */     
/* 234 */     if (wsRMEnabled) {
/*     */       
/* 236 */       if (wsRMPolicyKey != null) {
/* 237 */         clientOptions.setProperty(""sandeshaPolicy"", getPolicy(synapseOutMessageContext, wsRMPolicyKey));
/*     */       }
/*     */ 
/*     */       
/* 241 */       copyRMOptions(originalInMsgCtx, clientOptions);
/*     */     } 
/*     */ 
/*     */     
/* 245 */     if (wsSecurityEnabled) {
/*     */       
/* 247 */       if (wsSecPolicyKey != null) {
/* 248 */         clientOptions.setProperty(""rampartPolicy"", getPolicy(synapseOutMessageContext, wsSecPolicyKey));
/*     */       }
/*     */ 
/*     */ 
/*     */       
/* 253 */       if (axisOutMsgCtx.getEnvelope().getHeader() == null) {
/* 254 */         SOAPFactory fac = axisOutMsgCtx.isSOAP11() ? OMAbstractFactory.getSOAP11Factory() : OMAbstractFactory.getSOAP12Factory();
/*     */         
/* 256 */         fac.createSOAPHeader(axisOutMsgCtx.getEnvelope());
/*     */       } 
/*     */     } 
/*     */     
/* 260 */     OperationClient mepClient = axisAnonymousOperation.createClient(serviceCtx, clientOptions);
/* 261 */     mepClient.addMessageContext(axisOutMsgCtx);
/* 262 */     axisOutMsgCtx.setAxisMessage(axisAnonymousOperation.getMessage(""Out""));
/*     */ 
/*     */     
/* 265 */     if (!outOnlyMessage) {
/*     */ 
/*     */ 
/*     */ 
/*     */       
/* 270 */       AsyncCallback callback = new AsyncCallback(synapseOutMessageContext);
/* 271 */       if (endpoint != null) {
/*     */ 
/*     */         
/* 274 */         callback.setTimeOutOn(System.currentTimeMillis() + endpoint.getTimeoutDuration());
/* 275 */         callback.setTimeOutAction(endpoint.getTimeoutAction());
/*     */       } else {
/* 277 */         callback.setTimeOutOn(System.currentTimeMillis());
/*     */       } 
/* 279 */       mepClient.setCallback(callback);
/*     */     } 
/*     */ 
/*     */ 
/*     */ 
/*     */     
/* 285 */     originalInMsgCtx.getOperationContext().setProperty(""RESPONSE_WRITTEN"", ""SKIP"");
/*     */ 
/*     */     
/* 288 */     mepClient.execute(true);
/*     */   }
/*     */ 
/*     */   
/*     */   private static MessageContext cloneForSend(MessageContext ori) throws AxisFault {
/* 293 */     MessageContext newMC = MessageHelper.clonePartially(ori);
/*     */     
/* 295 */     newMC.setEnvelope(ori.getEnvelope());
/* 296 */     removeAddressingHeaders(newMC);
/*     */     
/* 298 */     newMC.setProperty(""TRANSPORT_HEADERS"", ori.getProperty(""TRANSPORT_HEADERS""));
/*     */ 
/*     */     
/* 301 */     return newMC;
/*     */   }
/*     */   
/*     */   private static void copyRMOptions(MessageContext oriContext, Options targetOptions) {
/* 305 */     Options oriOptions = oriContext.getOptions();
/* 306 */     if (oriOptions.getProperty(""MercuryLastMessage"") != null) {
/* 307 */       targetOptions.setProperty(""MercuryLastMessage"", oriOptions.getProperty(""MercuryLastMessage""));
/*     */     }
/*     */     
/* 310 */     if (oriOptions.getProperty(""MercuryRMSpecVersion"") != null) {
/* 311 */       targetOptions.setProperty(""MercuryRMSpecVersion"", oriOptions.getProperty(""MercuryRMSpecVersion""));
/*     */     }
/*     */     
/* 314 */     if (oriOptions.getProperty(""MercurySequenceKey"") != null) {
/* 315 */       targetOptions.setProperty(""MercurySequenceKey"", oriOptions.getProperty(""MercurySequenceKey""));
/*     */     }
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   private static Policy getPolicy(MessageContext synCtx, String propertyKey) {
/* 332 */     Object property = synCtx.getEntry(propertyKey);
/* 333 */     if (property != null && property instanceof OMElement) {
/* 334 */       return PolicyEngine.getPolicy((OMElement)property);
/*     */     }
/* 336 */     handleException(""Cannot locate policy from the property : "" + propertyKey);
/*     */     
/* 338 */     return null;
/*     */   }
/*     */   
/*     */   private static void handleException(String msg) {
/* 342 */     log.error(msg);
/* 343 */     throw new SynapseException(msg);
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public static SOAPEnvelope removeAddressingHeaders(MessageContext axisMsgCtx) {
/* 354 */     SOAPEnvelope env = axisMsgCtx.getEnvelope();
/* 355 */     SOAPHeader soapHeader = env.getHeader();
/*     */ 
/*     */     
/* 358 */     if (soapHeader != null) {
/* 359 */       ArrayList addressingHeaders = soapHeader.getHeaderBlocksWithNSURI(""http://schemas.xmlsoap.org/ws/2004/08/addressing"");
/*     */ 
/*     */       
/* 362 */       if (addressingHeaders != null && addressingHeaders.size() != 0) {
/* 363 */         detachAddressingInformation(addressingHeaders);
/*     */       } else {
/*     */         
/* 366 */         addressingHeaders = soapHeader.getHeaderBlocksWithNSURI(""http://www.w3.org/2005/08/addressing"");
/*     */         
/* 368 */         if (addressingHeaders != null && addressingHeaders.size() != 0) {
/* 369 */           detachAddressingInformation(addressingHeaders);
/*     */         }
/*     */       } 
/*     */     } 
/* 373 */     return env;
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   private static void detachAddressingInformation(ArrayList headerInformation) {
/* 381 */     for (Object o : headerInformation) {
/* 382 */       if (o instanceof SOAPHeaderBlock) {
/* 383 */         SOAPHeaderBlock headerBlock = (SOAPHeaderBlock)o;
/* 384 */         headerBlock.detach(); continue;
/* 385 */       }  if (o instanceof OMElement) {
/*     */         
/* 387 */         OMElement om = (OMElement)o;
/* 388 */         OMNamespace ns = om.getNamespace();
/* 389 */         if (ns != null && (""http://schemas.xmlsoap.org/ws/2004/08/addressing"".equals(ns.getNamespaceURI()) || ""http://www.w3.org/2005/08/addressing"".equals(ns.getNamespaceURI())))
/*     */         {
/*     */           
/* 392 */           om.detach();
/*     */         }
/*     */       } 
/*     */     } 
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\core\axis2\Axis2FlexibleMEPClient.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.core.axis2.Axis2MessageContext,"/*     */ package org.apache.synapse.core.axis2;
/*     */ 
/*     */ import java.util.HashMap;
/*     */ import java.util.Iterator;
/*     */ import java.util.Map;
/*     */ import java.util.Set;
/*     */ import java.util.Stack;
/*     */ import org.apache.axiom.om.OMElement;
/*     */ import org.apache.axiom.soap.SOAPBody;
/*     */ import org.apache.axiom.soap.SOAPEnvelope;
/*     */ import org.apache.axiom.soap.SOAPHeader;
/*     */ import org.apache.axiom.soap.SOAPHeaderBlock;
/*     */ import org.apache.axis2.AxisFault;
/*     */ import org.apache.axis2.addressing.EndpointReference;
/*     */ import org.apache.axis2.addressing.RelatesTo;
/*     */ import org.apache.axis2.context.MessageContext;
/*     */ import org.apache.commons.logging.Log;
/*     */ import org.apache.commons.logging.LogFactory;
/*     */ import org.apache.synapse.FaultHandler;
/*     */ import org.apache.synapse.Mediator;
/*     */ import org.apache.synapse.MessageContext;
/*     */ import org.apache.synapse.config.Entry;
/*     */ import org.apache.synapse.config.SynapseConfiguration;
/*     */ import org.apache.synapse.core.SynapseEnvironment;
/*     */ import org.apache.synapse.endpoints.Endpoint;
/*     */ import org.apache.synapse.mediators.MediatorFaultHandler;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class Axis2MessageContext
/*     */   implements MessageContext
/*     */ {
/*  52 */   private SynapseConfiguration synCfg = null;
/*     */ 
/*     */   
/*  55 */   private SynapseEnvironment synEnv = null;
/*     */ 
/*     */   
/*  58 */   private Map<String, Object> properties = new HashMap<String, Object>();
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  64 */   private Map<String, Object> localEntries = new HashMap<String, Object>();
/*     */ 
/*     */   
/*  67 */   private Stack<FaultHandler> faultStack = new Stack<FaultHandler>();
/*     */ 
/*     */   
/*  70 */   private MessageContext axis2MessageContext = null;
/*     */ 
/*     */   
/*     */   private boolean response = false;
/*     */ 
/*     */   
/*     */   private boolean faultResponse = false;
/*     */ 
/*     */   
/*  79 */   private int tracingState = 2;
/*     */ 
/*     */   
/*  82 */   private Log serviceLog = null;
/*     */ 
/*     */   
/*  85 */   public SynapseConfiguration getConfiguration() { return this.synCfg; }
/*     */ 
/*     */ 
/*     */   
/*  89 */   public void setConfiguration(SynapseConfiguration synCfg) { this.synCfg = synCfg; }
/*     */ 
/*     */ 
/*     */   
/*  93 */   public SynapseEnvironment getEnvironment() { return this.synEnv; }
/*     */ 
/*     */ 
/*     */   
/*  97 */   public void setEnvironment(SynapseEnvironment synEnv) { this.synEnv = synEnv; }
/*     */ 
/*     */ 
/*     */   
/* 101 */   public Map getContextEntries() { return this.localEntries; }
/*     */ 
/*     */ 
/*     */   
/* 105 */   public void setContextEntries(Map<String, Object> entries) { this.localEntries = entries; }
/*     */ 
/*     */   
/*     */   public Mediator getMainSequence() {
/* 109 */     Object o = this.localEntries.get(""main"");
/* 110 */     if (o != null && o instanceof Mediator) {
/* 111 */       return (Mediator)o;
/*     */     }
/* 113 */     Mediator main = getConfiguration().getMainSequence();
/* 114 */     this.localEntries.put(""main"", main);
/* 115 */     return main;
/*     */   }
/*     */ 
/*     */   
/*     */   public Mediator getFaultSequence() {
/* 120 */     Object o = this.localEntries.get(""fault"");
/* 121 */     if (o != null && o instanceof Mediator) {
/* 122 */       return (Mediator)o;
/*     */     }
/* 124 */     Mediator fault = getConfiguration().getFaultSequence();
/* 125 */     this.localEntries.put(""fault"", fault);
/* 126 */     return fault;
/*     */   }
/*     */ 
/*     */   
/*     */   public Mediator getSequence(String key) {
/* 131 */     Object o = this.localEntries.get(key);
/* 132 */     if (o != null && o instanceof Mediator) {
/* 133 */       return (Mediator)o;
/*     */     }
/* 135 */     Mediator m = getConfiguration().getSequence(key);
/* 136 */     this.localEntries.put(key, m);
/* 137 */     return m;
/*     */   }
/*     */ 
/*     */   
/*     */   public Endpoint getEndpoint(String key) {
/* 142 */     Object o = this.localEntries.get(key);
/* 143 */     if (o != null && o instanceof Endpoint) {
/* 144 */       return (Endpoint)o;
/*     */     }
/* 146 */     Endpoint e = getConfiguration().getEndpoint(key);
/* 147 */     this.localEntries.put(key, e);
/* 148 */     return e;
/*     */   }
/*     */ 
/*     */   
/*     */   public Object getEntry(String key) {
/* 153 */     Object o = this.localEntries.get(key);
/* 154 */     if (o != null && o instanceof Entry) {
/* 155 */       return ((Entry)o).getValue();
/*     */     }
/* 157 */     Object e = getConfiguration().getEntry(key);
/* 158 */     if (e != null) {
/* 159 */       this.localEntries.put(key, e);
/* 160 */       return e;
/*     */     } 
/* 162 */     getConfiguration().getEntryDefinition(key);
/* 163 */     return getConfiguration().getEntry(key);
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 169 */   public Object getProperty(String key) { return this.properties.get(key); }
/*     */ 
/*     */   
/*     */   public void setProperty(String key, Object value) {
/* 173 */     this.properties.put(key, value);
/*     */ 
/*     */     
/* 176 */     if (""RESPONSE"".equals(key) && getAxis2MessageContext().getOperationContext() != null)
/*     */     {
/* 178 */       getAxis2MessageContext().getOperationContext().setProperty(""RESPONSE_WRITTEN"", ""SKIP"");
/*     */     }
/*     */   }
/*     */ 
/*     */ 
/*     */   
/* 184 */   public Set getPropertyKeySet() { return this.properties.keySet(); }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public Axis2MessageContext(MessageContext axisMsgCtx, SynapseConfiguration synCfg, SynapseEnvironment synEnv) {
/* 196 */     setAxis2MessageContext(axisMsgCtx);
/* 197 */     this.synCfg = synCfg;
/* 198 */     this.synEnv = synEnv;
/* 199 */     pushFaultHandler((FaultHandler)new MediatorFaultHandler(synCfg.getFaultSequence()));
/*     */   }
/*     */ 
/*     */   
/* 203 */   public EndpointReference getFaultTo() { return this.axis2MessageContext.getFaultTo(); }
/*     */ 
/*     */ 
/*     */   
/* 207 */   public void setFaultTo(EndpointReference reference) { this.axis2MessageContext.setFaultTo(reference); }
/*     */ 
/*     */ 
/*     */   
/* 211 */   public EndpointReference getFrom() { return this.axis2MessageContext.getFrom(); }
/*     */ 
/*     */ 
/*     */   
/* 215 */   public void setFrom(EndpointReference reference) { this.axis2MessageContext.setFrom(reference); }
/*     */ 
/*     */ 
/*     */   
/* 219 */   public SOAPEnvelope getEnvelope() { return this.axis2MessageContext.getEnvelope(); }
/*     */ 
/*     */ 
/*     */   
/* 223 */   public void setEnvelope(SOAPEnvelope envelope) throws AxisFault { this.axis2MessageContext.setEnvelope(envelope); }
/*     */ 
/*     */ 
/*     */   
/* 227 */   public String getMessageID() { return this.axis2MessageContext.getMessageID(); }
/*     */ 
/*     */ 
/*     */   
/* 231 */   public void setMessageID(String string) { this.axis2MessageContext.setMessageID(string); }
/*     */ 
/*     */ 
/*     */   
/* 235 */   public RelatesTo getRelatesTo() { return this.axis2MessageContext.getRelatesTo(); }
/*     */ 
/*     */ 
/*     */   
/* 239 */   public void setRelatesTo(RelatesTo[] reference) { this.axis2MessageContext.setRelationships(reference); }
/*     */ 
/*     */ 
/*     */   
/* 243 */   public EndpointReference getReplyTo() { return this.axis2MessageContext.getReplyTo(); }
/*     */ 
/*     */ 
/*     */   
/* 247 */   public void setReplyTo(EndpointReference reference) { this.axis2MessageContext.setReplyTo(reference); }
/*     */ 
/*     */ 
/*     */   
/* 251 */   public EndpointReference getTo() { return this.axis2MessageContext.getTo(); }
/*     */ 
/*     */ 
/*     */   
/* 255 */   public void setTo(EndpointReference reference) { this.axis2MessageContext.setTo(reference); }
/*     */ 
/*     */ 
/*     */   
/* 259 */   public void setWSAAction(String actionURI) { this.axis2MessageContext.setWSAAction(actionURI); }
/*     */ 
/*     */ 
/*     */   
/* 263 */   public String getWSAAction() { return this.axis2MessageContext.getWSAAction(); }
/*     */ 
/*     */ 
/*     */   
/* 267 */   public void setWSAMessageID(String messageID) { this.axis2MessageContext.setWSAMessageId(messageID); }
/*     */ 
/*     */ 
/*     */   
/* 271 */   public String getWSAMessageID() { return this.axis2MessageContext.getMessageID(); }
/*     */ 
/*     */ 
/*     */   
/* 275 */   public String getSoapAction() { return this.axis2MessageContext.getSoapAction(); }
/*     */ 
/*     */ 
/*     */   
/* 279 */   public void setSoapAction(String string) { this.axis2MessageContext.setSoapAction(string); }
/*     */ 
/*     */ 
/*     */   
/* 283 */   public boolean isDoingMTOM() { return this.axis2MessageContext.isDoingMTOM(); }
/*     */ 
/*     */ 
/*     */   
/* 287 */   public boolean isDoingSWA() { return this.axis2MessageContext.isDoingSwA(); }
/*     */ 
/*     */ 
/*     */   
/* 291 */   public void setDoingMTOM(boolean b) { this.axis2MessageContext.setDoingMTOM(b); }
/*     */ 
/*     */ 
/*     */   
/* 295 */   public void setDoingSWA(boolean b) { this.axis2MessageContext.setDoingSwA(b); }
/*     */ 
/*     */ 
/*     */   
/* 299 */   public boolean isDoingPOX() { return this.axis2MessageContext.isDoingREST(); }
/*     */ 
/*     */ 
/*     */   
/* 303 */   public void setDoingPOX(boolean b) { this.axis2MessageContext.setDoingREST(b); }
/*     */ 
/*     */ 
/*     */   
/* 307 */   public boolean isDoingGET() { return (""GET"".equals(this.axis2MessageContext.getProperty(""HTTP_METHOD"")) && this.axis2MessageContext.isDoingREST()); }
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public void setDoingGET(boolean b) {
/* 313 */     if (b) {
/* 314 */       this.axis2MessageContext.setDoingREST(b);
/* 315 */       this.axis2MessageContext.setProperty(""HTTP_METHOD"", ""GET"");
/*     */     } else {
/*     */       
/* 318 */       this.axis2MessageContext.removeProperty(""HTTP_METHOD"");
/*     */     } 
/*     */   }
/*     */ 
/*     */   
/* 323 */   public boolean isSOAP11() { return this.axis2MessageContext.isSOAP11(); }
/*     */ 
/*     */   
/*     */   public void setResponse(boolean b) {
/* 327 */     this.response = b;
/* 328 */     this.axis2MessageContext.setProperty(""synapse.isresponse"", Boolean.valueOf(b));
/*     */   }
/*     */   
/*     */   public boolean isResponse() {
/* 332 */     Object o = this.properties.get(""RESPONSE"");
/* 333 */     return ((o != null && o instanceof String && ((String)o).equalsIgnoreCase(""true"")) || this.response);
/*     */   }
/*     */ 
/*     */ 
/*     */   
/* 338 */   public void setFaultResponse(boolean b) { this.faultResponse = b; }
/*     */ 
/*     */ 
/*     */   
/* 342 */   public boolean isFaultResponse() { return this.faultResponse; }
/*     */ 
/*     */ 
/*     */   
/* 346 */   public int getTracingState() { return this.tracingState; }
/*     */ 
/*     */ 
/*     */   
/* 350 */   public void setTracingState(int tracingState) { this.tracingState = tracingState; }
/*     */ 
/*     */ 
/*     */   
/* 354 */   public Stack getFaultStack() { return this.faultStack; }
/*     */ 
/*     */ 
/*     */   
/* 358 */   public void pushFaultHandler(FaultHandler fault) { this.faultStack.push(fault); }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public Log getServiceLog() {
/* 367 */     if (this.serviceLog != null) {
/* 368 */       return this.serviceLog;
/*     */     }
/* 370 */     String serviceName = (String)getProperty(""proxy.name"");
/* 371 */     if (serviceName != null && this.synCfg.getProxyService(serviceName) != null) {
/* 372 */       this.serviceLog = LogFactory.getLog(""SERVICE_LOGGER."" + serviceName);
/*     */       
/* 374 */       return this.serviceLog;
/*     */     } 
/* 376 */     this.serviceLog = LogFactory.getLog(""SERVICE_LOGGER."".substring(0, ""SERVICE_LOGGER."".length() - 1));
/*     */ 
/*     */     
/* 379 */     return this.serviceLog;
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 389 */   public void setServiceLog(Log serviceLog) { this.serviceLog = serviceLog; }
/*     */ 
/*     */ 
/*     */   
/* 393 */   public MessageContext getAxis2MessageContext() { return this.axis2MessageContext; }
/*     */ 
/*     */   
/*     */   public void setAxis2MessageContext(MessageContext axisMsgCtx) {
/* 397 */     this.axis2MessageContext = axisMsgCtx;
/* 398 */     Boolean resp = (Boolean)axisMsgCtx.getProperty(""synapse.isresponse"");
/* 399 */     if (resp != null) {
/* 400 */       this.response = resp.booleanValue();
/*     */     }
/*     */   }
/*     */ 
/*     */   
/* 405 */   public void setPaused(boolean value) { this.axis2MessageContext.setPaused(value); }
/*     */ 
/*     */ 
/*     */   
/* 409 */   public boolean isPaused() { return this.axis2MessageContext.isPaused(); }
/*     */ 
/*     */ 
/*     */   
/* 413 */   public boolean isServerSide() { return this.axis2MessageContext.isServerSide(); }
/*     */ 
/*     */ 
/*     */   
/* 417 */   public void setServerSide(boolean value) { this.axis2MessageContext.setServerSide(value); }
/*     */ 
/*     */ 
/*     */   
/*     */   public String toString() {
/* 422 */     StringBuffer sb = new StringBuffer();
/* 423 */     String separator = ""\n"";
/*     */     
/* 425 */     if (getTo() != null) {
/* 426 */       sb.append(""To : "").append(getTo().getAddress());
/*     */     } else {
/* 428 */       sb.append(""To : "");
/*     */     } 
/*     */     
/* 431 */     if (getFrom() != null) {
/* 432 */       sb.append(separator).append(""From : "").append(getFrom().getAddress());
/*     */     }
/*     */     
/* 435 */     if (getWSAAction() != null) {
/* 436 */       sb.append(separator).append(""WSAction : "").append(getWSAAction());
/*     */     }
/*     */     
/* 439 */     if (getSoapAction() != null) {
/* 440 */       sb.append(separator).append(""SOAPAction : "").append(getSoapAction());
/*     */     }
/*     */     
/* 443 */     if (getReplyTo() != null) {
/* 444 */       sb.append(separator).append(""ReplyTo : "").append(getReplyTo().getAddress());
/*     */     }
/*     */     
/* 447 */     if (getMessageID() != null) {
/* 448 */       sb.append(separator).append(""MessageID : "").append(getMessageID());
/*     */     }
/*     */     
/* 451 */     SOAPHeader soapHeader = getEnvelope().getHeader();
/* 452 */     if (soapHeader != null) {
/*     */       
/* 454 */       sb.append(separator).append(""Headers : "");
/* 455 */       for (Iterator iter = soapHeader.examineAllHeaderBlocks(); iter.hasNext(); ) {
/*     */         
/* 457 */         Object o = iter.next();
/* 458 */         if (o instanceof SOAPHeaderBlock) {
/*     */           
/* 460 */           SOAPHeaderBlock headerBlock = (SOAPHeaderBlock)o;
/* 461 */           sb.append(separator).append(""\t"").append(headerBlock.getLocalName()).append("" : "").append(headerBlock.getText());
/*     */           continue;
/*     */         } 
/* 464 */         if (o instanceof OMElement) {
/*     */           
/* 466 */           OMElement headerElem = (OMElement)o;
/* 467 */           sb.append(separator).append(""\t"").append(headerElem.getLocalName()).append("" : "").append(headerElem.getText());
/*     */         } 
/*     */       } 
/*     */     } 
/*     */ 
/*     */     
/* 473 */     SOAPBody soapBody = getEnvelope().getBody();
/* 474 */     if (soapBody != null) {
/* 475 */       sb.append(separator).append(""Body : "").append(soapBody.toString());
/*     */     }
/*     */     
/* 478 */     return sb.toString();
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\core\axis2\Axis2MessageContext.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.core.axis2.Axis2Sender,"/*     */ package org.apache.synapse.core.axis2;
/*     */ 
/*     */ import org.apache.axiom.om.OMAbstractFactory;
/*     */ import org.apache.axiom.soap.SOAPFactory;
/*     */ import org.apache.axis2.AxisFault;
/*     */ import org.apache.axis2.addressing.AddressingHelper;
/*     */ import org.apache.axis2.context.MessageContext;
/*     */ import org.apache.axis2.engine.AxisEngine;
/*     */ import org.apache.commons.logging.Log;
/*     */ import org.apache.commons.logging.LogFactory;
/*     */ import org.apache.synapse.MessageContext;
/*     */ import org.apache.synapse.SynapseException;
/*     */ import org.apache.synapse.endpoints.utils.EndpointDefinition;
/*     */ import org.apache.synapse.statistics.StatisticsUtils;
/*     */ import org.apache.synapse.util.POXUtils;
/*     */ import org.apache.synapse.util.UUIDGenerator;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class Axis2Sender
/*     */ {
/*  46 */   private static final Log log = LogFactory.getLog(Axis2Sender.class);
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public static void sendOn(EndpointDefinition endpoint, MessageContext synapseInMessageContext) {
/*     */     try {
/*  57 */       Axis2FlexibleMEPClient.send(endpoint, synapseInMessageContext);
/*     */ 
/*     */ 
/*     */ 
/*     */     
/*     */     }
/*  63 */     catch (Exception e) {
/*  64 */       handleException(""Unexpected error during sending message out"", e);
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public static void sendBack(MessageContext smc) {
/*  74 */     MessageContext messageContext = ((Axis2MessageContext)smc).getAxis2MessageContext();
/*     */ 
/*     */ 
/*     */     
/*  78 */     if (messageContext.isPropertyTrue(""SC_ACCEPTED"") && messageContext.getTransportOut() != null && !messageContext.getTransportOut().getName().startsWith(""http"")) {
/*     */       return;
/*     */     }
/*     */ 
/*     */ 
/*     */ 
/*     */     
/*  85 */     if (messageContext.isDoingREST() && messageContext.isFault()) {
/*  86 */       POXUtils.convertSOAPFaultToPOX(messageContext);
/*     */     }
/*     */     
/*     */     try {
/*  90 */       messageContext.setProperty(""synapse.isresponse"", Boolean.TRUE);
/*     */ 
/*     */       
/*  93 */       if (smc.isResponse()) {
/*     */         
/*  95 */         StatisticsUtils.processEndPointStatistics(smc);
/*  96 */         StatisticsUtils.processProxyServiceStatistics(smc);
/*  97 */         StatisticsUtils.processAllSequenceStatistics(smc);
/*     */       } 
/*     */       
/* 100 */       if (AddressingHelper.isReplyRedirected(messageContext) && !messageContext.getReplyTo().hasNoneAddress()) {
/*     */ 
/*     */         
/* 103 */         messageContext.setTo(messageContext.getReplyTo());
/* 104 */         messageContext.setReplyTo(null);
/* 105 */         messageContext.setWSAAction("""");
/* 106 */         messageContext.setSoapAction("""");
/* 107 */         messageContext.setProperty(""IGNORE_SC_ACCEPTED"", ""true"");
/*     */         
/* 109 */         messageContext.setProperty(""disableAddressingForOutMessages"", Boolean.FALSE);
/*     */       } 
/*     */ 
/*     */       
/* 113 */       if (messageContext.getEnvelope().hasFault() && AddressingHelper.isFaultRedirected(messageContext) && !messageContext.getFaultTo().hasNoneAddress()) {
/*     */ 
/*     */ 
/*     */         
/* 117 */         messageContext.setTo(messageContext.getFaultTo());
/* 118 */         messageContext.setFaultTo(null);
/* 119 */         messageContext.setWSAAction("""");
/* 120 */         messageContext.setSoapAction("""");
/* 121 */         messageContext.setProperty(""IGNORE_SC_ACCEPTED"", ""true"");
/*     */         
/* 123 */         messageContext.setProperty(""disableAddressingForOutMessages"", Boolean.FALSE);
/*     */       } 
/*     */ 
/*     */       
/* 127 */       Axis2FlexibleMEPClient.removeAddressingHeaders(messageContext);
/* 128 */       messageContext.setMessageID(UUIDGenerator.getUUID());
/*     */ 
/*     */       
/* 131 */       if (messageContext.isEngaged(""rampart"") && messageContext.getEnvelope().getHeader() == null) {
/*     */         
/* 133 */         SOAPFactory fac = messageContext.isSOAP11() ? OMAbstractFactory.getSOAP11Factory() : OMAbstractFactory.getSOAP12Factory();
/*     */         
/* 135 */         fac.createSOAPHeader(messageContext.getEnvelope());
/*     */       } 
/*     */       
/* 138 */       AxisEngine.send(messageContext);
/*     */     }
/* 140 */     catch (AxisFault e) {
/* 141 */       handleException(""Unexpected error sending message back"", (Exception)e);
/*     */     } 
/*     */   }
/*     */   
/*     */   private static void handleException(String msg, Exception e) {
/* 146 */     log.error(msg, e);
/* 147 */     throw new SynapseException(msg, e);
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\core\axis2\Axis2Sender.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.core.axis2.Axis2SynapseEnvironment,"/*     */ package org.apache.synapse.core.axis2;
/*     */ 
/*     */ import java.util.concurrent.ExecutorService;
/*     */ import org.apache.axiom.om.OMAbstractFactory;
/*     */ import org.apache.axiom.om.OMNode;
/*     */ import org.apache.axis2.context.ConfigurationContext;
/*     */ import org.apache.axis2.context.MessageContext;
/*     */ import org.apache.axis2.context.OperationContext;
/*     */ import org.apache.axis2.context.ServiceContext;
/*     */ import org.apache.axis2.description.AxisOperation;
/*     */ import org.apache.axis2.description.InOutAxisOperation;
/*     */ import org.apache.commons.logging.Log;
/*     */ import org.apache.commons.logging.LogFactory;
/*     */ import org.apache.synapse.Mediator;
/*     */ import org.apache.synapse.MessageContext;
/*     */ import org.apache.synapse.SynapseException;
/*     */ import org.apache.synapse.config.SynapseConfiguration;
/*     */ import org.apache.synapse.core.SynapseEnvironment;
/*     */ import org.apache.synapse.endpoints.utils.EndpointDefinition;
/*     */ import org.apache.synapse.mediators.MediatorWorker;
/*     */ import org.apache.synapse.mediators.base.SequenceMediator;
/*     */ import org.apache.synapse.statistics.StatisticsCollector;
/*     */ import org.apache.synapse.statistics.StatisticsUtils;
/*     */ import org.apache.synapse.util.TemporaryData;
/*     */ import org.apache.synapse.util.UUIDGenerator;
/*     */ import org.apache.synapse.util.concurrent.SynapseThreadPool;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class Axis2SynapseEnvironment
/*     */   implements SynapseEnvironment
/*     */ {
/*  51 */   private static final Log log = LogFactory.getLog(Axis2SynapseEnvironment.class);
/*     */   
/*     */   private SynapseConfiguration synapseConfig;
/*     */   
/*     */   private ConfigurationContext configContext;
/*     */   
/*     */   private ExecutorService executorService;
/*     */   
/*     */   private boolean initialized = false;
/*     */   private StatisticsCollector statisticsCollector;
/*     */   
/*     */   public Axis2SynapseEnvironment(SynapseConfiguration synCfg) {
/*  63 */     int coreThreads = 20;
/*  64 */     int maxThreads = 100;
/*  65 */     long keepAlive = 5L;
/*  66 */     int qlength = 10;
/*     */     
/*     */     try {
/*  69 */       qlength = Integer.parseInt(synCfg.getProperty(""synapse.threads.qlen""));
/*  70 */     } catch (Exception ignore) {}
/*     */     
/*     */     try {
/*  73 */       coreThreads = Integer.parseInt(synCfg.getProperty(""synapse.threads.core""));
/*  74 */     } catch (Exception ignore) {}
/*     */     
/*     */     try {
/*  77 */       maxThreads = Integer.parseInt(synCfg.getProperty(""synapse.threads.max""));
/*  78 */     } catch (Exception ignore) {}
/*     */     
/*     */     try {
/*  81 */       keepAlive = Long.parseLong(synCfg.getProperty(""synapse.threads.keepalive""));
/*  82 */     } catch (Exception ignore) {}
/*     */     
/*  84 */     this.executorService = (ExecutorService)new SynapseThreadPool(coreThreads, maxThreads, keepAlive, qlength, synCfg.getProperty(""synapse.threads.group"", ""synapse-thread-group""), synCfg.getProperty(""synapse.threads.idprefix"", ""SynapseWorker""));
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public Axis2SynapseEnvironment(ConfigurationContext cfgCtx, SynapseConfiguration synapseConfig) {
/*  93 */     this(synapseConfig);
/*  94 */     this.configContext = cfgCtx;
/*  95 */     this.synapseConfig = synapseConfig;
/*     */   }
/*     */   
/*     */   public boolean injectMessage(MessageContext synCtx) {
/*  99 */     if (log.isDebugEnabled()) {
/* 100 */       log.debug(""Injecting MessageContext"");
/*     */     }
/* 102 */     synCtx.setEnvironment(this);
/* 103 */     if (synCtx.isResponse()) {
/*     */       
/* 105 */       StatisticsUtils.processEndPointStatistics(synCtx);
/* 106 */       StatisticsUtils.processProxyServiceStatistics(synCtx);
/* 107 */       StatisticsUtils.processSequenceStatistics(synCtx);
/*     */     } 
/*     */     
/* 110 */     Mediator mandatorySeq = synCtx.getConfiguration().getMandatorySequence();
/*     */     
/* 112 */     if (mandatorySeq != null) {
/*     */       
/* 114 */       if (log.isDebugEnabled()) {
/* 115 */         log.debug(""Start mediating the message in the pre-mediate state using the mandatory sequence"");
/*     */       }
/*     */ 
/*     */       
/* 119 */       if (!mandatorySeq.mediate(synCtx)) {
/* 120 */         if (log.isDebugEnabled()) {
/* 121 */           log.debug((synCtx.isResponse() ? ""Response"" : ""Request"") + "" message for the "" + ((synCtx.getProperty(""proxy.name"") != null) ? (""proxy service "" + synCtx.getProperty(""proxy.name"")) : ""message mediation"") + "" dropped in the "" + ""pre-mediation state by the mandatory sequence : \n"" + synCtx);
/*     */         }
/*     */ 
/*     */ 
/*     */ 
/*     */         
/* 127 */         return false;
/*     */       } 
/*     */     } 
/*     */ 
/*     */     
/* 132 */     if (synCtx.getProperty(""proxy.name"") != null) {
/*     */       
/* 134 */       if (synCtx.getConfiguration().getProxyService((String)synCtx.getProperty(""proxy.name"")).getTargetOutSequence() != null) {
/*     */ 
/*     */         
/* 137 */         String sequenceName = synCtx.getConfiguration().getProxyService((String)synCtx.getProperty(""proxy.name"")).getTargetOutSequence();
/*     */         
/* 139 */         Mediator outSequence = synCtx.getSequence(sequenceName);
/*     */         
/* 141 */         if (outSequence != null) {
/* 142 */           if (log.isDebugEnabled()) {
/* 143 */             log.debug(""Using the sequence named "" + sequenceName + "" for the outgoing message mediation of the proxy service "" + synCtx.getProperty(""proxy.name""));
/*     */           }
/*     */ 
/*     */           
/* 147 */           outSequence.mediate(synCtx);
/*     */         } else {
/* 149 */           log.error(""Unable to find the out-sequence specified by the name "" + sequenceName);
/*     */           
/* 151 */           throw new SynapseException(""Unable to find the out-sequence specified by the name "" + sequenceName);
/*     */         }
/*     */       
/*     */       }
/* 155 */       else if (synCtx.getConfiguration().getProxyService((String)synCtx.getProperty(""proxy.name"")).getTargetInLineOutSequence() != null) {
/*     */         
/* 157 */         if (log.isDebugEnabled()) {
/* 158 */           log.debug(""Using the anonymous out-sequence specified in the proxy service "" + synCtx.getProperty(""proxy.name"") + "" for outgoing message mediation"");
/*     */         }
/*     */ 
/*     */         
/* 162 */         synCtx.getConfiguration().getProxyService((String)synCtx.getProperty(""proxy.name"")).getTargetInLineOutSequence().mediate(synCtx);
/*     */       } else {
/*     */         
/* 165 */         if (log.isDebugEnabled()) {
/* 166 */           log.debug(""Proxy service "" + synCtx.getProperty(""proxy.name"") + "" does not specifies an out-sequence - sending the response back"");
/*     */         }
/*     */         
/* 169 */         Axis2Sender.sendBack(synCtx);
/*     */       } 
/*     */     } else {
/*     */       
/* 173 */       if (log.isDebugEnabled()) {
/* 174 */         log.debug(""Using Main Sequence for injected message"");
/*     */       }
/* 176 */       return synCtx.getMainSequence().mediate(synCtx);
/*     */     } 
/* 178 */     return true;
/*     */   }
/*     */   
/*     */   public void injectAsync(MessageContext synCtx, SequenceMediator seq) {
/* 182 */     if (log.isDebugEnabled()) {
/* 183 */       log.debug(""Injecting MessageContext for asynchronous mediation using the : "" + ((seq.getName() == null) ? ""Anonymous"" : seq.getName()) + "" Sequence"");
/*     */     }
/*     */     
/* 186 */     synCtx.setEnvironment(this);
/*     */     
/* 188 */     if (synCtx.isResponse()) {
/*     */       
/* 190 */       StatisticsUtils.processEndPointStatistics(synCtx);
/* 191 */       StatisticsUtils.processProxyServiceStatistics(synCtx);
/* 192 */       StatisticsUtils.processSequenceStatistics(synCtx);
/*     */     } 
/*     */     
/* 195 */     this.executorService.execute((Runnable)new MediatorWorker((Mediator)seq, synCtx));
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public void send(EndpointDefinition endpoint, MessageContext synCtx) {
/* 208 */     if (synCtx.isResponse()) {
/*     */       
/* 210 */       if (endpoint != null) {
/*     */         
/* 212 */         StatisticsUtils.processEndPointStatistics(synCtx);
/* 213 */         StatisticsUtils.processProxyServiceStatistics(synCtx);
/* 214 */         StatisticsUtils.processAllSequenceStatistics(synCtx);
/*     */         
/* 216 */         Axis2Sender.sendOn(endpoint, synCtx);
/*     */       } else {
/*     */         
/* 219 */         Axis2Sender.sendBack(synCtx);
/*     */       } 
/*     */     } else {
/* 222 */       Axis2Sender.sendOn(endpoint, synCtx);
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public MessageContext createMessageContext() {
/* 238 */     if (log.isDebugEnabled()) {
/* 239 */       log.debug(""Creating Message Context"");
/*     */     }
/*     */     
/* 242 */     MessageContext axis2MC = new MessageContext();
/*     */     
/* 244 */     axis2MC.setConfigurationContext(this.configContext);
/*     */     
/* 246 */     ServiceContext svcCtx = new ServiceContext();
/* 247 */     OperationContext opCtx = new OperationContext((AxisOperation)new InOutAxisOperation(), svcCtx);
/* 248 */     axis2MC.setServiceContext(svcCtx);
/* 249 */     axis2MC.setOperationContext(opCtx);
/* 250 */     MessageContext mc = new Axis2MessageContext(axis2MC, this.synapseConfig, this);
/* 251 */     mc.setMessageID(UUIDGenerator.getUUID());
/*     */     try {
/* 253 */       mc.setEnvelope(OMAbstractFactory.getSOAP12Factory().createSOAPEnvelope());
/* 254 */       mc.getEnvelope().addChild((OMNode)OMAbstractFactory.getSOAP12Factory().createSOAPBody());
/* 255 */     } catch (Exception e) {
/* 256 */       handleException(""Unable to attach the SOAP envelope to the created new message context"", e);
/*     */     } 
/*     */ 
/*     */     
/* 260 */     return mc;
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public TemporaryData createTemporaryData() {
/* 273 */     String chkSize = this.synapseConfig.getProperty(""synapse.temp_data.chunk.size"");
/* 274 */     String chukNumber = this.synapseConfig.getProperty(""synapse.temp_data.chunk.threshold"");
/* 275 */     int numberOfChunks = 8;
/* 276 */     int chunkSize = 1024;
/*     */     
/* 278 */     if (chkSize != null) {
/* 279 */       chunkSize = Integer.parseInt(chkSize);
/*     */     }
/*     */     
/* 282 */     if (chukNumber != null) {
/* 283 */       numberOfChunks = Integer.parseInt(chukNumber);
/*     */     }
/*     */     
/* 286 */     String tempPrefix = this.synapseConfig.getProperty(""synapse.tempfile.prefix"", ""tmp_"");
/*     */     
/* 288 */     String tempSuffix = this.synapseConfig.getProperty(""synapse.tempfile.sufix"", "".dat"");
/*     */ 
/*     */     
/* 291 */     return new TemporaryData(numberOfChunks, chunkSize, tempPrefix, tempSuffix);
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 300 */   public StatisticsCollector getStatisticsCollector() { return this.statisticsCollector; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 309 */   public void setStatisticsCollector(StatisticsCollector collector) { this.statisticsCollector = collector; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 319 */   public ExecutorService getExecutorService() { return this.executorService; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 327 */   public boolean isInitialized() { return this.initialized; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 335 */   public void setInitialized(boolean state) { this.initialized = state; }
/*     */ 
/*     */   
/*     */   private void handleException(String message, Throwable e) {
/* 339 */     log.error(message, e);
/* 340 */     throw new SynapseException(message, e);
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\core\axis2\Axis2SynapseEnvironment.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.core.axis2.CustomURIResolver,"/*    */ package org.apache.synapse.core.axis2;
/*    */ 
/*    */ import org.apache.synapse.config.SynapseConfigUtils;
/*    */ import org.apache.synapse.config.SynapseConfiguration;
/*    */ import org.apache.ws.commons.schema.resolver.URIResolver;
/*    */ import org.xml.sax.InputSource;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class CustomURIResolver
/*    */   implements URIResolver
/*    */ {
/*    */   private ResourceMap resourceMap;
/*    */   private SynapseConfiguration synCfg;
/*    */   
/*    */   public CustomURIResolver() {}
/*    */   
/*    */   public CustomURIResolver(ResourceMap resourceMap, SynapseConfiguration synCfg) {
/* 45 */     this();
/* 46 */     this.resourceMap = resourceMap;
/* 47 */     this.synCfg = synCfg;
/*    */   }
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */   
/*    */   public InputSource resolveEntity(String targetNamespace, String schemaLocation, String baseUri) {
/* 59 */     InputSource result = null;
/* 60 */     if (this.resourceMap != null) {
/* 61 */       result = this.resourceMap.resolve(this.synCfg, schemaLocation);
/*    */     }
/* 63 */     if (result == null) {
/* 64 */       result = new InputSource(SynapseConfigUtils.resolveRelativeURI(baseUri, schemaLocation));
/*    */     }
/* 66 */     return result;
/*    */   }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\core\axis2\CustomURIResolver.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.core.axis2.CustomWSDLLocator,"/*    */ package org.apache.synapse.core.axis2;
/*    */ 
/*    */ import javax.wsdl.xml.WSDLLocator;
/*    */ import org.apache.synapse.config.SynapseConfigUtils;
/*    */ import org.apache.synapse.config.SynapseConfiguration;
/*    */ import org.xml.sax.InputSource;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class CustomWSDLLocator
/*    */   implements WSDLLocator
/*    */ {
/*    */   private final InputSource baseInputSource;
/*    */   private final String baseURI;
/*    */   private ResourceMap resourceMap;
/*    */   private SynapseConfiguration synCfg;
/*    */   private String latestImportURI;
/*    */   
/*    */   public CustomWSDLLocator(InputSource baseInputSource, String baseURI) {
/* 41 */     this.baseInputSource = baseInputSource;
/* 42 */     this.baseURI = baseURI;
/*    */   }
/*    */ 
/*    */ 
/*    */ 
/*    */   
/*    */   public CustomWSDLLocator(InputSource baseInputSource, String baseURI, ResourceMap resourceMap, SynapseConfiguration synCfg) {
/* 49 */     this(baseInputSource, baseURI);
/* 50 */     this.resourceMap = resourceMap;
/* 51 */     this.synCfg = synCfg;
/*    */   }
/*    */ 
/*    */   
/* 55 */   public InputSource getBaseInputSource() { return this.baseInputSource; }
/*    */ 
/*    */ 
/*    */   
/* 59 */   public String getBaseURI() { return this.baseURI; }
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */   
/*    */   public InputSource getImportInputSource(String parentLocation, String relativeLocation) {
/* 71 */     InputSource result = null;
/* 72 */     if (this.resourceMap != null) {
/* 73 */       result = this.resourceMap.resolve(this.synCfg, relativeLocation);
/*    */     }
/* 75 */     if (result == null) {
/* 76 */       result = new InputSource(SynapseConfigUtils.resolveRelativeURI(parentLocation, relativeLocation));
/*    */     }
/* 78 */     this.latestImportURI = relativeLocation;
/* 79 */     return result;
/*    */   }
/*    */ 
/*    */   
/* 83 */   public String getLatestImportURI() { return this.latestImportURI; }
/*    */   
/*    */   public void close() {}
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\core\axis2\CustomWSDLLocator.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.core.axis2.DynamicAxisOperation,"/*     */ package org.apache.synapse.core.axis2;
/*     */ 
/*     */ import javax.xml.namespace.QName;
/*     */ import org.apache.axiom.soap.SOAPEnvelope;
/*     */ import org.apache.axis2.AxisFault;
/*     */ import org.apache.axis2.addressing.EndpointReference;
/*     */ import org.apache.axis2.client.OperationClient;
/*     */ import org.apache.axis2.client.Options;
/*     */ import org.apache.axis2.client.async.Callback;
/*     */ import org.apache.axis2.context.ConfigurationContext;
/*     */ import org.apache.axis2.context.MessageContext;
/*     */ import org.apache.axis2.context.ServiceContext;
/*     */ import org.apache.axis2.description.AxisOperation;
/*     */ import org.apache.axis2.description.ClientUtils;
/*     */ import org.apache.axis2.description.OutInAxisOperation;
/*     */ import org.apache.axis2.description.TransportOutDescription;
/*     */ import org.apache.axis2.engine.AxisEngine;
/*     */ import org.apache.axis2.i18n.Messages;
/*     */ import org.apache.axis2.transport.TransportUtils;
/*     */ import org.apache.axis2.util.TargetResolver;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class DynamicAxisOperation
/*     */   extends OutInAxisOperation
/*     */ {
/*     */   public DynamicAxisOperation() {}
/*     */   
/*  55 */   public DynamicAxisOperation(QName name) { super(name); }
/*     */ 
/*     */ 
/*     */   
/*  59 */   public OperationClient createClient(ServiceContext sc, Options options) { return new DynamicOperationClient(this, sc, options); }
/*     */ 
/*     */   
/*     */   class DynamicOperationClient
/*     */     extends OperationClient
/*     */   {
/*  65 */     DynamicOperationClient(OutInAxisOperation axisOp, ServiceContext sc, Options options) { super((AxisOperation)axisOp, sc, options); }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */     
/*     */     public void addMessageContext(MessageContext mc) throws AxisFault {
/*  72 */       mc.setServiceContext(this.sc);
/*  73 */       if (mc.getMessageID() == null) {
/*  74 */         setMessageID(mc);
/*     */       }
/*  76 */       this.axisOp.registerOperationContext(mc, this.oc);
/*     */     }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */     
/*  83 */     public MessageContext getMessageContext(String messageLabel) throws AxisFault { return this.oc.getMessageContext(messageLabel); }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */     
/*  90 */     public void setCallback(Callback callback) { this.callback = callback; }
/*     */ 
/*     */ 
/*     */ 
/*     */     
/*     */     public void executeImpl(boolean block) throws AxisFault {
/*  96 */       if (this.completed) {
/*  97 */         throw new AxisFault(Messages.getMessage(""mepiscomplted""));
/*     */       }
/*     */ 
/*     */       
/* 101 */       MessageContext outMsgCtx = this.oc.getMessageContext(""Out"");
/* 102 */       if (outMsgCtx == null) {
/* 103 */         throw new AxisFault(Messages.getMessage(""outmsgctxnull""));
/*     */       }
/*     */       
/* 106 */       ConfigurationContext cfgCtx = this.sc.getConfigurationContext();
/*     */ 
/*     */       
/* 109 */       outMsgCtx.setOptions(this.options);
/*     */ 
/*     */       
/* 112 */       TargetResolver tr = cfgCtx.getAxisConfiguration().getTargetResolverChain();
/* 113 */       if (tr != null) {
/* 114 */         tr.resolveTarget(outMsgCtx);
/*     */       }
/*     */ 
/*     */       
/* 118 */       TransportOutDescription transportOut = this.options.getTransportOut();
/* 119 */       if (transportOut == null) {
/* 120 */         EndpointReference toEPR = (this.options.getTo() != null) ? this.options.getTo() : outMsgCtx.getTo();
/*     */         
/* 122 */         transportOut = ClientUtils.inferOutTransport(cfgCtx.getAxisConfiguration(), toEPR, outMsgCtx);
/*     */       } 
/*     */       
/* 125 */       outMsgCtx.setTransportOut(transportOut);
/*     */       
/* 127 */       if (this.options.getTransportIn() == null && outMsgCtx.getTransportIn() == null) {
/* 128 */         outMsgCtx.setTransportIn(ClientUtils.inferInTransport(cfgCtx.getAxisConfiguration(), this.options, outMsgCtx));
/*     */       }
/* 130 */       else if (outMsgCtx.getTransportIn() == null) {
/* 131 */         outMsgCtx.setTransportIn(this.options.getTransportIn());
/*     */       } 
/*     */ 
/*     */       
/* 135 */       addReferenceParameters(outMsgCtx);
/*     */       
/* 137 */       if (this.options.isUseSeparateListener()) {
/*     */         
/* 139 */         this.options.setTransportIn(outMsgCtx.getConfigurationContext().getAxisConfiguration().getTransportIn(""http""));
/*     */ 
/*     */         
/* 142 */         SynapseCallbackReceiver callbackReceiver = (SynapseCallbackReceiver)this.axisOp.getMessageReceiver();
/*     */ 
/*     */         
/* 145 */         ((Axis2MessageContext)((AsyncCallback)this.axisCallback).getSynapseOutMsgCtx()).getAxis2MessageContext().setProperty(""IGNORE_SC_ACCEPTED"", ""true"");
/*     */ 
/*     */         
/* 148 */         callbackReceiver.addCallback(outMsgCtx.getMessageID(), this.axisCallback);
/*     */         
/* 150 */         EndpointReference replyToFromTransport = outMsgCtx.getConfigurationContext().getListenerManager().getEPRforService(this.sc.getAxisService().getName(), this.axisOp.getName().getLocalPart(), outMsgCtx.getTransportOut().getName());
/*     */ 
/*     */ 
/*     */         
/* 154 */         if (outMsgCtx.getReplyTo() == null) {
/* 155 */           outMsgCtx.setReplyTo(replyToFromTransport);
/*     */         } else {
/* 157 */           outMsgCtx.getReplyTo().setAddress(replyToFromTransport.getAddress());
/*     */         } 
/*     */         
/* 160 */         outMsgCtx.getConfigurationContext().registerOperationContext(outMsgCtx.getMessageID(), this.oc);
/*     */ 
/*     */         
/* 163 */         AxisEngine.send(outMsgCtx);
/*     */ 
/*     */ 
/*     */         
/* 167 */         this.options.setAction("""");
/*     */       }
/*     */       else {
/*     */         
/* 171 */         SynapseCallbackReceiver callbackReceiver = (SynapseCallbackReceiver)this.axisOp.getMessageReceiver();
/*     */         
/* 173 */         callbackReceiver.addCallback(outMsgCtx.getMessageID(), this.axisCallback);
/* 174 */         send(outMsgCtx);
/*     */       } 
/*     */     }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */     
/*     */     private void send(MessageContext msgctx) throws AxisFault {
/* 183 */       MessageContext responseMessageContext = new MessageContext();
/* 184 */       responseMessageContext.setMessageID(msgctx.getMessageID());
/* 185 */       responseMessageContext.setProperty(""synapse.RelatesToForPox"", msgctx.getMessageID());
/*     */       
/* 187 */       responseMessageContext.setOptions(this.options);
/* 188 */       addMessageContext(responseMessageContext);
/*     */       
/* 190 */       AxisEngine.send(msgctx);
/*     */ 
/*     */ 
/*     */       
/* 194 */       if (msgctx.getProperty(""TRANSPORT_IN"") != null) {
/*     */         
/* 196 */         responseMessageContext.setOperationContext(msgctx.getOperationContext());
/* 197 */         responseMessageContext.setAxisMessage(msgctx.getOperationContext().getAxisOperation().getMessage(""In""));
/*     */ 
/*     */         
/* 200 */         responseMessageContext.setAxisService(msgctx.getAxisService());
/*     */ 
/*     */         
/* 203 */         responseMessageContext.setServerSide(true);
/* 204 */         responseMessageContext.setProperty(""TRANSPORT_OUT"", msgctx.getProperty(""TRANSPORT_OUT""));
/*     */         
/* 206 */         responseMessageContext.setProperty(""OutTransportInfo"", msgctx.getProperty(""OutTransportInfo""));
/*     */ 
/*     */         
/* 209 */         responseMessageContext.setProperty(""synapse.isresponse"", Boolean.TRUE);
/*     */         
/* 211 */         responseMessageContext.setTransportIn(msgctx.getTransportIn());
/* 212 */         responseMessageContext.setTransportOut(msgctx.getTransportOut());
/*     */ 
/*     */         
/* 215 */         responseMessageContext.setDoingREST(msgctx.isDoingREST());
/*     */         
/* 217 */         responseMessageContext.setProperty(""TRANSPORT_IN"", msgctx.getProperty(""TRANSPORT_IN""));
/*     */         
/* 219 */         responseMessageContext.setTransportIn(msgctx.getTransportIn());
/* 220 */         responseMessageContext.setTransportOut(msgctx.getTransportOut());
/*     */ 
/*     */ 
/*     */         
/* 224 */         responseMessageContext.setSoapAction("""");
/*     */         
/* 226 */         if (responseMessageContext.getEnvelope() == null) {
/*     */ 
/*     */ 
/*     */           
/* 230 */           SOAPEnvelope resenvelope = TransportUtils.createSOAPMessage(responseMessageContext);
/*     */ 
/*     */           
/* 233 */           if (resenvelope != null) {
/* 234 */             responseMessageContext.setEnvelope(resenvelope);
/* 235 */             AxisEngine.receive(responseMessageContext);
/* 236 */             if (responseMessageContext.getReplyTo() != null) {
/* 237 */               this.sc.setTargetEPR(responseMessageContext.getReplyTo());
/*     */             }
/*     */           } else {
/* 240 */             throw new AxisFault(Messages.getMessage(""blockingInvocationExpectsResponse""));
/*     */           } 
/*     */         } 
/*     */       } 
/*     */     }
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\core\axis2\DynamicAxisOperation.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.core.axis2.MediatorDeployer,"/*     */ package org.apache.synapse.core.axis2;
/*     */ 
/*     */ import java.io.IOException;
/*     */ import java.io.InputStream;
/*     */ import java.io.InputStreamReader;
/*     */ import java.net.URL;
/*     */ import org.apache.axis2.context.ConfigurationContext;
/*     */ import org.apache.axis2.deployment.Deployer;
/*     */ import org.apache.axis2.deployment.DeploymentClassLoader;
/*     */ import org.apache.axis2.deployment.DeploymentException;
/*     */ import org.apache.axis2.deployment.repository.util.DeploymentFileData;
/*     */ import org.apache.commons.logging.Log;
/*     */ import org.apache.commons.logging.LogFactory;
/*     */ import org.apache.synapse.config.xml.MediatorFactory;
/*     */ import org.apache.synapse.config.xml.MediatorFactoryFinder;
/*     */ import org.apache.synapse.config.xml.MediatorSerializer;
/*     */ import org.apache.synapse.config.xml.MediatorSerializerFinder;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class MediatorDeployer
/*     */   implements Deployer
/*     */ {
/*  48 */   private static final Log log = LogFactory.getLog(MediatorDeployer.class);
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  53 */   private ConfigurationContext cfgCtx = null;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  62 */   public void init(ConfigurationContext configurationContext) { this.cfgCtx = configurationContext; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public void deploy(DeploymentFileData deploymentFileData) throws DeploymentException {
/*  75 */     log.info(""Loading mediator from: "" + deploymentFileData.getAbsolutePath());
/*     */ 
/*     */     
/*  78 */     ClassLoader prevCl = Thread.currentThread().getContextClassLoader();
/*     */ 
/*     */     
/*     */     try {
/*  82 */       DeploymentClassLoader urlCl = new DeploymentClassLoader(new URL[] { deploymentFileData.getFile().toURL() }, null, prevCl);
/*     */       
/*  84 */       Thread.currentThread().setContextClassLoader((ClassLoader)urlCl);
/*     */ 
/*     */       
/*  87 */       URL facURL = urlCl.findResource(""META-INF/services/org.apache.synapse.config.xml.MediatorFactory"");
/*     */       
/*  89 */       if (facURL != null) {
/*  90 */         InputStream facStream = facURL.openStream();
/*  91 */         InputStreamReader facreader = new InputStreamReader(facStream);
/*     */         
/*  93 */         StringBuffer facSB = new StringBuffer();
/*     */         int c;
/*  95 */         while ((c = facreader.read()) != -1) {
/*  96 */           facSB.append((char)c);
/*     */         }
/*     */         
/*  99 */         String[] facClassNames = facSB.toString().split(""\n"");
/* 100 */         for (String facClassName : facClassNames) {
/* 101 */           log.info(""Registering the Mediator factory: "" + facClassName);
/* 102 */           Class<MediatorFactory> facClass = urlCl.loadClass(facClassName);
/* 103 */           MediatorFactory facInst = facClass.newInstance();
/* 104 */           MediatorFactoryFinder.getInstance().getFactoryMap().put(facInst.getTagQName(), facClass);
/*     */           
/* 106 */           log.info(""Mediator loaded and registered for the tag name: "" + facInst.getTagQName());
/*     */         } 
/*     */       } else {
/*     */         
/* 110 */         handleException(""Unable to find the MediatorFactory implementation. Unable to register the MediatorFactory with the FactoryFinder"");
/*     */       } 
/*     */ 
/*     */ 
/*     */       
/* 115 */       URL serURL = urlCl.findResource(""META-INF/services/org.apache.synapse.config.xml.MediatorSerializer"");
/*     */       
/* 117 */       if (serURL != null) {
/* 118 */         InputStream serStream = serURL.openStream();
/* 119 */         InputStreamReader serReader = new InputStreamReader(serStream);
/*     */         
/* 121 */         StringBuffer serSB = new StringBuffer();
/*     */         int c;
/* 123 */         while ((c = serReader.read()) != -1) {
/* 124 */           serSB.append((char)c);
/*     */         }
/*     */         
/* 127 */         String[] serClassNames = serSB.toString().split(""\n"");
/* 128 */         for (String serClassName : serClassNames) {
/* 129 */           log.info(""Registering the Mediator serializer: "" + serClassName);
/* 130 */           Class<MediatorSerializer> serClass = urlCl.loadClass(serClassName);
/* 131 */           MediatorSerializer serInst = serClass.newInstance();
/* 132 */           MediatorSerializerFinder.getInstance().getSerializerMap().put(serInst.getMediatorClassName(), serInst);
/*     */           
/* 134 */           log.info(""Mediator loaded and registered for the serialization as: "" + serInst.getMediatorClassName());
/*     */         }
/*     */       
/*     */       }
/* 138 */       else if (log.isDebugEnabled()) {
/* 139 */         log.debug(""Unable to find the MediatorSerializer implementation. Unable to register the MediatorSerializer with the SerializerFinder"");
/*     */       
/*     */       }
/*     */     
/*     */     }
/* 144 */     catch (IOException e) {
/* 145 */       handleException(""I/O error in reading the mediator jar file"", e);
/* 146 */     } catch (ClassNotFoundException e) {
/* 147 */       handleException(""Unable to find the specified class on the path or in the jar file"", e);
/* 148 */     } catch (IllegalAccessException e) {
/* 149 */       handleException(""Unable to load the class from the jar"", e);
/* 150 */     } catch (InstantiationException e) {
/* 151 */       handleException(""Unable to instantiate the class specified"", e);
/*     */     } finally {
/*     */       
/* 154 */       if (log.isDebugEnabled()) {
/* 155 */         log.debug(""Restoring the context class loader to the original"");
/*     */       }
/* 157 */       Thread.currentThread().setContextClassLoader(prevCl);
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public void setDirectory(String string) {}
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public void setExtension(String string) {}
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public void unDeploy(String string) throws DeploymentException {}
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   private void handleException(String message, Exception e) throws DeploymentException {
/* 190 */     if (log.isDebugEnabled()) {
/* 191 */       log.debug(message, e);
/*     */     }
/* 193 */     throw new DeploymentException(message, e);
/*     */   }
/*     */   
/*     */   private void handleException(String message) throws DeploymentException {
/* 197 */     if (log.isDebugEnabled()) {
/* 198 */       log.debug(message);
/*     */     }
/* 200 */     throw new DeploymentException(message);
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\core\axis2\MediatorDeployer.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.core.axis2.MessageContextCreatorForAxis2,"/*    */ package org.apache.synapse.core.axis2;
/*    */ 
/*    */ import org.apache.axis2.AxisFault;
/*    */ import org.apache.axis2.context.MessageContext;
/*    */ import org.apache.commons.logging.Log;
/*    */ import org.apache.commons.logging.LogFactory;
/*    */ import org.apache.synapse.MessageContext;
/*    */ import org.apache.synapse.SynapseException;
/*    */ import org.apache.synapse.config.SynapseConfiguration;
/*    */ import org.apache.synapse.core.SynapseEnvironment;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class MessageContextCreatorForAxis2
/*    */ {
/* 37 */   private static final Log log = LogFactory.getLog(MessageContextCreatorForAxis2.class);
/*    */   
/* 39 */   private static SynapseConfiguration synCfg = null;
/* 40 */   private static SynapseEnvironment synEnv = null;
/*    */ 
/*    */ 
/*    */   
/*    */   public static MessageContext getSynapseMessageContext(MessageContext axisMsgCtx) throws AxisFault {
/* 45 */     if (synCfg == null || synEnv == null) {
/* 46 */       String msg = ""Synapse environment has not initialized properly.."";
/* 47 */       log.fatal(msg);
/* 48 */       throw new SynapseException(msg);
/*    */     } 
/*    */     
/* 51 */     return new Axis2MessageContext(axisMsgCtx, synCfg, synEnv);
/*    */   }
/*    */ 
/*    */   
/* 55 */   public static void setSynConfig(SynapseConfiguration synCfg) { MessageContextCreatorForAxis2.synCfg = synCfg; }
/*    */ 
/*    */ 
/*    */   
/* 59 */   public static void setSynEnv(SynapseEnvironment synEnv) { MessageContextCreatorForAxis2.synEnv = synEnv; }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\core\axis2\MessageContextCreatorForAxis2.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.core.axis2.ProxyService,"/*     */ package org.apache.synapse.core.axis2;
/*     */ 
/*     */ import java.io.ByteArrayInputStream;
/*     */ import java.io.ByteArrayOutputStream;
/*     */ import java.io.IOException;
/*     */ import java.io.InputStream;
/*     */ import java.net.MalformedURLException;
/*     */ import java.net.URI;
/*     */ import java.net.URL;
/*     */ import java.util.ArrayList;
/*     */ import java.util.HashMap;
/*     */ import java.util.Iterator;
/*     */ import java.util.List;
/*     */ import java.util.Map;
/*     */ import javax.xml.namespace.QName;
/*     */ import javax.xml.stream.XMLStreamException;
/*     */ import org.apache.axiom.om.OMElement;
/*     */ import org.apache.axiom.om.OMNamespace;
/*     */ import org.apache.axiom.om.OMNode;
/*     */ import org.apache.axis2.AxisFault;
/*     */ import org.apache.axis2.description.AxisDescription;
/*     */ import org.apache.axis2.description.AxisMessage;
/*     */ import org.apache.axis2.description.AxisOperation;
/*     */ import org.apache.axis2.description.AxisService;
/*     */ import org.apache.axis2.description.InOutAxisOperation;
/*     */ import org.apache.axis2.description.Parameter;
/*     */ import org.apache.axis2.description.WSDL11ToAxisServiceBuilder;
/*     */ import org.apache.axis2.description.WSDL20ToAxisServiceBuilder;
/*     */ import org.apache.axis2.engine.AxisConfiguration;
/*     */ import org.apache.commons.logging.Log;
/*     */ import org.apache.commons.logging.LogFactory;
/*     */ import org.apache.neethi.Policy;
/*     */ import org.apache.neethi.PolicyEngine;
/*     */ import org.apache.synapse.ServerManager;
/*     */ import org.apache.synapse.SynapseException;
/*     */ import org.apache.synapse.config.SynapseConfigUtils;
/*     */ import org.apache.synapse.config.SynapseConfiguration;
/*     */ import org.apache.synapse.core.SynapseEnvironment;
/*     */ import org.apache.synapse.endpoints.Endpoint;
/*     */ import org.apache.synapse.mediators.base.SequenceMediator;
/*     */ import org.apache.synapse.util.PolicyInfo;
/*     */ import org.xml.sax.InputSource;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class ProxyService
/*     */ {
/*  81 */   private static final Log log = LogFactory.getLog(ProxyService.class);
/*  82 */   private static final Log trace = LogFactory.getLog(""TRACE_LOGGER"");
/*     */ 
/*     */ 
/*     */   
/*     */   private final Log serviceLog;
/*     */ 
/*     */ 
/*     */   
/*     */   private String name;
/*     */ 
/*     */   
/*     */   private String description;
/*     */ 
/*     */   
/*     */   private ArrayList transports;
/*     */ 
/*     */   
/*  99 */   private List pinnedServers = new ArrayList();
/*     */ 
/*     */ 
/*     */   
/* 103 */   private String targetEndpoint = null;
/*     */ 
/*     */ 
/*     */   
/* 107 */   private String targetInSequence = null;
/*     */ 
/*     */ 
/*     */   
/* 111 */   private String targetOutSequence = null;
/*     */ 
/*     */ 
/*     */   
/* 115 */   private String targetFaultSequence = null;
/*     */ 
/*     */ 
/*     */   
/* 119 */   private Endpoint targetInLineEndpoint = null;
/*     */ 
/*     */ 
/*     */   
/* 123 */   private SequenceMediator targetInLineInSequence = null;
/*     */ 
/*     */ 
/*     */   
/* 127 */   private SequenceMediator targetInLineOutSequence = null;
/*     */ 
/*     */ 
/*     */   
/* 131 */   private SequenceMediator targetInLineFaultSequence = null;
/*     */ 
/*     */ 
/*     */   
/* 135 */   private Map<String, Object> parameters = new HashMap<String, Object>();
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   private String wsdlKey;
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   private URI wsdlURI;
/*     */ 
/*     */ 
/*     */   
/*     */   private Object inLineWSDL;
/*     */ 
/*     */ 
/*     */   
/*     */   private ResourceMap resourceMap;
/*     */ 
/*     */ 
/*     */   
/* 157 */   private List<PolicyInfo> policies = new ArrayList<PolicyInfo>();
/*     */ 
/*     */ 
/*     */   
/* 161 */   private List<String> serviceLevelPolicies = new ArrayList<String>();
/*     */ 
/*     */ 
/*     */   
/* 165 */   private List<String> inMessagePolicies = new ArrayList<String>();
/*     */ 
/*     */ 
/*     */   
/* 169 */   private List<String> outMessagePolicies = new ArrayList<String>();
/*     */ 
/*     */ 
/*     */   
/*     */   private boolean wsRMEnabled = false;
/*     */ 
/*     */ 
/*     */   
/*     */   private boolean wsSecEnabled = false;
/*     */ 
/*     */ 
/*     */   
/*     */   private boolean startOnLoad = true;
/*     */ 
/*     */ 
/*     */   
/*     */   private boolean running = false;
/*     */ 
/*     */ 
/*     */   
/*     */   public static final String ALL_TRANSPORTS = ""all"";
/*     */ 
/*     */   
/* 192 */   private int statisticsState = 2;
/*     */ 
/*     */ 
/*     */   
/* 196 */   protected int traceState = 2;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public ProxyService(String name) {
/* 205 */     this.name = name;
/* 206 */     this.serviceLog = LogFactory.getLog(""SERVICE_LOGGER."" + name);
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public AxisService buildAxisService(SynapseConfiguration synCfg, AxisConfiguration axisCfg) {
/* 218 */     auditInfo(""Building Axis service for Proxy service : "" + this.name);
/* 219 */     AxisService proxyService = null;
/*     */ 
/*     */     
/* 222 */     if (trace()) {
/* 223 */       trace.info(""Loading the WSDL : "" + ((this.wsdlKey != null) ? ("" key = "" + this.wsdlKey) : ((this.wsdlURI != null) ? ("" URI = "" + this.wsdlURI) : "" <Inlined>"")));
/*     */     }
/*     */ 
/*     */ 
/*     */     
/* 228 */     InputStream wsdlInputStream = null;
/* 229 */     OMElement wsdlElement = null;
/* 230 */     boolean wsdlFound = false;
/*     */     
/* 232 */     if (this.wsdlKey != null) {
/* 233 */       synCfg.getEntryDefinition(this.wsdlKey);
/* 234 */       Object keyObject = synCfg.getEntry(this.wsdlKey);
/* 235 */       if (keyObject instanceof OMElement) {
/* 236 */         wsdlElement = (OMElement)keyObject;
/*     */       }
/* 238 */       wsdlFound = true;
/* 239 */     } else if (this.inLineWSDL != null) {
/* 240 */       wsdlElement = (OMElement)this.inLineWSDL;
/* 241 */       wsdlFound = true;
/* 242 */     } else if (this.wsdlURI != null) {
/*     */       try {
/* 244 */         URL url = this.wsdlURI.toURL();
/* 245 */         OMNode node = SynapseConfigUtils.getOMElementFromURL(url.toString());
/* 246 */         if (node instanceof OMElement) {
/* 247 */           wsdlElement = (OMElement)node;
/*     */         }
/* 249 */         wsdlFound = true;
/* 250 */       } catch (MalformedURLException e) {
/* 251 */         handleException(""Malformed URI for wsdl"", e);
/* 252 */       } catch (IOException e) {
/* 253 */         handleException(""Error reading from wsdl URI"", e);
/*     */       }
/*     */     
/*     */     } else {
/*     */       
/* 258 */       if (trace()) trace.info(""Did not find a WSDL. Assuming a POX or Legacy service""); 
/* 259 */       proxyService = new AxisService();
/* 260 */       InOutAxisOperation inOutAxisOperation = new InOutAxisOperation(new QName(""mediate""));
/* 261 */       proxyService.addOperation((AxisOperation)inOutAxisOperation);
/*     */     } 
/*     */ 
/*     */     
/* 265 */     if (wsdlElement != null) {
/* 266 */       OMNamespace wsdlNamespace = wsdlElement.getNamespace();
/*     */ 
/*     */       
/* 269 */       ByteArrayOutputStream baos = new ByteArrayOutputStream();
/*     */       try {
/* 271 */         if (trace()) trace.info(""Serializing wsdlElement found to build an Axis2 service""); 
/* 272 */         wsdlElement.serialize(baos);
/* 273 */         wsdlInputStream = new ByteArrayInputStream(baos.toByteArray());
/* 274 */       } catch (XMLStreamException e) {
/* 275 */         handleException(""Error converting to a StreamSource"", e);
/*     */       } 
/*     */       
/* 278 */       if (wsdlInputStream != null) {
/*     */         
/*     */         try {
/*     */           
/* 282 */           if (trace()) trace.info(""WSDL Namespace is : "" + wsdlNamespace.getNamespaceURI());
/*     */ 
/*     */           
/* 285 */           if (wsdlNamespace != null) {
/* 286 */             boolean isWSDL11 = false;
/* 287 */             Object object = null;
/*     */             
/* 289 */             if (""http://www.w3.org/ns/wsdl"".equals(wsdlNamespace.getNamespaceURI())) {
/*     */               
/* 291 */               WSDL20ToAxisServiceBuilder wSDL20ToAxisServiceBuilder = new WSDL20ToAxisServiceBuilder(wsdlInputStream, null, null);
/*     */             
/*     */             }
/* 294 */             else if (""http://schemas.xmlsoap.org/wsdl/"".equals(wsdlNamespace.getNamespaceURI())) {
/*     */               
/* 296 */               object = new WSDL11ToAxisServiceBuilder(wsdlInputStream);
/*     */               
/* 298 */               isWSDL11 = true;
/*     */             } else {
/* 300 */               handleException(""Unknown WSDL format.. not WSDL 1.1 or WSDL 2.0"");
/*     */             } 
/*     */             
/* 303 */             if (object == null) {
/* 304 */               throw new SynapseException(""Could not get the WSDL to Axis Service Builder"");
/*     */             }
/*     */ 
/*     */             
/* 308 */             object.setBaseUri((this.wsdlURI != null) ? this.wsdlURI.toString() : ServerManager.getInstance().getSynapseHome());
/*     */ 
/*     */ 
/*     */             
/* 312 */             if (trace()) {
/* 313 */               trace.info(""Setting up custom resolvers"");
/*     */             }
/*     */ 
/*     */             
/* 317 */             if (this.resourceMap != null) {
/*     */               
/* 319 */               object.setCustomResolver(new CustomURIResolver(this.resourceMap, synCfg));
/*     */ 
/*     */               
/* 322 */               if (object instanceof WSDL11ToAxisServiceBuilder) {
/* 323 */                 ((WSDL11ToAxisServiceBuilder)object).setCustomWSLD4JResolver(new CustomWSDLLocator(new InputSource(wsdlInputStream), (this.wsdlURI != null) ? this.wsdlURI.toString() : """", this.resourceMap, synCfg));
/*     */ 
/*     */               
/*     */               }
/*     */             
/*     */             }
/*     */             else {
/*     */ 
/*     */               
/* 332 */               object.setCustomResolver(new CustomURIResolver());
/*     */ 
/*     */               
/* 335 */               if (object instanceof WSDL11ToAxisServiceBuilder) {
/* 336 */                 ((WSDL11ToAxisServiceBuilder)object).setCustomWSLD4JResolver(new CustomWSDLLocator(new InputSource(wsdlInputStream), (this.wsdlURI != null) ? this.wsdlURI.toString() : """"));
/*     */               }
/*     */             } 
/*     */ 
/*     */ 
/*     */ 
/*     */             
/* 343 */             if (trace()) {
/* 344 */               trace.info(""Populating Axis2 service using WSDL"");
/* 345 */               if (trace.isTraceEnabled()) {
/* 346 */                 trace.trace(""WSDL : "" + wsdlElement.toString());
/*     */               }
/*     */             } 
/* 349 */             proxyService = object.populateService();
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */             
/* 355 */             proxyService.getEndpoints().clear();
/*     */           } else {
/*     */             
/* 358 */             handleException(""Unknown WSDL format.. not WSDL 1.1 or WSDL 2.0"");
/*     */           }
/*     */         
/* 361 */         } catch (AxisFault af) {
/* 362 */           handleException(""Error building service from WSDL"", (Exception)af);
/* 363 */         } catch (IOException ioe) {
/* 364 */           handleException(""Error reading WSDL"", ioe);
/*     */         } 
/*     */       }
/* 367 */     } else if (wsdlFound) {
/* 368 */       handleException(""Couldn't build the proxy service : "" + this.name + "". Unable to locate the specified WSDL to build the service"");
/*     */     } 
/*     */ 
/*     */ 
/*     */ 
/*     */     
/* 374 */     if (proxyService == null) {
/* 375 */       throw new SynapseException(""Could not create a proxy service"");
/*     */     }
/* 377 */     proxyService.setName(this.name);
/* 378 */     if (this.description != null) {
/* 379 */       proxyService.setDocumentation(this.description);
/*     */     }
/*     */ 
/*     */ 
/*     */ 
/*     */     
/* 385 */     if (this.transports != null && this.transports.size() != 0) {
/*     */ 
/*     */       
/* 388 */       if (trace()) trace.info(""Exposing transports : "" + this.transports); 
/* 389 */       proxyService.setExposedTransports(this.transports);
/*     */     } 
/*     */ 
/*     */     
/* 393 */     if (trace() && this.parameters.size() > 0) {
/* 394 */       trace.info(""Setting service parameters : "" + this.parameters);
/*     */     }
/* 396 */     for (String o : this.parameters.keySet()) {
/* 397 */       String name = o;
/* 398 */       Object value = this.parameters.get(name);
/*     */       
/* 400 */       Parameter p = new Parameter();
/* 401 */       p.setName(name);
/* 402 */       p.setValue(value);
/*     */       
/*     */       try {
/* 405 */         proxyService.addParameter(p);
/* 406 */       } catch (AxisFault af) {
/* 407 */         handleException(""Error setting parameter : "" + name + """" + ""to proxy service as a Parameter"", (Exception)af);
/*     */       } 
/*     */     } 
/*     */ 
/*     */     
/* 412 */     if (!this.policies.isEmpty())
/*     */     {
/* 414 */       for (PolicyInfo pi : this.policies) {
/*     */         
/* 416 */         if (pi.isServicePolicy()) {
/*     */           
/* 418 */           proxyService.getPolicyInclude().addPolicyElement(3, getPolicyFromKey(pi.getPolicyKey(), synCfg));
/*     */           
/*     */           continue;
/*     */         } 
/* 422 */         if (pi.isOperationPolicy()) {
/*     */           
/* 424 */           AxisOperation op = proxyService.getOperation(pi.getOperation());
/* 425 */           if (op != null) {
/* 426 */             op.getPolicyInclude().addPolicyElement(4, getPolicyFromKey(pi.getPolicyKey(), synCfg));
/*     */             continue;
/*     */           } 
/* 429 */           handleException(""Couldn't find the operation specified by the QName : "" + pi.getOperation());
/*     */           
/*     */           continue;
/*     */         } 
/* 433 */         if (pi.isMessagePolicy()) {
/*     */           
/* 435 */           if (pi.getOperation() != null) {
/*     */             
/* 437 */             AxisOperation op = proxyService.getOperation(pi.getOperation());
/* 438 */             if (op != null) {
/* 439 */               op.getMessage(pi.getMessageLable()).getPolicyInclude().addPolicyElement(16, getPolicyFromKey(pi.getPolicyKey(), synCfg));
/*     */               
/*     */               continue;
/*     */             } 
/* 443 */             handleException(""Couldn't find the operation specified by the QName : "" + pi.getOperation());
/*     */ 
/*     */             
/*     */             continue;
/*     */           } 
/*     */           
/* 449 */           for (Iterator itr = proxyService.getOperations(); itr.hasNext(); ) {
/* 450 */             Object obj = itr.next();
/* 451 */             if (obj instanceof AxisOperation)
/*     */             {
/* 453 */               if ((!(obj instanceof org.apache.axis2.description.OutOnlyAxisOperation) || pi.getType() != 1) && (!(obj instanceof org.apache.axis2.description.InOnlyAxisOperation) || pi.getType() != 2)) {
/*     */ 
/*     */ 
/*     */ 
/*     */                 
/* 458 */                 AxisMessage message = ((AxisOperation)obj).getMessage(pi.getMessageLable());
/*     */                 
/* 460 */                 message.getPolicyInclude().addPolicyElement(5, getPolicyFromKey(pi.getPolicyKey(), synCfg));
/*     */               } 
/*     */             }
/*     */           } 
/*     */           
/*     */           continue;
/*     */         } 
/*     */         
/* 468 */         handleException(""Undefined Policy type"");
/*     */       } 
/*     */     }
/*     */ 
/*     */ 
/*     */     
/* 474 */     ProxyServiceMessageReceiver msgRcvr = new ProxyServiceMessageReceiver();
/* 475 */     msgRcvr.setName(this.name);
/* 476 */     msgRcvr.setProxy(this);
/*     */     
/* 478 */     Iterator<AxisOperation> iter = proxyService.getOperations();
/* 479 */     while (iter.hasNext()) {
/* 480 */       AxisOperation op = iter.next();
/* 481 */       op.setMessageReceiver(msgRcvr);
/*     */     } 
/*     */     
/*     */     try {
/* 485 */       auditInfo(""Adding service "" + this.name + "" to the Axis2 configuration"");
/* 486 */       axisCfg.addService(proxyService);
/* 487 */       setRunning(true);
/* 488 */     } catch (AxisFault axisFault) {
/*     */       try {
/* 490 */         if (axisCfg.getService(proxyService.getName()) != null) {
/* 491 */           if (trace()) trace.info(""Removing service "" + this.name + "" due to error : "" + axisFault.getMessage());
/*     */           
/* 493 */           axisCfg.removeService(proxyService.getName());
/*     */         } 
/* 495 */       } catch (AxisFault ignore) {}
/* 496 */       handleException(""Error adding Proxy service to the Axis2 engine"", (Exception)axisFault);
/*     */     } 
/*     */ 
/*     */     
/* 500 */     if (this.wsRMEnabled) {
/* 501 */       auditInfo(""WS-Reliable messaging is enabled for service : "" + this.name);
/*     */       try {
/* 503 */         proxyService.engageModule(axisCfg.getModule(""Mercury""), (AxisDescription)axisCfg);
/*     */       }
/* 505 */       catch (AxisFault axisFault) {
/* 506 */         handleException(""Error loading WS RM module on proxy service : "" + this.name, (Exception)axisFault);
/*     */       } 
/*     */     } 
/*     */ 
/*     */     
/* 511 */     if (this.wsSecEnabled) {
/* 512 */       auditInfo(""WS-Security is enabled for service : "" + this.name);
/*     */       try {
/* 514 */         proxyService.engageModule(axisCfg.getModule(""rampart""), (AxisDescription)axisCfg);
/*     */       }
/* 516 */       catch (AxisFault axisFault) {
/* 517 */         handleException(""Error loading WS Sec module on proxy service : "" + this.name, (Exception)axisFault);
/*     */       } 
/*     */     } 
/*     */ 
/*     */     
/* 522 */     auditInfo(""Successfully created the Axis2 service for Proxy service : "" + this.name);
/* 523 */     return proxyService;
/*     */   }
/*     */ 
/*     */   
/*     */   private Policy getPolicyFromKey(String key, SynapseConfiguration synCfg) {
/* 528 */     synCfg.getEntryDefinition(key);
/* 529 */     return PolicyEngine.getPolicy(SynapseConfigUtils.getStreamSource(synCfg.getEntry(key)).getInputStream());
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public void start(SynapseConfiguration synCfg) {
/* 538 */     AxisConfiguration axisConfig = synCfg.getAxisConfiguration();
/* 539 */     if (axisConfig != null) {
/*     */       
/* 541 */       Parameter param = axisConfig.getParameter(""synapse.env"");
/* 542 */       if (param != null && param.getValue() instanceof SynapseEnvironment) {
/* 543 */         SynapseEnvironment env = (SynapseEnvironment)param.getValue();
/* 544 */         if (this.targetInLineInSequence != null) {
/* 545 */           this.targetInLineInSequence.init(env);
/*     */         }
/* 547 */         if (this.targetInLineOutSequence != null) {
/* 548 */           this.targetInLineOutSequence.init(env);
/*     */         }
/* 550 */         if (this.targetInLineFaultSequence != null) {
/* 551 */           this.targetInLineFaultSequence.init(env);
/*     */         }
/*     */       } else {
/* 554 */         auditWarn(""Unable to find the SynapseEnvironment. Components of the proxy service may not be initialized"");
/*     */       } 
/*     */ 
/*     */       
/* 558 */       AxisService as = axisConfig.getServiceForActivation(getName());
/* 559 */       as.setActive(true);
/* 560 */       axisConfig.notifyObservers(3, as);
/* 561 */       setRunning(true);
/* 562 */       auditInfo(""Started the proxy service : "" + this.name);
/*     */     } else {
/* 564 */       auditWarn(""Unable to start proxy service : "" + this.name + "". Couldn't access Axis configuration"");
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public void stop(SynapseConfiguration synCfg) {
/* 574 */     AxisConfiguration axisConfig = synCfg.getAxisConfiguration();
/* 575 */     if (axisConfig != null) {
/*     */       
/* 577 */       if (this.targetInLineInSequence != null) {
/* 578 */         this.targetInLineInSequence.destroy();
/*     */       }
/* 580 */       if (this.targetInLineOutSequence != null) {
/* 581 */         this.targetInLineOutSequence.destroy();
/*     */       }
/* 583 */       if (this.targetInLineFaultSequence != null) {
/* 584 */         this.targetInLineFaultSequence.destroy();
/*     */       }
/*     */       
/*     */       try {
/* 588 */         AxisService as = axisConfig.getService(getName());
/* 589 */         if (as != null) {
/* 590 */           as.setActive(false);
/* 591 */           axisConfig.notifyObservers(2, as);
/*     */         } 
/* 593 */         setRunning(false);
/* 594 */         auditInfo(""Stopped the proxy service : "" + this.name);
/* 595 */       } catch (AxisFault axisFault) {
/* 596 */         handleException(""Error stopping the proxy service : "" + this.name, (Exception)axisFault);
/*     */       } 
/*     */     } else {
/* 599 */       auditWarn(""Unable to stop proxy service : "" + this.name + "". Couldn't access Axis configuration"");
/*     */     } 
/*     */   }
/*     */ 
/*     */   
/*     */   private void handleException(String msg) {
/* 605 */     this.serviceLog.error(msg);
/* 606 */     log.error(msg);
/* 607 */     if (trace()) trace.error(msg); 
/* 608 */     throw new SynapseException(msg);
/*     */   }
/*     */   
/*     */   private void handleException(String msg, Exception e) {
/* 612 */     this.serviceLog.error(msg);
/* 613 */     log.error(msg, e);
/* 614 */     if (trace()) trace.error(msg + "" :: "" + e.getMessage()); 
/* 615 */     throw new SynapseException(msg, e);
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   private void auditInfo(String message) {
/* 623 */     log.info(message);
/* 624 */     this.serviceLog.info(message);
/* 625 */     if (trace()) {
/* 626 */       trace.info(message);
/*     */     }
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   private void auditWarn(String message) {
/* 635 */     log.warn(message);
/* 636 */     this.serviceLog.warn(message);
/* 637 */     if (trace()) {
/* 638 */       trace.warn(message);
/*     */     }
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 647 */   private boolean trace() { return (this.traceState == 1); }
/*     */ 
/*     */ 
/*     */   
/* 651 */   public String getName() { return this.name; }
/*     */ 
/*     */ 
/*     */   
/* 655 */   public String getDescription() { return this.description; }
/*     */ 
/*     */ 
/*     */   
/* 659 */   public void setDescription(String description) { this.description = description; }
/*     */ 
/*     */ 
/*     */   
/* 663 */   public ArrayList getTransports() { return this.transports; }
/*     */ 
/*     */ 
/*     */   
/* 667 */   public void addParameter(String name, Object value) { this.parameters.put(name, value); }
/*     */ 
/*     */ 
/*     */   
/* 671 */   public Map<String, Object> getParameterMap() { return this.parameters; }
/*     */ 
/*     */ 
/*     */   
/* 675 */   public void setTransports(ArrayList transports) { this.transports = transports; }
/*     */ 
/*     */ 
/*     */   
/* 679 */   public String getTargetEndpoint() { return this.targetEndpoint; }
/*     */ 
/*     */ 
/*     */   
/* 683 */   public void setTargetEndpoint(String targetEndpoint) { this.targetEndpoint = targetEndpoint; }
/*     */ 
/*     */ 
/*     */   
/* 687 */   public String getTargetInSequence() { return this.targetInSequence; }
/*     */ 
/*     */ 
/*     */   
/* 691 */   public void setTargetInSequence(String targetInSequence) { this.targetInSequence = targetInSequence; }
/*     */ 
/*     */ 
/*     */   
/* 695 */   public String getTargetOutSequence() { return this.targetOutSequence; }
/*     */ 
/*     */ 
/*     */   
/* 699 */   public void setTargetOutSequence(String targetOutSequence) { this.targetOutSequence = targetOutSequence; }
/*     */ 
/*     */ 
/*     */   
/* 703 */   public String getWSDLKey() { return this.wsdlKey; }
/*     */ 
/*     */ 
/*     */   
/* 707 */   public void setWSDLKey(String wsdlKey) { this.wsdlKey = wsdlKey; }
/*     */ 
/*     */ 
/*     */   
/* 711 */   public List<String> getServiceLevelPolicies() { return this.serviceLevelPolicies; }
/*     */ 
/*     */ 
/*     */   
/* 715 */   public void addServiceLevelPolicy(String serviceLevelPolicy) { this.serviceLevelPolicies.add(serviceLevelPolicy); }
/*     */ 
/*     */ 
/*     */   
/* 719 */   public boolean isWsRMEnabled() { return this.wsRMEnabled; }
/*     */ 
/*     */ 
/*     */   
/* 723 */   public void setWsRMEnabled(boolean wsRMEnabled) { this.wsRMEnabled = wsRMEnabled; }
/*     */ 
/*     */ 
/*     */   
/* 727 */   public boolean isWsSecEnabled() { return this.wsSecEnabled; }
/*     */ 
/*     */ 
/*     */   
/* 731 */   public void setWsSecEnabled(boolean wsSecEnabled) { this.wsSecEnabled = wsSecEnabled; }
/*     */ 
/*     */ 
/*     */   
/* 735 */   public boolean isStartOnLoad() { return this.startOnLoad; }
/*     */ 
/*     */ 
/*     */   
/* 739 */   public void setStartOnLoad(boolean startOnLoad) { this.startOnLoad = startOnLoad; }
/*     */ 
/*     */ 
/*     */   
/* 743 */   public boolean isRunning() { return this.running; }
/*     */ 
/*     */ 
/*     */   
/* 747 */   public void setRunning(boolean running) { this.running = running; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 756 */   public int getStatisticsState() { return this.statisticsState; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 765 */   public void setStatisticsState(int statisticsState) { this.statisticsState = statisticsState; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 774 */   public int getTraceState() { return this.traceState; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 783 */   public void setTraceState(int traceState) { this.traceState = traceState; }
/*     */ 
/*     */ 
/*     */   
/* 787 */   public String getTargetFaultSequence() { return this.targetFaultSequence; }
/*     */ 
/*     */ 
/*     */   
/* 791 */   public void setTargetFaultSequence(String targetFaultSequence) { this.targetFaultSequence = targetFaultSequence; }
/*     */ 
/*     */ 
/*     */   
/* 795 */   public Object getInLineWSDL() { return this.inLineWSDL; }
/*     */ 
/*     */ 
/*     */   
/* 799 */   public void setInLineWSDL(Object inLineWSDL) { this.inLineWSDL = inLineWSDL; }
/*     */ 
/*     */ 
/*     */   
/* 803 */   public URI getWsdlURI() { return this.wsdlURI; }
/*     */ 
/*     */ 
/*     */   
/* 807 */   public void setWsdlURI(URI wsdlURI) { this.wsdlURI = wsdlURI; }
/*     */ 
/*     */ 
/*     */   
/* 811 */   public Endpoint getTargetInLineEndpoint() { return this.targetInLineEndpoint; }
/*     */ 
/*     */ 
/*     */   
/* 815 */   public void setTargetInLineEndpoint(Endpoint targetInLineEndpoint) { this.targetInLineEndpoint = targetInLineEndpoint; }
/*     */ 
/*     */ 
/*     */   
/* 819 */   public SequenceMediator getTargetInLineInSequence() { return this.targetInLineInSequence; }
/*     */ 
/*     */ 
/*     */   
/* 823 */   public void setTargetInLineInSequence(SequenceMediator targetInLineInSequence) { this.targetInLineInSequence = targetInLineInSequence; }
/*     */ 
/*     */ 
/*     */   
/* 827 */   public SequenceMediator getTargetInLineOutSequence() { return this.targetInLineOutSequence; }
/*     */ 
/*     */ 
/*     */   
/* 831 */   public void setTargetInLineOutSequence(SequenceMediator targetInLineOutSequence) { this.targetInLineOutSequence = targetInLineOutSequence; }
/*     */ 
/*     */ 
/*     */   
/* 835 */   public SequenceMediator getTargetInLineFaultSequence() { return this.targetInLineFaultSequence; }
/*     */ 
/*     */ 
/*     */   
/* 839 */   public void setTargetInLineFaultSequence(SequenceMediator targetInLineFaultSequence) { this.targetInLineFaultSequence = targetInLineFaultSequence; }
/*     */ 
/*     */ 
/*     */   
/* 843 */   public List getPinnedServers() { return this.pinnedServers; }
/*     */ 
/*     */ 
/*     */   
/* 847 */   public void setPinnedServers(List pinnedServers) { this.pinnedServers = pinnedServers; }
/*     */ 
/*     */ 
/*     */   
/* 851 */   public ResourceMap getResourceMap() { return this.resourceMap; }
/*     */ 
/*     */ 
/*     */   
/* 855 */   public void setResourceMap(ResourceMap resourceMap) { this.resourceMap = resourceMap; }
/*     */ 
/*     */ 
/*     */   
/* 859 */   public List<String> getInMessagePolicies() { return this.inMessagePolicies; }
/*     */ 
/*     */ 
/*     */   
/* 863 */   public void setInMessagePolicies(List<String> inMessagePolicies) { this.inMessagePolicies = inMessagePolicies; }
/*     */ 
/*     */ 
/*     */   
/* 867 */   public void addInMessagePolicy(String messagePolicy) { this.inMessagePolicies.add(messagePolicy); }
/*     */ 
/*     */ 
/*     */   
/* 871 */   public List<String> getOutMessagePolicies() { return this.outMessagePolicies; }
/*     */ 
/*     */ 
/*     */   
/* 875 */   public void setOutMessagePolicies(List<String> outMessagePolicies) { this.outMessagePolicies = outMessagePolicies; }
/*     */ 
/*     */ 
/*     */   
/* 879 */   public void addOutMessagePolicy(String messagePolicy) { this.outMessagePolicies.add(messagePolicy); }
/*     */ 
/*     */ 
/*     */   
/* 883 */   public List<PolicyInfo> getPolicies() { return this.policies; }
/*     */ 
/*     */ 
/*     */   
/* 887 */   public void setPolicies(List<PolicyInfo> policies) { this.policies = policies; }
/*     */ 
/*     */ 
/*     */   
/* 891 */   public void addPolicyInfo(PolicyInfo pi) { this.policies.add(pi); }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\core\axis2\ProxyService.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.core.axis2.ProxyServiceMessageReceiver,"/*     */ package org.apache.synapse.core.axis2;
/*     */ 
/*     */ import org.apache.axis2.AxisFault;
/*     */ import org.apache.axis2.context.MessageContext;
/*     */ import org.apache.commons.logging.Log;
/*     */ import org.apache.commons.logging.LogFactory;
/*     */ import org.apache.synapse.FaultHandler;
/*     */ import org.apache.synapse.Mediator;
/*     */ import org.apache.synapse.MessageContext;
/*     */ import org.apache.synapse.SynapseException;
/*     */ import org.apache.synapse.endpoints.Endpoint;
/*     */ import org.apache.synapse.mediators.MediatorFaultHandler;
/*     */ import org.apache.synapse.statistics.impl.ProxyServiceStatisticsStack;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class ProxyServiceMessageReceiver
/*     */   extends SynapseMessageReceiver
/*     */ {
/*  35 */   private static final Log log = LogFactory.getLog(ProxyServiceMessageReceiver.class);
/*  36 */   private static final Log trace = LogFactory.getLog(""TRACE_LOGGER"");
/*     */ 
/*     */   
/*  39 */   private String name = null;
/*     */   
/*  41 */   private ProxyService proxy = null;
/*     */ 
/*     */   
/*     */   public void receive(MessageContext mc) throws AxisFault {
/*  45 */     boolean traceOn = (this.proxy.getTraceState() == 1);
/*  46 */     boolean traceOrDebugOn = (traceOn || log.isDebugEnabled());
/*     */     
/*  48 */     String remoteAddr = (String)mc.getProperty(""REMOTE_ADDR"");
/*     */ 
/*     */     
/*  51 */     if (traceOrDebugOn) {
/*  52 */       traceOrDebug(traceOn, ""Proxy Service "" + this.name + "" received a new message"" + ((remoteAddr != null) ? ("" from : "" + remoteAddr) : ""...""));
/*     */       
/*  54 */       traceOrDebug(traceOn, ""Message To: "" + ((mc.getTo() != null) ? mc.getTo().getAddress() : ""null""));
/*     */       
/*  56 */       traceOrDebug(traceOn, ""SOAPAction: "" + ((mc.getSoapAction() != null) ? mc.getSoapAction() : ""null""));
/*     */       
/*  58 */       traceOrDebug(traceOn, ""WSA-Action: "" + ((mc.getWSAAction() != null) ? mc.getWSAAction() : ""null""));
/*     */ 
/*     */       
/*  61 */       if (traceOn && trace.isTraceEnabled()) {
/*  62 */         String[] cids = mc.getAttachmentMap().getAllContentIDs();
/*  63 */         if (cids != null && cids.length > 0) {
/*  64 */           for (String cid : cids) {
/*  65 */             trace.trace(""With attachment content ID : "" + cid);
/*     */           }
/*     */         }
/*  68 */         trace.trace(""Envelope : "" + mc.getEnvelope());
/*     */       } 
/*     */     } 
/*     */     
/*  72 */     MessageContext synCtx = MessageContextCreatorForAxis2.getSynapseMessageContext(mc);
/*     */ 
/*     */     
/*  75 */     Log serviceLog = LogFactory.getLog(""SERVICE_LOGGER."" + this.name);
/*  76 */     ((Axis2MessageContext)synCtx).setServiceLog(serviceLog);
/*     */     
/*  78 */     synCtx.setProperty(""proxy.name"", this.name);
/*  79 */     synCtx.setTracingState(this.proxy.getTraceState());
/*     */ 
/*     */     
/*     */     try {
/*  83 */       boolean statsOn = (1 == this.proxy.getStatisticsState());
/*  84 */       if (statsOn) {
/*  85 */         ProxyServiceStatisticsStack proxyServiceStatisticsStack = new ProxyServiceStatisticsStack();
/*     */         
/*  87 */         boolean isFault = synCtx.getEnvelope().getBody().hasFault();
/*  88 */         proxyServiceStatisticsStack.put(this.name, System.currentTimeMillis(), !synCtx.isResponse(), statsOn, isFault);
/*     */         
/*  90 */         synCtx.setProperty(""synapse.proxy.stats"", proxyServiceStatisticsStack);
/*     */       } 
/*     */ 
/*     */       
/*  94 */       Mediator mandatorySeq = synCtx.getConfiguration().getMandatorySequence();
/*  95 */       if (mandatorySeq != null) {
/*  96 */         if (log.isDebugEnabled()) {
/*  97 */           log.debug(""Start mediating the message in the pre-mediate state using the mandatory sequence"");
/*     */         }
/*     */ 
/*     */         
/* 101 */         if (!mandatorySeq.mediate(synCtx)) {
/* 102 */           if (log.isDebugEnabled()) {
/* 103 */             log.debug(""Request message for the proxy service "" + this.name + "" dropped in "" + ""the pre-mediation state by the mandatory sequence : \n"" + synCtx);
/*     */           }
/*     */ 
/*     */           
/*     */           return;
/*     */         } 
/*     */       } 
/*     */       
/* 111 */       if (this.proxy.getTargetFaultSequence() != null) {
/*     */         
/* 113 */         Mediator faultSequence = synCtx.getSequence(this.proxy.getTargetFaultSequence());
/* 114 */         if (faultSequence != null) {
/* 115 */           if (traceOrDebugOn) {
/* 116 */             traceOrDebug(traceOn, ""Setting the fault-sequence to : "" + faultSequence);
/*     */           }
/*     */           
/* 119 */           synCtx.pushFaultHandler((FaultHandler)new MediatorFaultHandler(synCtx.getSequence(this.proxy.getTargetFaultSequence())));
/*     */ 
/*     */         
/*     */         }
/*     */         else {
/*     */ 
/*     */           
/* 126 */           traceOrDebug(traceOn, ""Unable to find fault-sequence : "" + this.proxy.getTargetFaultSequence() + ""; using default fault sequence"");
/*     */           
/* 128 */           synCtx.pushFaultHandler((FaultHandler)new MediatorFaultHandler(synCtx.getSequence(""fault"")));
/*     */         }
/*     */       
/*     */       }
/* 132 */       else if (this.proxy.getTargetInLineFaultSequence() != null) {
/* 133 */         if (traceOrDebugOn) {
/* 134 */           traceOrDebug(traceOn, ""Setting specified anonymous fault-sequence for proxy"");
/*     */         }
/* 136 */         synCtx.pushFaultHandler((FaultHandler)new MediatorFaultHandler((Mediator)this.proxy.getTargetInLineFaultSequence()));
/*     */       } 
/*     */ 
/*     */       
/* 140 */       boolean inSequenceResult = true;
/*     */ 
/*     */       
/* 143 */       if (this.proxy.getTargetInSequence() != null) {
/*     */         
/* 145 */         Mediator inSequence = synCtx.getSequence(this.proxy.getTargetInSequence());
/* 146 */         if (inSequence != null) {
/* 147 */           traceOrDebug(traceOn, ""Using sequence named : "" + this.proxy.getTargetInSequence() + "" for incoming message mediation"");
/*     */           
/* 149 */           inSequenceResult = inSequence.mediate(synCtx);
/*     */         } else {
/*     */           
/* 152 */           handleException(""Unable to find in-sequence : "" + this.proxy.getTargetInSequence(), synCtx);
/*     */         }
/*     */       
/* 155 */       } else if (this.proxy.getTargetInLineInSequence() != null) {
/* 156 */         traceOrDebug(traceOn, ""Using the anonymous in-sequence of the proxy service for mediation"");
/*     */         
/* 158 */         inSequenceResult = this.proxy.getTargetInLineInSequence().mediate(synCtx);
/*     */       } 
/*     */ 
/*     */       
/* 162 */       if (inSequenceResult) {
/* 163 */         if (this.proxy.getTargetEndpoint() != null) {
/* 164 */           Endpoint endpoint = synCtx.getEndpoint(this.proxy.getTargetEndpoint());
/*     */           
/* 166 */           if (endpoint != null) {
/* 167 */             traceOrDebug(traceOn, ""Forwarding message to the endpoint : "" + this.proxy.getTargetEndpoint());
/*     */             
/* 169 */             endpoint.send(synCtx);
/*     */           } else {
/*     */             
/* 172 */             handleException(""Unable to find the endpoint specified : "" + this.proxy.getTargetEndpoint(), synCtx);
/*     */           }
/*     */         
/*     */         }
/* 176 */         else if (this.proxy.getTargetInLineEndpoint() != null) {
/* 177 */           traceOrDebug(traceOn, ""Forwarding the message to the anonymous endpoint of the proxy service"");
/*     */           
/* 179 */           this.proxy.getTargetInLineEndpoint().send(synCtx);
/*     */         }
/*     */       
/*     */       }
/* 183 */     } catch (SynapseException syne) {
/*     */       
/* 185 */       if (!synCtx.getFaultStack().isEmpty()) {
/* 186 */         warn(traceOn, ""Executing fault handler due to exception encountered"", synCtx);
/* 187 */         ((FaultHandler)synCtx.getFaultStack().pop()).handleFault(synCtx, (Exception)syne);
/*     */       } else {
/*     */         
/* 190 */         warn(traceOn, ""Exception encountered but no fault handler found - message dropped"", synCtx);
/*     */       } 
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 202 */   public void setName(String name) { this.name = name; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 210 */   public void setProxy(ProxyService proxy) { this.proxy = proxy; }
/*     */ 
/*     */   
/*     */   private void traceOrDebug(boolean traceOn, String msg) {
/* 214 */     if (traceOn) {
/* 215 */       trace.info(msg);
/*     */     }
/* 217 */     if (log.isDebugEnabled()) {
/* 218 */       log.debug(msg);
/*     */     }
/*     */   }
/*     */   
/*     */   private void warn(boolean traceOn, String msg, MessageContext msgContext) {
/* 223 */     if (traceOn) {
/* 224 */       trace.warn(msg);
/*     */     }
/* 226 */     if (log.isDebugEnabled()) {
/* 227 */       log.warn(msg);
/*     */     }
/* 229 */     if (msgContext.getServiceLog() != null) {
/* 230 */       msgContext.getServiceLog().warn(msg);
/*     */     }
/*     */   }
/*     */   
/*     */   private void handleException(String msg, MessageContext msgContext) {
/* 235 */     log.error(msg);
/* 236 */     if (msgContext.getServiceLog() != null) {
/* 237 */       msgContext.getServiceLog().error(msg);
/*     */     }
/* 239 */     if (this.proxy.getTraceState() == 1) {
/* 240 */       trace.error(msg);
/*     */     }
/* 242 */     throw new SynapseException(msg);
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\core\axis2\ProxyServiceMessageReceiver.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.core.axis2.ResourceMap,"/*     */ package org.apache.synapse.core.axis2;
/*     */ 
/*     */ import java.io.ByteArrayInputStream;
/*     */ import java.io.ByteArrayOutputStream;
/*     */ import java.util.Collections;
/*     */ import java.util.LinkedHashMap;
/*     */ import java.util.Map;
/*     */ import javax.xml.stream.XMLStreamException;
/*     */ import org.apache.axiom.om.OMElement;
/*     */ import org.apache.commons.logging.Log;
/*     */ import org.apache.commons.logging.LogFactory;
/*     */ import org.apache.synapse.SynapseException;
/*     */ import org.apache.synapse.config.SynapseConfiguration;
/*     */ import org.xml.sax.InputSource;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class ResourceMap
/*     */ {
/*  47 */   private static final Log log = LogFactory.getLog(ResourceMap.class);
/*     */   
/*  49 */   private final Map<String, String> resources = new LinkedHashMap<String, String>();
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  58 */   public void addResource(String location, String key) { this.resources.put(location, key); }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  67 */   public Map<String, String> getResources() { return Collections.unmodifiableMap(this.resources); }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public InputSource resolve(SynapseConfiguration synCfg, String location) {
/*  78 */     String key = this.resources.get(location);
/*  79 */     if (key == null) {
/*  80 */       if (log.isDebugEnabled()) {
/*  81 */         log.debug(""No resource mapping is defined for location '"" + location + ""'"");
/*     */       }
/*  83 */       return null;
/*     */     } 
/*  85 */     if (log.isDebugEnabled()) {
/*  86 */       log.debug(""Resolving location '"" + location + ""' to registry item '"" + key + ""'"");
/*     */     }
/*  88 */     synCfg.getEntryDefinition(key);
/*  89 */     Object keyObject = synCfg.getEntry(key);
/*  90 */     if (keyObject instanceof OMElement) {
/*  91 */       ByteArrayOutputStream baos = new ByteArrayOutputStream();
/*     */       try {
/*  93 */         ((OMElement)keyObject).serialize(baos);
/*     */       }
/*  95 */       catch (XMLStreamException ex) {
/*  96 */         String msg = ""Unable to serialize registry item '"" + key + ""' for location '"" + location + ""'"";
/*     */         
/*  98 */         log.error(msg);
/*  99 */         throw new SynapseException(msg, ex);
/*     */       } 
/* 101 */       return new InputSource(new ByteArrayInputStream(baos.toByteArray()));
/*     */     } 
/* 103 */     String msg = ""Registry item '"" + key + ""' for location '"" + location + ""' is not an OMElement"";
/*     */     
/* 105 */     log.error(msg);
/* 106 */     throw new SynapseException(msg);
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\core\axis2\ResourceMap.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.core.axis2.SOAPUtils,"/*     */ package org.apache.synapse.core.axis2;
/*     */ 
/*     */ import java.util.Iterator;
/*     */ import java.util.List;
/*     */ import org.apache.axiom.om.OMAbstractFactory;
/*     */ import org.apache.axiom.om.OMAttribute;
/*     */ import org.apache.axiom.om.OMNode;
/*     */ import org.apache.axiom.soap.SOAPEnvelope;
/*     */ import org.apache.axiom.soap.SOAPFactory;
/*     */ import org.apache.axiom.soap.SOAPFault;
/*     */ import org.apache.axiom.soap.SOAPFaultCode;
/*     */ import org.apache.axiom.soap.SOAPFaultReason;
/*     */ import org.apache.axiom.soap.SOAPFaultText;
/*     */ import org.apache.axiom.soap.SOAPFaultValue;
/*     */ import org.apache.axiom.soap.SOAPHeaderBlock;
/*     */ import org.apache.axis2.AxisFault;
/*     */ import org.apache.axis2.context.MessageContext;
/*     */ import org.apache.commons.logging.Log;
/*     */ import org.apache.commons.logging.LogFactory;
/*     */ import org.apache.synapse.SynapseException;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class SOAPUtils
/*     */ {
/*  46 */   private static final Log log = LogFactory.getLog(SOAPUtils.class);
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public static void convertSoapVersion(MessageContext axisOutMsgCtx, String soapVersionURI) throws AxisFault {
/*  61 */     if (""http://www.w3.org/2003/05/soap-envelope"".equals(soapVersionURI)) {
/*  62 */       convertSOAP11toSOAP12(axisOutMsgCtx);
/*  63 */     } else if (""http://schemas.xmlsoap.org/soap/envelope/"".equals(soapVersionURI)) {
/*  64 */       convertSOAP12toSOAP11(axisOutMsgCtx);
/*     */     } else {
/*  66 */       throw new SynapseException(""Invalid soapVersionURI:"" + soapVersionURI);
/*     */     } 
/*     */   }
/*     */   
/*  70 */   private static String SOAP_ATR_ACTOR = ""actor"";
/*  71 */   private static String SOAP_ATR_ROLE = ""role"";
/*  72 */   private static String SOAP_ATR_MUST_UNDERSTAND = ""mustUnderstand"";
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public static void convertSOAP11toSOAP12(MessageContext axisOutMsgCtx) throws AxisFault {
/*  98 */     if (log.isDebugEnabled()) {
/*  99 */       log.debug(""convert SOAP11 to SOAP12"");
/*     */     }
/*     */     
/* 102 */     SOAPEnvelope oldEnvelope = axisOutMsgCtx.getEnvelope();
/*     */     
/* 104 */     SOAPFactory soap12Factory = OMAbstractFactory.getSOAP12Factory();
/* 105 */     SOAPEnvelope newEnvelope = soap12Factory.getDefaultEnvelope();
/*     */     
/* 107 */     if (oldEnvelope.getHeader() != null) {
/* 108 */       Iterator<OMNode> itr = oldEnvelope.getHeader().getChildren();
/* 109 */       while (itr.hasNext()) {
/* 110 */         OMNode omNode = itr.next();
/*     */         
/* 112 */         if (omNode instanceof SOAPHeaderBlock) {
/* 113 */           SOAPHeaderBlock soapHeader = (SOAPHeaderBlock)omNode;
/* 114 */           SOAPHeaderBlock newSOAPHeader = soap12Factory.createSOAPHeaderBlock(soapHeader.getLocalName(), soapHeader.getNamespace());
/*     */           
/* 116 */           Iterator<OMAttribute> allAttributes = soapHeader.getAllAttributes();
/*     */           
/* 118 */           while (allAttributes.hasNext()) {
/* 119 */             OMAttribute attr = allAttributes.next();
/* 120 */             if (attr.getNamespace() != null && ""http://schemas.xmlsoap.org/soap/envelope/"".equals(attr.getNamespace().getNamespaceURI())) {
/*     */ 
/*     */               
/* 123 */               String attrName = attr.getLocalName();
/*     */               
/* 125 */               if (SOAP_ATR_ACTOR.equals(attrName)) {
/* 126 */                 OMAttribute newAtr = omNode.getOMFactory().createOMAttribute(SOAP_ATR_ROLE, newEnvelope.getNamespace(), attr.getAttributeValue());
/*     */ 
/*     */                 
/* 129 */                 newSOAPHeader.addAttribute(newAtr);
/*     */               }
/* 131 */               else if (SOAP_ATR_MUST_UNDERSTAND.equals(attrName)) {
/* 132 */                 boolean isMustUnderstand = soapHeader.getMustUnderstand();
/* 133 */                 newSOAPHeader.setMustUnderstand(isMustUnderstand);
/*     */               } else {
/*     */                 
/* 136 */                 log.warn(""removed unsupported attribute from SOAP 1.1 namespace when converting to SOAP 1.2:"" + attrName);
/*     */               }
/*     */             
/*     */             } else {
/*     */               
/* 141 */               newSOAPHeader.addAttribute(attr);
/*     */             } 
/*     */             
/* 144 */             Iterator<OMNode> itrChildren = soapHeader.getChildren();
/* 145 */             while (itrChildren.hasNext()) {
/* 146 */               newSOAPHeader.addChild(itrChildren.next());
/*     */             }
/*     */             
/* 149 */             newEnvelope.getHeader().addChild((OMNode)newSOAPHeader);
/*     */           } 
/*     */           continue;
/*     */         } 
/* 153 */         newEnvelope.getHeader().addChild(omNode);
/*     */       } 
/*     */     } 
/*     */ 
/*     */ 
/*     */ 
/*     */     
/* 160 */     if (oldEnvelope.getBody() != null) {
/*     */       
/* 162 */       Iterator<OMNode> itrBodyChildren = oldEnvelope.getBody().getChildren();
/* 163 */       while (itrBodyChildren.hasNext()) {
/* 164 */         OMNode omNode = itrBodyChildren.next();
/*     */         
/* 166 */         if (omNode instanceof SOAPFault) {
/* 167 */           SOAPFault soapFault = (SOAPFault)omNode;
/* 168 */           if (soapFault != null) {
/* 169 */             SOAPFault newSOAPFault = soap12Factory.createSOAPFault();
/* 170 */             newEnvelope.getBody().addChild((OMNode)newSOAPFault);
/*     */             
/* 172 */             SOAPFaultCode code = soapFault.getCode();
/* 173 */             if (code != null) {
/* 174 */               SOAPFaultCode newSOAPFaultCode = soap12Factory.createSOAPFaultCode();
/* 175 */               newSOAPFault.setCode(newSOAPFaultCode);
/*     */               
/* 177 */               String value = code.getText();
/* 178 */               if (value != null) {
/* 179 */                 SOAPFaultValue newSOAPFaultValue = soap12Factory.createSOAPFaultValue(newSOAPFaultCode);
/*     */                 
/* 181 */                 newSOAPFaultValue.setText(value);
/*     */               } 
/*     */             } 
/*     */ 
/*     */             
/* 186 */             SOAPFaultReason reason = soapFault.getReason();
/* 187 */             if (reason != null) {
/* 188 */               SOAPFaultReason newSOAPFaultReason = soap12Factory.createSOAPFaultReason(newSOAPFault);
/*     */               
/* 190 */               String reasonText = reason.getText();
/* 191 */               if (reasonText != null) {
/* 192 */                 SOAPFaultText newSOAPFaultText = soap12Factory.createSOAPFaultText(newSOAPFaultReason);
/*     */                 
/* 194 */                 newSOAPFaultText.setLang(""en"");
/* 195 */                 newSOAPFaultText.setText(reasonText);
/*     */               } 
/* 197 */               newSOAPFault.setReason(newSOAPFaultReason);
/*     */             } 
/*     */           } 
/*     */           
/*     */           continue;
/*     */         } 
/* 203 */         newEnvelope.getBody().addChild(omNode);
/*     */       } 
/*     */     } 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */     
/* 211 */     axisOutMsgCtx.setEnvelope(newEnvelope);
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public static void convertSOAP12toSOAP11(MessageContext axisOutMsgCtx) throws AxisFault {
/* 237 */     if (log.isDebugEnabled()) {
/* 238 */       log.debug(""convert SOAP12 to SOAP11"");
/*     */     }
/*     */     
/* 241 */     SOAPEnvelope oldEnvelope = axisOutMsgCtx.getEnvelope();
/*     */     
/* 243 */     SOAPFactory soap11Factory = OMAbstractFactory.getSOAP11Factory();
/* 244 */     SOAPEnvelope newEnvelope = soap11Factory.getDefaultEnvelope();
/* 245 */     if (oldEnvelope.getHeader() != null) {
/* 246 */       Iterator<OMNode> itr = oldEnvelope.getHeader().getChildren();
/* 247 */       while (itr.hasNext()) {
/* 248 */         OMNode omNode = itr.next();
/*     */         
/* 250 */         if (omNode instanceof SOAPHeaderBlock) {
/* 251 */           SOAPHeaderBlock soapHeaderBlock = (SOAPHeaderBlock)omNode;
/* 252 */           SOAPHeaderBlock newSOAPHeader = soap11Factory.createSOAPHeaderBlock(soapHeaderBlock.getLocalName(), soapHeaderBlock.getNamespace());
/*     */ 
/*     */           
/* 255 */           Iterator<OMAttribute> allAttributes = soapHeaderBlock.getAllAttributes();
/*     */           
/* 257 */           while (allAttributes.hasNext()) {
/* 258 */             OMAttribute attr = allAttributes.next();
/* 259 */             if (attr.getNamespace() != null && ""http://www.w3.org/2003/05/soap-envelope"".equals(attr.getNamespace().getNamespaceURI())) {
/*     */ 
/*     */               
/* 262 */               String attrName = attr.getLocalName();
/*     */               
/* 264 */               if (SOAP_ATR_ROLE.equals(attrName)) {
/* 265 */                 OMAttribute newAtr = omNode.getOMFactory().createOMAttribute(SOAP_ATR_ACTOR, newEnvelope.getNamespace(), attr.getAttributeValue());
/*     */ 
/*     */                 
/* 268 */                 newSOAPHeader.addAttribute(newAtr);
/*     */               }
/* 270 */               else if (SOAP_ATR_MUST_UNDERSTAND.equals(attrName)) {
/* 271 */                 boolean isMustUnderstand = soapHeaderBlock.getMustUnderstand();
/* 272 */                 newSOAPHeader.setMustUnderstand(isMustUnderstand);
/*     */               } else {
/*     */                 
/* 275 */                 log.warn(""removed unsupported attribute from SOAP 1.2 namespace when converting to SOAP 1.1:"" + attrName);
/*     */               }
/*     */             
/*     */             } else {
/*     */               
/* 280 */               newSOAPHeader.addAttribute(attr);
/*     */             } 
/*     */             
/* 283 */             Iterator<OMNode> itrChildren = soapHeaderBlock.getChildren();
/* 284 */             while (itrChildren.hasNext()) {
/* 285 */               newSOAPHeader.addChild(itrChildren.next());
/*     */             }
/*     */             
/* 288 */             newEnvelope.getHeader().addChild((OMNode)newSOAPHeader);
/*     */           } 
/*     */           continue;
/*     */         } 
/* 292 */         newEnvelope.getHeader().addChild(omNode);
/*     */       } 
/*     */     } 
/*     */ 
/*     */ 
/*     */ 
/*     */     
/* 299 */     if (oldEnvelope.getBody() != null) {
/* 300 */       Iterator<OMNode> itr = oldEnvelope.getBody().getChildren();
/* 301 */       while (itr.hasNext()) {
/* 302 */         OMNode omNode = itr.next();
/*     */         
/* 304 */         if (omNode instanceof SOAPFault) {
/*     */           
/* 306 */           SOAPFault soapFault = (SOAPFault)omNode;
/* 307 */           if (soapFault != null) {
/* 308 */             SOAPFault newSOAPFault = soap11Factory.createSOAPFault();
/* 309 */             newEnvelope.getBody().addChild((OMNode)newSOAPFault);
/*     */             
/* 311 */             SOAPFaultCode code = soapFault.getCode();
/* 312 */             if (code != null) {
/* 313 */               SOAPFaultCode newSOAPFaultCode = soap11Factory.createSOAPFaultCode(newSOAPFault);
/*     */ 
/*     */               
/* 316 */               SOAPFaultValue value = code.getValue();
/* 317 */               if (value != null) {
/* 318 */                 soap11Factory.createSOAPFaultValue(newSOAPFaultCode);
/* 319 */                 if (value.getText() != null) {
/* 320 */                   newSOAPFaultCode.setText(value.getText());
/*     */                 }
/*     */               } 
/*     */             } 
/*     */             
/* 325 */             SOAPFaultReason reason = soapFault.getReason();
/* 326 */             if (reason != null) {
/* 327 */               SOAPFaultReason newSOAPFaultReason = soap11Factory.createSOAPFaultReason(newSOAPFault);
/*     */ 
/*     */               
/* 330 */               List allSoapTexts = reason.getAllSoapTexts();
/* 331 */               Iterator<SOAPFaultText> iterAllSoapTexts = allSoapTexts.iterator();
/* 332 */               if (iterAllSoapTexts.hasNext()) {
/* 333 */                 SOAPFaultText soapFaultText = iterAllSoapTexts.next();
/*     */                 
/* 335 */                 SOAPFaultText newSOAPFaultText = soap11Factory.createSOAPFaultText(newSOAPFaultReason);
/*     */                 
/* 337 */                 newSOAPFaultReason.setText(soapFaultText.getText());
/*     */               } 
/*     */             } 
/*     */           } 
/*     */           
/*     */           continue;
/*     */         } 
/*     */         
/* 345 */         newEnvelope.getBody().addChild(omNode);
/*     */       } 
/*     */     } 
/*     */ 
/*     */ 
/*     */ 
/*     */     
/* 352 */     axisOutMsgCtx.setEnvelope(newEnvelope);
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\core\axis2\SOAPUtils.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.core.axis2.SynapseAxisServlet,"/*    */ package org.apache.synapse.core.axis2;
/*    */ 
/*    */ import javax.servlet.ServletConfig;
/*    */ import javax.servlet.ServletContext;
/*    */ import javax.servlet.ServletException;
/*    */ import javax.servlet.http.HttpServletRequest;
/*    */ import org.apache.axis2.transport.http.AxisServlet;
/*    */ import org.apache.axis2.transport.http.ListingAgent;
/*    */ import org.apache.commons.logging.Log;
/*    */ import org.apache.commons.logging.LogFactory;
/*    */ import org.apache.synapse.ServerManager;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class SynapseAxisServlet
/*    */   extends AxisServlet
/*    */ {
/* 37 */   private static final Log log = LogFactory.getLog(SynapseAxisServlet.class);
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */   
/*    */   public void init(ServletConfig config) throws ServletException {
/* 46 */     ServletContext servletContext = config.getServletContext();
/* 47 */     this.configContext = ServerManager.getInstance().getConfigurationContext();
/* 48 */     this.axisConfiguration = this.configContext.getAxisConfiguration();
/* 49 */     servletContext.setAttribute(getClass().getName(), this);
/* 50 */     this.servletConfig = config;
/* 51 */     this.agent = new ListingAgent(this.configContext);
/* 52 */     initParams();
/*    */   }
/*    */ 
/*    */   
/* 56 */   public void initContextRoot(HttpServletRequest req) { this.configContext.setContextRoot(""/""); }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\core\axis2\SynapseAxisServlet.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.core.axis2.SynapseCallbackReceiver,"/*     */ package org.apache.synapse.core.axis2;
/*     */ 
/*     */ import java.util.Collections;
/*     */ import java.util.HashMap;
/*     */ import java.util.Map;
/*     */ import java.util.Stack;
/*     */ import java.util.Timer;
/*     */ import org.apache.axiom.soap.SOAPEnvelope;
/*     */ import org.apache.axiom.soap.SOAPFault;
/*     */ import org.apache.axiom.soap.SOAPFaultReason;
/*     */ import org.apache.axis2.AxisFault;
/*     */ import org.apache.axis2.addressing.EndpointReference;
/*     */ import org.apache.axis2.addressing.RelatesTo;
/*     */ import org.apache.axis2.client.Options;
/*     */ import org.apache.axis2.client.async.AxisCallback;
/*     */ import org.apache.axis2.context.MessageContext;
/*     */ import org.apache.axis2.engine.MessageReceiver;
/*     */ import org.apache.commons.logging.Log;
/*     */ import org.apache.commons.logging.LogFactory;
/*     */ import org.apache.synapse.FaultHandler;
/*     */ import org.apache.synapse.MessageContext;
/*     */ import org.apache.synapse.ServerManager;
/*     */ import org.apache.synapse.SynapseException;
/*     */ import org.apache.synapse.config.SynapseConfiguration;
/*     */ import org.apache.synapse.transport.nhttp.util.ResponseAcceptEncodingProcessor;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class SynapseCallbackReceiver
/*     */   implements MessageReceiver
/*     */ {
/*  58 */   private static final Log log = LogFactory.getLog(SynapseCallbackReceiver.class);
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   private Map<String, AxisCallback> callbackStore;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public SynapseCallbackReceiver(SynapseConfiguration synCfg) {
/*  70 */     this.callbackStore = Collections.synchronizedMap(new HashMap<String, AxisCallback>());
/*  71 */     ServerManager.getInstance().setCallbackStore(this.callbackStore);
/*     */ 
/*     */     
/*  74 */     TimeoutHandler timeoutHandler = new TimeoutHandler(this.callbackStore);
/*     */     
/*  76 */     Timer timeOutTimer = synCfg.getSynapseTimer();
/*  77 */     long timeoutHandlerInterval = ServerManager.getInstance().getTimeoutHandlerInterval();
/*     */ 
/*     */     
/*  80 */     timeOutTimer.schedule(timeoutHandler, 0L, timeoutHandlerInterval);
/*     */   }
/*     */ 
/*     */   
/*     */   public void addCallback(String MsgID, AxisCallback callback) {
/*  85 */     this.callbackStore.put(MsgID, callback);
/*  86 */     if (log.isDebugEnabled()) {
/*  87 */       log.debug(""Callback added. Total callbacks waiting for : "" + this.callbackStore.size());
/*     */     }
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public void receive(MessageContext messageCtx) throws AxisFault {
/* 101 */     String messageID = null;
/*     */     
/* 103 */     if (messageCtx.getOptions() != null && messageCtx.getOptions().getRelatesTo() != null) {
/*     */       
/* 105 */       Options options = messageCtx.getOptions();
/* 106 */       if (options != null) {
/* 107 */         RelatesTo relatesTo = options.getRelatesTo();
/* 108 */         if (relatesTo != null) {
/* 109 */           messageID = relatesTo.getValue();
/*     */         }
/*     */       } 
/* 112 */     } else if (messageCtx.getProperty(""MercurySequenceKey"") == null) {
/* 113 */       messageID = (String)messageCtx.getProperty(""synapse.RelatesToForPox"");
/*     */     } 
/*     */     
/* 116 */     if (messageID != null) {
/* 117 */       AxisCallback callback = this.callbackStore.remove(messageID);
/* 118 */       if (log.isDebugEnabled()) {
/* 119 */         log.debug(""Callback removed. Pending callbacks count : "" + this.callbackStore.size());
/*     */       }
/*     */       
/* 122 */       RelatesTo[] relates = messageCtx.getRelationships();
/* 123 */       if (relates != null && relates.length > 1)
/*     */       {
/*     */ 
/*     */         
/* 127 */         removeDuplicateRelatesTo(messageCtx, relates);
/*     */       }
/*     */       
/* 130 */       if (callback != null) {
/* 131 */         handleMessage(messageCtx, ((AsyncCallback)callback).getSynapseOutMsgCtx());
/*     */       }
/*     */       else {
/*     */         
/* 135 */         log.warn(""Synapse received a response for the request with message Id : "" + messageID + "" But a callback is not registered (anymore) to process this response"");
/*     */       }
/*     */     
/*     */     }
/* 139 */     else if (!messageCtx.isPropertyTrue(""SC_ACCEPTED"")) {
/*     */       
/* 141 */       log.warn(""Synapse received a response message without a message Id"");
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   private void handleMessage(MessageContext response, MessageContext synapseOutMsgCtx) throws AxisFault {
/* 157 */     Object o = response.getProperty(""sending_fault"");
/* 158 */     if (o != null && Boolean.TRUE.equals(o)) {
/*     */ 
/*     */ 
/*     */       
/* 162 */       Stack<FaultHandler> faultStack = synapseOutMsgCtx.getFaultStack();
/* 163 */       if (faultStack != null && !faultStack.isEmpty()) {
/* 164 */         SOAPEnvelope envelope = response.getEnvelope();
/* 165 */         if (envelope != null) {
/* 166 */           SOAPFault fault = envelope.getBody().getFault();
/* 167 */           if (fault != null) {
/* 168 */             Exception e = fault.getException();
/* 169 */             if (e == null) {
/* 170 */               SOAPFaultReason reason = fault.getReason();
/* 171 */               if (reason != null) {
/* 172 */                 e = new Exception(reason.getText());
/*     */               }
/*     */             } 
/*     */ 
/*     */             
/* 177 */             synapseOutMsgCtx.setProperty(""ERROR_CODE"", ""503"");
/*     */             
/* 179 */             SOAPFaultReason faultReason = fault.getReason();
/* 180 */             if (faultReason != null) {
/* 181 */               synapseOutMsgCtx.setProperty(""ERROR_MESSAGE"", faultReason.getText());
/*     */             }
/*     */             
/* 184 */             if (fault.getException() != null) {
/* 185 */               synapseOutMsgCtx.setProperty(""ERROR_EXCEPTION"", fault.getException());
/*     */             }
/*     */             
/* 188 */             ((FaultHandler)faultStack.pop()).handleFault(synapseOutMsgCtx, e);
/*     */           }
/*     */         
/*     */         }
/*     */       
/*     */       }
/*     */     
/*     */     } else {
/*     */       
/* 197 */       Stack faultStack = synapseOutMsgCtx.getFaultStack();
/* 198 */       if (faultStack != null && !faultStack.isEmpty() && faultStack.peek() instanceof org.apache.synapse.endpoints.Endpoint)
/*     */       {
/* 200 */         faultStack.pop();
/*     */       }
/* 202 */       if (log.isDebugEnabled()) {
/* 203 */         log.debug(""Synapse received an asynchronous response message"");
/* 204 */         log.debug(""Received To: "" + ((response.getTo() != null) ? response.getTo().getAddress() : ""null""));
/*     */         
/* 206 */         log.debug(""SOAPAction: "" + ((response.getSoapAction() != null) ? response.getSoapAction() : ""null""));
/*     */         
/* 208 */         log.debug(""WSA-Action: "" + ((response.getWSAAction() != null) ? response.getWSAAction() : ""null""));
/*     */         
/* 210 */         String[] cids = response.getAttachmentMap().getAllContentIDs();
/* 211 */         if (cids != null && cids.length > 0) {
/* 212 */           for (String cid : cids) {
/* 213 */             log.debug(""Attachment : "" + cid);
/*     */           }
/*     */         }
/* 216 */         log.debug(""Body : \n"" + response.getEnvelope());
/*     */       } 
/* 218 */       MessageContext axisOutMsgCtx = ((Axis2MessageContext)synapseOutMsgCtx).getAxis2MessageContext();
/*     */ 
/*     */ 
/*     */       
/* 222 */       ResponseAcceptEncodingProcessor.process(response, axisOutMsgCtx);
/*     */       
/* 224 */       response.setServiceContext(null);
/* 225 */       response.setOperationContext(axisOutMsgCtx.getOperationContext());
/* 226 */       response.setAxisMessage(axisOutMsgCtx.getAxisOperation().getMessage(""Out""));
/*     */ 
/*     */ 
/*     */       
/* 230 */       response.setServerSide(true);
/* 231 */       response.setProperty(""synapse.isresponse"", Boolean.TRUE);
/* 232 */       response.setProperty(""TRANSPORT_OUT"", axisOutMsgCtx.getProperty(""TRANSPORT_OUT""));
/*     */       
/* 234 */       response.setProperty(""OutTransportInfo"", axisOutMsgCtx.getProperty(""OutTransportInfo""));
/*     */       
/* 236 */       response.setTransportIn(axisOutMsgCtx.getTransportIn());
/* 237 */       response.setTransportOut(axisOutMsgCtx.getTransportOut());
/*     */ 
/*     */       
/* 240 */       response.setDoingREST(axisOutMsgCtx.isDoingREST());
/* 241 */       if (axisOutMsgCtx.isDoingMTOM()) {
/* 242 */         response.setDoingMTOM(true);
/* 243 */         response.setProperty(""enableMTOM"", ""true"");
/*     */       } 
/*     */ 
/*     */       
/* 247 */       if (axisOutMsgCtx.isDoingSwA()) {
/* 248 */         response.setDoingSwA(true);
/* 249 */         response.setProperty(""enableSwA"", ""true"");
/*     */       } 
/*     */ 
/*     */ 
/*     */ 
/*     */       
/* 255 */       response.setProperty(""messageType"", axisOutMsgCtx.getProperty(""messageType""));
/*     */ 
/*     */ 
/*     */ 
/*     */       
/* 260 */       if (axisOutMsgCtx.isSOAP11() != response.isSOAP11()) {
/* 261 */         if (axisOutMsgCtx.isSOAP11()) {
/* 262 */           SOAPUtils.convertSOAP12toSOAP11(response);
/*     */         } else {
/* 264 */           SOAPUtils.convertSOAP11toSOAP12(response);
/*     */         } 
/*     */       }
/*     */       
/* 268 */       if (axisOutMsgCtx.getMessageID() != null) {
/* 269 */         response.setRelationships(new RelatesTo[] { new RelatesTo(axisOutMsgCtx.getMessageID()) });
/*     */       }
/*     */ 
/*     */       
/* 273 */       response.setReplyTo(axisOutMsgCtx.getReplyTo());
/* 274 */       response.setFaultTo(axisOutMsgCtx.getFaultTo());
/*     */       
/* 276 */       if (axisOutMsgCtx.isPropertyTrue(""IGNORE_SC_ACCEPTED"")) {
/* 277 */         response.setProperty(""FORCE_SC_ACCEPTED"", ""true"");
/*     */       }
/*     */ 
/*     */       
/* 281 */       Axis2MessageContext synapseInMessageContext = new Axis2MessageContext(response, synapseOutMsgCtx.getConfiguration(), synapseOutMsgCtx.getEnvironment());
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */       
/* 287 */       synapseInMessageContext.setResponse(true);
/* 288 */       synapseInMessageContext.setTo(new EndpointReference(""http://www.w3.org/2005/08/addressing/anonymous""));
/*     */       
/* 290 */       synapseInMessageContext.setTracingState(synapseOutMsgCtx.getTracingState());
/*     */ 
/*     */ 
/*     */       
/* 294 */       for (Object key : synapseOutMsgCtx.getPropertyKeySet()) {
/* 295 */         synapseInMessageContext.setProperty((String)key, synapseOutMsgCtx.getProperty((String)key));
/*     */       }
/*     */ 
/*     */ 
/*     */       
/*     */       try {
/* 301 */         synapseOutMsgCtx.getEnvironment().injectMessage(synapseInMessageContext);
/* 302 */       } catch (SynapseException syne) {
/* 303 */         Stack<FaultHandler> stack = synapseInMessageContext.getFaultStack();
/* 304 */         if (stack != null && !stack.isEmpty()) {
/*     */           
/* 306 */           ((FaultHandler)stack.pop()).handleFault(synapseInMessageContext, (Exception)syne);
/*     */         } else {
/* 308 */           log.error(""Synapse encountered an exception, No error handlers found - [Message Dropped]\n"" + syne.getMessage());
/*     */         } 
/*     */       } 
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   private void removeDuplicateRelatesTo(MessageContext mc, RelatesTo[] relates) {
/* 325 */     int insertPos = 0;
/* 326 */     RelatesTo[] newRelates = new RelatesTo[relates.length];
/*     */     
/* 328 */     for (RelatesTo current : relates) {
/* 329 */       boolean found = false;
/* 330 */       for (int j = 0; j < newRelates.length && j < insertPos; j++) {
/* 331 */         if (newRelates[j].equals(current) || newRelates[j].getValue().equals(current.getValue())) {
/*     */           
/* 333 */           found = true;
/*     */           break;
/*     */         } 
/*     */       } 
/* 337 */       if (!found) {
/* 338 */         newRelates[insertPos++] = current;
/*     */       }
/*     */     } 
/*     */     
/* 342 */     RelatesTo[] trimmedRelates = new RelatesTo[insertPos];
/* 343 */     System.arraycopy(newRelates, 0, trimmedRelates, 0, insertPos);
/* 344 */     mc.setRelationships(trimmedRelates);
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\core\axis2\SynapseCallbackReceiver.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.core.axis2.SynapseDispatcher,"/*    */ package org.apache.synapse.core.axis2;
/*    */ 
/*    */ import javax.xml.namespace.QName;
/*    */ import org.apache.axis2.AxisFault;
/*    */ import org.apache.axis2.context.MessageContext;
/*    */ import org.apache.axis2.description.AxisOperation;
/*    */ import org.apache.axis2.description.AxisService;
/*    */ import org.apache.axis2.description.HandlerDescription;
/*    */ import org.apache.axis2.engine.AbstractDispatcher;
/*    */ import org.apache.axis2.engine.AxisConfiguration;
/*    */ import org.apache.synapse.SynapseConstants;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class SynapseDispatcher
/*    */   extends AbstractDispatcher
/*    */ {
/*    */   public void initDispatcher() {
/* 40 */     QName qn = new QName(""http://synapse.apache.org"", ""SynapseDispatcher"");
/* 41 */     HandlerDescription hd = new HandlerDescription(qn.getLocalPart());
/* 42 */     init(hd);
/*    */   }
/*    */   
/*    */   public AxisService findService(MessageContext mc) throws AxisFault {
/* 46 */     AxisConfiguration ac = mc.getConfigurationContext().getAxisConfiguration();
/* 47 */     return ac.getService(""__SynapseService"");
/*    */   }
/*    */ 
/*    */   
/* 51 */   public AxisOperation findOperation(AxisService svc, MessageContext mc) throws AxisFault { return svc.getOperation(SynapseConstants.SYNAPSE_OPERATION_NAME); }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\core\axis2\SynapseDispatcher.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.core.axis2.SynapseInitializationModule,"/*     */ package org.apache.synapse.core.axis2;
/*     */ 
/*     */ import java.net.InetAddress;
/*     */ import java.net.UnknownHostException;
/*     */ import java.util.ArrayList;
/*     */ import java.util.Date;
/*     */ import java.util.List;
/*     */ import org.apache.axis2.AxisFault;
/*     */ import org.apache.axis2.context.ConfigurationContext;
/*     */ import org.apache.axis2.description.AxisDescription;
/*     */ import org.apache.axis2.description.AxisModule;
/*     */ import org.apache.axis2.description.AxisOperation;
/*     */ import org.apache.axis2.description.AxisService;
/*     */ import org.apache.axis2.description.InOutAxisOperation;
/*     */ import org.apache.axis2.description.Parameter;
/*     */ import org.apache.axis2.engine.AxisConfiguration;
/*     */ import org.apache.axis2.modules.Module;
/*     */ import org.apache.commons.logging.Log;
/*     */ import org.apache.commons.logging.LogFactory;
/*     */ import org.apache.log4j.MDC;
/*     */ import org.apache.neethi.Assertion;
/*     */ import org.apache.neethi.Policy;
/*     */ import org.apache.synapse.ServerManager;
/*     */ import org.apache.synapse.SynapseConstants;
/*     */ import org.apache.synapse.SynapseException;
/*     */ import org.apache.synapse.config.SynapseConfiguration;
/*     */ import org.apache.synapse.config.SynapseConfigurationBuilder;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class SynapseInitializationModule
/*     */   implements Module
/*     */ {
/*  51 */   private static final Log log = LogFactory.getLog(SynapseInitializationModule.class);
/*     */   
/*     */   private SynapseConfiguration synCfg;
/*     */ 
/*     */   
/*     */   public void init(ConfigurationContext configurationContext, AxisModule axisModule) throws AxisFault {
/*  57 */     log.info(""Initializing Synapse at : "" + new Date());
/*     */     try {
/*  59 */       InetAddress addr = InetAddress.getLocalHost();
/*  60 */       if (addr != null) {
/*     */         
/*  62 */         String ipAddr = addr.getHostAddress();
/*  63 */         if (ipAddr != null) {
/*  64 */           MDC.put(""ip"", ipAddr);
/*     */         }
/*     */ 
/*     */         
/*  68 */         String hostname = addr.getHostName();
/*  69 */         if (hostname == null) {
/*  70 */           hostname = ipAddr;
/*     */         }
/*  72 */         MDC.put(""host"", hostname);
/*     */       } 
/*  74 */     } catch (UnknownHostException e) {
/*  75 */       log.warn(""Unable to determine hostname or IP address of the server for logging"", e);
/*     */     } 
/*     */ 
/*     */     
/*  79 */     log.info(""Loading mediator extensions..."");
/*  80 */     configurationContext.getAxisConfiguration().getConfigurator().loadServices();
/*     */ 
/*     */     
/*  83 */     log.info(""Initializing the Synapse configuration ..."");
/*  84 */     this.synCfg = getConfiguration(configurationContext);
/*     */     
/*  86 */     log.info(""Deploying the Synapse service.."");
/*     */     
/*  88 */     AxisConfiguration axisCfg = configurationContext.getAxisConfiguration();
/*  89 */     AxisService synapseService = new AxisService(""__SynapseService"");
/*  90 */     InOutAxisOperation inOutAxisOperation = new InOutAxisOperation(SynapseConstants.SYNAPSE_OPERATION_NAME);
/*     */     
/*  92 */     inOutAxisOperation.setMessageReceiver(new SynapseMessageReceiver());
/*  93 */     synapseService.addOperation((AxisOperation)inOutAxisOperation);
/*  94 */     List<String> transports = new ArrayList();
/*  95 */     transports.add(""http"");
/*  96 */     transports.add(""https"");
/*  97 */     synapseService.setExposedTransports(transports);
/*  98 */     axisCfg.addService(synapseService);
/*     */ 
/*     */ 
/*     */ 
/*     */     
/* 103 */     String thisServerName = ServerManager.getInstance().getServerName();
/* 104 */     if (thisServerName == null || thisServerName.equals("""")) {
/*     */       try {
/* 106 */         InetAddress addr = InetAddress.getLocalHost();
/* 107 */         thisServerName = addr.getHostName();
/*     */       }
/* 109 */       catch (UnknownHostException e) {
/* 110 */         log.warn(""Could not get local host name"", e);
/*     */       } 
/*     */       
/* 113 */       if (thisServerName == null || thisServerName.equals("""")) {
/* 114 */         thisServerName = ""localhost"";
/*     */       }
/*     */     } 
/* 117 */     log.info(""Synapse server name : "" + thisServerName);
/*     */     
/* 119 */     log.info(""Deploying Proxy services..."");
/*     */     
/* 121 */     for (ProxyService proxy : this.synCfg.getProxyServices()) {
/*     */ 
/*     */ 
/*     */ 
/*     */       
/* 126 */       List pinnedServers = proxy.getPinnedServers();
/* 127 */       if (pinnedServers != null && !pinnedServers.isEmpty() && 
/* 128 */         !pinnedServers.contains(thisServerName)) {
/* 129 */         log.info(""Server name not in pinned servers list. Not deploying Proxy service : "" + proxy.getName());
/*     */         
/*     */         continue;
/*     */       } 
/*     */       
/* 134 */       proxy.buildAxisService(this.synCfg, axisCfg);
/* 135 */       log.info(""Deployed Proxy service : "" + proxy.getName());
/* 136 */       if (!proxy.isStartOnLoad()) {
/* 137 */         proxy.stop(this.synCfg);
/*     */       }
/*     */     } 
/*     */     
/* 141 */     log.info(""Synapse initialized successfully...!"");
/*     */   }
/*     */   
/*     */   private static SynapseConfiguration getConfiguration(ConfigurationContext cfgCtx) {
/*     */     SynapseConfiguration synapseConfiguration;
/* 146 */     cfgCtx.setProperty(""addressing.validateAction"", Boolean.FALSE);
/* 147 */     AxisConfiguration axisConfiguration = cfgCtx.getAxisConfiguration();
/*     */ 
/*     */     
/* 150 */     String config = ServerManager.getInstance().getSynapseXMLPath();
/*     */     
/* 152 */     if (config != null) {
/* 153 */       synapseConfiguration = SynapseConfigurationBuilder.getConfiguration(config);
/*     */     } else {
/* 155 */       log.warn(""System property or init-parameter 'synapse.xml' is not specified. Using default configuration.."");
/*     */       
/* 157 */       synapseConfiguration = SynapseConfigurationBuilder.getDefaultConfiguration();
/*     */     } 
/*     */ 
/*     */     
/* 161 */     synapseConfiguration.setAxisConfiguration(cfgCtx.getAxisConfiguration());
/*     */ 
/*     */     
/* 164 */     Parameter synapseCtxParam = new Parameter(""synapse.config"", null);
/* 165 */     synapseCtxParam.setValue(synapseConfiguration);
/* 166 */     MessageContextCreatorForAxis2.setSynConfig(synapseConfiguration);
/*     */     
/* 168 */     Parameter synapseEnvParam = new Parameter(""synapse.env"", null);
/* 169 */     Axis2SynapseEnvironment synEnv = new Axis2SynapseEnvironment(cfgCtx, synapseConfiguration);
/* 170 */     synapseEnvParam.setValue(synEnv);
/* 171 */     MessageContextCreatorForAxis2.setSynEnv(synEnv);
/*     */     
/*     */     try {
/* 174 */       axisConfiguration.addParameter(synapseCtxParam);
/* 175 */       axisConfiguration.addParameter(synapseEnvParam);
/*     */     }
/* 177 */     catch (AxisFault e) {
/* 178 */       String msg = ""Could not set parameters 'synapse.config' and/or 'synapse.env'to the Axis2 configuration : "" + e.getMessage();
/*     */ 
/*     */ 
/*     */       
/* 182 */       log.fatal(msg, (Throwable)e);
/* 183 */       throw new SynapseException(msg, (Throwable)e);
/*     */     } 
/* 185 */     synapseConfiguration.init(synEnv);
/*     */     
/* 187 */     return synapseConfiguration;
/*     */   }
/*     */ 
/*     */ 
/*     */   
/*     */   public void engageNotify(AxisDescription axisDescription) throws AxisFault {}
/*     */ 
/*     */   
/* 195 */   public boolean canSupportAssertion(Assertion assertion) { return false; }
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public void applyPolicy(Policy policy, AxisDescription axisDescription) throws AxisFault {}
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 205 */   public void shutdown(ConfigurationContext configurationContext) throws AxisFault { this.synCfg.destroy(); }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\core\axis2\SynapseInitializationModule.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.core.axis2.SynapseMessageReceiver,"/*     */ package org.apache.synapse.core.axis2;
/*     */ 
/*     */ import org.apache.axis2.AxisFault;
/*     */ import org.apache.axis2.context.MessageContext;
/*     */ import org.apache.axis2.engine.MessageReceiver;
/*     */ import org.apache.commons.logging.Log;
/*     */ import org.apache.commons.logging.LogFactory;
/*     */ import org.apache.synapse.FaultHandler;
/*     */ import org.apache.synapse.MessageContext;
/*     */ import org.apache.synapse.SynapseException;
/*     */ import org.apache.synapse.mediators.MediatorFaultHandler;
/*     */ import org.apache.synapse.statistics.impl.ProxyServiceStatisticsStack;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class SynapseMessageReceiver
/*     */   implements MessageReceiver
/*     */ {
/*  41 */   private static final Log log = LogFactory.getLog(SynapseMessageReceiver.class);
/*  42 */   private static final Log trace = LogFactory.getLog(""TRACE_LOGGER"");
/*     */ 
/*     */   
/*     */   public void receive(MessageContext mc) throws AxisFault {
/*  46 */     MessageContext synCtx = MessageContextCreatorForAxis2.getSynapseMessageContext(mc);
/*     */     
/*  48 */     boolean traceOn = (synCtx.getMainSequence().getTraceState() == 1);
/*  49 */     boolean traceOrDebugOn = (traceOn || log.isDebugEnabled());
/*     */     
/*  51 */     if (traceOrDebugOn) {
/*  52 */       traceOrDebug(traceOn, ""Synapse received a new message for message mediation..."");
/*  53 */       traceOrDebug(traceOn, ""Received To: "" + ((mc.getTo() != null) ? mc.getTo().getAddress() : ""null""));
/*     */       
/*  55 */       traceOrDebug(traceOn, ""SOAPAction: "" + ((mc.getSoapAction() != null) ? mc.getSoapAction() : ""null""));
/*     */       
/*  57 */       traceOrDebug(traceOn, ""WSA-Action: "" + ((mc.getWSAAction() != null) ? mc.getWSAAction() : ""null""));
/*     */ 
/*     */       
/*  60 */       if (traceOn && trace.isTraceEnabled()) {
/*  61 */         String[] cids = mc.getAttachmentMap().getAllContentIDs();
/*  62 */         if (cids != null && cids.length > 0) {
/*  63 */           for (int i = 0; i < cids.length; i++) {
/*  64 */             trace.trace(""Attachment : "" + cids[i]);
/*     */           }
/*     */         }
/*  67 */         trace.trace(""Envelope : "" + mc.getEnvelope());
/*     */       } 
/*     */     } 
/*     */ 
/*     */     
/*  72 */     Log serviceLog = LogFactory.getLog(""SERVICE_LOGGER.__SynapseService"");
/*     */     
/*  74 */     ((Axis2MessageContext)synCtx).setServiceLog(serviceLog);
/*     */ 
/*     */     
/*     */     try {
/*  78 */       ProxyServiceStatisticsStack proxyServiceStatisticsStack = new ProxyServiceStatisticsStack();
/*  79 */       boolean isFault = synCtx.getEnvelope().getBody().hasFault();
/*  80 */       proxyServiceStatisticsStack.put(""__SynapseService"", System.currentTimeMillis(), !synCtx.isResponse(), true, isFault);
/*     */       
/*  82 */       synCtx.setProperty(""synapse.service.stats"", proxyServiceStatisticsStack);
/*     */ 
/*     */       
/*  85 */       synCtx.pushFaultHandler((FaultHandler)new MediatorFaultHandler(synCtx.getSequence(""fault"")));
/*     */ 
/*     */ 
/*     */       
/*  89 */       synCtx.getEnvironment().injectMessage(synCtx);
/*     */     }
/*  91 */     catch (SynapseException syne) {
/*     */       
/*  93 */       if (!synCtx.getFaultStack().isEmpty()) {
/*  94 */         warn(traceOn, ""Executing fault handler due to exception encountered"", synCtx);
/*  95 */         ((FaultHandler)synCtx.getFaultStack().pop()).handleFault(synCtx, (Exception)syne);
/*     */       } else {
/*     */         
/*  98 */         warn(traceOn, ""Exception encountered but no fault handler found - message dropped"", synCtx);
/*     */       } 
/*     */     } 
/*     */   }
/*     */ 
/*     */   
/*     */   private void traceOrDebug(boolean traceOn, String msg) {
/* 105 */     if (traceOn) {
/* 106 */       trace.info(msg);
/*     */     }
/* 108 */     if (log.isDebugEnabled()) {
/* 109 */       log.debug(msg);
/*     */     }
/*     */   }
/*     */   
/*     */   private void warn(boolean traceOn, String msg, MessageContext msgContext) {
/* 114 */     if (traceOn) {
/* 115 */       trace.warn(msg);
/*     */     }
/* 117 */     if (log.isDebugEnabled()) {
/* 118 */       log.warn(msg);
/*     */     }
/* 120 */     if (msgContext.getServiceLog() != null)
/* 121 */       msgContext.getServiceLog().warn(msg); 
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\core\axis2\SynapseMessageReceiver.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.core.axis2.SynapseMustUnderstandHandler,"/*    */ package org.apache.synapse.core.axis2;
/*    */ 
/*    */ import java.util.ArrayList;
/*    */ import java.util.Iterator;
/*    */ import org.apache.axiom.soap.SOAPEnvelope;
/*    */ import org.apache.axiom.soap.SOAPHeaderBlock;
/*    */ import org.apache.axis2.AxisFault;
/*    */ import org.apache.axis2.context.MessageContext;
/*    */ import org.apache.axis2.engine.Handler;
/*    */ import org.apache.axis2.handlers.AbstractHandler;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class SynapseMustUnderstandHandler
/*    */   extends AbstractHandler
/*    */ {
/*    */   public Handler.InvocationResponse invoke(MessageContext messageContext) throws AxisFault {
/* 40 */     SOAPEnvelope envelope = messageContext.getEnvelope();
/*    */     
/* 42 */     if (envelope.getHeader() != null) {
/* 43 */       Iterator<SOAPHeaderBlock> headerBlocks = envelope.getHeader().getHeadersToProcess(null);
/* 44 */       ArrayList<SOAPHeaderBlock> markedHeaderBlocks = new ArrayList();
/*    */       
/* 46 */       while (headerBlocks.hasNext()) {
/* 47 */         SOAPHeaderBlock headerBlock = headerBlocks.next();
/*    */ 
/*    */ 
/*    */         
/* 51 */         if (!headerBlock.isProcessed() && headerBlock.getMustUnderstand()) {
/* 52 */           markedHeaderBlocks.add(headerBlock);
/* 53 */           headerBlock.setProcessed();
/*    */         } 
/*    */       } 
/*    */ 
/*    */       
/* 58 */       messageContext.setProperty(""headersMarkedAsProcessedBySynapse"", markedHeaderBlocks);
/*    */     } 
/*    */     
/* 61 */     return Handler.InvocationResponse.CONTINUE;
/*    */   }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\core\axis2\SynapseMustUnderstandHandler.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.core.axis2.SynapseStartUpServlet,"/*     */ package org.apache.synapse.core.axis2;
/*     */ 
/*     */ import java.io.IOException;
/*     */ import javax.servlet.ServletConfig;
/*     */ import javax.servlet.ServletContext;
/*     */ import javax.servlet.ServletException;
/*     */ import javax.servlet.http.HttpServlet;
/*     */ import javax.servlet.http.HttpServletRequest;
/*     */ import javax.servlet.http.HttpServletResponse;
/*     */ import org.apache.commons.logging.Log;
/*     */ import org.apache.commons.logging.LogFactory;
/*     */ import org.apache.synapse.ServerManager;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class SynapseStartUpServlet
/*     */   extends HttpServlet
/*     */ {
/*  41 */   private static Log log = LogFactory.getLog(SynapseStartUpServlet.class);
/*     */   private static final String ALREADY_INITED = ""synapseAlreadyInited"";
/*     */   
/*     */   public void init() throws ServletException {
/*  45 */     ServletConfig servletConfig = getServletConfig();
/*  46 */     ServletContext servletContext = servletConfig.getServletContext();
/*  47 */     if (Boolean.TRUE.equals(servletContext.getAttribute(""synapseAlreadyInited""))) {
/*     */       return;
/*     */     }
/*     */     
/*  51 */     ServerManager serverManager = ServerManager.getInstance();
/*  52 */     String synHome = loadParameter(servletConfig, ""synapse.home"", false);
/*     */     
/*  54 */     if (synHome == null) {
/*  55 */       log.info(""synapse.home not set; using web application root as default value"");
/*  56 */       String webinfPath = servletContext.getRealPath(""WEB-INF"");
/*  57 */       if (webinfPath == null || !webinfPath.endsWith(""WEB-INF"")) {
/*  58 */         handleException(""Unable to determine web application root directory"");
/*     */       } else {
/*  60 */         synHome = webinfPath.substring(0, webinfPath.length() - 7);
/*  61 */         log.info(""Setting synapse.home to : "" + synHome);
/*     */       } 
/*     */     } 
/*  64 */     serverManager.setSynapseHome(synHome);
/*     */     
/*  66 */     serverManager.setSynapseXMLPath(loadParameter(servletConfig, ""synapse.xml"", true));
/*  67 */     String resolveRoot = loadParameter(servletConfig, ""resolve.root"", false);
/*  68 */     if (resolveRoot != null) {
/*  69 */       serverManager.setResolveRoot(resolveRoot);
/*     */     }
/*  71 */     serverManager.setAxis2Repolocation(loadParameter(servletConfig, ""axis2.repo"", true));
/*  72 */     serverManager.setAxis2Xml(loadParameter(servletConfig, ""axis2.xml"", true));
/*  73 */     serverManager.setServerName(loadParameter(servletConfig, ""serverName"", false));
/*     */     
/*  75 */     serverManager.start();
/*  76 */     servletContext.setAttribute(""synapseAlreadyInited"", Boolean.TRUE);
/*     */   }
/*     */ 
/*     */ 
/*     */   
/*     */   protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {}
/*     */ 
/*     */ 
/*     */   
/*     */   protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {}
/*     */ 
/*     */   
/*     */   public void destroy() {
/*     */     try {
/*  90 */       ServerManager serverManager = ServerManager.getInstance();
/*  91 */       serverManager.stop();
/*  92 */       getServletContext().removeAttribute(""synapseAlreadyInited"");
/*  93 */     } catch (Exception e) {
/*  94 */       log.error(""Error stopping the Synapse listener manager"", e);
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */   
/*     */   private String loadParameter(ServletConfig servletConfig, String name, boolean required) throws ServletException {
/* 101 */     if (System.getProperty(name) == null) {
/*     */       
/* 103 */       String value = servletConfig.getInitParameter(name);
/* 104 */       log.debug(""Init parameter '"" + name + ""' : "" + value);
/*     */       
/* 106 */       if ((value == null || value.trim().length() == 0) && required) {
/* 107 */         handleException(""A valid system property or init parameter '"" + name + ""' is required"");
/*     */       } else {
/* 109 */         return value;
/*     */       } 
/*     */     } else {
/* 112 */       return System.getProperty(name);
/*     */     } 
/* 114 */     return null;
/*     */   }
/*     */   
/*     */   private void handleException(String message) throws ServletException {
/* 118 */     log.error(message);
/* 119 */     log(message);
/* 120 */     throw new ServletException(message);
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\core\axis2\SynapseStartUpServlet.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.core.axis2.TimeoutHandler,"/*     */ package org.apache.synapse.core.axis2;
/*     */ 
/*     */ import java.util.Iterator;
/*     */ import java.util.Map;
/*     */ import java.util.Stack;
/*     */ import java.util.TimerTask;
/*     */ import org.apache.commons.logging.Log;
/*     */ import org.apache.commons.logging.LogFactory;
/*     */ import org.apache.synapse.FaultHandler;
/*     */ import org.apache.synapse.MessageContext;
/*     */ import org.apache.synapse.ServerManager;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class TimeoutHandler
/*     */   extends TimerTask
/*     */ {
/*  48 */   private static final Log log = LogFactory.getLog(TimeoutHandler.class);
/*     */ 
/*     */   
/*  51 */   private Map callbackStore = null;
/*     */   
/*  53 */   private Object lock = new Object();
/*     */ 
/*     */   
/*     */   private boolean alreadyExecuting = false;
/*     */ 
/*     */   
/*  59 */   private long globalTimeout = 86400000L;
/*     */   
/*     */   public TimeoutHandler(Map callbacks) {
/*  62 */     this.callbackStore = callbacks;
/*  63 */     this.globalTimeout = ServerManager.getInstance().getGlobalTimeoutInterval();
/*  64 */     log.info(""This engine will expire all callbacks after : "" + (this.globalTimeout / 1000L) + "" seconds, irrespective of the timeout action, after the specified or optional timeout"");
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public void run() {
/*  73 */     if (this.alreadyExecuting)
/*     */       return; 
/*  75 */     synchronized (this.lock) {
/*  76 */       this.alreadyExecuting = true;
/*     */       try {
/*  78 */         processCallbacks();
/*  79 */       } catch (Exception ignore) {}
/*  80 */       this.alreadyExecuting = false;
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   private void processCallbacks() {
/*  91 */     synchronized (this.callbackStore) {
/*     */       
/*  93 */       if (this.callbackStore.size() > 0) {
/*     */         
/*  95 */         long currentTime = currentTime();
/*  96 */         Iterator i = this.callbackStore.keySet().iterator();
/*     */         
/*  98 */         while (i.hasNext()) {
/*     */           
/* 100 */           Object key = i.next();
/* 101 */           AsyncCallback callback = (AsyncCallback)this.callbackStore.get(key);
/*     */           
/* 103 */           if (callback.getTimeOutAction() != 100) {
/*     */             
/* 105 */             if (callback.getTimeOutOn() <= currentTime) {
/* 106 */               this.callbackStore.remove(key);
/*     */               
/* 108 */               if (callback.getTimeOutAction() == 102) {
/*     */ 
/*     */                 
/* 111 */                 MessageContext msgContext = callback.getSynapseOutMsgCtx();
/*     */ 
/*     */ 
/*     */                 
/* 115 */                 msgContext.setProperty(""ERROR_CODE"", ""504"");
/* 116 */                 msgContext.setProperty(""ERROR_MESSAGE"", ""Send timeout"");
/*     */                 
/* 118 */                 Stack faultStack = msgContext.getFaultStack();
/*     */                 
/* 120 */                 for (int j = 0; j < faultStack.size(); j++) {
/* 121 */                   Object o = faultStack.pop();
/* 122 */                   if (o instanceof FaultHandler) {
/* 123 */                     ((FaultHandler)o).handleFault(msgContext);
/*     */                   }
/*     */                 } 
/*     */               } 
/*     */             } 
/*     */             continue;
/*     */           } 
/* 130 */           if (currentTime > this.globalTimeout + callback.getTimeOutOn()) {
/* 131 */             log.warn(""Expiring message ID : "" + key + ""; dropping message after "" + ""global timeout of : "" + (this.globalTimeout / 1000L) + "" seconds"");
/*     */             
/* 133 */             this.callbackStore.remove(key);
/*     */           } 
/*     */         } 
/*     */       } 
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 147 */   private long currentTime() { return System.currentTimeMillis(); }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\core\axis2\TimeoutHandler.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.endpoints.AddressEndpoint,"/*     */ package org.apache.synapse.endpoints;
/*     */ 
/*     */ import org.apache.axis2.clustering.ClusterManager;
/*     */ import org.apache.axis2.context.ConfigurationContext;
/*     */ import org.apache.axis2.context.MessageContext;
/*     */ import org.apache.synapse.MessageContext;
/*     */ import org.apache.synapse.core.axis2.Axis2MessageContext;
/*     */ import org.apache.synapse.endpoints.utils.EndpointDefinition;
/*     */ import org.apache.synapse.statistics.impl.EndPointStatisticsStack;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class AddressEndpoint
/*     */   extends DefaultEndpoint
/*     */ {
/*  40 */   private final EndpointContext endpointContext = new EndpointContext();
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public boolean isActive(MessageContext synMessageContext) {
/*  51 */     boolean active = this.endpointContext.isActive();
/*  52 */     if (!active) {
/*     */       
/*  54 */       long recoverOn = this.endpointContext.getRecoverOn();
/*  55 */       if (System.currentTimeMillis() > recoverOn) {
/*  56 */         active = true;
/*  57 */         this.endpointContext.setActive(true);
/*  58 */         this.endpointContext.setRecoverOn(0L);
/*     */       } 
/*     */     } 
/*     */ 
/*     */     
/*  63 */     if (this.log.isDebugEnabled()) {
/*  64 */       this.log.debug(""AddressEndpoint with name '"" + getName() + ""' is in "" + (active ? ""active"" : ""inactive"") + "" state"");
/*     */     }
/*     */ 
/*     */     
/*  68 */     return active;
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public synchronized void setActive(boolean active, MessageContext synMessageContext) {
/*  83 */     if (!active) {
/*  84 */       EndpointDefinition endpoint = getEndpoint();
/*  85 */       if (endpoint.getSuspendOnFailDuration() != -1L) {
/*     */ 
/*     */         
/*  88 */         this.endpointContext.setRecoverOn(System.currentTimeMillis() + endpoint.getSuspendOnFailDuration());
/*     */       } else {
/*     */         
/*  91 */         this.endpointContext.setRecoverOn(Long.MAX_VALUE);
/*     */       } 
/*     */     } 
/*     */     
/*  95 */     this.endpointContext.setActive(active);
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public void send(MessageContext synCtx) {
/* 109 */     boolean traceOn = isTraceOn(synCtx);
/* 110 */     boolean traceOrDebugOn = isTraceOrDebugOn(traceOn);
/*     */     
/* 112 */     if (traceOrDebugOn) {
/* 113 */       traceOrDebug(traceOn, ""Start : Address Endpoint"");
/*     */       
/* 115 */       if (traceOn && trace.isTraceEnabled()) {
/* 116 */         trace.trace(""Message : "" + synCtx.getEnvelope());
/*     */       }
/*     */     } 
/*     */     
/* 120 */     boolean isClusteringEnable = false;
/*     */     
/* 122 */     MessageContext axisMC = ((Axis2MessageContext)synCtx).getAxis2MessageContext();
/*     */     
/* 124 */     ConfigurationContext cc = axisMC.getConfigurationContext();
/*     */ 
/*     */ 
/*     */     
/* 128 */     ClusterManager clusterManager = cc.getAxisConfiguration().getClusterManager();
/* 129 */     if (clusterManager != null && clusterManager.getContextManager() != null)
/*     */     {
/* 131 */       isClusteringEnable = true;
/*     */     }
/*     */     
/* 134 */     String endPointName = getName();
/* 135 */     if (endPointName == null) {
/*     */       
/* 137 */       if (traceOrDebugOn && isClusteringEnable) {
/* 138 */         this.log.warn(""In a clustering environment, the endpoint name should be specified even for anonymous endpoints. Otherwise the clustering would not function properly, if there are more than one anonymous endpoints."");
/*     */       }
/* 140 */       endPointName = ""AnonymousEndpoint"";
/*     */     } 
/*     */     
/* 143 */     if (isClusteringEnable)
/*     */     {
/*     */       
/* 146 */       if (this.endpointContext.getConfigurationContext() == null) {
/* 147 */         this.endpointContext.setConfigurationContext(cc);
/* 148 */         this.endpointContext.setContextID(endPointName);
/*     */       } 
/*     */     }
/*     */     
/* 152 */     EndpointDefinition endpoint = getEndpoint();
/*     */     
/* 154 */     boolean statisticsEnable = (1 == endpoint.getStatisticsState());
/*     */     
/* 156 */     if (statisticsEnable) {
/* 157 */       EndPointStatisticsStack endPointStatisticsStack = null;
/* 158 */       Object statisticsStackObj = synCtx.getProperty(""synapse.endpoint.stats"");
/*     */       
/* 160 */       if (statisticsStackObj == null) {
/* 161 */         endPointStatisticsStack = new EndPointStatisticsStack();
/* 162 */         synCtx.setProperty(""synapse.endpoint.stats"", endPointStatisticsStack);
/*     */       }
/* 164 */       else if (statisticsStackObj instanceof EndPointStatisticsStack) {
/* 165 */         endPointStatisticsStack = (EndPointStatisticsStack)statisticsStackObj;
/*     */       } 
/* 167 */       if (endPointStatisticsStack != null) {
/* 168 */         boolean isFault = synCtx.getEnvelope().getBody().hasFault();
/* 169 */         endPointStatisticsStack.put(endPointName, System.currentTimeMillis(), !synCtx.isResponse(), statisticsEnable, isFault);
/*     */       } 
/*     */     } 
/*     */ 
/*     */     
/* 174 */     if (endpoint.getAddress() != null && 
/* 175 */       traceOrDebugOn) {
/* 176 */       traceOrDebug(traceOn, ""Sending message to endpoint : "" + endPointName + "" resolves to address = "" + endpoint.getAddress());
/*     */       
/* 178 */       traceOrDebug(traceOn, ""SOAPAction: "" + ((synCtx.getSoapAction() != null) ? synCtx.getSoapAction() : ""null""));
/*     */       
/* 180 */       traceOrDebug(traceOn, ""WSA-Action: "" + ((synCtx.getWSAAction() != null) ? synCtx.getWSAAction() : ""null""));
/*     */ 
/*     */       
/* 183 */       if (traceOn && trace.isTraceEnabled()) {
/* 184 */         trace.trace(""Envelope : \n"" + synCtx.getEnvelope());
/*     */       }
/*     */     } 
/*     */ 
/*     */ 
/*     */     
/* 190 */     synCtx.pushFaultHandler(this);
/*     */ 
/*     */     
/* 193 */     synCtx.setProperty(""processed_endpoint"", this);
/*     */     
/* 195 */     synCtx.getEnvironment().send(endpoint, synCtx);
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public void onFault(MessageContext synCtx) {
/* 202 */     setActive(false, synCtx);
/* 203 */     super.onFault(synCtx);
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\endpoints\AddressEndpoint.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.endpoints.DefaultEndpoint,"/*     */ package org.apache.synapse.endpoints;
/*     */ 
/*     */ import java.util.Stack;
/*     */ import org.apache.commons.logging.Log;
/*     */ import org.apache.commons.logging.LogFactory;
/*     */ import org.apache.synapse.FaultHandler;
/*     */ import org.apache.synapse.MessageContext;
/*     */ import org.apache.synapse.endpoints.utils.EndpointDefinition;
/*     */ import org.apache.synapse.statistics.impl.EndPointStatisticsStack;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class DefaultEndpoint
/*     */   extends FaultHandler
/*     */   implements Endpoint
/*     */ {
/*     */   protected Log log;
/*  42 */   protected static final Log trace = LogFactory.getLog(""TRACE_LOGGER"");
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  48 */   private String name = null;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  54 */   private EndpointDefinition endpoint = null;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  60 */   private Endpoint parentEndpoint = null;
/*     */ 
/*     */   
/*  63 */   public DefaultEndpoint() { this.log = LogFactory.getLog(getClass()); }
/*     */ 
/*     */ 
/*     */   
/*  67 */   public EndpointDefinition getEndpoint() { return this.endpoint; }
/*     */ 
/*     */ 
/*     */   
/*  71 */   public void setEndpoint(EndpointDefinition endpoint) { this.endpoint = endpoint; }
/*     */ 
/*     */ 
/*     */   
/*  75 */   public String getName() { return this.name; }
/*     */ 
/*     */ 
/*     */   
/*  79 */   public void setName(String name) { this.name = name.trim(); }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  90 */   public boolean isActive(MessageContext synMessageContext) { return true; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public synchronized void setActive(boolean active, MessageContext synMessageContext) {}
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public void send(MessageContext synCtx) {
/* 115 */     boolean traceOn = isTraceOn(synCtx);
/* 116 */     boolean traceOrDebugOn = isTraceOrDebugOn(traceOn);
/*     */     
/* 118 */     if (traceOrDebugOn) {
/* 119 */       traceOrDebug(traceOn, ""Start : Default Endpoint"");
/*     */       
/* 121 */       if (traceOn && trace.isTraceEnabled()) {
/* 122 */         trace.trace(""Message : "" + synCtx.getEnvelope());
/*     */       }
/*     */     } 
/*     */     
/* 126 */     String endPointName = getName();
/* 127 */     if (endPointName == null) {
/* 128 */       endPointName = ""AnonymousEndpoint"";
/*     */     }
/*     */ 
/*     */     
/* 132 */     boolean statisticsEnable = (1 == this.endpoint.getStatisticsState());
/*     */     
/* 134 */     if (statisticsEnable) {
/* 135 */       EndPointStatisticsStack endPointStatisticsStack = null;
/* 136 */       Object statisticsStackObj = synCtx.getProperty(""synapse.endpoint.stats"");
/*     */       
/* 138 */       if (statisticsStackObj == null) {
/* 139 */         endPointStatisticsStack = new EndPointStatisticsStack();
/* 140 */         synCtx.setProperty(""synapse.endpoint.stats"", endPointStatisticsStack);
/*     */       }
/* 142 */       else if (statisticsStackObj instanceof EndPointStatisticsStack) {
/* 143 */         endPointStatisticsStack = (EndPointStatisticsStack)statisticsStackObj;
/*     */       } 
/* 145 */       if (endPointStatisticsStack != null) {
/* 146 */         boolean isFault = synCtx.getEnvelope().getBody().hasFault();
/* 147 */         endPointStatisticsStack.put(endPointName, System.currentTimeMillis(), !synCtx.isResponse(), statisticsEnable, isFault);
/*     */       } 
/*     */     } 
/*     */ 
/*     */     
/* 152 */     if (synCtx.getTo() != null && synCtx.getTo().getAddress() != null && 
/* 153 */       traceOrDebugOn) {
/* 154 */       traceOrDebug(traceOn, ""Sending message to endpoint : "" + endPointName + "" resolves to address = "" + synCtx.getTo().getAddress());
/*     */       
/* 156 */       traceOrDebug(traceOn, ""SOAPAction: "" + ((synCtx.getSoapAction() != null) ? synCtx.getSoapAction() : ""null""));
/*     */       
/* 158 */       traceOrDebug(traceOn, ""WSA-Action: "" + ((synCtx.getWSAAction() != null) ? synCtx.getWSAAction() : ""null""));
/*     */ 
/*     */       
/* 161 */       if (traceOn && trace.isTraceEnabled()) {
/* 162 */         trace.trace(""Envelope : \n"" + synCtx.getEnvelope());
/*     */       }
/*     */     } 
/*     */ 
/*     */ 
/*     */     
/* 168 */     synCtx.pushFaultHandler(this);
/*     */ 
/*     */     
/* 171 */     synCtx.setProperty(""processed_endpoint"", this);
/*     */     
/* 173 */     synCtx.getEnvironment().send(this.endpoint, synCtx);
/*     */   }
/*     */ 
/*     */ 
/*     */   
/*     */   public void onChildEndpointFail(Endpoint endpoint, MessageContext synMessageContext) {}
/*     */ 
/*     */   
/* 181 */   public void setParentEndpoint(Endpoint parentEndpoint) { this.parentEndpoint = parentEndpoint; }
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public void onFault(MessageContext synCtx) {
/* 187 */     if (this.parentEndpoint != null) {
/* 188 */       this.parentEndpoint.onChildEndpointFail(this, synCtx);
/*     */     } else {
/* 190 */       Stack<FaultHandler> faultStack = synCtx.getFaultStack();
/* 191 */       if (!faultStack.isEmpty()) {
/* 192 */         ((FaultHandler)faultStack.pop()).handleFault(synCtx);
/*     */       }
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 205 */   protected boolean isTraceOn(MessageContext msgCtx) { return (this.endpoint.getTraceState() == 1 || (this.endpoint.getTraceState() == 2 && msgCtx.getTracingState() == 1)); }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 217 */   protected boolean isTraceOrDebugOn(boolean isTraceOn) { return (isTraceOn || this.log.isDebugEnabled()); }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   protected void traceOrDebug(boolean traceOn, String msg) {
/* 227 */     if (traceOn) {
/* 228 */       trace.info(msg);
/*     */     }
/* 230 */     if (this.log.isDebugEnabled())
/* 231 */       this.log.debug(msg); 
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\endpoints\DefaultEndpoint.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.endpoints.Endpoint,"package org.apache.synapse.endpoints;
import org.apache.synapse.MessageContext;
public interface Endpoint {
  void send(MessageContext paramMessageContext);
  void onChildEndpointFail(Endpoint paramEndpoint, MessageContext paramMessageContext);
  void setParentEndpoint(Endpoint paramEndpoint);
  String getName();
  void setName(String paramString);
  boolean isActive(MessageContext paramMessageContext);
  void setActive(boolean paramBoolean, MessageContext paramMessageContext);
}
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\endpoints\Endpoint.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.endpoints.EndpointContext,"/*     */ package org.apache.synapse.endpoints;
/*     */ 
/*     */ import org.apache.axis2.clustering.ClusteringFault;
/*     */ import org.apache.axis2.clustering.context.Replicator;
/*     */ import org.apache.axis2.context.AbstractContext;
/*     */ import org.apache.axis2.context.ConfigurationContext;
/*     */ import org.apache.commons.logging.Log;
/*     */ import org.apache.commons.logging.LogFactory;
/*     */ import org.apache.synapse.SynapseException;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class EndpointContext
/*     */ {
/*  41 */   private static final Log log = LogFactory.getLog(EndpointContext.class);
/*     */ 
/*     */   
/*     */   private static final String ACTIVE = ""active"";
/*     */ 
/*     */   
/*     */   private static final String RECOVER_ON = ""recover_on"";
/*     */ 
/*     */   
/*     */   private static final String UNDERSCORE_STRING = ""_"";
/*     */   
/*     */   private boolean active = true;
/*     */   
/*  54 */   private long recoverOn = Long.MAX_VALUE;
/*     */ 
/*     */ 
/*     */   
/*     */   private ConfigurationContext configCtx;
/*     */ 
/*     */ 
/*     */   
/*     */   private String activePropertyKey;
/*     */ 
/*     */ 
/*     */   
/*     */   private String recoverOnPropertyKey;
/*     */ 
/*     */ 
/*     */   
/*     */   private boolean isClusteringEnable = false;
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public boolean isActive() {
/*  76 */     if (this.isClusteringEnable) {
/*     */       
/*  78 */       if (this.activePropertyKey == null || """".equals(this.activePropertyKey)) {
/*  79 */         handleException(""Cannot find the required key to find the shared state of 'active' attribute"");
/*     */       }
/*     */ 
/*     */ 
/*     */       
/*  84 */       Object value = this.configCtx.getPropertyNonReplicable(this.activePropertyKey);
/*  85 */       if (value == null) {
/*  86 */         return true;
/*     */       }
/*  88 */       if (value instanceof Boolean)
/*  89 */         return ((Boolean)value).booleanValue(); 
/*  90 */       if (value instanceof String) {
/*  91 */         return Boolean.parseBoolean((String)value);
/*     */       }
/*  93 */       handleException(""Unsupported object type for value"" + value);
/*     */     }
/*     */     else {
/*     */       
/*  97 */       return this.active;
/*     */     } 
/*     */     
/* 100 */     throw new SynapseException(""Invalid states in endpoint context"");
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public synchronized void setActive(boolean active) {
/* 111 */     if (this.isClusteringEnable) {
/*     */       
/* 113 */       setAndReplicateState(this.activePropertyKey, Boolean.valueOf(active));
/*     */     } else {
/* 115 */       this.active = active;
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public long getRecoverOn() {
/* 127 */     if (this.isClusteringEnable) {
/*     */       
/* 129 */       if (this.recoverOnPropertyKey == null || """".equals(this.recoverOnPropertyKey)) {
/* 130 */         handleException(""Cannot find the required key to find the shared state of 'recoveOn' attribute"");
/*     */       }
/*     */ 
/*     */ 
/*     */       
/* 135 */       Object value = this.configCtx.getPropertyNonReplicable(this.recoverOnPropertyKey);
/* 136 */       if (value == null) {
/* 137 */         return Long.MAX_VALUE;
/*     */       }
/* 139 */       if (value instanceof Long)
/* 140 */         return ((Long)value).longValue(); 
/* 141 */       if (value instanceof String) {
/*     */         try {
/* 143 */           return Long.parseLong((String)value);
/* 144 */         } catch (NumberFormatException e) {
/* 145 */           return Long.MAX_VALUE;
/*     */         } 
/*     */       }
/* 148 */       handleException(""Unsupported object type for value"" + value);
/*     */     }
/*     */     else {
/*     */       
/* 152 */       return this.recoverOn;
/*     */     } 
/* 154 */     throw new SynapseException(""Invalid states in endpoint context"");
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public void setRecoverOn(long recoverOn) {
/* 164 */     if (this.isClusteringEnable) {
/*     */       
/* 166 */       setAndReplicateState(this.recoverOnPropertyKey, Long.valueOf(recoverOn));
/*     */     } else {
/* 168 */       this.recoverOn = recoverOn;
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 178 */   public ConfigurationContext getConfigurationContext() { return this.configCtx; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public void setConfigurationContext(ConfigurationContext configCtx) {
/* 189 */     if (configCtx == null) {
/* 190 */       handleException(""The ConfigurationContext cannot be null when system in a cluster environment"");
/*     */     }
/*     */ 
/*     */     
/* 194 */     this.configCtx = configCtx;
/* 195 */     this.isClusteringEnable = true;
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public void setContextID(String contextID) {
/* 206 */     if (contextID == null || """".equals(contextID)) {
/* 207 */       handleException(""The Context ID cannot be null when system in a cluster environment"");
/*     */     }
/*     */ 
/*     */ 
/*     */     
/* 212 */     StringBuffer buffer = new StringBuffer();
/* 213 */     buffer.append(contextID);
/* 214 */     buffer.append(""_"");
/* 215 */     String prefix = buffer.toString();
/*     */     
/* 217 */     this.recoverOnPropertyKey = prefix + ""recover_on"";
/* 218 */     this.activePropertyKey = prefix + ""active"";
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   private void setAndReplicateState(String key, Object value) {
/* 232 */     if (this.configCtx != null && key != null && value != null) {
/*     */       
/*     */       try {
/* 235 */         if (log.isDebugEnabled()) {
/* 236 */           log.debug(""Start replicating the property with key : "" + key + "" value : "" + value);
/*     */         }
/*     */ 
/*     */         
/* 240 */         this.configCtx.setProperty(key, value);
/* 241 */         Replicator.replicate((AbstractContext)this.configCtx, new String[] { key });
/*     */         
/* 243 */         if (log.isDebugEnabled()) {
/* 244 */           log.debug(""Completed replication of the property with key : "" + key);
/*     */         }
/*     */       }
/* 247 */       catch (ClusteringFault clusteringFault) {
/* 248 */         handleException(""Error during the replicating states "", (Exception)clusteringFault);
/*     */       } 
/*     */     }
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   protected void handleException(String msg) {
/* 259 */     log.error(msg);
/* 260 */     throw new SynapseException(msg);
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   protected void handleException(String msg, Exception e) {
/* 270 */     log.error(msg, e);
/* 271 */     throw new SynapseException(msg, e);
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\endpoints\EndpointContext.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.endpoints.FailoverEndpoint,"/*     */ package org.apache.synapse.endpoints;
/*     */ 
/*     */ import java.util.List;
/*     */ import org.apache.axis2.clustering.ClusterManager;
/*     */ import org.apache.axis2.context.ConfigurationContext;
/*     */ import org.apache.axis2.context.MessageContext;
/*     */ import org.apache.commons.logging.Log;
/*     */ import org.apache.commons.logging.LogFactory;
/*     */ import org.apache.synapse.FaultHandler;
/*     */ import org.apache.synapse.MessageContext;
/*     */ import org.apache.synapse.core.axis2.Axis2MessageContext;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class FailoverEndpoint
/*     */   implements Endpoint
/*     */ {
/*  44 */   private static final Log log = LogFactory.getLog(FailoverEndpoint.class);
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  50 */   private String name = null;
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  55 */   private List<Endpoint> endpoints = null;
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  60 */   private Endpoint currentEndpoint = null;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  67 */   private Endpoint parentEndpoint = null;
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  72 */   private final EndpointContext endpointContext = new EndpointContext();
/*     */ 
/*     */   
/*     */   public void send(MessageContext synMessageContext) {
/*  76 */     if (log.isDebugEnabled()) {
/*  77 */       log.debug(""Start : Failover Endpoint"");
/*     */     }
/*     */     
/*  80 */     boolean isClusteringEnable = false;
/*     */     
/*  82 */     MessageContext axisMC = ((Axis2MessageContext)synMessageContext).getAxis2MessageContext();
/*     */     
/*  84 */     ConfigurationContext cc = axisMC.getConfigurationContext();
/*     */ 
/*     */ 
/*     */     
/*  88 */     ClusterManager clusterManager = cc.getAxisConfiguration().getClusterManager();
/*  89 */     if (clusterManager != null && clusterManager.getContextManager() != null)
/*     */     {
/*  91 */       isClusteringEnable = true;
/*     */     }
/*     */     
/*  94 */     String endPointName = getName();
/*  95 */     if (endPointName == null) {
/*     */       
/*  97 */       if (log.isDebugEnabled() && isClusteringEnable) {
/*  98 */         log.warn(""In a clustering environment , the endpoint  name should be specifiedeven for anonymous endpoints. Otherwise , the clustering would not be functioned correctly if there are more than one anonymous endpoints. "");
/*     */       }
/*     */ 
/*     */       
/* 102 */       endPointName = ""AnonymousEndpoint"";
/*     */     } 
/*     */     
/* 105 */     if (isClusteringEnable)
/*     */     {
/* 107 */       if (this.endpointContext.getConfigurationContext() == null) {
/* 108 */         this.endpointContext.setConfigurationContext(cc);
/* 109 */         this.endpointContext.setContextID(endPointName);
/*     */       } 
/*     */     }
/*     */ 
/*     */ 
/*     */ 
/*     */     
/* 116 */     synMessageContext.getEnvelope().build();
/*     */     
/* 118 */     if (this.currentEndpoint.isActive(synMessageContext)) {
/* 119 */       this.currentEndpoint.send(synMessageContext);
/*     */     } else {
/*     */       
/* 122 */       boolean foundEndpoint = false;
/* 123 */       for (Endpoint endpoint : this.endpoints) {
/* 124 */         if (endpoint.isActive(synMessageContext)) {
/* 125 */           foundEndpoint = true;
/* 126 */           this.currentEndpoint = endpoint;
/* 127 */           this.currentEndpoint.send(synMessageContext);
/*     */           
/*     */           break;
/*     */         } 
/*     */       } 
/* 132 */       if (!foundEndpoint) {
/*     */         
/* 134 */         setActive(false, synMessageContext);
/*     */         
/* 136 */         if (this.parentEndpoint != null) {
/* 137 */           this.parentEndpoint.onChildEndpointFail(this, synMessageContext);
/*     */         } else {
/* 139 */           Object o = synMessageContext.getFaultStack().pop();
/* 140 */           if (o != null) {
/* 141 */             ((FaultHandler)o).handleFault(synMessageContext);
/*     */           }
/*     */         } 
/*     */       } 
/*     */     } 
/*     */   }
/*     */ 
/*     */   
/* 149 */   public String getName() { return this.name; }
/*     */ 
/*     */ 
/*     */   
/* 153 */   public void setName(String name) { this.name = name.trim(); }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public boolean isActive(MessageContext synMessageContext) {
/* 165 */     boolean active = this.endpointContext.isActive();
/* 166 */     if (!active) {
/* 167 */       for (Endpoint endpoint : this.endpoints) {
/* 168 */         if (endpoint.isActive(synMessageContext)) {
/* 169 */           active = true;
/* 170 */           this.endpointContext.setActive(true);
/*     */         } 
/*     */       } 
/*     */     }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */     
/* 179 */     if (log.isDebugEnabled()) {
/* 180 */       log.debug(""Endpoint  '"" + this.name + ""' is in state ' "" + active + "" '"");
/*     */     }
/*     */     
/* 183 */     return active;
/*     */   }
/*     */ 
/*     */ 
/*     */   
/* 188 */   public void setActive(boolean active, MessageContext synMessageContext) { this.endpointContext.setActive(active); }
/*     */ 
/*     */ 
/*     */   
/* 192 */   public List<Endpoint> getEndpoints() { return this.endpoints; }
/*     */ 
/*     */   
/*     */   public void setEndpoints(List<Endpoint> endpoints) {
/* 196 */     this.endpoints = endpoints;
/* 197 */     if (endpoints.size() > 0) {
/* 198 */       this.currentEndpoint = endpoints.get(0);
/*     */     }
/*     */   }
/*     */ 
/*     */   
/* 203 */   public void onChildEndpointFail(Endpoint endpoint, MessageContext synMessageContext) { send(synMessageContext); }
/*     */ 
/*     */ 
/*     */   
/* 207 */   public void setParentEndpoint(Endpoint parentEndpoint) { this.parentEndpoint = parentEndpoint; }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\endpoints\FailoverEndpoint.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.endpoints.IndirectEndpoint,"/*     */ package org.apache.synapse.endpoints;
/*     */ 
/*     */ import org.apache.commons.logging.Log;
/*     */ import org.apache.commons.logging.LogFactory;
/*     */ import org.apache.synapse.FaultHandler;
/*     */ import org.apache.synapse.MessageContext;
/*     */ import org.apache.synapse.SynapseException;
/*     */ import org.apache.synapse.endpoints.utils.EndpointDefinition;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class IndirectEndpoint
/*     */   extends FaultHandler
/*     */   implements Endpoint
/*     */ {
/*  40 */   private static final Log trace = LogFactory.getLog(""TRACE_LOGGER"");
/*  41 */   private static final Log log = LogFactory.getLog(IndirectEndpoint.class);
/*     */   
/*  43 */   private String name = null;
/*  44 */   private String key = null;
/*  45 */   private Endpoint parentEndpoint = null;
/*     */ 
/*     */ 
/*     */   
/*     */   public void send(MessageContext synMessageContext) {
/*  50 */     Endpoint endpoint = synMessageContext.getEndpoint(this.key);
/*  51 */     if (endpoint == null) {
/*  52 */       handleException(""Reference to non-existent endpoint for key : "" + this.key);
/*     */     }
/*     */     
/*  55 */     assert endpoint != null;
/*  56 */     if (endpoint.isActive(synMessageContext)) {
/*     */       
/*  58 */       synMessageContext.pushFaultHandler(this);
/*  59 */       endpoint.send(synMessageContext);
/*     */ 
/*     */     
/*     */     }
/*  63 */     else if (this.parentEndpoint != null) {
/*  64 */       auditWarn(""Endpoint : "" + endpoint.getName() + "" is currently inactive"" + "" - invoking parent endpoint"", synMessageContext);
/*     */       
/*  66 */       this.parentEndpoint.onChildEndpointFail(this, synMessageContext);
/*     */     } else {
/*     */       
/*  69 */       auditWarn(""Endpoint : "" + endpoint.getName() + "" is currently inactive"" + "" - invoking fault handler / assuming failure"", synMessageContext);
/*     */ 
/*     */       
/*  72 */       Object o = synMessageContext.getFaultStack().pop();
/*  73 */       if (o != null) {
/*  74 */         ((FaultHandler)o).handleFault(synMessageContext);
/*     */       }
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */   
/*  81 */   public String getName() { return this.name; }
/*     */ 
/*     */ 
/*     */   
/*  85 */   public void setName(String name) { this.name = name.trim(); }
/*     */ 
/*     */ 
/*     */   
/*  89 */   public String getKey() { return this.key; }
/*     */ 
/*     */ 
/*     */   
/*  93 */   public void setKey(String key) { this.key = key; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public boolean isActive(MessageContext synMessageContext) {
/* 104 */     Endpoint endpoint = synMessageContext.getEndpoint(this.key);
/* 105 */     if (endpoint == null) {
/* 106 */       handleException(""Reference to non-existent endpoint for key : "" + this.key);
/*     */     }
/*     */     
/* 109 */     assert endpoint != null;
/* 110 */     return endpoint.isActive(synMessageContext);
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public void setActive(boolean active, MessageContext synMessageContext) {
/* 121 */     Endpoint endpoint = synMessageContext.getEndpoint(this.key);
/* 122 */     if (endpoint == null) {
/* 123 */       handleException(""Reference to non-existent endpoint for key : "" + this.key);
/*     */     }
/*     */     
/* 126 */     assert endpoint != null;
/* 127 */     endpoint.setActive(active, synMessageContext);
/*     */   }
/*     */ 
/*     */   
/* 131 */   public void setParentEndpoint(Endpoint parentEndpoint) { this.parentEndpoint = parentEndpoint; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public void onChildEndpointFail(Endpoint endpoint, MessageContext synMessageContext) {
/* 138 */     if (this.parentEndpoint != null) {
/* 139 */       this.parentEndpoint.onChildEndpointFail(this, synMessageContext);
/*     */     } else {
/* 141 */       Object o = synMessageContext.getFaultStack().pop();
/* 142 */       if (o != null) {
/* 143 */         ((FaultHandler)o).handleFault(synMessageContext);
/*     */       }
/*     */     } 
/*     */   }
/*     */   
/*     */   private void handleException(String msg) {
/* 149 */     log.error(msg);
/* 150 */     throw new SynapseException(msg);
/*     */   }
/*     */   
/*     */   protected void auditWarn(String msg, MessageContext msgContext) {
/* 154 */     log.warn(msg);
/* 155 */     if (msgContext.getServiceLog() != null) {
/* 156 */       msgContext.getServiceLog().warn(msg);
/*     */     }
/* 158 */     if (shouldTrace(msgContext)) {
/* 159 */       trace.warn(msg);
/*     */     }
/*     */   }
/*     */   
/*     */   public boolean shouldTrace(MessageContext synCtx) {
/* 164 */     Endpoint endpoint = synCtx.getEndpoint(this.key);
/* 165 */     EndpointDefinition endptDefn = null;
/* 166 */     if (endpoint instanceof AddressEndpoint) {
/* 167 */       AddressEndpoint addEndpt = (AddressEndpoint)endpoint;
/* 168 */       endptDefn = addEndpt.getEndpoint();
/* 169 */     } else if (endpoint instanceof WSDLEndpoint) {
/* 170 */       WSDLEndpoint wsdlEndpt = (WSDLEndpoint)endpoint;
/* 171 */       endptDefn = wsdlEndpt.getEndpoint();
/*     */     } 
/*     */     
/* 174 */     return (endptDefn != null && (endptDefn.getTraceState() == 1 || (endptDefn.getTraceState() == 2 && synCtx.getTracingState() == 1)));
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public void onFault(MessageContext synMessageContext) {
/* 183 */     if (this.parentEndpoint != null) {
/* 184 */       this.parentEndpoint.onChildEndpointFail(this, synMessageContext);
/*     */     } else {
/* 186 */       Object o = synMessageContext.getFaultStack().pop();
/* 187 */       if (o != null)
/* 188 */         ((FaultHandler)o).handleFault(synMessageContext); 
/*     */     } 
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\endpoints\IndirectEndpoint.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.endpoints.LoadbalanceEndpoint,"/*     */ package org.apache.synapse.endpoints;
/*     */ 
/*     */ import java.util.List;
/*     */ import org.apache.axis2.clustering.ClusterManager;
/*     */ import org.apache.axis2.context.ConfigurationContext;
/*     */ import org.apache.axis2.context.MessageContext;
/*     */ import org.apache.commons.logging.Log;
/*     */ import org.apache.commons.logging.LogFactory;
/*     */ import org.apache.synapse.FaultHandler;
/*     */ import org.apache.synapse.MessageContext;
/*     */ import org.apache.synapse.core.axis2.Axis2MessageContext;
/*     */ import org.apache.synapse.endpoints.algorithms.AlgorithmContext;
/*     */ import org.apache.synapse.endpoints.algorithms.LoadbalanceAlgorithm;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class LoadbalanceEndpoint
/*     */   implements Endpoint
/*     */ {
/*  46 */   private static final Log log = LogFactory.getLog(LoadbalanceEndpoint.class);
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  51 */   private String name = null;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  57 */   private List<Endpoint> endpoints = null;
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  62 */   private LoadbalanceAlgorithm algorithm = null;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   private boolean failover = true;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  74 */   private Endpoint parentEndpoint = null;
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  79 */   private final EndpointContext endpointContext = new EndpointContext();
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  85 */   private final AlgorithmContext algorithmContext = new AlgorithmContext();
/*     */ 
/*     */   
/*     */   public void send(MessageContext synMessageContext) {
/*  89 */     if (log.isDebugEnabled()) {
/*  90 */       log.debug(""Start : Load-balance Endpoint"");
/*     */     }
/*     */     
/*  93 */     boolean isClusteringEnable = false;
/*     */     
/*  95 */     MessageContext axisMC = ((Axis2MessageContext)synMessageContext).getAxis2MessageContext();
/*     */     
/*  97 */     ConfigurationContext cc = axisMC.getConfigurationContext();
/*     */ 
/*     */ 
/*     */     
/* 101 */     ClusterManager clusterManager = cc.getAxisConfiguration().getClusterManager();
/* 102 */     if (clusterManager != null && clusterManager.getContextManager() != null)
/*     */     {
/* 104 */       isClusteringEnable = true;
/*     */     }
/*     */     
/* 107 */     String endPointName = getName();
/* 108 */     if (endPointName == null) {
/*     */       
/* 110 */       if (isClusteringEnable) {
/* 111 */         log.warn(""In a clustering environment , the endpoint  name should be specifiedeven for anonymous endpoints. Otherwise , the clustering would not be functioned correctly if there are more than one anonymous endpoints. "");
/*     */       }
/*     */ 
/*     */       
/* 115 */       endPointName = ""AnonymousEndpoint"";
/*     */     } 
/*     */     
/* 118 */     if (isClusteringEnable) {
/*     */ 
/*     */       
/* 121 */       if (this.endpointContext.getConfigurationContext() == null) {
/* 122 */         this.endpointContext.setConfigurationContext(cc);
/* 123 */         this.endpointContext.setContextID(endPointName);
/*     */       } 
/*     */ 
/*     */ 
/*     */       
/* 128 */       if (this.algorithmContext.getConfigurationContext() == null) {
/* 129 */         this.algorithmContext.setConfigurationContext(cc);
/* 130 */         this.algorithmContext.setContextID(endPointName);
/*     */       } 
/*     */     } 
/*     */     
/* 134 */     Endpoint endpoint = this.algorithm.getNextEndpoint(synMessageContext, this.algorithmContext);
/* 135 */     if (endpoint != null) {
/*     */ 
/*     */ 
/*     */ 
/*     */       
/* 140 */       if (this.failover) {
/* 141 */         synMessageContext.getEnvelope().build();
/*     */       }
/*     */       
/* 144 */       endpoint.send(synMessageContext);
/*     */     }
/*     */     else {
/*     */       
/* 148 */       setActive(false, synMessageContext);
/*     */       
/* 150 */       if (this.parentEndpoint != null) {
/* 151 */         this.parentEndpoint.onChildEndpointFail(this, synMessageContext);
/*     */       } else {
/* 153 */         Object o = synMessageContext.getFaultStack().pop();
/* 154 */         if (o != null) {
/* 155 */           ((FaultHandler)o).handleFault(synMessageContext);
/*     */         }
/*     */       } 
/*     */     } 
/*     */   }
/*     */ 
/*     */   
/* 162 */   public String getName() { return this.name; }
/*     */ 
/*     */ 
/*     */   
/* 166 */   public void setName(String name) { this.name = name.trim(); }
/*     */ 
/*     */ 
/*     */   
/* 170 */   public LoadbalanceAlgorithm getAlgorithm() { return this.algorithm; }
/*     */ 
/*     */ 
/*     */   
/* 174 */   public void setAlgorithm(LoadbalanceAlgorithm algorithm) { this.algorithm = algorithm; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public boolean isActive(MessageContext synMessageContext) {
/* 187 */     boolean active = this.endpointContext.isActive();
/* 188 */     if (!active && this.endpoints != null) {
/* 189 */       for (Endpoint endpoint : this.endpoints) {
/* 190 */         if (endpoint.isActive(synMessageContext)) {
/* 191 */           active = true;
/* 192 */           this.endpointContext.setActive(true);
/*     */         } 
/*     */       } 
/*     */     }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */     
/* 201 */     if (log.isDebugEnabled()) {
/* 202 */       log.debug(""Endpoint  '"" + this.name + ""' is in state ' "" + active + "" '"");
/*     */     }
/*     */     
/* 205 */     return active;
/*     */   }
/*     */ 
/*     */ 
/*     */   
/* 210 */   public void setActive(boolean active, MessageContext synMessageContext) { this.endpointContext.setActive(active); }
/*     */ 
/*     */ 
/*     */   
/* 214 */   public boolean isFailover() { return this.failover; }
/*     */ 
/*     */ 
/*     */   
/* 218 */   public void setFailover(boolean failover) { this.failover = failover; }
/*     */ 
/*     */ 
/*     */   
/* 222 */   public List<Endpoint> getEndpoints() { return this.endpoints; }
/*     */ 
/*     */ 
/*     */   
/* 226 */   public void setEndpoints(List<Endpoint> endpoints) { this.endpoints = endpoints; }
/*     */ 
/*     */ 
/*     */   
/* 230 */   public void setParentEndpoint(Endpoint parentEndpoint) { this.parentEndpoint = parentEndpoint; }
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public void onChildEndpointFail(Endpoint endpoint, MessageContext synMessageContext) {
/* 236 */     if (this.failover) {
/* 237 */       send(synMessageContext);
/*     */     
/*     */     }
/*     */     else {
/*     */ 
/*     */       
/* 243 */       Object o = synMessageContext.getFaultStack().pop();
/* 244 */       if (o != null)
/* 245 */         ((FaultHandler)o).handleFault(synMessageContext); 
/*     */     } 
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\endpoints\LoadbalanceEndpoint.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.endpoints.SALoadbalanceEndpoint,"/*     */ package org.apache.synapse.endpoints;
/*     */ 
/*     */ import java.util.ArrayList;
/*     */ import java.util.List;
/*     */ import org.apache.axis2.clustering.ClusterManager;
/*     */ import org.apache.axis2.context.ConfigurationContext;
/*     */ import org.apache.axis2.context.MessageContext;
/*     */ import org.apache.axis2.context.OperationContext;
/*     */ import org.apache.commons.logging.Log;
/*     */ import org.apache.commons.logging.LogFactory;
/*     */ import org.apache.synapse.FaultHandler;
/*     */ import org.apache.synapse.MessageContext;
/*     */ import org.apache.synapse.core.axis2.Axis2MessageContext;
/*     */ import org.apache.synapse.endpoints.algorithms.AlgorithmContext;
/*     */ import org.apache.synapse.endpoints.algorithms.LoadbalanceAlgorithm;
/*     */ import org.apache.synapse.endpoints.dispatch.Dispatcher;
/*     */ import org.apache.synapse.endpoints.dispatch.DispatcherContext;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class SALoadbalanceEndpoint
/*     */   implements Endpoint
/*     */ {
/*  60 */   private static final Log log = LogFactory.getLog(SALoadbalanceEndpoint.class);
/*     */ 
/*     */   
/*     */   private static final String FIRST_MESSAGE_IN_SESSION = ""first_message_in_session"";
/*     */ 
/*     */   
/*     */   public static final String ENDPOINT_LIST = ""endpointList"";
/*     */   
/*     */   public static final String ROOT_ENDPOINT = ""rootendpoint"";
/*     */   
/*     */   public static final String ENDPOINT_NAME_LIST = ""endpointNameList"";
/*     */   
/*     */   public static final String WARN_MESSAGE = ""In a clustering environment, the endpoint name should be specified even for anonymous endpoints. Otherwise the clustering would not function properly, if there are more than one anonymous endpoints."";
/*     */   
/*  74 */   private String name = null;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  80 */   private List<Endpoint> endpoints = null;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  86 */   private LoadbalanceAlgorithm algorithm = null;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  93 */   private Endpoint parentEndpoint = null;
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  98 */   private Dispatcher dispatcher = null;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 104 */   private final DispatcherContext dispatcherContext = new DispatcherContext();
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 109 */   private final EndpointContext endpointContext = new EndpointContext();
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 115 */   private final AlgorithmContext algorithmContext = new AlgorithmContext();
/*     */ 
/*     */ 
/*     */   
/*     */   public void send(MessageContext synMessageContext) {
/* 120 */     if (log.isDebugEnabled()) {
/* 121 */       log.debug(""Start : Session Affinity Load-balance Endpoint "" + this.name);
/*     */     }
/*     */     
/* 124 */     boolean isClusteringEnable = false;
/*     */     
/* 126 */     MessageContext axisMC = ((Axis2MessageContext)synMessageContext).getAxis2MessageContext();
/*     */     
/* 128 */     ConfigurationContext cc = axisMC.getConfigurationContext();
/*     */ 
/*     */     
/* 131 */     ClusterManager clusterManager = cc.getAxisConfiguration().getClusterManager();
/* 132 */     if (clusterManager != null && clusterManager.getContextManager() != null)
/*     */     {
/* 134 */       isClusteringEnable = true;
/*     */     }
/*     */     
/* 137 */     String endpointName = getName();
/* 138 */     if (endpointName == null) {
/* 139 */       if (isClusteringEnable) {
/* 140 */         log.warn(""In a clustering environment, the endpoint name should be specified even for anonymous endpoints. Otherwise the clustering would not function properly, if there are more than one anonymous endpoints."");
/*     */       }
/* 142 */       if (log.isDebugEnabled()) {
/* 143 */         log.debug(""Using the name for the anonymous endpoint as : 'AnonymousEndpoint'"");
/*     */       }
/*     */       
/* 146 */       endpointName = ""AnonymousEndpoint"";
/*     */     } 
/*     */     
/* 149 */     if (isClusteringEnable) {
/*     */ 
/*     */       
/* 152 */       if (this.endpointContext.getConfigurationContext() == null) {
/*     */         
/* 154 */         if (log.isDebugEnabled()) {
/* 155 */           log.debug(""Setting the ConfigurationContext to the EndpointContext with the name "" + endpointName + "" for replicating data on the cluster"");
/*     */         }
/*     */ 
/*     */         
/* 159 */         this.endpointContext.setConfigurationContext(cc);
/* 160 */         this.endpointContext.setContextID(endpointName);
/*     */       } 
/*     */ 
/*     */ 
/*     */       
/* 165 */       if (this.algorithmContext.getConfigurationContext() == null) {
/*     */         
/* 167 */         if (log.isDebugEnabled()) {
/* 168 */           log.debug(""Setting the ConfigurationContext to the AlgorithmContext with the name "" + endpointName + "" for replicating data on the cluster"");
/*     */         }
/*     */ 
/*     */         
/* 172 */         this.algorithmContext.setConfigurationContext(cc);
/* 173 */         this.algorithmContext.setContextID(endpointName);
/*     */       } 
/*     */ 
/*     */ 
/*     */       
/* 178 */       if (this.dispatcherContext.getConfigurationContext() == null) {
/*     */         
/* 180 */         if (log.isDebugEnabled()) {
/* 181 */           log.debug(""Setting the ConfigurationContext to the DispatcherContext with the name "" + endpointName + "" for replicating data on the cluster"");
/*     */         }
/*     */ 
/*     */         
/* 185 */         this.dispatcherContext.setConfigurationContext(cc);
/* 186 */         this.dispatcherContext.setContextID(endpointName);
/*     */         
/* 188 */         if (log.isDebugEnabled()) {
/* 189 */           log.debug(""Setting the endpoints to the DispatcherContext : "" + this.endpoints);
/*     */         }
/* 191 */         this.dispatcherContext.setEndpoints(this.endpoints);
/*     */       } 
/*     */     } 
/*     */ 
/*     */ 
/*     */     
/* 197 */     Endpoint endpoint = this.dispatcher.getEndpoint(synMessageContext, this.dispatcherContext);
/* 198 */     if (endpoint == null) {
/*     */ 
/*     */ 
/*     */       
/* 202 */       endpoint = this.algorithm.getNextEndpoint(synMessageContext, this.algorithmContext);
/*     */ 
/*     */       
/* 205 */       if (this.dispatcher.isServerInitiatedSession()) {
/*     */         
/* 207 */         if (log.isDebugEnabled()) {
/* 208 */           log.debug(""Adding a new server initiated session for the current message"");
/*     */         }
/*     */ 
/*     */         
/* 212 */         Axis2MessageContext axis2MsgCtx = (Axis2MessageContext)synMessageContext;
/* 213 */         OperationContext opCtx = axis2MsgCtx.getAxis2MessageContext().getOperationContext();
/*     */         
/* 215 */         if (isClusteringEnable) {
/*     */           List<String> epNameList;
/*     */ 
/*     */           
/* 219 */           Object o = opCtx.getPropertyNonReplicable(""endpointNameList"");
/*     */           
/* 221 */           if (o instanceof List) {
/* 222 */             epNameList = (List<String>)o;
/* 223 */             epNameList.add(endpointName);
/*     */           }
/*     */           else {
/*     */             
/* 227 */             epNameList = new ArrayList<String>();
/* 228 */             epNameList.add(endpointName);
/* 229 */             opCtx.setNonReplicableProperty(""rootendpoint"", this);
/*     */           } 
/*     */ 
/*     */ 
/*     */           
/* 234 */           if (!(endpoint instanceof SALoadbalanceEndpoint)) {
/*     */             String name;
/*     */             
/* 237 */             if (endpoint instanceof IndirectEndpoint) {
/* 238 */               name = ((IndirectEndpoint)endpoint).getKey();
/*     */             } else {
/* 240 */               name = endpoint.getName();
/*     */             } 
/*     */             
/* 243 */             if (name == null) {
/* 244 */               log.warn(""In a clustering environment, the endpoint name should be specified even for anonymous endpoints. Otherwise the clustering would not function properly, if there are more than one anonymous endpoints."");
/* 245 */               name = ""AnonymousEndpoint"";
/*     */             } 
/* 247 */             epNameList.add(name);
/*     */           } 
/*     */           
/* 250 */           if (log.isDebugEnabled()) {
/* 251 */             log.debug(""Operating on a cluster. Setting the endpoint name list to the OperationContext : "" + epNameList);
/*     */           }
/*     */           
/* 254 */           opCtx.setProperty(""endpointNameList"", epNameList);
/*     */         } else {
/*     */           List<Endpoint> endpointList;
/*     */           
/* 258 */           Object o = opCtx.getProperty(""endpointList"");
/*     */           
/* 260 */           if (o instanceof List) {
/* 261 */             endpointList = (List<Endpoint>)o;
/* 262 */             endpointList.add(this);
/*     */           }
/*     */           else {
/*     */             
/* 266 */             endpointList = new ArrayList<Endpoint>();
/* 267 */             endpointList.add(this);
/* 268 */             opCtx.setProperty(""endpointList"", endpointList);
/*     */           } 
/*     */ 
/*     */ 
/*     */           
/* 273 */           if (!(endpoint instanceof SALoadbalanceEndpoint)) {
/* 274 */             endpointList.add(endpoint);
/*     */           }
/*     */         } 
/*     */       } else {
/*     */         
/* 279 */         this.dispatcher.updateSession(synMessageContext, this.dispatcherContext, endpoint);
/*     */       } 
/*     */ 
/*     */ 
/*     */ 
/*     */       
/* 285 */       synMessageContext.getEnvelope().build();
/*     */ 
/*     */ 
/*     */       
/* 289 */       synMessageContext.setProperty(""first_message_in_session"", Boolean.TRUE);
/*     */     } 
/*     */     
/* 292 */     if (endpoint != null) {
/*     */ 
/*     */ 
/*     */       
/* 296 */       if (endpoint.isActive(synMessageContext)) {
/* 297 */         if (log.isDebugEnabled()) {
/* 298 */           log.debug(""Using the endpoint on the session with "" + ((endpoint instanceof IndirectEndpoint) ? (""key : "" + ((IndirectEndpoint)endpoint).getKey()) : (""name : "" + endpoint.getName())) + "" for sending the message"");
/*     */         }
/*     */ 
/*     */ 
/*     */         
/* 303 */         endpoint.send(synMessageContext);
/*     */       } else {
/* 305 */         informFailure(synMessageContext);
/*     */       }
/*     */     
/*     */     }
/*     */     else {
/*     */       
/* 311 */       if (log.isDebugEnabled()) {
/* 312 */         log.debug(""Marking the Endpoint as failed, because all child endpoints has been failed"");
/*     */       }
/*     */       
/* 315 */       setActive(false, synMessageContext);
/* 316 */       informFailure(synMessageContext);
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public void updateSession(MessageContext responseMsgCtx, List<String> endpointList, boolean isClusteringEnable) {
/* 330 */     Endpoint endpoint = null;
/*     */     
/* 332 */     if (isClusteringEnable) {
/*     */ 
/*     */       
/* 335 */       String epNameObj = endpointList.remove(0);
/* 336 */       for (Endpoint ep : this.endpoints) {
/* 337 */         if (ep != null) {
/*     */           String name;
/*     */           
/* 340 */           if (ep instanceof IndirectEndpoint) {
/* 341 */             name = ((IndirectEndpoint)ep).getKey();
/*     */           } else {
/* 343 */             name = ep.getName();
/*     */           } 
/*     */           
/* 346 */           if (name != null && name.equals(epNameObj)) {
/* 347 */             endpoint = ep;
/*     */             
/*     */             break;
/*     */           } 
/*     */         } 
/*     */       } 
/*     */     } else {
/* 354 */       endpoint = (Endpoint)endpointList.remove(0);
/*     */     } 
/*     */     
/* 357 */     if (endpoint != null) {
/*     */       
/* 359 */       this.dispatcher.updateSession(responseMsgCtx, this.dispatcherContext, endpoint);
/* 360 */       if (endpoint instanceof SALoadbalanceEndpoint) {
/* 361 */         ((SALoadbalanceEndpoint)endpoint).updateSession(responseMsgCtx, endpointList, isClusteringEnable);
/*     */       }
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */   
/* 368 */   public String getName() { return this.name; }
/*     */ 
/*     */ 
/*     */   
/* 372 */   public void setName(String name) { this.name = name.trim(); }
/*     */ 
/*     */ 
/*     */   
/* 376 */   public LoadbalanceAlgorithm getAlgorithm() { return this.algorithm; }
/*     */ 
/*     */ 
/*     */   
/* 380 */   public void setAlgorithm(LoadbalanceAlgorithm algorithm) { this.algorithm = algorithm; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public boolean isActive(MessageContext synMessageContext) {
/*     */     boolean active;
/* 397 */     Endpoint endpoint = this.dispatcher.getEndpoint(synMessageContext, this.dispatcherContext);
/* 398 */     if (endpoint == null) {
/* 399 */       active = this.endpointContext.isActive();
/* 400 */       if (!active && this.endpoints != null) {
/* 401 */         for (Endpoint ep : this.endpoints) {
/* 402 */           if (ep != null) {
/* 403 */             active = ep.isActive(synMessageContext);
/* 404 */             if (active) {
/* 405 */               this.endpointContext.setActive(active);
/*     */             }
/*     */           }
/*     */         
/*     */         }
/*     */       
/*     */       }
/*     */     }
/*     */     else {
/*     */       
/* 415 */       active = endpoint.isActive(synMessageContext);
/* 416 */       if (active) {
/* 417 */         this.endpointContext.setActive(active);
/*     */       }
/*     */     } 
/*     */     
/* 421 */     if (log.isDebugEnabled()) {
/* 422 */       log.debug(""SALoadbalanceEndpoint with name '"" + getName() + ""' is in "" + (active ? ""active"" : ""inactive"") + "" state"");
/*     */     }
/*     */ 
/*     */     
/* 426 */     return active;
/*     */   }
/*     */ 
/*     */   
/* 430 */   public void setActive(boolean active, MessageContext synMessageContext) { this.endpointContext.setActive(active); }
/*     */ 
/*     */ 
/*     */   
/* 434 */   public List<Endpoint> getEndpoints() { return this.endpoints; }
/*     */ 
/*     */ 
/*     */   
/* 438 */   public void setEndpoints(List<Endpoint> endpoints) { this.endpoints = endpoints; }
/*     */ 
/*     */ 
/*     */   
/* 442 */   public void setParentEndpoint(Endpoint parentEndpoint) { this.parentEndpoint = parentEndpoint; }
/*     */ 
/*     */ 
/*     */   
/* 446 */   public Dispatcher getDispatcher() { return this.dispatcher; }
/*     */ 
/*     */ 
/*     */   
/* 450 */   public void setDispatcher(Dispatcher dispatcher) { this.dispatcher = dispatcher; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public void onChildEndpointFail(Endpoint endpoint, MessageContext synMessageContext) {
/* 467 */     Object o = synMessageContext.getProperty(""first_message_in_session"");
/*     */     
/* 469 */     if (o != null && Boolean.TRUE.equals(o)) {
/*     */ 
/*     */ 
/*     */       
/* 473 */       this.dispatcher.unbind(synMessageContext, this.dispatcherContext);
/* 474 */       send(synMessageContext);
/*     */     
/*     */     }
/*     */     else {
/*     */       
/* 479 */       informFailure(synMessageContext);
/*     */     } 
/*     */   }
/*     */ 
/*     */   
/*     */   private void informFailure(MessageContext synMessageContext) {
/* 485 */     log.warn(""Failed to send using the selected endpoint, becasue it is inactive"");
/*     */     
/* 487 */     if (this.parentEndpoint != null) {
/* 488 */       this.parentEndpoint.onChildEndpointFail(this, synMessageContext);
/*     */     } else {
/* 490 */       Object o = synMessageContext.getFaultStack().pop();
/* 491 */       if (o != null)
/* 492 */         ((FaultHandler)o).handleFault(synMessageContext); 
/*     */     } 
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\endpoints\SALoadbalanceEndpoint.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.endpoints.WSDLEndpoint,"/*     */ package org.apache.synapse.endpoints;
/*     */ 
/*     */ import java.util.Stack;
/*     */ import org.apache.axiom.om.OMElement;
/*     */ import org.apache.axis2.clustering.ClusterManager;
/*     */ import org.apache.axis2.context.ConfigurationContext;
/*     */ import org.apache.axis2.context.MessageContext;
/*     */ import org.apache.commons.logging.Log;
/*     */ import org.apache.commons.logging.LogFactory;
/*     */ import org.apache.synapse.FaultHandler;
/*     */ import org.apache.synapse.MessageContext;
/*     */ import org.apache.synapse.core.axis2.Axis2MessageContext;
/*     */ import org.apache.synapse.endpoints.utils.EndpointDefinition;
/*     */ import org.apache.synapse.statistics.impl.EndPointStatisticsStack;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class WSDLEndpoint
/*     */   extends FaultHandler
/*     */   implements Endpoint
/*     */ {
/*  47 */   private static final Log log = LogFactory.getLog(WSDLEndpoint.class);
/*  48 */   private static final Log trace = LogFactory.getLog(""TRACE_LOGGER"");
/*     */   
/*  50 */   private String name = null;
/*     */   
/*     */   private String wsdlURI;
/*     */   private OMElement wsdlDoc;
/*     */   private String serviceName;
/*     */   private String portName;
/*  56 */   private Endpoint parentEndpoint = null;
/*  57 */   private EndpointDefinition endpoint = null;
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  62 */   private final EndpointContext endpointContext = new EndpointContext();
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public void send(MessageContext synCtx) {
/*  75 */     boolean traceOn = isTraceOn(synCtx);
/*  76 */     boolean traceOrDebugOn = isTraceOrDebugOn(traceOn);
/*     */     
/*  78 */     if (traceOrDebugOn) {
/*  79 */       traceOrDebug(traceOn, ""Start : WSDL Endpoint"");
/*     */       
/*  81 */       if (traceOn && trace.isTraceEnabled()) {
/*  82 */         trace.trace(""Message : "" + synCtx.getEnvelope());
/*     */       }
/*     */     } 
/*     */     
/*  86 */     if (this.endpoint.getAddress() != null) {
/*     */       
/*  88 */       String eprAddress = this.endpoint.getAddress();
/*  89 */       boolean isClusteringEnable = false;
/*     */       
/*  91 */       MessageContext axisMC = ((Axis2MessageContext)synCtx).getAxis2MessageContext();
/*     */       
/*  93 */       ConfigurationContext cc = axisMC.getConfigurationContext();
/*     */ 
/*     */       
/*  96 */       ClusterManager clusterManager = cc.getAxisConfiguration().getClusterManager();
/*  97 */       if (clusterManager != null && clusterManager.getContextManager() != null)
/*     */       {
/*  99 */         isClusteringEnable = true;
/*     */       }
/*     */       
/* 102 */       String endPointName = getName();
/* 103 */       if (endPointName == null) {
/*     */         
/* 105 */         if (traceOrDebugOn && isClusteringEnable) {
/* 106 */           log.warn(""In a clustering environment , the endpoint  name should be specified even for anonymous endpoints. Otherwise, the clustering would not be functioned correctly if there are more than one anonymous endpoints. "");
/*     */         }
/*     */ 
/*     */ 
/*     */         
/* 111 */         endPointName = ""AnonymousEndpoint"";
/*     */       } 
/*     */       
/* 114 */       if (isClusteringEnable)
/*     */       {
/*     */         
/* 117 */         if (this.endpointContext.getConfigurationContext() == null) {
/* 118 */           this.endpointContext.setConfigurationContext(cc);
/* 119 */           this.endpointContext.setContextID(endPointName);
/*     */         } 
/*     */       }
/*     */ 
/*     */       
/* 124 */       boolean statisticsEnable = (1 == this.endpoint.getStatisticsState());
/*     */ 
/*     */       
/* 127 */       if (statisticsEnable) {
/* 128 */         EndPointStatisticsStack endPointStatisticsStack = null;
/* 129 */         Object statisticsStackObj = synCtx.getProperty(""synapse.endpoint.stats"");
/*     */         
/* 131 */         if (statisticsStackObj == null) {
/* 132 */           endPointStatisticsStack = new EndPointStatisticsStack();
/* 133 */           synCtx.setProperty(""synapse.endpoint.stats"", endPointStatisticsStack);
/*     */         }
/* 135 */         else if (statisticsStackObj instanceof EndPointStatisticsStack) {
/* 136 */           endPointStatisticsStack = (EndPointStatisticsStack)statisticsStackObj;
/*     */         } 
/* 138 */         if (endPointStatisticsStack != null) {
/* 139 */           boolean isFault = synCtx.getEnvelope().getBody().hasFault();
/* 140 */           endPointStatisticsStack.put(endPointName, System.currentTimeMillis(), !synCtx.isResponse(), statisticsEnable, isFault);
/*     */         } 
/*     */       } 
/*     */       
/* 144 */       if (traceOrDebugOn) {
/* 145 */         traceOrDebug(traceOn, ""Sending message to WSDL endpoint : "" + endPointName + "" resolves to address = "" + eprAddress);
/*     */         
/* 147 */         traceOrDebug(traceOn, ""SOAPAction: "" + ((synCtx.getSoapAction() != null) ? synCtx.getSoapAction() : ""null""));
/*     */         
/* 149 */         traceOrDebug(traceOn, ""WSA-Action: "" + ((synCtx.getWSAAction() != null) ? synCtx.getWSAAction() : ""null""));
/*     */ 
/*     */         
/* 152 */         if (traceOn && trace.isTraceEnabled()) {
/* 153 */           trace.trace(""Envelope : \n"" + synCtx.getEnvelope());
/*     */         }
/*     */       } 
/*     */ 
/*     */       
/* 158 */       synCtx.pushFaultHandler(this);
/*     */ 
/*     */       
/* 161 */       synCtx.setProperty(""processed_endpoint"", this);
/*     */       
/* 163 */       synCtx.getEnvironment().send(this.endpoint, synCtx);
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public void onFault(MessageContext synCtx) {
/* 171 */     setActive(false, synCtx);
/*     */     
/* 173 */     if (this.parentEndpoint != null) {
/* 174 */       this.parentEndpoint.onChildEndpointFail(this, synCtx);
/*     */     } else {
/* 176 */       Stack<FaultHandler> faultStack = synCtx.getFaultStack();
/* 177 */       if (!faultStack.isEmpty()) {
/* 178 */         ((FaultHandler)faultStack.pop()).handleFault(synCtx);
/*     */       }
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */   
/*     */   public void onChildEndpointFail(Endpoint endpoint, MessageContext synMessageContext) {}
/*     */ 
/*     */   
/* 188 */   public String getName() { return this.name; }
/*     */ 
/*     */ 
/*     */   
/* 192 */   public void setName(String name) { this.name = name.trim(); }
/*     */ 
/*     */ 
/*     */   
/* 196 */   public String getWsdlURI() { return this.wsdlURI; }
/*     */ 
/*     */ 
/*     */   
/* 200 */   public void setWsdlURI(String wsdlURI) { this.wsdlURI = wsdlURI; }
/*     */ 
/*     */ 
/*     */   
/* 204 */   public OMElement getWsdlDoc() { return this.wsdlDoc; }
/*     */ 
/*     */ 
/*     */   
/* 208 */   public void setWsdlDoc(OMElement wsdlDoc) { this.wsdlDoc = wsdlDoc; }
/*     */ 
/*     */ 
/*     */   
/* 212 */   public String getServiceName() { return this.serviceName; }
/*     */ 
/*     */ 
/*     */   
/* 216 */   public void setServiceName(String serviceName) { this.serviceName = serviceName; }
/*     */ 
/*     */ 
/*     */   
/* 220 */   public String getPortName() { return this.portName; }
/*     */ 
/*     */ 
/*     */   
/* 224 */   public void setPortName(String portName) { this.portName = portName; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public boolean isActive(MessageContext synMessageContext) {
/* 235 */     boolean active = this.endpointContext.isActive();
/* 236 */     if (!active) {
/* 237 */       long recoverOn = this.endpointContext.getRecoverOn();
/* 238 */       if (System.currentTimeMillis() > recoverOn) {
/* 239 */         active = true;
/* 240 */         this.endpointContext.setActive(true);
/*     */       } 
/*     */     } 
/*     */     
/* 244 */     if (log.isDebugEnabled()) {
/* 245 */       log.debug(""WSDLEndpoint with name '"" + this.name + ""' is in "" + (active ? ""active"" : ""inactive"") + "" state"");
/*     */     }
/*     */ 
/*     */     
/* 249 */     return active;
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public void setActive(boolean active, MessageContext synMessageContext) {
/* 261 */     if (!active) {
/* 262 */       if (this.endpoint.getSuspendOnFailDuration() != -1L) {
/*     */ 
/*     */         
/* 265 */         this.endpointContext.setRecoverOn(System.currentTimeMillis() + this.endpoint.getSuspendOnFailDuration());
/*     */       } else {
/*     */         
/* 268 */         this.endpointContext.setRecoverOn(Long.MAX_VALUE);
/*     */       } 
/*     */     }
/*     */     
/* 272 */     this.endpointContext.setActive(true);
/*     */   }
/*     */ 
/*     */   
/* 276 */   public void setParentEndpoint(Endpoint parentEndpoint) { this.parentEndpoint = parentEndpoint; }
/*     */ 
/*     */ 
/*     */   
/* 280 */   public EndpointDefinition getEndpoint() { return this.endpoint; }
/*     */ 
/*     */ 
/*     */   
/* 284 */   public void setEndpoint(EndpointDefinition endpoint) { this.endpoint = endpoint; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 295 */   protected boolean isTraceOn(MessageContext msgCtx) { return (this.endpoint.getTraceState() == 1 || (this.endpoint.getTraceState() == 2 && msgCtx.getTracingState() == 1)); }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 308 */   protected boolean isTraceOrDebugOn(boolean isTraceOn) { return (isTraceOn || log.isDebugEnabled()); }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   protected void traceOrDebug(boolean traceOn, String msg) {
/* 318 */     if (traceOn) {
/* 319 */       trace.info(msg);
/*     */     }
/* 321 */     if (log.isDebugEnabled())
/* 322 */       log.debug(msg); 
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\endpoints\WSDLEndpoint.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.endpoints.algorithms.AlgorithmContext,"/*     */ package org.apache.synapse.endpoints.algorithms;
/*     */ 
/*     */ import org.apache.axis2.clustering.ClusteringFault;
/*     */ import org.apache.axis2.clustering.context.Replicator;
/*     */ import org.apache.axis2.context.AbstractContext;
/*     */ import org.apache.axis2.context.ConfigurationContext;
/*     */ import org.apache.commons.logging.Log;
/*     */ import org.apache.commons.logging.LogFactory;
/*     */ import org.apache.synapse.SynapseException;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class AlgorithmContext
/*     */ {
/*  41 */   private static final Log log = LogFactory.getLog(AlgorithmContext.class);
/*     */ 
/*     */ 
/*     */   
/*     */   private static final String UNDERSCORE_STRING = ""_"";
/*     */ 
/*     */   
/*     */   private static final String CURRENT_EPR = ""currentEPR"";
/*     */ 
/*     */   
/*     */   private ConfigurationContext configCtx;
/*     */ 
/*     */   
/*     */   private boolean isClusteringEnable = false;
/*     */ 
/*     */   
/*     */   private String currentEPRPropertyKey;
/*     */ 
/*     */   
/*  60 */   private int currentEPR = 0;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public int getCurrentEndpointIndex() {
/*  70 */     if (this.isClusteringEnable) {
/*     */       
/*  72 */       if (this.currentEPRPropertyKey == null || """".equals(this.currentEPRPropertyKey)) {
/*  73 */         handleException(""Cannot find the required key to find the shared state of the 'currentEPR' attribute"");
/*     */       }
/*     */ 
/*     */       
/*  77 */       Object value = this.configCtx.getPropertyNonReplicable(this.currentEPRPropertyKey);
/*  78 */       if (value == null) {
/*  79 */         return 0;
/*     */       }
/*     */       try {
/*  82 */         if (value instanceof Integer)
/*  83 */           return ((Integer)value).intValue(); 
/*  84 */         if (value instanceof String) {
/*  85 */           return Integer.parseInt((String)value);
/*     */         }
/*  87 */       } catch (NumberFormatException e) {
/*  88 */         handleException(""The invalid value for the 'currentEPR' attribute"");
/*     */       } 
/*     */     } else {
/*  91 */       return this.currentEPR;
/*     */     } 
/*  93 */     return 0;
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public void setCurrentEPR(int currentEPR) {
/* 103 */     if (this.isClusteringEnable) {
/*     */       
/* 105 */       if (this.currentEPRPropertyKey != null) {
/* 106 */         if (log.isDebugEnabled()) {
/* 107 */           log.debug(""Setting the current EPR "" + currentEPR + "" with the key "" + this.currentEPRPropertyKey);
/*     */         }
/*     */ 
/*     */         
/* 111 */         setAndReplicateState(this.currentEPRPropertyKey, Integer.valueOf(currentEPR));
/*     */       } 
/*     */     } else {
/* 114 */       if (log.isDebugEnabled()) {
/* 115 */         log.debug(""Setting the current EPR "" + currentEPR);
/*     */       }
/* 117 */       this.currentEPR = currentEPR;
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 127 */   public ConfigurationContext getConfigurationContext() { return this.configCtx; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public void setConfigurationContext(ConfigurationContext configCtx) {
/* 138 */     if (configCtx == null) {
/* 139 */       handleException(""The ConfigurationContext cannot be null when system in a cluster environment"");
/*     */     }
/*     */ 
/*     */     
/* 143 */     this.configCtx = configCtx;
/* 144 */     this.isClusteringEnable = true;
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public void setContextID(String contextID) {
/* 155 */     if (contextID == null || """".equals(contextID)) {
/* 156 */       handleException(""The Context ID cannot be null when system in a cluster environment"");
/*     */     }
/*     */ 
/*     */ 
/*     */     
/* 161 */     StringBuffer buffer = new StringBuffer();
/* 162 */     buffer.append(contextID);
/* 163 */     buffer.append(""_"");
/* 164 */     buffer.append(""currentEPR"");
/* 165 */     this.currentEPRPropertyKey = buffer.toString();
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   protected void handleException(String msg) {
/* 175 */     log.error(msg);
/* 176 */     throw new SynapseException(msg);
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   protected void handleException(String msg, Exception e) {
/* 186 */     log.error(msg, e);
/* 187 */     throw new SynapseException(msg, e);
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   private void setAndReplicateState(String key, Object value) {
/* 200 */     if (this.configCtx != null && key != null && value != null)
/*     */       
/*     */       try {
/* 203 */         if (log.isDebugEnabled()) {
/* 204 */           log.debug(""Start replicating the property with key : "" + key + "" value : "" + value);
/*     */         }
/*     */ 
/*     */         
/* 208 */         this.configCtx.setProperty(key, value);
/* 209 */         Replicator.replicate((AbstractContext)this.configCtx, new String[] { key });
/*     */         
/* 211 */         if (log.isDebugEnabled()) {
/* 212 */           log.debug(""Completed replication of the property with key : "" + key);
/*     */         }
/*     */       }
/* 215 */       catch (ClusteringFault clusteringFault) {
/* 216 */         handleException(""Error during the replicating states "", (Exception)clusteringFault);
/*     */       }  
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\endpoints\algorithms\AlgorithmContext.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.endpoints.algorithms.LoadbalanceAlgorithm,"package org.apache.synapse.endpoints.algorithms;
import org.apache.synapse.MessageContext;
import org.apache.synapse.endpoints.Endpoint;
public interface LoadbalanceAlgorithm {
  Endpoint getNextEndpoint(MessageContext paramMessageContext, AlgorithmContext paramAlgorithmContext);
  void reset(AlgorithmContext paramAlgorithmContext);
}
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\endpoints\algorithms\LoadbalanceAlgorithm.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.endpoints.algorithms.RoundRobin,"/*    */ package org.apache.synapse.endpoints.algorithms;
/*    */ 
/*    */ import java.util.ArrayList;
/*    */ import org.apache.commons.logging.Log;
/*    */ import org.apache.commons.logging.LogFactory;
/*    */ import org.apache.synapse.MessageContext;
/*    */ import org.apache.synapse.endpoints.Endpoint;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class RoundRobin
/*    */   implements LoadbalanceAlgorithm
/*    */ {
/* 35 */   private static final Log log = LogFactory.getLog(RoundRobin.class);
/*    */ 
/*    */ 
/*    */ 
/*    */   
/* 40 */   private ArrayList endpoints = null;
/*    */ 
/*    */   
/* 43 */   public RoundRobin(ArrayList endpoints) { this.endpoints = endpoints; }
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */   
/*    */   public Endpoint getNextEndpoint(MessageContext synapseMessageContext, AlgorithmContext algorithmContext) {
/*    */     Endpoint nextEndpoint;
/* 57 */     if (log.isDebugEnabled()) {
/* 58 */       log.debug(""Using the Round Robin loadbalancing algorithm to select the next endpoint"");
/*    */     }
/*    */ 
/*    */     
/* 62 */     int attempts = 0;
/* 63 */     int currentEPR = algorithmContext.getCurrentEndpointIndex();
/*    */     
/*    */     do {
/* 66 */       synchronized (this) {
/* 67 */         nextEndpoint = this.endpoints.get(currentEPR);
/*    */         
/* 69 */         if (currentEPR == this.endpoints.size() - 1) {
/* 70 */           currentEPR = 0;
/*    */         } else {
/* 72 */           currentEPR++;
/*    */         } 
/* 74 */         algorithmContext.setCurrentEPR(currentEPR);
/*    */       } 
/*    */       
/* 77 */       attempts++;
/* 78 */       if (attempts > this.endpoints.size()) {
/* 79 */         log.warn(""Couldn't find an endpoint from the Round Robin loadbalancing algorithm"");
/* 80 */         return null;
/*    */       }
/*    */     
/* 83 */     } while (!nextEndpoint.isActive(synapseMessageContext));
/*    */     
/* 85 */     return nextEndpoint;
/*    */   }
/*    */   
/*    */   public void reset(AlgorithmContext algorithmContext) {
/* 89 */     if (log.isDebugEnabled()) {
/* 90 */       log.debug(""Resetting the Round Robin loadbalancing algorithm ..."");
/*    */     }
/* 92 */     algorithmContext.setCurrentEPR(0);
/*    */   }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\endpoints\algorithms\RoundRobin.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.endpoints.dispatch.Dispatcher,"package org.apache.synapse.endpoints.dispatch;
import org.apache.synapse.MessageContext;
import org.apache.synapse.endpoints.Endpoint;
public interface Dispatcher {
  Endpoint getEndpoint(MessageContext paramMessageContext, DispatcherContext paramDispatcherContext);
  void updateSession(MessageContext paramMessageContext, DispatcherContext paramDispatcherContext, Endpoint paramEndpoint);
  void unbind(MessageContext paramMessageContext, DispatcherContext paramDispatcherContext);
  boolean isServerInitiatedSession();
}
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\endpoints\dispatch\Dispatcher.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.endpoints.dispatch.DispatcherContext,"/*     */ package org.apache.synapse.endpoints.dispatch;
/*     */ 
/*     */ import java.util.Collections;
/*     */ import java.util.HashMap;
/*     */ import java.util.List;
/*     */ import java.util.Map;
/*     */ import org.apache.axis2.clustering.ClusteringFault;
/*     */ import org.apache.axis2.clustering.context.Replicator;
/*     */ import org.apache.axis2.context.AbstractContext;
/*     */ import org.apache.axis2.context.ConfigurationContext;
/*     */ import org.apache.commons.logging.Log;
/*     */ import org.apache.commons.logging.LogFactory;
/*     */ import org.apache.synapse.SynapseException;
/*     */ import org.apache.synapse.endpoints.Endpoint;
/*     */ import org.apache.synapse.endpoints.IndirectEndpoint;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class DispatcherContext
/*     */ {
/*  50 */   private static final Log log = LogFactory.getLog(DispatcherContext.class);
/*     */ 
/*     */   
/*     */   private static final String SESSION = ""session"";
/*     */ 
/*     */   
/*     */   private static final String UNDERSCORE_STRING = ""_"";
/*     */ 
/*     */   
/*  59 */   private final Map<String, Endpoint> sessionMap = Collections.synchronizedMap(new HashMap<String, Endpoint>());
/*     */ 
/*     */ 
/*     */   
/*     */   private ConfigurationContext configCtx;
/*     */ 
/*     */ 
/*     */   
/*     */   private boolean isClusteringEnable = false;
/*     */ 
/*     */   
/*     */   private String keyPrefix;
/*     */ 
/*     */   
/*  73 */   private final Map<String, Endpoint> endpointsMap = new HashMap<String, Endpoint>();
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public Endpoint getEndpoint(String sessionID) {
/*  84 */     if (this.isClusteringEnable) {
/*     */       
/*  86 */       if (this.keyPrefix == null || """".equals(this.keyPrefix)) {
/*  87 */         handleException(""Cannot find the required key prefix to find the shared state of one of  'session'"");
/*     */       }
/*     */ 
/*     */       
/*  91 */       Object value = this.configCtx.getPropertyNonReplicable(this.keyPrefix + sessionID);
/*  92 */       if (value != null && value instanceof String) {
/*  93 */         if (log.isDebugEnabled()) {
/*  94 */           log.debug(""Retrieving the endpoint from the session id "" + value);
/*     */         }
/*  96 */         return this.endpointsMap.get(value.toString());
/*     */       }
/*     */     
/*     */     } else {
/*     */       
/* 101 */       synchronized (this.sessionMap) {
/* 102 */         if (log.isDebugEnabled()) {
/* 103 */           log.debug(""Retrieving the endpoint from the session id "" + sessionID);
/*     */         }
/* 105 */         return this.sessionMap.get(sessionID);
/*     */       } 
/*     */     } 
/*     */     
/* 109 */     return null;
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public void setEndpoint(String sessionID, Endpoint endpoint) {
/* 120 */     if (this.isClusteringEnable) {
/*     */       String endpointName;
/*     */       
/* 123 */       if (endpoint instanceof IndirectEndpoint) {
/* 124 */         endpointName = ((IndirectEndpoint)endpoint).getKey();
/*     */       } else {
/* 126 */         endpointName = endpoint.getName();
/*     */       } 
/*     */       
/* 129 */       if (endpointName == null) {
/* 130 */         if (log.isDebugEnabled() && isClusteringEnable()) {
/* 131 */           log.warn(""In a clustering environment, the endpoint name should be specified even for anonymous endpoints. Otherwise the clustering would not function properly, if there are more than one anonymous endpoints."");
/*     */         }
/* 133 */         endpointName = ""AnonymousEndpoint"";
/*     */       } 
/*     */       
/* 136 */       if (this.keyPrefix != null) {
/* 137 */         if (log.isDebugEnabled()) {
/* 138 */           log.debug(""Adding the enpoint "" + endpointName + "" with the session id "" + this.keyPrefix + sessionID + "" for replication to the session"");
/*     */         }
/*     */ 
/*     */         
/* 142 */         setAndReplicateState(this.keyPrefix + sessionID, endpointName);
/*     */       }
/*     */     
/*     */     } else {
/*     */       
/* 147 */       synchronized (this.sessionMap) {
/* 148 */         if (log.isDebugEnabled()) {
/* 149 */           log.debug(""Adding the endpoint "" + endpoint + "" with the session id "" + sessionID + "" to the session"");
/*     */         }
/*     */         
/* 152 */         this.sessionMap.put(sessionID, endpoint);
/*     */       } 
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public void removeSession(String id) {
/* 165 */     if (this.isClusteringEnable) {
/*     */       
/* 167 */       if (this.keyPrefix != null) {
/* 168 */         if (log.isDebugEnabled()) {
/* 169 */           log.debug(""Removing and replicating the session with the session id "" + this.keyPrefix + id);
/*     */         }
/*     */ 
/*     */ 
/*     */         
/* 174 */         removeAndReplicateState(this.keyPrefix + id);
/*     */       }
/*     */     
/*     */     } else {
/*     */       
/* 179 */       synchronized (this.sessionMap) {
/* 180 */         if (log.isDebugEnabled()) {
/* 181 */           log.debug(""Removing the session with the session id "" + id);
/*     */         }
/* 183 */         this.sessionMap.remove(id);
/*     */       } 
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 194 */   public ConfigurationContext getConfigurationContext() { return this.configCtx; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public void setConfigurationContext(ConfigurationContext configCtx) {
/* 205 */     if (configCtx == null) {
/* 206 */       handleException(""The ConfigurationContext cannot be null when system in a cluster environment"");
/*     */     }
/*     */ 
/*     */     
/* 210 */     this.configCtx = configCtx;
/* 211 */     this.isClusteringEnable = true;
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public void setContextID(String contextID) {
/* 222 */     if (contextID == null || """".equals(contextID)) {
/* 223 */       handleException(""The Context ID cannot be null when system in a cluster environment"");
/*     */     }
/*     */ 
/*     */ 
/*     */     
/* 228 */     StringBuffer buffer = new StringBuffer();
/* 229 */     buffer.append(contextID);
/* 230 */     buffer.append(""_"");
/* 231 */     buffer.append(""session"");
/* 232 */     buffer.append(""_"");
/* 233 */     this.keyPrefix = buffer.toString();
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   protected void handleException(String msg) {
/* 243 */     log.error(msg);
/* 244 */     throw new SynapseException(msg);
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   protected void handleException(String msg, Exception e) {
/* 254 */     log.error(msg, e);
/* 255 */     throw new SynapseException(msg, e);
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   private void setAndReplicateState(String key, Object value) {
/* 268 */     if (this.configCtx != null && key != null && value != null) {
/*     */       
/*     */       try {
/* 271 */         if (log.isDebugEnabled()) {
/* 272 */           log.debug(""Start replicating the property with key : "" + key + "" value : "" + value);
/*     */         }
/*     */ 
/*     */         
/* 276 */         Object prop = this.configCtx.getPropertyNonReplicable(key);
/* 277 */         if (prop == null) {
/* 278 */           this.configCtx.setProperty(key, value);
/* 279 */           Replicator.replicate((AbstractContext)this.configCtx, new String[] { key });
/*     */         } 
/*     */         
/* 282 */         if (log.isDebugEnabled()) {
/* 283 */           log.debug(""Completed replication of the property with key: "" + key);
/*     */         }
/*     */       }
/* 286 */       catch (ClusteringFault clusteringFault) {
/* 287 */         handleException(""Error during the replicating states "", (Exception)clusteringFault);
/*     */       } 
/*     */     }
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   private void removeAndReplicateState(String key) {
/* 301 */     if (this.configCtx != null && key != null) {
/*     */       
/*     */       try {
/* 304 */         if (log.isDebugEnabled()) {
/* 305 */           log.debug(""Start replicating the property removal with key : "" + key);
/*     */         }
/*     */         
/* 308 */         this.configCtx.removeProperty(key);
/* 309 */         Replicator.replicate((AbstractContext)this.configCtx, new String[] { key });
/*     */         
/* 311 */         if (log.isDebugEnabled()) {
/* 312 */           log.debug(""Completed replication of the property removal with key : "" + key);
/*     */         }
/*     */       }
/* 315 */       catch (ClusteringFault clusteringFault) {
/* 316 */         handleException(""Error during the replicating states "", (Exception)clusteringFault);
/*     */       } 
/*     */     }
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 327 */   public boolean isClusteringEnable() { return this.isClusteringEnable; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public void setEndpoints(List<Endpoint> endpoints) {
/* 337 */     if (endpoints != null)
/*     */     {
/* 339 */       for (Endpoint endpoint : endpoints) {
/*     */         String endpointName;
/*     */         
/* 342 */         if (endpoint instanceof IndirectEndpoint) {
/* 343 */           endpointName = ((IndirectEndpoint)endpoint).getKey();
/*     */         } else {
/* 345 */           endpointName = endpoint.getName();
/*     */         } 
/*     */         
/* 348 */         if (endpointName == null) {
/* 349 */           if (log.isDebugEnabled() && isClusteringEnable()) {
/* 350 */             log.warn(""In a clustering environment, the endpoint name should be specified even for anonymous endpoints. Otherwise the clustering would not function properly, if there are more than one anonymous endpoints."");
/*     */           }
/* 352 */           endpointName = ""AnonymousEndpoint"";
/*     */         } 
/*     */         
/* 355 */         if (log.isDebugEnabled()) {
/* 356 */           log.debug(""Adding an endpoint with the name/key "" + endpointName + "" to the endpoints map"");
/*     */         }
/*     */         
/* 359 */         this.endpointsMap.put(endpointName, endpoint);
/*     */       } 
/*     */     }
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\endpoints\dispatch\DispatcherContext.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.endpoints.dispatch.HttpSessionDispatcher,"/*     */ package org.apache.synapse.endpoints.dispatch;
/*     */ 
/*     */ import java.util.Map;
/*     */ import org.apache.axis2.context.MessageContext;
/*     */ import org.apache.commons.logging.Log;
/*     */ import org.apache.commons.logging.LogFactory;
/*     */ import org.apache.synapse.MessageContext;
/*     */ import org.apache.synapse.core.axis2.Axis2MessageContext;
/*     */ import org.apache.synapse.endpoints.Endpoint;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class HttpSessionDispatcher
/*     */   implements Dispatcher
/*     */ {
/*  37 */   private static final Log log = LogFactory.getLog(HttpSessionDispatcher.class);
/*     */ 
/*     */ 
/*     */   
/*     */   private static final String TRANSPORT_HEADERS = ""TRANSPORT_HEADERS"";
/*     */ 
/*     */ 
/*     */   
/*     */   private static final String COOKIE = ""Cookie"";
/*     */ 
/*     */ 
/*     */   
/*     */   private static final String SET_COOKIE = ""Set-Cookie"";
/*     */ 
/*     */ 
/*     */   
/*     */   public Endpoint getEndpoint(MessageContext synCtx, DispatcherContext dispatcherContext) {
/*  54 */     Endpoint endpoint = null;
/*     */     
/*  56 */     MessageContext axis2MessageContext = ((Axis2MessageContext)synCtx).getAxis2MessageContext();
/*     */ 
/*     */     
/*  59 */     Object o = axis2MessageContext.getProperty(""TRANSPORT_HEADERS"");
/*  60 */     if (o != null && o instanceof Map) {
/*  61 */       Map headerMap = (Map)o;
/*  62 */       Object cookie = headerMap.get(""Cookie"");
/*     */       
/*  64 */       if (cookie != null && cookie instanceof String) {
/*     */         
/*  66 */         if (log.isDebugEnabled()) {
/*  67 */           log.debug(""Using the HTTP header 'Cookie: "" + cookie + ""' to retrieve the endpoint in the transport session"");
/*     */         }
/*     */ 
/*     */         
/*  71 */         Object ep = dispatcherContext.getEndpoint((String)cookie);
/*  72 */         if (ep != null && ep instanceof Endpoint) {
/*  73 */           endpoint = (Endpoint)ep;
/*  74 */         } else if (log.isDebugEnabled()) {
/*  75 */           log.debug(""No endpoint found in the transport session for the session id "" + cookie);
/*     */         }
/*     */       
/*     */       }
/*  79 */       else if (log.isDebugEnabled()) {
/*  80 */         log.debug(""No 'Cookie' HTTP headers found to extract the endpoint from the transport session"");
/*     */       } 
/*     */     } 
/*     */ 
/*     */     
/*  85 */     return endpoint;
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public void updateSession(MessageContext synCtx, DispatcherContext dispatcherContext, Endpoint endpoint) {
/*  99 */     if (endpoint == null || dispatcherContext == null) {
/*     */       return;
/*     */     }
/*     */     
/* 103 */     MessageContext axis2MessageContext = ((Axis2MessageContext)synCtx).getAxis2MessageContext();
/*     */ 
/*     */     
/* 106 */     Object o = axis2MessageContext.getProperty(""TRANSPORT_HEADERS"");
/* 107 */     if (o != null && o instanceof Map) {
/* 108 */       Map headerMap = (Map)o;
/* 109 */       Object cookie = headerMap.get(""Set-Cookie"");
/*     */       
/* 111 */       if (cookie != null && cookie instanceof String) {
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */         
/* 120 */         if (log.isDebugEnabled()) {
/* 121 */           log.debug(""Found the HTTP header 'Set-Cookie: "" + cookie + ""' for updating the session"");
/*     */         }
/*     */         
/* 124 */         String sessionId = ((String)cookie).split("";"")[0];
/*     */         
/* 126 */         if (log.isDebugEnabled()) {
/* 127 */           log.debug(""Using the session id '"" + sessionId + ""' extracted from the Set-Cookie header to update the session "" + ""with the endpoint "" + endpoint);
/*     */         }
/*     */ 
/*     */         
/* 131 */         dispatcherContext.setEndpoint(sessionId, endpoint);
/*     */       }
/* 133 */       else if (log.isDebugEnabled()) {
/* 134 */         log.debug(""No 'Set-Cookie' HTTP header is specified in the message to update the session"");
/*     */       } 
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */   
/*     */   public void unbind(MessageContext synCtx, DispatcherContext dispatcherContext) {
/* 142 */     MessageContext axis2MessageContext = ((Axis2MessageContext)synCtx).getAxis2MessageContext();
/*     */ 
/*     */     
/* 145 */     Object o = axis2MessageContext.getProperty(""TRANSPORT_HEADERS"");
/* 146 */     if (o != null && o instanceof Map) {
/* 147 */       Map headerMap = (Map)o;
/* 148 */       Object cookie = headerMap.get(""Cookie"");
/*     */       
/* 150 */       if (cookie != null && cookie instanceof String) {
/*     */         
/* 152 */         if (log.isDebugEnabled()) {
/* 153 */           log.debug(""Using the HTTP header 'Cookie: "" + cookie + ""' to unbind the session"");
/*     */         }
/*     */         
/* 156 */         dispatcherContext.removeSession((String)cookie);
/*     */       }
/* 158 */       else if (log.isDebugEnabled()) {
/* 159 */         log.debug(""No 'Cookie' HTTP header is specified in the message to unbind the session"");
/*     */       } 
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 171 */   public boolean isServerInitiatedSession() { return true; }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\endpoints\dispatch\HttpSessionDispatcher.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.endpoints.dispatch.SimpleClientSessionDispatcher,"/*     */ package org.apache.synapse.endpoints.dispatch;
/*     */ 
/*     */ import javax.xml.namespace.QName;
/*     */ import org.apache.axiom.om.OMElement;
/*     */ import org.apache.axiom.soap.SOAPHeader;
/*     */ import org.apache.commons.logging.Log;
/*     */ import org.apache.commons.logging.LogFactory;
/*     */ import org.apache.synapse.MessageContext;
/*     */ import org.apache.synapse.endpoints.Endpoint;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class SimpleClientSessionDispatcher
/*     */   implements Dispatcher
/*     */ {
/*  39 */   private static final Log log = LogFactory.getLog(SimpleClientSessionDispatcher.class);
/*     */   
/*  41 */   private static final QName CSID_QNAME = new QName(""http://ws.apache.org/ns/synapse"", ""ClientID"", ""syn"");
/*     */ 
/*     */ 
/*     */   
/*     */   public Endpoint getEndpoint(MessageContext synCtx, DispatcherContext dispatcherContext) {
/*  46 */     SOAPHeader header = synCtx.getEnvelope().getHeader();
/*     */     
/*  48 */     if (header != null) {
/*  49 */       OMElement sgcIDElm = header.getFirstChildWithName(CSID_QNAME);
/*     */       
/*  51 */       if (sgcIDElm != null) {
/*  52 */         String sgcID = sgcIDElm.getText();
/*     */         
/*  54 */         if (sgcID != null) {
/*  55 */           log.debug(""Using the client session id : '"" + sgcID + ""' extracted from current message to retrieve endpoint"");
/*     */           
/*  57 */           Object o = dispatcherContext.getEndpoint(sgcID);
/*     */           
/*  59 */           if (o != null && o instanceof Endpoint) {
/*  60 */             return (Endpoint)o;
/*     */           }
/*  62 */         } else if (log.isDebugEnabled()) {
/*  63 */           log.debug(""Couldn't find the client session id for the current message to retrieve endpoint"");
/*     */         }
/*     */       
/*  66 */       } else if (log.isDebugEnabled()) {
/*  67 */         log.debug(""Couldn't find a SOAP header with the QName "" + CSID_QNAME + "" for the current message to retrieve the endpoint"");
/*     */       } 
/*     */     } 
/*     */ 
/*     */     
/*  72 */     return null;
/*     */   }
/*     */ 
/*     */ 
/*     */   
/*     */   public void updateSession(MessageContext synCtx, DispatcherContext dispatcherContext, Endpoint endpoint) {
/*  78 */     if (endpoint == null || dispatcherContext == null) {
/*     */       return;
/*     */     }
/*     */     
/*  82 */     SOAPHeader header = synCtx.getEnvelope().getHeader();
/*     */     
/*  84 */     if (header != null) {
/*  85 */       OMElement csIDElm = header.getFirstChildWithName(CSID_QNAME);
/*     */       
/*  87 */       if (csIDElm != null) {
/*  88 */         String csID = csIDElm.getText();
/*     */         
/*  90 */         if (csID != null) {
/*  91 */           if (log.isDebugEnabled()) {
/*  92 */             log.debug(""Using the client session id : '"" + csID + ""' extracted from current message to update the session"");
/*     */           }
/*     */           
/*  95 */           dispatcherContext.setEndpoint(csID, endpoint);
/*  96 */         } else if (log.isDebugEnabled()) {
/*  97 */           log.debug(""Couldn't find the client session id for the current message to update the session"");
/*     */         }
/*     */       
/* 100 */       } else if (log.isDebugEnabled()) {
/* 101 */         log.debug(""Couldn't find a SOAP header with the QName "" + CSID_QNAME + "" for the current message to update the session"");
/*     */       } 
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public void unbind(MessageContext synCtx, DispatcherContext dispatcherContext) {
/* 110 */     if (dispatcherContext == null) {
/*     */       return;
/*     */     }
/*     */     
/* 114 */     SOAPHeader header = synCtx.getEnvelope().getHeader();
/*     */     
/* 116 */     if (header != null) {
/* 117 */       OMElement csIDElm = header.getFirstChildWithName(CSID_QNAME);
/*     */       
/* 119 */       if (csIDElm != null) {
/* 120 */         String csID = csIDElm.getText();
/*     */         
/* 122 */         if (csID != null) {
/* 123 */           dispatcherContext.removeSession(csID);
/* 124 */         } else if (log.isDebugEnabled()) {
/* 125 */           log.debug(""Couldn't find the client session id for the current message to unbind the session"");
/*     */         }
/*     */       
/* 128 */       } else if (log.isDebugEnabled()) {
/* 129 */         log.debug(""Couldn't find a SOAP header with the QName "" + CSID_QNAME + "" for the current message to unbind the session"");
/*     */       } 
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */   
/* 136 */   public boolean isServerInitiatedSession() { return false; }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\endpoints\dispatch\SimpleClientSessionDispatcher.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.endpoints.dispatch.SoapSessionDispatcher,"/*     */ package org.apache.synapse.endpoints.dispatch;
/*     */ 
/*     */ import javax.xml.namespace.QName;
/*     */ import org.apache.axiom.om.OMElement;
/*     */ import org.apache.axiom.soap.SOAPHeader;
/*     */ import org.apache.axis2.addressing.AddressingConstants;
/*     */ import org.apache.commons.logging.Log;
/*     */ import org.apache.commons.logging.LogFactory;
/*     */ import org.apache.synapse.MessageContext;
/*     */ import org.apache.synapse.endpoints.Endpoint;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class SoapSessionDispatcher
/*     */   implements Dispatcher
/*     */ {
/*  34 */   private static final Log log = LogFactory.getLog(SoapSessionDispatcher.class);
/*     */   
/*  36 */   private static final QName QNAME_SERVICE_GROUP_ID = new QName(""http://ws.apache.org/namespaces/axis2"", ""ServiceGroupId"", ""axis2"");
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public Endpoint getEndpoint(MessageContext synCtx, DispatcherContext dispatcherContext) {
/*  49 */     Endpoint endpoint = null;
/*  50 */     SOAPHeader header = synCtx.getEnvelope().getHeader();
/*     */     
/*  52 */     if (header != null) {
/*  53 */       OMElement sgcElm = header.getFirstChildWithName(QNAME_SERVICE_GROUP_ID);
/*     */       
/*  55 */       if (sgcElm != null) {
/*  56 */         String sgcID = sgcElm.getText();
/*     */         
/*  58 */         if (sgcID != null) {
/*  59 */           if (log.isDebugEnabled()) {
/*  60 */             log.debug(""Using the ServiceGroupId SOAP header value "" + sgcID + "" to retrieve endpoint on the session"");
/*     */           }
/*     */           
/*  63 */           endpoint = dispatcherContext.getEndpoint(sgcID);
/*     */         } 
/*  65 */       } else if (log.isDebugEnabled()) {
/*  66 */         log.debug(""Couldn't find the ServiceQroupId SOAP header to retrieve the endpoint on the session"");
/*     */       } 
/*     */     } 
/*     */ 
/*     */     
/*  71 */     return endpoint;
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public void updateSession(MessageContext synCtx, DispatcherContext dispatcherContext, Endpoint endpoint) {
/*  85 */     if (endpoint == null || dispatcherContext == null) {
/*     */       return;
/*     */     }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */     
/*  93 */     SOAPHeader header = synCtx.getEnvelope().getHeader();
/*     */     
/*  95 */     if (header != null) {
/*  96 */       OMElement replyTo = header.getFirstChildWithName(AddressingConstants.Final.QNAME_WSA_REPLY_TO);
/*     */ 
/*     */       
/*  99 */       if (replyTo != null) {
/* 100 */         OMElement referenceParameters = replyTo.getFirstChildWithName(new QName(""http://www.w3.org/2005/08/addressing"", ""ReferenceParameters"", ""wsa""));
/*     */ 
/*     */         
/* 103 */         if (referenceParameters != null) {
/* 104 */           OMElement sgcElm = referenceParameters.getFirstChildWithName(QNAME_SERVICE_GROUP_ID);
/*     */ 
/*     */           
/* 107 */           if (sgcElm != null) {
/*     */             
/* 109 */             String sgcID = sgcElm.getText();
/*     */             
/* 111 */             if (sgcID != null) {
/* 112 */               if (log.isDebugEnabled()) {
/* 113 */                 log.debug(""Using the ServiceGroupId value "" + sgcID + "" to update the endpoint session"");
/*     */               }
/*     */               
/* 116 */               dispatcherContext.setEndpoint(sgcID, endpoint);
/*     */             } 
/* 118 */           } else if (log.isDebugEnabled()) {
/* 119 */             log.debug(""Couldn't find the WSA ServiceQroupId on the ReferenceParameters of the Reply-To header to update the session"");
/*     */           }
/*     */         
/* 122 */         } else if (log.isDebugEnabled()) {
/* 123 */           log.debug(""Couldn't find the WSA ReferenceParameters in the Reply-To header to retrieve the ServiceQroupId"");
/*     */         }
/*     */       
/* 126 */       } else if (log.isDebugEnabled()) {
/* 127 */         log.debug(""Couldn't find the WSA Reply-To header to retrieve the ServiceQroupId"");
/*     */       } 
/*     */     } 
/*     */   }
/*     */ 
/*     */   
/*     */   public void unbind(MessageContext synCtx, DispatcherContext dispatcherContext) {
/* 134 */     SOAPHeader header = synCtx.getEnvelope().getHeader();
/*     */     
/* 136 */     if (header != null) {
/* 137 */       OMElement sgcIDElm = header.getFirstChildWithName(QNAME_SERVICE_GROUP_ID);
/*     */       
/* 139 */       if (sgcIDElm != null) {
/* 140 */         String sgcID = sgcIDElm.getText();
/*     */         
/* 142 */         if (sgcID != null) {
/* 143 */           if (log.isDebugEnabled()) {
/* 144 */             log.debug(""Using the ServiceGroupId value "" + sgcID + "" to unbind session"");
/*     */           }
/*     */           
/* 147 */           dispatcherContext.removeSession(sgcID);
/*     */         } 
/* 149 */       } else if (log.isDebugEnabled()) {
/* 150 */         log.debug(""Couldn't find the ServiceQroupId SOAP header to unbind the session"");
/*     */       } 
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 161 */   public boolean isServerInitiatedSession() { return true; }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\endpoints\dispatch\SoapSessionDispatcher.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.endpoints.utils.EndpointDefinition,"/*     */ package org.apache.synapse.endpoints.utils;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class EndpointDefinition
/*     */ {
/*  36 */   private String address = null;
/*     */ 
/*     */ 
/*     */   
/*     */   private boolean reliableMessagingOn = false;
/*     */ 
/*     */ 
/*     */   
/*     */   private boolean addressingOn = false;
/*     */ 
/*     */ 
/*     */   
/*  48 */   private String addressingVersion = null;
/*     */ 
/*     */ 
/*     */   
/*     */   private boolean securityOn = false;
/*     */ 
/*     */ 
/*     */   
/*  56 */   private String wsRMPolicyKey = null;
/*     */ 
/*     */ 
/*     */   
/*  60 */   private String wsSecPolicyKey = null;
/*     */ 
/*     */ 
/*     */   
/*     */   private boolean useSeparateListener = false;
/*     */ 
/*     */ 
/*     */   
/*     */   private boolean forcePOX = false;
/*     */ 
/*     */ 
/*     */   
/*     */   private boolean forceGET = false;
/*     */ 
/*     */ 
/*     */   
/*     */   private boolean forceSOAP11 = false;
/*     */ 
/*     */ 
/*     */   
/*     */   private boolean forceSOAP12 = false;
/*     */ 
/*     */ 
/*     */   
/*     */   private boolean useMTOM = false;
/*     */ 
/*     */ 
/*     */   
/*     */   private boolean useSwa = false;
/*     */ 
/*     */ 
/*     */   
/*  92 */   private String format = null;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   private String charSetEncoding;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 105 */   private long timeoutDuration = 0L;
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 110 */   private int timeoutAction = 100;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 117 */   private long suspendOnFailDuration = -1L;
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 122 */   private int statisticsState = 2;
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 127 */   private int traceState = 2;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 136 */   public String getAddress() { return this.address; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 145 */   public void setAddress(String address) { this.address = address; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 154 */   public boolean isReliableMessagingOn() { return this.reliableMessagingOn; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 163 */   public void setReliableMessagingOn(boolean reliableMessagingOn) { this.reliableMessagingOn = reliableMessagingOn; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 172 */   public boolean isAddressingOn() { return this.addressingOn; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 181 */   public void setAddressingOn(boolean addressingOn) { this.addressingOn = addressingOn; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 190 */   public String getAddressingVersion() { return this.addressingVersion; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 199 */   public void setAddressingVersion(String addressingVersion) { this.addressingVersion = addressingVersion; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 208 */   public boolean isSecurityOn() { return this.securityOn; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 217 */   public void setSecurityOn(boolean securityOn) { this.securityOn = securityOn; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 226 */   public String getWsSecPolicyKey() { return this.wsSecPolicyKey; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 235 */   public void setWsSecPolicyKey(String wsSecPolicyKey) { this.wsSecPolicyKey = wsSecPolicyKey; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 244 */   public String getWsRMPolicyKey() { return this.wsRMPolicyKey; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 253 */   public void setWsRMPolicyKey(String wsRMPolicyKey) { this.wsRMPolicyKey = wsRMPolicyKey; }
/*     */ 
/*     */ 
/*     */   
/* 257 */   public void setUseSeparateListener(boolean b) { this.useSeparateListener = b; }
/*     */ 
/*     */ 
/*     */   
/* 261 */   public boolean isUseSeparateListener() { return this.useSeparateListener; }
/*     */ 
/*     */ 
/*     */   
/* 265 */   public void setForcePOX(boolean forcePOX) { this.forcePOX = forcePOX; }
/*     */ 
/*     */ 
/*     */   
/* 269 */   public boolean isForcePOX() { return this.forcePOX; }
/*     */ 
/*     */ 
/*     */   
/* 273 */   public boolean isForceGET() { return this.forceGET; }
/*     */ 
/*     */ 
/*     */   
/* 277 */   public void setForceGET(boolean forceGET) { this.forceGET = forceGET; }
/*     */ 
/*     */ 
/*     */   
/* 281 */   public void setForceSOAP11(boolean forceSOAP11) { this.forceSOAP11 = forceSOAP11; }
/*     */ 
/*     */ 
/*     */   
/* 285 */   public boolean isForceSOAP11() { return this.forceSOAP11; }
/*     */ 
/*     */ 
/*     */   
/* 289 */   public void setForceSOAP12(boolean forceSOAP12) { this.forceSOAP12 = forceSOAP12; }
/*     */ 
/*     */ 
/*     */   
/* 293 */   public boolean isForceSOAP12() { return this.forceSOAP12; }
/*     */ 
/*     */ 
/*     */   
/* 297 */   public boolean isUseMTOM() { return this.useMTOM; }
/*     */ 
/*     */ 
/*     */   
/* 301 */   public void setUseMTOM(boolean useMTOM) { this.useMTOM = useMTOM; }
/*     */ 
/*     */ 
/*     */   
/* 305 */   public boolean isUseSwa() { return this.useSwa; }
/*     */ 
/*     */ 
/*     */   
/* 309 */   public void setUseSwa(boolean useSwa) { this.useSwa = useSwa; }
/*     */ 
/*     */ 
/*     */   
/* 313 */   public long getTimeoutDuration() { return this.timeoutDuration; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 322 */   public void setTimeoutDuration(long timeoutDuration) { this.timeoutDuration = timeoutDuration; }
/*     */ 
/*     */ 
/*     */   
/* 326 */   public int getTimeoutAction() { return this.timeoutAction; }
/*     */ 
/*     */ 
/*     */   
/* 330 */   public void setTimeoutAction(int timeoutAction) { this.timeoutAction = timeoutAction; }
/*     */ 
/*     */ 
/*     */   
/* 334 */   public String getFormat() { return this.format; }
/*     */ 
/*     */ 
/*     */   
/* 338 */   public void setFormat(String format) { this.format = format; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 347 */   public String getCharSetEncoding() { return this.charSetEncoding; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 356 */   public void setCharSetEncoding(String charSetEncoding) { this.charSetEncoding = charSetEncoding; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 365 */   public long getSuspendOnFailDuration() { return this.suspendOnFailDuration; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 374 */   public void setSuspendOnFailDuration(long suspendOnFailDuration) { this.suspendOnFailDuration = suspendOnFailDuration; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 383 */   public int getStatisticsState() { return this.statisticsState; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 392 */   public void setStatisticsState(int statisticsState) { this.statisticsState = statisticsState; }
/*     */ 
/*     */ 
/*     */   
/* 396 */   public int getTraceState() { return this.traceState; }
/*     */ 
/*     */ 
/*     */   
/* 400 */   public void setTraceState(int traceState) { this.traceState = traceState; }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\endpoint\\utils\EndpointDefinition.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.mediators.AbstractListMediator,"/*     */ package org.apache.synapse.mediators;
/*     */ 
/*     */ import java.util.ArrayList;
/*     */ import java.util.List;
/*     */ import org.apache.synapse.ManagedLifecycle;
/*     */ import org.apache.synapse.Mediator;
/*     */ import org.apache.synapse.MessageContext;
/*     */ import org.apache.synapse.core.SynapseEnvironment;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public abstract class AbstractListMediator
/*     */   extends AbstractMediator
/*     */   implements ListMediator, ManagedLifecycle
/*     */ {
/*  39 */   protected List<Mediator> mediators = new ArrayList<Mediator>();
/*     */ 
/*     */   
/*     */   public boolean mediate(MessageContext synCtx) {
/*  43 */     int parentsEffectiveTraceState = synCtx.getTracingState();
/*     */ 
/*     */     
/*  46 */     setEffectiveTraceState(synCtx);
/*  47 */     int myEffectiveTraceState = synCtx.getTracingState();
/*     */     
/*     */     try {
/*  50 */       if (isTraceOrDebugOn(isTraceOn(synCtx))) {
/*  51 */         traceOrDebug(isTraceOn(synCtx), ""Sequence <"" + getType() + ""> :: mediate()"");
/*     */       }
/*     */       
/*  54 */       for (Mediator mediator : this.mediators) {
/*     */ 
/*     */         
/*  57 */         synCtx.setTracingState(myEffectiveTraceState);
/*  58 */         if (!mediator.mediate(synCtx)) {
/*  59 */           return false;
/*     */         }
/*     */       } 
/*     */     } finally {
/*  63 */       synCtx.setTracingState(parentsEffectiveTraceState);
/*     */     } 
/*  65 */     return true;
/*     */   }
/*     */ 
/*     */   
/*  69 */   public List getList() { return this.mediators; }
/*     */ 
/*     */ 
/*     */   
/*  73 */   public boolean addChild(Mediator m) { return this.mediators.add(m); }
/*     */ 
/*     */ 
/*     */   
/*  77 */   public boolean addAll(List<Mediator> c) { return this.mediators.addAll(c); }
/*     */ 
/*     */ 
/*     */   
/*  81 */   public Mediator getChild(int pos) { return this.mediators.get(pos); }
/*     */ 
/*     */ 
/*     */   
/*  85 */   public boolean removeChild(Mediator m) { return this.mediators.remove(m); }
/*     */ 
/*     */ 
/*     */   
/*  89 */   public Mediator removeChild(int pos) { return this.mediators.remove(pos); }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public void init(SynapseEnvironment se) {
/*  98 */     if (this.log.isDebugEnabled()) {
/*  99 */       this.log.debug(""Initializing child mediators"");
/*     */     }
/*     */     
/* 102 */     for (Mediator mediator : this.mediators) {
/* 103 */       Mediator m = mediator;
/*     */       
/* 105 */       if (m instanceof ManagedLifecycle) {
/* 106 */         ((ManagedLifecycle)m).init(se);
/*     */       }
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public void destroy() {
/* 115 */     if (this.log.isDebugEnabled()) {
/* 116 */       this.log.debug(""Destroying child mediators"");
/*     */     }
/*     */     
/* 119 */     for (Mediator mediator : this.mediators) {
/*     */       
/* 121 */       if (mediator instanceof ManagedLifecycle)
/* 122 */         ((ManagedLifecycle)mediator).destroy(); 
/*     */     } 
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\mediators\AbstractListMediator.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.mediators.AbstractMediator,"/*     */ package org.apache.synapse.mediators;
/*     */ 
/*     */ import org.apache.commons.logging.Log;
/*     */ import org.apache.commons.logging.LogFactory;
/*     */ import org.apache.synapse.Mediator;
/*     */ import org.apache.synapse.MessageContext;
/*     */ import org.apache.synapse.SynapseException;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public abstract class AbstractMediator
/*     */   implements Mediator
/*     */ {
/*     */   protected Log log;
/*  39 */   protected static final Log trace = LogFactory.getLog(""TRACE_LOGGER"");
/*     */ 
/*     */   
/*  42 */   protected int traceState = 2;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  48 */   protected AbstractMediator() { this.log = LogFactory.getLog(getClass()); }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public String getType() {
/*  56 */     String cls = getClass().getName();
/*  57 */     int p = cls.lastIndexOf(""."");
/*  58 */     if (p == -1) {
/*  59 */       return cls;
/*     */     }
/*  61 */     return cls.substring(p + 1);
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  69 */   public int getTraceState() { return this.traceState; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  77 */   public void setTraceState(int traceState) { this.traceState = traceState; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public void setEffectiveTraceState(MessageContext synCtx) {
/*  89 */     if (this.traceState != 2) {
/*  90 */       synCtx.setTracingState(this.traceState);
/*     */     }
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 101 */   public boolean shouldTrace(int parentTraceState) { return (this.traceState == 1 || (this.traceState == 2 && parentTraceState == 1)); }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 114 */   protected boolean isTraceOn(MessageContext msgCtx) { return (this.traceState == 1 || (this.traceState == 2 && msgCtx.getTracingState() == 1)); }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 126 */   protected boolean isTraceOrDebugOn(boolean isTraceOn) { return (isTraceOn || this.log.isDebugEnabled()); }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   protected void traceOrDebug(boolean traceOn, String msg) {
/* 135 */     if (traceOn) {
/* 136 */       trace.info(msg);
/*     */     }
/* 138 */     if (this.log.isDebugEnabled()) {
/* 139 */       this.log.debug(msg);
/*     */     }
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   protected void traceOrDebugWarn(boolean traceOn, String msg) {
/* 149 */     if (traceOn) {
/* 150 */       trace.warn(msg);
/*     */     }
/* 152 */     if (this.log.isDebugEnabled()) {
/* 153 */       this.log.warn(msg);
/*     */     }
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   protected void auditLog(String msg, MessageContext msgContext) {
/* 164 */     this.log.info(msg);
/* 165 */     if (msgContext.getServiceLog() != null) {
/* 166 */       msgContext.getServiceLog().info(msg);
/*     */     }
/* 168 */     if (shouldTrace(msgContext.getTracingState())) {
/* 169 */       trace.info(msg);
/*     */     }
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   protected void handleException(String msg, MessageContext msgContext) {
/* 180 */     this.log.error(msg);
/* 181 */     if (msgContext.getServiceLog() != null) {
/* 182 */       msgContext.getServiceLog().error(msg);
/*     */     }
/* 184 */     if (shouldTrace(msgContext.getTracingState())) {
/* 185 */       trace.error(msg);
/*     */     }
/* 187 */     throw new SynapseException(msg);
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   protected void auditWarn(String msg, MessageContext msgContext) {
/* 196 */     this.log.warn(msg);
/* 197 */     if (msgContext.getServiceLog() != null) {
/* 198 */       msgContext.getServiceLog().warn(msg);
/*     */     }
/* 200 */     if (shouldTrace(msgContext.getTracingState())) {
/* 201 */       trace.warn(msg);
/*     */     }
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   protected void handleException(String msg, Exception e, MessageContext msgContext) {
/* 213 */     this.log.error(msg, e);
/* 214 */     if (msgContext.getServiceLog() != null) {
/* 215 */       msgContext.getServiceLog().error(msg, e);
/*     */     }
/* 217 */     if (shouldTrace(msgContext.getTracingState())) {
/* 218 */       trace.error(msg, e);
/*     */     }
/* 220 */     throw new SynapseException(msg, e);
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\mediators\AbstractMediator.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.mediators.FilterMediator,"package org.apache.synapse.mediators;
import org.apache.synapse.MessageContext;
public interface FilterMediator extends ListMediator {
  boolean test(MessageContext paramMessageContext);
}
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\mediators\FilterMediator.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.mediators.GetPropertyFunction,"/*     */ package org.apache.synapse.mediators;
/*     */ 
/*     */ import java.text.Format;
/*     */ import java.text.SimpleDateFormat;
/*     */ import java.util.Date;
/*     */ import java.util.List;
/*     */ import java.util.Map;
/*     */ import org.apache.axis2.addressing.EndpointReference;
/*     */ import org.apache.axis2.context.MessageContext;
/*     */ import org.apache.axis2.description.AxisOperation;
/*     */ import org.apache.commons.logging.Log;
/*     */ import org.apache.commons.logging.LogFactory;
/*     */ import org.apache.synapse.MessageContext;
/*     */ import org.apache.synapse.core.axis2.Axis2MessageContext;
/*     */ import org.jaxen.Context;
/*     */ import org.jaxen.Function;
/*     */ import org.jaxen.FunctionCallException;
/*     */ import org.jaxen.Navigator;
/*     */ import org.jaxen.function.StringFunction;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class GetPropertyFunction
/*     */   implements Function
/*     */ {
/*  47 */   private static final Log log = LogFactory.getLog(GetPropertyFunction.class);
/*  48 */   private static final Log trace = LogFactory.getLog(""TRACE_LOGGER"");
/*     */ 
/*     */   
/*     */   public static final String NULL_STRING = """";
/*     */   
/*  53 */   private MessageContext synCtx = null;
/*     */ 
/*     */   
/*  56 */   public MessageContext getSynCtx() { return this.synCtx; }
/*     */ 
/*     */ 
/*     */   
/*  60 */   public void setSynCtx(MessageContext synCtx) { this.synCtx = synCtx; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public Object call(Context context, List args) throws FunctionCallException {
/*  74 */     boolean traceOn = (this.synCtx.getTracingState() == 1);
/*  75 */     boolean traceOrDebugOn = (traceOn || log.isDebugEnabled());
/*     */     
/*  77 */     if (args == null || args.size() == 0) {
/*  78 */       if (traceOrDebugOn) {
/*  79 */         traceOrDebug(traceOn, ""Property key value for lookup is not specified"");
/*     */       }
/*  81 */       return """";
/*     */     } 
/*     */     
/*  84 */     int size = args.size();
/*  85 */     if (size == 1) {
/*  86 */       return evaluate(""default"", args.get(0), null, context.getNavigator());
/*     */     }
/*     */     
/*  89 */     if (size == 2) {
/*  90 */       String argOne = StringFunction.evaluate(args.get(0), context.getNavigator());
/*  91 */       if (argOne != null) {
/*  92 */         if (!""axis2"".equals(argOne) && !""default"".equals(argOne) && !""transport"".equals(argOne))
/*     */         {
/*     */           
/*  95 */           return evaluate(""default"", args.get(0), args.get(1), context.getNavigator());
/*     */         }
/*     */         
/*  98 */         return evaluate(args.get(0), args.get(1), null, context.getNavigator());
/*     */       } 
/*     */     } else {
/* 101 */       if (size == 3) {
/* 102 */         return evaluate(args.get(0), args.get(1), args.get(2), context.getNavigator());
/*     */       }
/*     */       
/* 105 */       String msg = ""Invalid arguments for synapse:get-property(prop-name) 0r  synapse:get-property(scope, prop-name) XPath function "";
/*     */       
/* 107 */       if (traceOn) {
/* 108 */         trace.error(msg);
/*     */       }
/* 110 */       log.error(msg);
/* 111 */       throw new FunctionCallException(msg);
/*     */     } 
/*     */     
/* 114 */     return """";
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public Object evaluate(Object scopeObject, Object keyObject, Object dateformat, Navigator navigator) {
/* 129 */     boolean traceOn = (this.synCtx.getTracingState() == 1);
/* 130 */     boolean traceOrDebugOn = (traceOn || log.isDebugEnabled());
/*     */     
/* 132 */     if (this.synCtx == null) {
/* 133 */       if (traceOrDebugOn) {
/* 134 */         traceOrDebug(traceOn, ""Synapse message context has not been set for the XPath extension function 'synapse:get-property(prop-name)'"");
/*     */       }
/*     */       
/* 137 */       return null;
/*     */     } 
/*     */     
/* 140 */     String scope = StringFunction.evaluate(scopeObject, navigator);
/* 141 */     String key = StringFunction.evaluate(keyObject, navigator);
/*     */     
/* 143 */     if (key == null || """".equals(key)) {
/* 144 */       if (traceOrDebugOn) {
/* 145 */         traceOrDebug(traceOn, ""property-name should be provided when executing synapse:get-property(scope,prop-name) or synapse:get-property(prop-name) Xpath function"");
/*     */       }
/*     */ 
/*     */       
/* 149 */       return """";
/*     */     } 
/*     */ 
/*     */ 
/*     */ 
/*     */     
/* 155 */     if (""SYSTEM_DATE"".equals(key)) {
/* 156 */       if (dateformat != null) {
/* 157 */         Format formatter = new SimpleDateFormat(dateformat.toString());
/* 158 */         return formatter.format(new Date());
/*     */       } 
/* 160 */       Format formatter = new SimpleDateFormat();
/* 161 */       return formatter.format(new Date());
/*     */     } 
/*     */ 
/*     */ 
/*     */     
/* 166 */     if (""SYSTEM_TIME"".equals(key))
/*     */     {
/* 168 */       return Long.toString(System.currentTimeMillis());
/*     */     }
/*     */     
/* 171 */     if (""default"".equals(scope)) {
/*     */       
/* 173 */       if (""To"".equals(key)) {
/* 174 */         EndpointReference toEPR = this.synCtx.getTo();
/* 175 */         if (toEPR != null) {
/* 176 */           return toEPR.getAddress();
/*     */         }
/* 178 */         return """";
/*     */       } 
/* 180 */       if (""From"".equals(key)) {
/* 181 */         EndpointReference fromEPR = this.synCtx.getFrom();
/* 182 */         if (fromEPR != null) {
/* 183 */           return fromEPR.getAddress();
/*     */         }
/* 185 */         return """";
/*     */       } 
/* 187 */       if (""Action"".equals(key)) {
/* 188 */         String wsaAction = this.synCtx.getWSAAction();
/* 189 */         if (wsaAction != null) {
/* 190 */           return wsaAction;
/*     */         }
/* 192 */         return """";
/*     */       } 
/* 194 */       if (""FaultTo"".equals(key)) {
/* 195 */         EndpointReference faultEPR = this.synCtx.getFaultTo();
/* 196 */         if (faultEPR != null) {
/* 197 */           return faultEPR.getAddress();
/*     */         }
/* 199 */         return """";
/*     */       } 
/* 201 */       if (""ReplyTo"".equals(key)) {
/* 202 */         EndpointReference replyToEPR = this.synCtx.getReplyTo();
/* 203 */         if (replyToEPR != null) {
/* 204 */           return replyToEPR.getAddress();
/*     */         }
/* 206 */         return """";
/*     */       } 
/* 208 */       if (""MessageID"".equals(key)) {
/* 209 */         String messageID = this.synCtx.getMessageID();
/* 210 */         if (messageID != null) {
/* 211 */           return messageID;
/*     */         }
/* 213 */         return """";
/*     */       } 
/* 215 */       if (""MESSAGE_FORMAT"".equals(key)) {
/* 216 */         if (this.synCtx.isDoingPOX())
/* 217 */           return ""pox""; 
/* 218 */         if (this.synCtx.isDoingGET())
/* 219 */           return ""get""; 
/* 220 */         if (this.synCtx.isSOAP11()) {
/* 221 */           return ""soap11"";
/*     */         }
/* 223 */         return ""soap12"";
/* 224 */       }  if (""OperationName"".equals(key) || ""OperationNamespace"".equals(key)) {
/*     */         
/* 226 */         if (this.synCtx instanceof Axis2MessageContext) {
/* 227 */           AxisOperation axisOperation = ((Axis2MessageContext)this.synCtx).getAxis2MessageContext().getAxisOperation();
/*     */           
/* 229 */           if (axisOperation != null) {
/* 230 */             if (""OperationNamespace"".equals(key)) {
/* 231 */               return axisOperation.getName().getNamespaceURI();
/*     */             }
/* 233 */             return axisOperation.getName().getLocalPart();
/*     */           } 
/*     */         } 
/*     */       } else {
/*     */         
/* 238 */         Object result = this.synCtx.getProperty(key);
/* 239 */         if (result != null) {
/* 240 */           return result;
/*     */         }
/* 242 */         return this.synCtx.getEntry(key);
/*     */       } 
/*     */     } else {
/* 245 */       if (""axis2"".equals(scope) && this.synCtx instanceof Axis2MessageContext) {
/*     */ 
/*     */         
/* 248 */         MessageContext axis2MessageContext = ((Axis2MessageContext)this.synCtx).getAxis2MessageContext();
/*     */         
/* 250 */         return axis2MessageContext.getProperty(key);
/*     */       } 
/* 252 */       if (""transport"".equals(scope) && this.synCtx instanceof Axis2MessageContext) {
/*     */ 
/*     */         
/* 255 */         MessageContext axis2MessageContext = ((Axis2MessageContext)this.synCtx).getAxis2MessageContext();
/*     */         
/* 257 */         Object headers = axis2MessageContext.getProperty(""TRANSPORT_HEADERS"");
/*     */ 
/*     */         
/* 260 */         if (headers != null && headers instanceof Map) {
/* 261 */           Map headersMap = (Map)headers;
/* 262 */           return headersMap.get(key);
/*     */         }
/*     */       
/*     */       }
/* 266 */       else if (traceOrDebugOn) {
/* 267 */         traceOrDebug(traceOn, ""Invalid scope : '"" + scope + ""' has been set for the "" + ""synapse:get-property(scope,prop-name) XPath function"");
/*     */       } 
/*     */     } 
/*     */     
/* 271 */     return """";
/*     */   }
/*     */   
/*     */   private void traceOrDebug(boolean traceOn, String msg) {
/* 275 */     if (traceOn) {
/* 276 */       trace.info(msg);
/*     */     }
/* 278 */     if (log.isDebugEnabled())
/* 279 */       log.debug(msg); 
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\mediators\GetPropertyFunction.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.mediators.ListMediator,"package org.apache.synapse.mediators;
import java.util.List;
import org.apache.synapse.Mediator;
public interface ListMediator extends Mediator {
  boolean addChild(Mediator paramMediator);
  boolean addAll(List<Mediator> paramList);
  Mediator getChild(int paramInt);
  boolean removeChild(Mediator paramMediator);
  Mediator removeChild(int paramInt);
  List getList();
}
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\mediators\ListMediator.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.mediators.MediatorFaultHandler,"/*     */ package org.apache.synapse.mediators;
/*     */ 
/*     */ import org.apache.commons.logging.Log;
/*     */ import org.apache.commons.logging.LogFactory;
/*     */ import org.apache.synapse.FaultHandler;
/*     */ import org.apache.synapse.Mediator;
/*     */ import org.apache.synapse.MessageContext;
/*     */ import org.apache.synapse.SynapseException;
/*     */ import org.apache.synapse.mediators.base.SequenceMediator;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class MediatorFaultHandler
/*     */   extends FaultHandler
/*     */ {
/*  36 */   private static final Log log = LogFactory.getLog(MediatorFaultHandler.class);
/*  37 */   private static final Log trace = LogFactory.getLog(""TRACE_LOGGER"");
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  42 */   private Mediator faultMediator = null;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  51 */   public MediatorFaultHandler(Mediator faultMediator) { this.faultMediator = faultMediator; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public void onFault(MessageContext synCtx) throws SynapseException {
/*  63 */     boolean traceOn = (synCtx.getTracingState() == 1);
/*  64 */     boolean traceOrDebugOn = (traceOn || log.isDebugEnabled());
/*     */     
/*  66 */     String name = null;
/*  67 */     if (this.faultMediator instanceof SequenceMediator) {
/*  68 */       name = ((SequenceMediator)this.faultMediator).getName();
/*     */     }
/*  70 */     if (name == null) {
/*  71 */       name = this.faultMediator.getClass().getName();
/*     */     }
/*     */     
/*  74 */     if (traceOrDebugOn) {
/*  75 */       traceOrDebugWarn(traceOn, ""Executing fault handler mediator : "" + name);
/*     */     }
/*     */     
/*  78 */     synCtx.getServiceLog().warn(""Executing fault sequence mediator : "" + name);
/*  79 */     this.faultMediator.mediate(synCtx);
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  88 */   public Mediator getFaultMediator() { return this.faultMediator; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  97 */   public void setFaultMediator(Mediator faultMediator) { this.faultMediator = faultMediator; }
/*     */ 
/*     */   
/*     */   private void traceOrDebugWarn(boolean traceOn, String msg) {
/* 101 */     if (traceOn) {
/* 102 */       trace.warn(msg);
/*     */     }
/* 104 */     log.warn(msg);
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\mediators\MediatorFaultHandler.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.mediators.MediatorProperty,"/*    */ package org.apache.synapse.mediators;
/*    */ 
/*    */ import javax.xml.namespace.QName;
/*    */ import org.apache.synapse.MessageContext;
/*    */ import org.apache.synapse.util.xpath.SynapseXPath;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class MediatorProperty
/*    */ {
/* 35 */   public static final QName PROPERTY_Q = new QName(""http://ws.apache.org/ns/synapse"", ""property"");
/* 36 */   public static final QName ATT_NAME_Q = new QName("""", ""name"");
/* 37 */   public static final QName ATT_VALUE_Q = new QName("""", ""value"");
/* 38 */   public static final QName ATT_EXPR_Q = new QName("""", ""expression"");
/*    */   
/*    */   private String name;
/*    */   
/*    */   private String value;
/*    */   
/*    */   private SynapseXPath expression;
/*    */ 
/*    */   
/* 47 */   public String getName() { return this.name; }
/*    */ 
/*    */ 
/*    */   
/* 51 */   public void setName(String name) { this.name = name; }
/*    */ 
/*    */ 
/*    */   
/* 55 */   public String getValue() { return this.value; }
/*    */ 
/*    */ 
/*    */   
/* 59 */   public void setValue(String value) { this.value = value; }
/*    */ 
/*    */ 
/*    */   
/* 63 */   public SynapseXPath getExpression() { return this.expression; }
/*    */ 
/*    */ 
/*    */   
/* 67 */   public void setExpression(SynapseXPath expression) { this.expression = expression; }
/*    */ 
/*    */ 
/*    */   
/* 71 */   public String getEvaluatedExpression(MessageContext synCtx) { return this.expression.stringValueOf(synCtx); }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\mediators\MediatorProperty.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.mediators.MediatorWorker,"/*     */ package org.apache.synapse.mediators;
/*     */ 
/*     */ import org.apache.commons.logging.Log;
/*     */ import org.apache.commons.logging.LogFactory;
/*     */ import org.apache.synapse.FaultHandler;
/*     */ import org.apache.synapse.Mediator;
/*     */ import org.apache.synapse.MessageContext;
/*     */ import org.apache.synapse.SynapseException;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class MediatorWorker
/*     */   implements Runnable
/*     */ {
/*  33 */   private static final Log log = LogFactory.getLog(MediatorWorker.class);
/*  34 */   private static final Log trace = LogFactory.getLog(""TRACE_LOGGER"");
/*     */ 
/*     */   
/*  37 */   private Mediator seq = null;
/*     */ 
/*     */   
/*  40 */   private MessageContext synCtx = null;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public MediatorWorker(Mediator seq, MessageContext synCtx) {
/*  49 */     this.seq = seq;
/*  50 */     this.synCtx = synCtx;
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public MediatorWorker(MessageContext synCtx) {
/*  60 */     this.synCtx = synCtx;
/*  61 */     this.seq = synCtx.getMainSequence();
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public void run() {
/*     */     try {
/*  70 */       this.seq.mediate(this.synCtx);
/*     */     
/*     */     }
/*  73 */     catch (SynapseException syne) {
/*  74 */       if (!this.synCtx.getFaultStack().isEmpty()) {
/*  75 */         warn(false, ""Executing fault handler due to exception encountered"", this.synCtx);
/*  76 */         ((FaultHandler)this.synCtx.getFaultStack().pop()).handleFault(this.synCtx, (Exception)syne);
/*     */       } else {
/*     */         
/*  79 */         warn(false, ""Exception encountered but no fault handler found - message dropped"", this.synCtx);
/*     */       }
/*     */     
/*     */     }
/*  83 */     catch (Exception e) {
/*  84 */       String msg = ""Unexpected error executing task/async inject"";
/*  85 */       log.error(msg, e);
/*  86 */       if (this.synCtx.getServiceLog() != null) {
/*  87 */         this.synCtx.getServiceLog().error(msg, e);
/*     */       }
/*  89 */       if (!this.synCtx.getFaultStack().isEmpty()) {
/*  90 */         warn(false, ""Executing fault handler due to exception encountered"", this.synCtx);
/*  91 */         ((FaultHandler)this.synCtx.getFaultStack().pop()).handleFault(this.synCtx, e);
/*     */       } else {
/*     */         
/*  94 */         warn(false, ""Exception encountered but no fault handler found - message dropped"", this.synCtx);
/*     */       } 
/*     */     } 
/*     */     
/*  98 */     this.synCtx = null;
/*  99 */     this.seq = null;
/*     */   }
/*     */   
/*     */   private void warn(boolean traceOn, String msg, MessageContext msgContext) {
/* 103 */     if (traceOn) {
/* 104 */       trace.warn(msg);
/*     */     }
/* 106 */     if (log.isDebugEnabled()) {
/* 107 */       log.warn(msg);
/*     */     }
/* 109 */     if (msgContext.getServiceLog() != null)
/* 110 */       msgContext.getServiceLog().warn(msg); 
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\mediators\MediatorWorker.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.mediators.annotations.Execute,"package org.apache.synapse.mediators.annotations;
import java.lang.annotation.ElementType;
import java.lang.annotation.Retention;
import java.lang.annotation.RetentionPolicy;
import java.lang.annotation.Target;
@Target({ElementType.METHOD})
@Retention(RetentionPolicy.RUNTIME)
public @interface Execute {}
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\mediators\annotations\Execute.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.mediators.annotations.Namespaces,"package org.apache.synapse.mediators.annotations;
import java.lang.annotation.ElementType;
import java.lang.annotation.Retention;
import java.lang.annotation.RetentionPolicy;
import java.lang.annotation.Target;
@Target({ElementType.TYPE, ElementType.FIELD, ElementType.METHOD})
@Retention(RetentionPolicy.RUNTIME)
public @interface Namespaces {
  String[] value();
}
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\mediators\annotations\Namespaces.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.mediators.annotations.ReadAndUpdate,"package org.apache.synapse.mediators.annotations;
import java.lang.annotation.ElementType;
import java.lang.annotation.Retention;
import java.lang.annotation.RetentionPolicy;
import java.lang.annotation.Target;
@Target({ElementType.FIELD})
@Retention(RetentionPolicy.RUNTIME)
public @interface ReadAndUpdate {
  String value();
}
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\mediators\annotations\ReadAndUpdate.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.mediators.annotations.ReadFromMessage,"package org.apache.synapse.mediators.annotations;
import java.lang.annotation.ElementType;
import java.lang.annotation.Retention;
import java.lang.annotation.RetentionPolicy;
import java.lang.annotation.Target;
@Target({ElementType.FIELD, ElementType.METHOD})
@Retention(RetentionPolicy.RUNTIME)
public @interface ReadFromMessage {
  String value();
}
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\mediators\annotations\ReadFromMessage.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.mediators.annotations.UpdateMessage,"package org.apache.synapse.mediators.annotations;
import java.lang.annotation.ElementType;
import java.lang.annotation.Retention;
import java.lang.annotation.RetentionPolicy;
import java.lang.annotation.Target;
@Target({ElementType.FIELD, ElementType.METHOD})
@Retention(RetentionPolicy.RUNTIME)
public @interface UpdateMessage {
  String value();
}
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\mediators\annotations\UpdateMessage.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.mediators.base.SequenceMediator,"/*     */ package org.apache.synapse.mediators.base;
/*     */ 
/*     */ import java.util.Stack;
/*     */ import org.apache.synapse.FaultHandler;
/*     */ import org.apache.synapse.Mediator;
/*     */ import org.apache.synapse.MessageContext;
/*     */ import org.apache.synapse.core.SynapseEnvironment;
/*     */ import org.apache.synapse.mediators.AbstractListMediator;
/*     */ import org.apache.synapse.mediators.MediatorFaultHandler;
/*     */ import org.apache.synapse.statistics.StatisticsUtils;
/*     */ import org.apache.synapse.statistics.impl.SequenceStatisticsStack;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class SequenceMediator
/*     */   extends AbstractListMediator
/*     */ {
/*  46 */   private String name = null;
/*     */   
/*  48 */   private String key = null;
/*     */   
/*  50 */   private String errorHandler = null;
/*     */   
/*     */   private boolean dynamic = false;
/*     */   
/*     */   private boolean initialized = false;
/*     */   
/*  56 */   private String registryKey = null;
/*     */ 
/*     */   
/*  59 */   private int statisticsState = 2;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public boolean mediate(MessageContext synCtx) {
/*  74 */     boolean statsOn = (1 == this.statisticsState);
/*  75 */     boolean traceOn = isTraceOn(synCtx);
/*  76 */     boolean traceOrDebugOn = isTraceOrDebugOn(traceOn);
/*     */     
/*  78 */     if (traceOrDebugOn) {
/*  79 */       traceOrDebug(traceOn, ""Start : Sequence "" + ((this.name == null) ? ((this.key == null) ? ""<anonymous"" : (""key=<"" + this.key)) : (""<"" + this.name)) + "">"");
/*     */ 
/*     */       
/*  82 */       if (traceOn && trace.isTraceEnabled()) {
/*  83 */         trace.trace(""Message : "" + synCtx.getEnvelope());
/*     */       }
/*     */     } 
/*     */     
/*  87 */     if (this.key == null) {
/*     */ 
/*     */ 
/*     */       
/*  91 */       Mediator errorHandlerMediator = null;
/*     */ 
/*     */       
/*  94 */       if (statsOn) {
/*  95 */         Object object = synCtx.getProperty(""synapse.sequence.stats"");
/*     */         
/*  97 */         if (object == null) {
/*  98 */           object = new SequenceStatisticsStack();
/*  99 */           synCtx.setProperty(""synapse.sequence.stats"", object);
/*     */         } 
/* 101 */         String seqName = (this.name == null) ? ""AnonymousSequence"" : this.name;
/* 102 */         boolean isFault = synCtx.getEnvelope().getBody().hasFault();
/* 103 */         object.put(seqName, System.currentTimeMillis(), !synCtx.isResponse(), statsOn, isFault);
/*     */       } 
/*     */ 
/*     */ 
/*     */       
/*     */       try {
/* 109 */         if (this.errorHandler != null) {
/* 110 */           errorHandlerMediator = synCtx.getSequence(this.errorHandler);
/*     */           
/* 112 */           if (errorHandlerMediator != null) {
/* 113 */             if (traceOrDebugOn) {
/* 114 */               traceOrDebug(traceOn, ""Setting the onError handler : "" + this.errorHandler + "" for the sequence : "" + this.name);
/*     */             }
/*     */             
/* 117 */             synCtx.pushFaultHandler((FaultHandler)new MediatorFaultHandler(errorHandlerMediator));
/*     */           } else {
/*     */             
/* 120 */             auditWarn(""onError handler : "" + this.errorHandler + "" for sequence : "" + this.name + "" cannot be found"", synCtx);
/*     */           } 
/*     */         } 
/*     */ 
/*     */         
/* 125 */         boolean result = super.mediate(synCtx);
/*     */ 
/*     */ 
/*     */         
/* 129 */         if (errorHandlerMediator != null) {
/* 130 */           Stack faultStack = synCtx.getFaultStack();
/* 131 */           if (faultStack != null && !faultStack.isEmpty()) {
/* 132 */             Object o = faultStack.peek();
/*     */             
/* 134 */             if (o instanceof MediatorFaultHandler && errorHandlerMediator.equals(((MediatorFaultHandler)o).getFaultMediator()))
/*     */             {
/*     */               
/* 137 */               faultStack.pop();
/*     */             }
/*     */           } 
/*     */         } 
/*     */         
/* 142 */         if (traceOrDebugOn) {
/* 143 */           if (traceOn && trace.isTraceEnabled()) {
/* 144 */             trace.trace(""Message : "" + synCtx.getEnvelope());
/*     */           }
/*     */           
/* 147 */           traceOrDebug(traceOn, ""End : Sequence <"" + ((this.name == null) ? ""anonymous"" : this.name) + "">"");
/*     */         } 
/*     */ 
/*     */         
/* 151 */         return result;
/*     */       
/*     */       }
/*     */       finally {
/*     */         
/* 156 */         if (statsOn) {
/* 157 */           StatisticsUtils.processSequenceStatistics(synCtx);
/*     */         }
/*     */         
/* 160 */         StatisticsUtils.processProxyServiceStatistics(synCtx);
/*     */       } 
/*     */     } 
/*     */ 
/*     */     
/* 165 */     Mediator m = synCtx.getSequence(this.key);
/* 166 */     if (m == null) {
/* 167 */       handleException(""Sequence named "" + this.key + "" cannot be found"", synCtx);
/*     */     } else {
/*     */       
/* 170 */       if (traceOrDebugOn) {
/* 171 */         traceOrDebug(traceOn, ""Executing with key "" + this.key);
/*     */       }
/*     */       
/* 174 */       boolean result = m.mediate(synCtx);
/*     */       
/* 176 */       if (traceOrDebugOn) {
/* 177 */         traceOrDebug(traceOn, ""End : Sequence key=<"" + this.key + "">"");
/*     */       }
/* 179 */       return result;
/*     */     } 
/*     */ 
/*     */     
/* 183 */     return false;
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public synchronized void init(SynapseEnvironment se) {
/* 191 */     if (!this.initialized) {
/* 192 */       super.init(se);
/* 193 */       this.initialized = true;
/*     */     } 
/*     */   }
/*     */   
/*     */   public synchronized void destroy() {
/* 198 */     if (this.initialized) {
/* 199 */       super.destroy();
/* 200 */       this.initialized = false;
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 209 */   public String getName() { return this.name; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 217 */   public void setName(String name) { this.name = name; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 225 */   public String getKey() { return this.key; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 233 */   public void setKey(String key) { this.key = key; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 241 */   public String getErrorHandler() { return this.errorHandler; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 250 */   public void setErrorHandler(String errorHandler) { this.errorHandler = errorHandler; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 259 */   public int getStatisticsState() { return this.statisticsState; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 268 */   public void setStatisticsState(int statisticsState) { this.statisticsState = statisticsState; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 276 */   public boolean isDynamic() { return this.dynamic; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 284 */   public void setDynamic(boolean dynamic) { this.dynamic = dynamic; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 292 */   public String getRegistryKey() { return this.registryKey; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 300 */   public void setRegistryKey(String registryKey) { this.registryKey = registryKey; }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\mediators\base\SequenceMediator.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.mediators.base.SynapseMediator,"/*    */ package org.apache.synapse.mediators.base;
/*    */ 
/*    */ import org.apache.synapse.MessageContext;
/*    */ import org.apache.synapse.mediators.AbstractListMediator;
/*    */ import org.apache.synapse.statistics.StatisticsUtils;
/*    */ import org.apache.synapse.statistics.impl.SequenceStatisticsStack;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class SynapseMediator
/*    */   extends AbstractListMediator
/*    */ {
/*    */   public boolean mediate(MessageContext synCtx) {
/* 48 */     boolean traceOn = isTraceOn(synCtx);
/* 49 */     boolean traceOrDebugOn = isTraceOrDebugOn(traceOn);
/*    */     
/* 51 */     if (traceOrDebugOn) {
/* 52 */       traceOrDebug(traceOn, ""Start : Mediation using 'main' sequence Message is a : "" + (synCtx.isResponse() ? ""response"" : ""request""));
/*    */ 
/*    */       
/* 55 */       if (traceOn && trace.isTraceEnabled()) {
/* 56 */         trace.trace(""Message : "" + synCtx.getEnvelope());
/*    */       }
/*    */     } 
/*    */ 
/*    */     
/* 61 */     if (synCtx.isResponse()) {
/* 62 */       StatisticsUtils.processAllSequenceStatistics(synCtx);
/*    */     }
/*    */ 
/*    */     
/* 66 */     Object object = synCtx.getProperty(""synapse.sequence.stats"");
/*    */     
/* 68 */     if (object == null) {
/* 69 */       object = new SequenceStatisticsStack();
/* 70 */       synCtx.setProperty(""synapse.sequence.stats"", object);
/*    */     } 
/* 72 */     String seqName = ""MainSequence"";
/* 73 */     boolean isFault = synCtx.getEnvelope().getBody().hasFault();
/* 74 */     object.put(seqName, System.currentTimeMillis(), !synCtx.isResponse(), true, isFault);
/*    */     
/* 76 */     boolean result = super.mediate(synCtx);
/*    */     
/* 78 */     if (traceOrDebugOn) {
/* 79 */       if (traceOn && trace.isTraceEnabled()) {
/* 80 */         trace.trace(""Message : "" + synCtx.getEnvelope());
/*    */       }
/* 82 */       traceOrDebug(traceOn, ""End : Mediation using 'main' sequence"");
/*    */     } 
/*    */     
/* 85 */     return result;
/*    */   }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\mediators\base\SynapseMediator.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.mediators.builtin.CacheMediator,"/*     */ package org.apache.synapse.mediators.builtin;
/*     */ 
/*     */ import java.io.ByteArrayInputStream;
/*     */ import java.io.ByteArrayOutputStream;
/*     */ import java.io.IOException;
/*     */ import java.io.OutputStream;
/*     */ import javax.xml.soap.MessageFactory;
/*     */ import javax.xml.soap.MimeHeaders;
/*     */ import javax.xml.soap.SOAPException;
/*     */ import javax.xml.soap.SOAPMessage;
/*     */ import javax.xml.stream.XMLStreamException;
/*     */ import org.apache.axiom.soap.SOAPEnvelope;
/*     */ import org.apache.axis2.AxisFault;
/*     */ import org.apache.axis2.clustering.ClusteringFault;
/*     */ import org.apache.axis2.clustering.context.Replicator;
/*     */ import org.apache.axis2.context.AbstractContext;
/*     */ import org.apache.axis2.context.ConfigurationContext;
/*     */ import org.apache.axis2.saaj.util.SAAJUtil;
/*     */ import org.apache.synapse.MessageContext;
/*     */ import org.apache.synapse.SynapseException;
/*     */ import org.apache.synapse.core.axis2.Axis2MessageContext;
/*     */ import org.apache.synapse.core.axis2.Axis2Sender;
/*     */ import org.apache.synapse.mediators.AbstractMediator;
/*     */ import org.apache.synapse.mediators.base.SequenceMediator;
/*     */ import org.apache.synapse.util.FixedByteArrayOutputStream;
/*     */ import org.apache.synapse.util.MessageHelper;
/*     */ import org.wso2.caching.CacheManager;
/*     */ import org.wso2.caching.CachedObject;
/*     */ import org.wso2.caching.CachingConstants;
/*     */ import org.wso2.caching.CachingException;
/*     */ import org.wso2.caching.digest.DigestGenerator;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class CacheMediator
/*     */   extends AbstractMediator
/*     */ {
/*  60 */   private String id = null;
/*  61 */   private String scope = ""per-host"";
/*     */   private boolean collector = false;
/*  63 */   private DigestGenerator digestGenerator = CachingConstants.DEFAULT_XML_IDENTIFIER;
/*  64 */   private int inMemoryCacheSize = 1000;
/*     */ 
/*     */   
/*  67 */   private int diskCacheSize = 0;
/*  68 */   private long timeout = 0L;
/*  69 */   private SequenceMediator onCacheHitSequence = null;
/*  70 */   private String onCacheHitRef = null;
/*  71 */   private int maxMessageSize = 0;
/*  72 */   private String cacheManagerKey = ""cacheManager"";
/*     */   
/*     */   private static final String CACHE_MANAGER_PREFIX = ""synapse.cache_manager_"";
/*     */   
/*     */   public boolean mediate(MessageContext synCtx) {
/*     */     CacheManager cacheManager;
/*  78 */     boolean traceOn = isTraceOn(synCtx);
/*  79 */     boolean traceOrDebugOn = isTraceOrDebugOn(traceOn);
/*     */     
/*  81 */     if (traceOrDebugOn) {
/*  82 */       traceOrDebug(traceOn, ""Start : Cache mediator"");
/*     */       
/*  84 */       if (traceOn && trace.isTraceEnabled()) {
/*  85 */         trace.trace(""Message : "" + synCtx.getEnvelope());
/*     */       }
/*     */     } 
/*     */ 
/*     */     
/*  90 */     FixedByteArrayOutputStream fbaos = null;
/*  91 */     if (this.maxMessageSize > 0) {
/*  92 */       fbaos = new FixedByteArrayOutputStream(this.maxMessageSize);
/*     */       try {
/*  94 */         MessageHelper.cloneSOAPEnvelope(synCtx.getEnvelope()).serialize((OutputStream)fbaos);
/*  95 */       } catch (XMLStreamException e) {
/*  96 */         handleException(""Error in checking the message size"", e, synCtx);
/*  97 */       } catch (SynapseException syne) {
/*  98 */         if (traceOrDebugOn) {
/*  99 */           traceOrDebug(traceOn, ""Message size exceeds the upper bound for caching, request will not be cached"");
/*     */           
/* 101 */           return true;
/*     */         } 
/*     */       } 
/*     */     } 
/*     */     
/* 106 */     ConfigurationContext cfgCtx = ((Axis2MessageContext)synCtx).getAxis2MessageContext().getConfigurationContext();
/*     */     
/* 108 */     if (cfgCtx == null) {
/* 109 */       handleException(""Unable to perform caching,  ConfigurationContext cannot be found"", synCtx);
/*     */       
/* 111 */       return false;
/*     */     } 
/*     */     
/* 114 */     if (traceOrDebugOn) {
/* 115 */       traceOrDebug(traceOn, ""Looking up cache at scope : "" + this.scope + "" with ID : "" + this.cacheManagerKey);
/*     */     }
/*     */ 
/*     */ 
/*     */     
/* 120 */     Object prop = cfgCtx.getPropertyNonReplicable(this.cacheManagerKey);
/*     */     
/* 122 */     if (prop != null && prop instanceof CacheManager) {
/* 123 */       cacheManager = (CacheManager)prop;
/*     */     } else {
/* 125 */       synchronized (cfgCtx) {
/*     */         
/* 127 */         prop = cfgCtx.getPropertyNonReplicable(this.cacheManagerKey);
/* 128 */         if (prop != null && prop instanceof CacheManager) {
/* 129 */           cacheManager = (CacheManager)prop;
/*     */         } else {
/*     */           
/* 132 */           if (traceOrDebugOn) {
/* 133 */             traceOrDebug(traceOn, ""Creating/recreating the cache object"");
/*     */           }
/* 135 */           cacheManager = new CacheManager();
/* 136 */           cfgCtx.setProperty(this.cacheManagerKey, cacheManager);
/*     */         } 
/*     */       } 
/*     */     } 
/*     */     
/* 141 */     boolean result = true;
/*     */     
/*     */     try {
/* 144 */       if (synCtx.isResponse()) {
/* 145 */         processResponseMessage(synCtx, cfgCtx, traceOrDebugOn, traceOn, cacheManager);
/*     */       } else {
/*     */         
/* 148 */         result = processRequestMessage(synCtx, cfgCtx, traceOrDebugOn, traceOn, cacheManager);
/*     */       }
/*     */     
/*     */     }
/* 152 */     catch (ClusteringFault clusteringFault) {
/* 153 */       if (traceOrDebugOn) {
/* 154 */         traceOrDebug(traceOn, ""Unable to replicate Cache mediator state among the cluster"");
/*     */       }
/*     */     } 
/*     */     
/* 158 */     if (traceOrDebugOn) {
/* 159 */       traceOrDebug(traceOn, ""End : Cache mediator"");
/*     */     }
/*     */     
/* 162 */     return result;
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   private void processResponseMessage(MessageContext synCtx, ConfigurationContext cfgCtx, boolean traceOrDebugOn, boolean traceOn, CacheManager cacheManager) throws ClusteringFault {
/* 179 */     if (!this.collector) {
/* 180 */       handleException(""Response messages cannot be handled in a non collector cache"", synCtx);
/*     */     }
/*     */     
/* 183 */     String requestHash = (String)synCtx.getProperty(""requestHash"");
/*     */     
/* 185 */     if (requestHash != null) {
/* 186 */       if (traceOrDebugOn) {
/* 187 */         traceOrDebug(traceOn, ""Storing the response message into the cache at scope : "" + this.scope + "" with ID : "" + this.cacheManagerKey + "" for request hash : "" + requestHash);
/*     */       }
/*     */ 
/*     */       
/* 191 */       CachedObject cachedObj = cacheManager.getResponseForKey(requestHash, (AbstractContext)cfgCtx);
/* 192 */       if (cachedObj != null) {
/*     */         
/* 194 */         if (traceOrDebugOn) {
/* 195 */           traceOrDebug(traceOn, ""Storing the response for the message with ID : "" + synCtx.getMessageID() + "" with request hash ID : "" + cachedObj.getRequestHash() + "" in the cache : "" + this.cacheManagerKey);
/*     */         }
/*     */ 
/*     */ 
/*     */         
/* 200 */         ByteArrayOutputStream outStream = new ByteArrayOutputStream();
/*     */         try {
/* 202 */           MessageHelper.cloneSOAPEnvelope(synCtx.getEnvelope()).serialize(outStream);
/* 203 */           cachedObj.setResponseEnvelope(outStream.toByteArray());
/* 204 */         } catch (XMLStreamException e) {
/* 205 */           handleException(""Unable to set the response to the Cache"", e, synCtx);
/*     */         } 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */         
/* 216 */         if (cachedObj.getTimeout() > 0L) {
/* 217 */           cachedObj.setExpireTimeMillis(System.currentTimeMillis() + cachedObj.getTimeout());
/*     */         }
/*     */         
/* 220 */         cfgCtx.setProperty(this.cacheManagerKey, cacheManager);
/* 221 */         Replicator.replicate((AbstractContext)cfgCtx);
/*     */       } else {
/*     */         
/* 224 */         auditWarn(""A response message without a valid mapping to the request hash found. Unable to store the response in cache"", synCtx);
/*     */       }
/*     */     
/*     */     } else {
/*     */       
/* 229 */       auditWarn(""A response message without a mapping to the request hash found. Unable to store the response in cache"", synCtx);
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   private boolean processRequestMessage(MessageContext synCtx, ConfigurationContext cfgCtx, boolean traceOrDebugOn, boolean traceOn, CacheManager cacheManager) throws ClusteringFault {
/* 250 */     if (this.collector) {
/* 251 */       handleException(""Request messages cannot be handled in a collector cache"", synCtx);
/*     */     }
/*     */     
/* 254 */     String requestHash = null;
/*     */     try {
/* 256 */       requestHash = this.digestGenerator.getDigest(((Axis2MessageContext)synCtx).getAxis2MessageContext());
/*     */       
/* 258 */       synCtx.setProperty(""requestHash"", requestHash);
/* 259 */     } catch (CachingException e) {
/* 260 */       handleException(""Error in calculating the hash value of the request"", (Exception)e, synCtx);
/*     */     } 
/*     */     
/* 263 */     if (traceOrDebugOn) {
/* 264 */       traceOrDebug(traceOn, ""Generated request hash : "" + requestHash);
/*     */     }
/*     */     
/* 267 */     if (cacheManager.containsKey(requestHash) && cacheManager.getResponseForKey(requestHash, (AbstractContext)cfgCtx) != null) {
/*     */ 
/*     */ 
/*     */ 
/*     */       
/* 272 */       CachedObject cachedObj = cacheManager.getResponseForKey(requestHash, (AbstractContext)cfgCtx);
/*     */       
/* 274 */       if (!cachedObj.isExpired() && cachedObj.getResponseEnvelope() != null) {
/*     */         
/* 276 */         if (traceOrDebugOn) {
/* 277 */           traceOrDebug(traceOn, ""Cache-hit for message ID : "" + synCtx.getMessageID());
/*     */         }
/*     */ 
/*     */         
/* 281 */         synCtx.setResponse(true);
/*     */         try {
/* 283 */           MessageFactory mf = MessageFactory.newInstance();
/* 284 */           SOAPMessage smsg = mf.createMessage(new MimeHeaders(), new ByteArrayInputStream(cachedObj.getResponseEnvelope()));
/*     */ 
/*     */           
/* 287 */           SOAPEnvelope omSOAPEnv = SAAJUtil.toOMSOAPEnvelope(smsg.getSOAPPart().getDocumentElement());
/*     */ 
/*     */ 
/*     */ 
/*     */           
/* 292 */           synCtx.setEnvelope(omSOAPEnv);
/* 293 */         } catch (AxisFault axisFault) {
/* 294 */           handleException(""Error setting response envelope from cache : "" + this.cacheManagerKey, synCtx);
/*     */         }
/* 296 */         catch (IOException ioe) {
/* 297 */           handleException(""Error setting response envelope from cache : "" + this.cacheManagerKey, ioe, synCtx);
/*     */         }
/* 299 */         catch (SOAPException soape) {
/* 300 */           handleException(""Error setting response envelope from cache : "" + this.cacheManagerKey, soape, synCtx);
/*     */         } 
/*     */ 
/*     */ 
/*     */         
/* 305 */         if (this.onCacheHitSequence != null) {
/*     */           
/* 307 */           if (traceOrDebugOn) {
/* 308 */             traceOrDebug(traceOn, ""Delegating message to the onCachingHit Anonymous sequence"");
/*     */           }
/*     */           
/* 311 */           this.onCacheHitSequence.mediate(synCtx);
/*     */         }
/* 313 */         else if (this.onCacheHitRef != null) {
/*     */           
/* 315 */           if (traceOrDebugOn) {
/* 316 */             traceOrDebug(traceOn, ""Delegating message to the onCachingHit sequence : "" + this.onCacheHitRef);
/*     */           }
/*     */           
/* 319 */           synCtx.getSequence(this.onCacheHitRef).mediate(synCtx);
/*     */         }
/*     */         else {
/*     */           
/* 323 */           if (traceOrDebugOn) {
/* 324 */             traceOrDebug(traceOn, ""Request message "" + synCtx.getMessageID() + "" was served from the cache : "" + this.cacheManagerKey);
/*     */           }
/*     */ 
/*     */           
/* 328 */           synCtx.setTo(null);
/* 329 */           Axis2Sender.sendBack(synCtx);
/*     */         } 
/*     */         
/* 332 */         return false;
/*     */       } 
/*     */ 
/*     */       
/* 336 */       cachedObj.expire();
/* 337 */       cachedObj.setTimeout(this.timeout);
/* 338 */       if (traceOrDebugOn) {
/* 339 */         traceOrDebug(traceOn, ""Existing cached response has expired. Reset cache element"");
/*     */       }
/*     */ 
/*     */       
/* 343 */       cfgCtx.setProperty(this.cacheManagerKey, cacheManager);
/* 344 */       Replicator.replicate((AbstractContext)cfgCtx);
/*     */ 
/*     */ 
/*     */ 
/*     */     
/*     */     }
/* 350 */     else if (cacheManager.getCacheKeys().size() == this.inMemoryCacheSize) {
/* 351 */       cacheManager.removeExpiredResponses((AbstractContext)cfgCtx);
/* 352 */       if (cacheManager.getCacheKeys().size() == this.inMemoryCacheSize) {
/* 353 */         if (traceOrDebugOn) {
/* 354 */           traceOrDebug(traceOn, ""In-memory cache is full. Unable to cache"");
/*     */         }
/*     */       } else {
/* 357 */         storeRequestToCache(cfgCtx, requestHash, cacheManager);
/*     */       } 
/*     */     } else {
/* 360 */       storeRequestToCache(cfgCtx, requestHash, cacheManager);
/*     */     } 
/*     */     
/* 363 */     return true;
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   private void storeRequestToCache(ConfigurationContext cfgCtx, String requestHash, CacheManager cacheManager) throws ClusteringFault {
/* 377 */     CachedObject cachedObj = new CachedObject();
/* 378 */     cachedObj.setRequestHash(requestHash);
/*     */ 
/*     */     
/* 381 */     cachedObj.setTimeout(this.timeout);
/* 382 */     cacheManager.addResponseWithKey(requestHash, cachedObj, (AbstractContext)cfgCtx);
/*     */     
/* 384 */     cfgCtx.setProperty(this.cacheManagerKey, cacheManager);
/* 385 */     Replicator.replicate((AbstractContext)cfgCtx);
/*     */   }
/*     */ 
/*     */   
/* 389 */   public String getId() { return this.id; }
/*     */ 
/*     */ 
/*     */   
/* 393 */   public void setId(String id) { this.id = id; }
/*     */ 
/*     */ 
/*     */   
/* 397 */   public String getScope() { return this.scope; }
/*     */ 
/*     */   
/*     */   public void setScope(String scope) {
/* 401 */     this.scope = scope;
/* 402 */     if (""per-mediator"".equals(scope)) {
/* 403 */       this.cacheManagerKey = ""synapse.cache_manager_"" + this.id;
/*     */     }
/*     */   }
/*     */ 
/*     */   
/* 408 */   public boolean isCollector() { return this.collector; }
/*     */ 
/*     */ 
/*     */   
/* 412 */   public void setCollector(boolean collector) { this.collector = collector; }
/*     */ 
/*     */ 
/*     */   
/* 416 */   public DigestGenerator getDigestGenerator() { return this.digestGenerator; }
/*     */ 
/*     */ 
/*     */   
/* 420 */   public void setDigestGenerator(DigestGenerator digestGenerator) { this.digestGenerator = digestGenerator; }
/*     */ 
/*     */ 
/*     */   
/* 424 */   public int getInMemoryCacheSize() { return this.inMemoryCacheSize; }
/*     */ 
/*     */ 
/*     */   
/* 428 */   public void setInMemoryCacheSize(int inMemoryCacheSize) { this.inMemoryCacheSize = inMemoryCacheSize; }
/*     */ 
/*     */ 
/*     */   
/* 432 */   public int getDiskCacheSize() { return this.diskCacheSize; }
/*     */ 
/*     */ 
/*     */   
/* 436 */   public void setDiskCacheSize(int diskCacheSize) { this.diskCacheSize = diskCacheSize; }
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 441 */   public long getTimeout() { return this.timeout / 1000L; }
/*     */ 
/*     */ 
/*     */   
/* 445 */   public void setTimeout(long timeout) { this.timeout = timeout * 1000L; }
/*     */ 
/*     */ 
/*     */   
/* 449 */   public SequenceMediator getOnCacheHitSequence() { return this.onCacheHitSequence; }
/*     */ 
/*     */ 
/*     */   
/* 453 */   public void setOnCacheHitSequence(SequenceMediator onCacheHitSequence) { this.onCacheHitSequence = onCacheHitSequence; }
/*     */ 
/*     */ 
/*     */   
/* 457 */   public String getOnCacheHitRef() { return this.onCacheHitRef; }
/*     */ 
/*     */ 
/*     */   
/* 461 */   public void setOnCacheHitRef(String onCacheHitRef) { this.onCacheHitRef = onCacheHitRef; }
/*     */ 
/*     */ 
/*     */   
/* 465 */   public int getMaxMessageSize() { return this.maxMessageSize; }
/*     */ 
/*     */ 
/*     */   
/* 469 */   public void setMaxMessageSize(int maxMessageSize) { this.maxMessageSize = maxMessageSize; }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\mediators\builtin\CacheMediator.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.mediators.builtin.CalloutMediator,"/*     */ package org.apache.synapse.mediators.builtin;
/*     */ 
/*     */ import java.util.List;
/*     */ import org.apache.axiom.om.OMElement;
/*     */ import org.apache.axiom.om.OMNode;
/*     */ import org.apache.axis2.AxisFault;
/*     */ import org.apache.axis2.addressing.EndpointReference;
/*     */ import org.apache.axis2.client.Options;
/*     */ import org.apache.axis2.client.ServiceClient;
/*     */ import org.apache.axis2.context.ConfigurationContext;
/*     */ import org.apache.axis2.context.ConfigurationContextFactory;
/*     */ import org.apache.axis2.context.MessageContext;
/*     */ import org.apache.axis2.description.Parameter;
/*     */ import org.apache.synapse.ManagedLifecycle;
/*     */ import org.apache.synapse.MessageContext;
/*     */ import org.apache.synapse.SynapseException;
/*     */ import org.apache.synapse.core.SynapseEnvironment;
/*     */ import org.apache.synapse.core.axis2.Axis2MessageContext;
/*     */ import org.apache.synapse.mediators.AbstractMediator;
/*     */ import org.apache.synapse.util.MessageHelper;
/*     */ import org.apache.synapse.util.xpath.SynapseXPath;
/*     */ import org.jaxen.JaxenException;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class CalloutMediator
/*     */   extends AbstractMediator
/*     */   implements ManagedLifecycle
/*     */ {
/*  55 */   private ServiceClient sc = null;
/*  56 */   private String serviceURL = null;
/*  57 */   private String action = null;
/*  58 */   private String requestKey = null;
/*  59 */   private SynapseXPath requestXPath = null;
/*  60 */   private SynapseXPath targetXPath = null;
/*  61 */   private String targetKey = null;
/*  62 */   private String clientRepository = null;
/*  63 */   private String axis2xml = null;
/*  64 */   public static String DEFAULT_CLIENT_REPO = ""./samples/axis2Client/client_repo"";
/*  65 */   public static String DEFAULT_AXIS2_XML = ""./samples/axis2Client/client_repo/conf/axis2.xml"";
/*     */ 
/*     */   
/*     */   public boolean mediate(MessageContext synCtx) {
/*  69 */     boolean traceOn = isTraceOn(synCtx);
/*  70 */     boolean traceOrDebugOn = isTraceOrDebugOn(traceOn);
/*     */     
/*  72 */     if (traceOrDebugOn) {
/*  73 */       traceOrDebug(traceOn, ""Start : Callout mediator"");
/*     */       
/*  75 */       if (traceOn && trace.isTraceEnabled()) {
/*  76 */         trace.trace(""Message : "" + synCtx.getEnvelope());
/*     */       }
/*     */     } 
/*     */     
/*     */     try {
/*  81 */       Options options = new Options();
/*  82 */       options.setTo(new EndpointReference(this.serviceURL));
/*     */       
/*  84 */       if (this.action != null) {
/*  85 */         options.setAction(this.action);
/*     */       }
/*  87 */       else if (synCtx.isSOAP11()) {
/*  88 */         options.setProperty(""disableSoapAction"", Boolean.valueOf(true));
/*     */       } else {
/*  90 */         Axis2MessageContext axis2smc = (Axis2MessageContext)synCtx;
/*  91 */         MessageContext axis2MessageCtx = axis2smc.getAxis2MessageContext();
/*     */         
/*  93 */         axis2MessageCtx.getTransportOut().addParameter(new Parameter(""OmitSOAP12Action"", Boolean.valueOf(true)));
/*     */       } 
/*     */ 
/*     */ 
/*     */       
/*  98 */       options.setProperty(""disableAddressingForOutMessages"", Boolean.TRUE);
/*     */       
/* 100 */       this.sc.setOptions(options);
/*     */       
/* 102 */       OMElement request = getRequestPayload(synCtx);
/* 103 */       if (traceOrDebugOn) {
/* 104 */         traceOrDebug(traceOn, ""About to invoke service : "" + this.serviceURL + ((this.action != null) ? ("" with action : "" + this.action) : """"));
/*     */         
/* 106 */         if (traceOn && trace.isTraceEnabled()) {
/* 107 */           trace.trace(""Request message payload : "" + request);
/*     */         }
/*     */       } 
/*     */       
/* 111 */       OMElement result = this.sc.sendReceive(request);
/*     */       
/* 113 */       if (traceOrDebugOn && 
/* 114 */         traceOn && trace.isTraceEnabled()) {
/* 115 */         trace.trace(""Response payload received : "" + result);
/*     */       }
/*     */ 
/*     */       
/* 119 */       if (result != null) {
/* 120 */         if (this.targetXPath != null) {
/* 121 */           Object o = this.targetXPath.evaluate(synCtx);
/*     */           
/* 123 */           if (o != null && o instanceof OMElement) {
/* 124 */             OMElement oMElement = (OMElement)o;
/* 125 */             oMElement.insertSiblingAfter((OMNode)result);
/* 126 */             oMElement.detach();
/* 127 */           } else if (o != null && o instanceof List && !((List)o).isEmpty()) {
/*     */             
/* 129 */             OMElement oMElement = ((List<OMElement>)o).get(0);
/* 130 */             oMElement.insertSiblingAfter((OMNode)result);
/* 131 */             oMElement.detach();
/*     */           } else {
/* 133 */             handleException(""Evaluation of target XPath expression : "" + this.targetXPath.toString() + "" did not yeild an OMNode"", synCtx);
/*     */           } 
/*     */         } 
/* 136 */         if (this.targetKey != null) {
/* 137 */           synCtx.setProperty(this.targetKey, result);
/*     */         }
/*     */       }
/* 140 */       else if (traceOrDebugOn) {
/* 141 */         traceOrDebug(traceOn, ""Service returned a null response"");
/*     */       }
/*     */     
/*     */     }
/* 145 */     catch (Exception e) {
/* 146 */       handleException(""Error invoking service : "" + this.serviceURL + ((this.action != null) ? ("" with action : "" + this.action) : """"), e, synCtx);
/*     */     } 
/*     */ 
/*     */     
/* 150 */     if (traceOrDebugOn) {
/* 151 */       traceOrDebug(traceOn, ""End : Callout mediator"");
/*     */     }
/* 153 */     return true;
/*     */   }
/*     */ 
/*     */   
/*     */   private OMElement getRequestPayload(MessageContext synCtx) throws AxisFault {
/* 158 */     if (this.requestKey != null) {
/* 159 */       Object request = synCtx.getProperty(this.requestKey);
/* 160 */       if (request == null) {
/* 161 */         request = synCtx.getEntry(this.requestKey);
/*     */       }
/* 163 */       if (request != null && request instanceof OMElement) {
/* 164 */         return (OMElement)request;
/*     */       }
/* 166 */       handleException(""The property : "" + this.requestKey + "" is not an OMElement"", synCtx);
/*     */     }
/* 168 */     else if (this.requestXPath != null) {
/*     */       try {
/* 170 */         Object o = null;
/* 171 */         o = this.requestXPath.evaluate(MessageHelper.cloneMessageContext(synCtx));
/*     */         
/* 173 */         if (o instanceof OMElement)
/* 174 */           return (OMElement)o; 
/* 175 */         if (o instanceof List && !((List)o).isEmpty()) {
/* 176 */           return ((List<OMElement>)o).get(0);
/*     */         }
/* 178 */         handleException(""The evaluation of the XPath expression : "" + this.requestXPath.toString() + "" did not result in an OMElement"", synCtx);
/*     */       
/*     */       }
/* 181 */       catch (JaxenException e) {
/* 182 */         handleException(""Error evaluating XPath expression : "" + this.requestXPath.toString(), (Exception)e, synCtx);
/*     */       } 
/*     */     } 
/*     */     
/* 186 */     return null;
/*     */   }
/*     */   
/*     */   public void init(SynapseEnvironment synEnv) {
/*     */     try {
/* 191 */       ConfigurationContext cfgCtx = ConfigurationContextFactory.createConfigurationContextFromFileSystem((this.clientRepository != null) ? this.clientRepository : DEFAULT_CLIENT_REPO, (this.axis2xml != null) ? this.axis2xml : DEFAULT_AXIS2_XML);
/*     */ 
/*     */ 
/*     */       
/* 195 */       this.sc = new ServiceClient(cfgCtx, null);
/* 196 */     } catch (AxisFault e) {
/* 197 */       String msg = ""Error initializing callout mediator : "" + e.getMessage();
/* 198 */       this.log.error(msg, (Throwable)e);
/* 199 */       throw new SynapseException(msg, (Throwable)e);
/*     */     } 
/*     */   }
/*     */   
/*     */   public void destroy() {
/*     */     try {
/* 205 */       this.sc.cleanup();
/* 206 */     } catch (AxisFault ignore) {}
/*     */   }
/*     */ 
/*     */   
/* 210 */   public String getServiceURL() { return this.serviceURL; }
/*     */ 
/*     */ 
/*     */   
/* 214 */   public void setServiceURL(String serviceURL) { this.serviceURL = serviceURL; }
/*     */ 
/*     */ 
/*     */   
/* 218 */   public String getAction() { return this.action; }
/*     */ 
/*     */ 
/*     */   
/* 222 */   public void setAction(String action) { this.action = action; }
/*     */ 
/*     */ 
/*     */   
/* 226 */   public String getRequestKey() { return this.requestKey; }
/*     */ 
/*     */ 
/*     */   
/* 230 */   public void setRequestKey(String requestKey) { this.requestKey = requestKey; }
/*     */ 
/*     */ 
/*     */   
/* 234 */   public void setRequestXPath(SynapseXPath requestXPath) throws JaxenException { this.requestXPath = requestXPath; }
/*     */ 
/*     */ 
/*     */   
/* 238 */   public void setTargetXPath(SynapseXPath targetXPath) throws JaxenException { this.targetXPath = targetXPath; }
/*     */ 
/*     */ 
/*     */   
/* 242 */   public String getTargetKey() { return this.targetKey; }
/*     */ 
/*     */ 
/*     */   
/* 246 */   public void setTargetKey(String targetKey) { this.targetKey = targetKey; }
/*     */ 
/*     */ 
/*     */   
/* 250 */   public SynapseXPath getRequestXPath() { return this.requestXPath; }
/*     */ 
/*     */ 
/*     */   
/* 254 */   public SynapseXPath getTargetXPath() { return this.targetXPath; }
/*     */ 
/*     */ 
/*     */   
/* 258 */   public String getClientRepository() { return this.clientRepository; }
/*     */ 
/*     */ 
/*     */   
/* 262 */   public void setClientRepository(String clientRepository) { this.clientRepository = clientRepository; }
/*     */ 
/*     */ 
/*     */   
/* 266 */   public String getAxis2xml() { return this.axis2xml; }
/*     */ 
/*     */ 
/*     */   
/* 270 */   public void setAxis2xml(String axis2xml) { this.axis2xml = axis2xml; }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\mediators\builtin\CalloutMediator.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.mediators.builtin.DropMediator,"/*    */ package org.apache.synapse.mediators.builtin;
/*    */ 
/*    */ import org.apache.synapse.MessageContext;
/*    */ import org.apache.synapse.mediators.AbstractMediator;
/*    */ import org.apache.synapse.statistics.StatisticsUtils;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class DropMediator
/*    */   extends AbstractMediator
/*    */ {
/*    */   public boolean mediate(MessageContext synCtx) {
/* 42 */     boolean traceOn = isTraceOn(synCtx);
/* 43 */     boolean traceOrDebugOn = isTraceOrDebugOn(traceOn);
/*    */     
/* 45 */     if (traceOrDebugOn) {
/* 46 */       traceOrDebug(traceOn, ""Start : Drop mediator"");
/*    */       
/* 48 */       if (traceOn && trace.isTraceEnabled()) {
/* 49 */         trace.trace(""Message : "" + synCtx.getEnvelope());
/*    */       }
/*    */     } 
/*    */ 
/*    */ 
/*    */     
/* 55 */     StatisticsUtils.processProxyServiceStatistics(synCtx);
/*    */     
/* 57 */     StatisticsUtils.processAllSequenceStatistics(synCtx);
/*    */     
/* 59 */     if (traceOrDebugOn) {
/* 60 */       traceOrDebug(traceOn, ""End : Drop mediator"");
/*    */     }
/* 62 */     synCtx.setTo(null);
/* 63 */     return false;
/*    */   }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\mediators\builtin\DropMediator.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.mediators.builtin.LogMediator,"/*     */ package org.apache.synapse.mediators.builtin;
/*     */ 
/*     */ import java.util.ArrayList;
/*     */ import java.util.Iterator;
/*     */ import java.util.List;
/*     */ import org.apache.axiom.om.OMElement;
/*     */ import org.apache.axiom.soap.SOAPHeader;
/*     */ import org.apache.axiom.soap.SOAPHeaderBlock;
/*     */ import org.apache.synapse.MessageContext;
/*     */ import org.apache.synapse.mediators.AbstractMediator;
/*     */ import org.apache.synapse.mediators.MediatorProperty;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class LogMediator
/*     */   extends AbstractMediator
/*     */ {
/*     */   public static final int CUSTOM = 0;
/*     */   public static final int SIMPLE = 1;
/*     */   public static final int HEADERS = 2;
/*     */   public static final int FULL = 3;
/*     */   public static final String DEFAULT_SEP = "", "";
/*  58 */   private int logLevel = 1;
/*     */   
/*  60 */   private String separator = "", "";
/*     */   
/*  62 */   private List properties = new ArrayList();
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public boolean mediate(MessageContext synCtx) {
/*  72 */     boolean traceOn = isTraceOn(synCtx);
/*  73 */     boolean traceOrDebugOn = isTraceOrDebugOn(traceOn);
/*     */     
/*  75 */     if (traceOrDebugOn) {
/*  76 */       traceOrDebug(traceOn, ""Start : Log mediator"");
/*     */       
/*  78 */       if (traceOn && trace.isTraceEnabled()) {
/*  79 */         trace.trace(""Message : "" + synCtx.getEnvelope());
/*     */       }
/*     */     } 
/*     */     
/*  83 */     String logMessage = getLogMessage(synCtx);
/*  84 */     synCtx.getServiceLog().info(logMessage);
/*     */     
/*  86 */     if (this.log.isInfoEnabled()) {
/*  87 */       this.log.info(logMessage);
/*     */     }
/*  89 */     if (traceOn) {
/*  90 */       trace.info(""Log message : "" + logMessage);
/*     */     }
/*     */     
/*  93 */     if (traceOrDebugOn) {
/*  94 */       traceOrDebug(traceOn, ""End : Log mediator"");
/*     */     }
/*  96 */     return true;
/*     */   }
/*     */   
/*     */   private String getLogMessage(MessageContext synCtx) {
/* 100 */     switch (this.logLevel) {
/*     */       case 0:
/* 102 */         return getCustomLogMessage(synCtx);
/*     */       case 1:
/* 104 */         return getSimpleLogMessage(synCtx);
/*     */       case 2:
/* 106 */         return getHeadersLogMessage(synCtx);
/*     */       case 3:
/* 108 */         return getFullLogMessage(synCtx);
/*     */     } 
/* 110 */     return ""Invalid log level specified"";
/*     */   }
/*     */ 
/*     */   
/*     */   private String getCustomLogMessage(MessageContext synCtx) {
/* 115 */     StringBuffer sb = new StringBuffer();
/* 116 */     setCustomProperties(sb, synCtx);
/* 117 */     return trimLeadingSeparator(sb);
/*     */   }
/*     */   
/*     */   private String getSimpleLogMessage(MessageContext synCtx) {
/* 121 */     StringBuffer sb = new StringBuffer();
/* 122 */     if (synCtx.getTo() != null) {
/* 123 */       sb.append(""To: "" + synCtx.getTo().getAddress());
/*     */     } else {
/* 125 */       sb.append(""To: "");
/* 126 */     }  if (synCtx.getFrom() != null)
/* 127 */       sb.append(this.separator + ""From: "" + synCtx.getFrom().getAddress()); 
/* 128 */     if (synCtx.getWSAAction() != null)
/* 129 */       sb.append(this.separator + ""WSAction: "" + synCtx.getWSAAction()); 
/* 130 */     if (synCtx.getSoapAction() != null)
/* 131 */       sb.append(this.separator + ""SOAPAction: "" + synCtx.getSoapAction()); 
/* 132 */     if (synCtx.getReplyTo() != null)
/* 133 */       sb.append(this.separator + ""ReplyTo: "" + synCtx.getReplyTo().getAddress()); 
/* 134 */     if (synCtx.getMessageID() != null)
/* 135 */       sb.append(this.separator + ""MessageID: "" + synCtx.getMessageID()); 
/* 136 */     sb.append(this.separator + ""Direction: "" + (synCtx.isResponse() ? ""response"" : ""request""));
/* 137 */     setCustomProperties(sb, synCtx);
/* 138 */     return trimLeadingSeparator(sb);
/*     */   }
/*     */   
/*     */   private String getHeadersLogMessage(MessageContext synCtx) {
/* 142 */     StringBuffer sb = new StringBuffer();
/* 143 */     if (synCtx.getEnvelope() != null) {
/* 144 */       SOAPHeader header = synCtx.getEnvelope().getHeader();
/* 145 */       if (header != null) {
/* 146 */         for (Iterator iter = header.examineAllHeaderBlocks(); iter.hasNext(); ) {
/* 147 */           Object o = iter.next();
/* 148 */           if (o instanceof SOAPHeaderBlock) {
/* 149 */             SOAPHeaderBlock headerBlk = (SOAPHeaderBlock)o;
/* 150 */             sb.append(this.separator + headerBlk.getLocalName() + "" : "" + headerBlk.getText()); continue;
/*     */           } 
/* 152 */           if (o instanceof OMElement) {
/* 153 */             OMElement headerElem = (OMElement)o;
/* 154 */             sb.append(this.separator + headerElem.getLocalName() + "" : "" + headerElem.getText());
/*     */           } 
/*     */         } 
/*     */       }
/*     */     } 
/*     */     
/* 160 */     setCustomProperties(sb, synCtx);
/* 161 */     return trimLeadingSeparator(sb);
/*     */   }
/*     */   
/*     */   private String getFullLogMessage(MessageContext synCtx) {
/* 165 */     StringBuffer sb = new StringBuffer();
/* 166 */     sb.append(getSimpleLogMessage(synCtx));
/* 167 */     if (synCtx.getEnvelope() != null)
/* 168 */       sb.append(this.separator + ""Envelope: "" + synCtx.getEnvelope()); 
/* 169 */     return trimLeadingSeparator(sb);
/*     */   }
/*     */   
/*     */   private void setCustomProperties(StringBuffer sb, MessageContext synCtx) {
/* 173 */     if (this.properties != null && !this.properties.isEmpty()) {
/* 174 */       for (Iterator<MediatorProperty> iter = this.properties.iterator(); iter.hasNext(); ) {
/* 175 */         MediatorProperty prop = iter.next();
/* 176 */         sb.append(this.separator + prop.getName() + "" = "" + ((prop.getValue() != null) ? prop.getValue() : prop.getEvaluatedExpression(synCtx)));
/*     */       } 
/*     */     }
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 184 */   public int getLogLevel() { return this.logLevel; }
/*     */ 
/*     */ 
/*     */   
/* 188 */   public void setLogLevel(int logLevel) { this.logLevel = logLevel; }
/*     */ 
/*     */ 
/*     */   
/* 192 */   public String getSeparator() { return this.separator; }
/*     */ 
/*     */ 
/*     */   
/* 196 */   public void setSeparator(String separator) { this.separator = separator; }
/*     */ 
/*     */ 
/*     */   
/* 200 */   public void addProperty(MediatorProperty p) { this.properties.add(p); }
/*     */ 
/*     */ 
/*     */   
/* 204 */   public void addAllProperties(List list) { this.properties.addAll(list); }
/*     */ 
/*     */ 
/*     */   
/* 208 */   public List getProperties() { return this.properties; }
/*     */ 
/*     */   
/*     */   private String trimLeadingSeparator(StringBuffer sb) {
/* 212 */     String retStr = sb.toString();
/* 213 */     if (retStr.startsWith(this.separator)) {
/* 214 */       return retStr.substring(this.separator.length());
/*     */     }
/* 216 */     return retStr;
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\mediators\builtin\LogMediator.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.mediators.builtin.PropertyMediator,"/*     */ package org.apache.synapse.mediators.builtin;
/*     */ 
/*     */ import java.util.HashMap;
/*     */ import java.util.Map;
/*     */ import java.util.Set;
/*     */ import org.apache.axis2.context.MessageContext;
/*     */ import org.apache.synapse.MessageContext;
/*     */ import org.apache.synapse.core.axis2.Axis2MessageContext;
/*     */ import org.apache.synapse.mediators.AbstractMediator;
/*     */ import org.apache.synapse.util.xpath.SynapseXPath;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class PropertyMediator
/*     */   extends AbstractMediator
/*     */ {
/*  43 */   private String name = null;
/*     */   
/*  45 */   private String value = null;
/*     */   
/*  47 */   private SynapseXPath expression = null;
/*     */   
/*  49 */   private String scope = null;
/*     */   
/*     */   public static final int ACTION_SET = 0;
/*     */   
/*     */   public static final int ACTION_REMOVE = 1;
/*  54 */   private int action = 0;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public boolean mediate(MessageContext synCtx) {
/*  65 */     boolean traceOn = isTraceOn(synCtx);
/*  66 */     boolean traceOrDebugOn = isTraceOrDebugOn(traceOn);
/*     */     
/*  68 */     if (traceOrDebugOn) {
/*  69 */       traceOrDebug(traceOn, ""Start : Property mediator"");
/*     */       
/*  71 */       if (traceOn && trace.isTraceEnabled()) {
/*  72 */         trace.trace(""Message : "" + synCtx.getEnvelope());
/*     */       }
/*     */     } 
/*     */     
/*  76 */     if (this.action == 0) {
/*     */       
/*  78 */       String resultValue = (this.value != null) ? this.value : this.expression.stringValueOf(synCtx);
/*     */       
/*  80 */       if (traceOrDebugOn) {
/*  81 */         traceOrDebug(traceOn, ""Setting property : "" + this.name + "" at scope : "" + ((this.scope == null) ? ""default"" : this.scope) + "" to : "" + resultValue + "" (i.e. "" + ((this.value != null) ? (""constant : "" + this.value) : (""result of expression : "" + this.expression)) + "")"");
/*     */       }
/*     */ 
/*     */ 
/*     */ 
/*     */       
/*  87 */       if (this.scope == null || ""default"".equals(this.scope))
/*     */       {
/*  89 */         synCtx.setProperty(this.name, resultValue);
/*     */       }
/*  91 */       else if (""axis2"".equals(this.scope) && synCtx instanceof Axis2MessageContext)
/*     */       {
/*     */         
/*  94 */         Axis2MessageContext axis2smc = (Axis2MessageContext)synCtx;
/*  95 */         MessageContext axis2MessageCtx = axis2smc.getAxis2MessageContext();
/*     */         
/*  97 */         axis2MessageCtx.setProperty(this.name, resultValue);
/*     */       }
/*  99 */       else if (""axis2-client"".equals(this.scope) && synCtx instanceof Axis2MessageContext)
/*     */       {
/*     */         
/* 102 */         Axis2MessageContext axis2smc = (Axis2MessageContext)synCtx;
/* 103 */         MessageContext axis2MessageCtx = axis2smc.getAxis2MessageContext();
/*     */         
/* 105 */         axis2MessageCtx.getOptions().setProperty(this.name, resultValue);
/*     */       }
/* 107 */       else if (""transport"".equals(this.scope) && synCtx instanceof Axis2MessageContext)
/*     */       {
/*     */         
/* 110 */         Axis2MessageContext axis2smc = (Axis2MessageContext)synCtx;
/* 111 */         MessageContext axis2MessageCtx = axis2smc.getAxis2MessageContext();
/*     */         
/* 113 */         Object headers = axis2MessageCtx.getProperty(""TRANSPORT_HEADERS"");
/*     */ 
/*     */         
/* 116 */         if (headers != null && headers instanceof Map) {
/* 117 */           Map<String, String> headersMap = (HashMap)headers;
/* 118 */           headersMap.put(this.name, resultValue);
/*     */         } 
/* 120 */         if (headers == null) {
/* 121 */           Map<Object, Object> headersMap = new HashMap<Object, Object>();
/* 122 */           headersMap.put(this.name, resultValue);
/* 123 */           axis2MessageCtx.setProperty(""TRANSPORT_HEADERS"", headersMap);
/*     */         }
/*     */       
/*     */       }
/*     */     
/*     */     } else {
/*     */       
/* 130 */       if (traceOrDebugOn) {
/* 131 */         traceOrDebug(traceOn, ""Removing property : "" + this.name + "" (scope:"" + ((this.scope == null) ? ""default"" : this.scope) + "")"");
/*     */       }
/*     */ 
/*     */       
/* 135 */       if (this.scope == null || ""default"".equals(this.scope)) {
/*     */         
/* 137 */         Set pros = synCtx.getPropertyKeySet();
/* 138 */         if (pros != null) {
/* 139 */           pros.remove(this.name);
/*     */         }
/*     */       }
/* 142 */       else if ((""axis2"".equals(this.scope) || ""axis2-client"".equals(this.scope)) && synCtx instanceof Axis2MessageContext) {
/*     */ 
/*     */ 
/*     */ 
/*     */         
/* 147 */         Axis2MessageContext axis2smc = (Axis2MessageContext)synCtx;
/* 148 */         MessageContext axis2MessageCtx = axis2smc.getAxis2MessageContext();
/*     */         
/* 150 */         axis2MessageCtx.removeProperty(this.name);
/*     */       }
/* 152 */       else if (""transport"".equals(this.scope) && synCtx instanceof Axis2MessageContext) {
/*     */ 
/*     */         
/* 155 */         Axis2MessageContext axis2smc = (Axis2MessageContext)synCtx;
/* 156 */         MessageContext axis2MessageCtx = axis2smc.getAxis2MessageContext();
/*     */         
/* 158 */         Object headers = axis2MessageCtx.getProperty(""TRANSPORT_HEADERS"");
/*     */         
/* 160 */         if (headers != null && headers instanceof Map) {
/* 161 */           Map headersMap = (HashMap)headers;
/* 162 */           headersMap.remove(this.name);
/*     */         }
/* 164 */         else if (traceOrDebugOn) {
/* 165 */           traceOrDebug(traceOn, ""No transport headers found for the message"");
/*     */         } 
/*     */       } 
/*     */     } 
/*     */     
/* 170 */     if (traceOrDebugOn) {
/* 171 */       traceOrDebug(traceOn, ""End : Property mediator"");
/*     */     }
/* 173 */     return true;
/*     */   }
/*     */ 
/*     */   
/* 177 */   public String getName() { return this.name; }
/*     */ 
/*     */ 
/*     */   
/* 181 */   public void setName(String name) { this.name = name; }
/*     */ 
/*     */ 
/*     */   
/* 185 */   public String getValue() { return this.value; }
/*     */ 
/*     */ 
/*     */   
/* 189 */   public void setValue(String value) { this.value = value; }
/*     */ 
/*     */ 
/*     */   
/* 193 */   public SynapseXPath getExpression() { return this.expression; }
/*     */ 
/*     */ 
/*     */   
/* 197 */   public void setExpression(SynapseXPath expression) { this.expression = expression; }
/*     */ 
/*     */ 
/*     */   
/* 201 */   public String getScope() { return this.scope; }
/*     */ 
/*     */ 
/*     */   
/* 205 */   public void setScope(String scope) { this.scope = scope; }
/*     */ 
/*     */ 
/*     */   
/* 209 */   public int getAction() { return this.action; }
/*     */ 
/*     */ 
/*     */   
/* 213 */   public void setAction(int action) { this.action = action; }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\mediators\builtin\PropertyMediator.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.mediators.builtin.RMSequenceMediator,"/*     */ package org.apache.synapse.mediators.builtin;
/*     */ 
/*     */ import java.util.Collections;
/*     */ import java.util.HashMap;
/*     */ import java.util.Iterator;
/*     */ import java.util.Map;
/*     */ import org.apache.axiom.om.OMElement;
/*     */ import org.apache.axis2.context.MessageContext;
/*     */ import org.apache.synapse.MessageContext;
/*     */ import org.apache.synapse.config.Entry;
/*     */ import org.apache.synapse.core.axis2.Axis2MessageContext;
/*     */ import org.apache.synapse.mediators.AbstractMediator;
/*     */ import org.apache.synapse.util.UUIDGenerator;
/*     */ import org.apache.synapse.util.xpath.SynapseXPath;
/*     */ import org.jaxen.JaxenException;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class RMSequenceMediator
/*     */   extends AbstractMediator
/*     */ {
/*  41 */   private SynapseXPath correlation = null;
/*  42 */   private SynapseXPath lastMessage = null;
/*  43 */   private Boolean single = null;
/*  44 */   private String version = null;
/*     */   
/*     */   private static final String WSRM_SpecVersion_1_0 = ""Spec_2005_02"";
/*     */   
/*     */   private static final String WSRM_SpecVersion_1_1 = ""Spec_2007_02"";
/*     */   private static final long SEQUENCE_EXPIRY_TIME = 300000L;
/*  50 */   private static Map sequenceMap = Collections.synchronizedMap(new HashMap<Object, Object>());
/*     */ 
/*     */   
/*     */   public boolean mediate(MessageContext synCtx) {
/*  54 */     boolean traceOn = isTraceOn(synCtx);
/*  55 */     boolean traceOrDebugOn = isTraceOrDebugOn(traceOn);
/*     */     
/*  57 */     if (traceOrDebugOn) {
/*  58 */       traceOrDebug(traceOn, ""Start : RMSequence mediator"");
/*     */       
/*  60 */       if (traceOn && trace.isTraceEnabled()) {
/*  61 */         trace.trace(""Message : "" + synCtx.getEnvelope());
/*     */       }
/*     */     } 
/*     */     
/*  65 */     if (!(synCtx instanceof Axis2MessageContext)) {
/*  66 */       if (traceOrDebugOn) {
/*  67 */         traceOrDebug(traceOn, ""Only axis2 message contexts are supported"");
/*     */       }
/*     */     } else {
/*     */       
/*  71 */       Axis2MessageContext axis2MessageCtx = (Axis2MessageContext)synCtx;
/*  72 */       MessageContext orgMessageCtx = axis2MessageCtx.getAxis2MessageContext();
/*     */ 
/*     */       
/*  75 */       cleanupSequenceMap();
/*     */       
/*  77 */       String version = getVersionValue();
/*  78 */       orgMessageCtx.getOptions().setProperty(""MercuryRMSpecVersion"", version);
/*     */ 
/*     */       
/*  81 */       if (isSingle()) {
/*  82 */         String sequenceID = UUIDGenerator.getUUID();
/*  83 */         String offeredSeqID = UUIDGenerator.getUUID();
/*     */         
/*  85 */         orgMessageCtx.getOptions().setProperty(""MercurySequenceKey"", sequenceID);
/*     */         
/*  87 */         orgMessageCtx.getOptions().setProperty(""MercurySequenceOffer"", offeredSeqID);
/*     */         
/*  89 */         orgMessageCtx.getOptions().setProperty(""MercuryLastMessage"", ""true"");
/*     */ 
/*     */         
/*  92 */         if (traceOrDebugOn) {
/*  93 */           traceOrDebug(traceOn, ""Using WS-RM version "" + version + "" and a single message sequence : "" + sequenceID + "" and offering sequence : "" + offeredSeqID);
/*     */         
/*     */         }
/*     */       
/*     */       }
/*     */       else {
/*     */         
/* 100 */         String correlationValue = getCorrelationValue(synCtx);
/* 101 */         boolean lastMessage = isLastMessage(synCtx);
/* 102 */         String offeredSeqID = null;
/*     */         
/* 104 */         if (!sequenceMap.containsKey(correlationValue)) {
/* 105 */           offeredSeqID = UUIDGenerator.getUUID();
/* 106 */           orgMessageCtx.getOptions().setProperty(""MercurySequenceOffer"", offeredSeqID);
/*     */         } 
/*     */ 
/*     */         
/* 110 */         String sequenceID = retrieveSequenceID(correlationValue);
/* 111 */         orgMessageCtx.getOptions().setProperty(""MercurySequenceKey"", sequenceID);
/*     */ 
/*     */         
/* 114 */         if (lastMessage) {
/* 115 */           orgMessageCtx.getOptions().setProperty(""MercuryLastMessage"", ""true"");
/*     */           
/* 117 */           sequenceMap.remove(correlationValue);
/*     */         } 
/*     */         
/* 120 */         if (traceOrDebugOn) {
/* 121 */           traceOrDebug(traceOn, ""Correlation value : "" + correlationValue + "" last message = "" + lastMessage + "" using sequence : "" + sequenceID + ((offeredSeqID != null) ? ("" offering sequence : "" + offeredSeqID) : """"));
/*     */         }
/*     */       } 
/*     */     } 
/*     */ 
/*     */ 
/*     */     
/* 128 */     if (traceOrDebugOn) {
/* 129 */       traceOrDebug(traceOn, ""End : RMSequence mediator"");
/*     */     }
/* 131 */     return true;
/*     */   }
/*     */   
/*     */   private String retrieveSequenceID(String correlationValue) {
/* 135 */     String sequenceID = null;
/* 136 */     if (!sequenceMap.containsKey(correlationValue)) {
/* 137 */       sequenceID = UUIDGenerator.getUUID();
/* 138 */       if (this.log.isDebugEnabled()) {
/* 139 */         this.log.debug(""setting sequenceID "" + sequenceID + "" for correlation "" + correlationValue);
/*     */       }
/* 141 */       Entry sequenceEntry = new Entry();
/* 142 */       sequenceEntry.setValue(sequenceID);
/* 143 */       sequenceEntry.setExpiryTime(System.currentTimeMillis() + 300000L);
/* 144 */       sequenceMap.put(correlationValue, sequenceEntry);
/*     */     } else {
/* 146 */       sequenceID = (String)((Entry)sequenceMap.get(correlationValue)).getValue();
/* 147 */       if (this.log.isDebugEnabled()) {
/* 148 */         this.log.debug(""got sequenceID "" + sequenceID + "" for correlation "" + correlationValue);
/*     */       }
/*     */     } 
/* 151 */     return sequenceID;
/*     */   }
/*     */   
/*     */   private String getCorrelationValue(MessageContext smc) {
/* 155 */     OMElement node = null;
/*     */     try {
/* 157 */       node = (OMElement)getCorrelation().selectSingleNode(smc);
/*     */       
/* 159 */       if (node != null) {
/* 160 */         return node.getText();
/*     */       }
/* 162 */       handleException(""XPath expression : "" + getCorrelation() + "" did not return any node"", smc);
/*     */ 
/*     */     
/*     */     }
/* 166 */     catch (JaxenException e) {
/* 167 */       handleException(""Error evaluating XPath expression to determine correlation : "" + getCorrelation(), (Exception)e, smc);
/*     */     } 
/*     */     
/* 170 */     return null;
/*     */   }
/*     */   
/*     */   private String getVersionValue() {
/* 174 */     if (""1.1"".equals(getVersion())) {
/* 175 */       return ""Spec_2007_02"";
/*     */     }
/* 177 */     return ""Spec_2005_02"";
/*     */   }
/*     */ 
/*     */   
/*     */   private boolean isLastMessage(MessageContext smc) {
/* 182 */     if (getLastMessage() == null) {
/* 183 */       return false;
/*     */     }
/*     */     try {
/* 186 */       return getLastMessage().booleanValueOf(smc);
/* 187 */     } catch (JaxenException e) {
/* 188 */       handleException(""Error evaluating XPath expression to determine if last message : "" + getLastMessage(), (Exception)e, smc);
/*     */ 
/*     */       
/* 191 */       return false;
/*     */     } 
/*     */   }
/*     */   
/*     */   private synchronized void cleanupSequenceMap() {
/* 196 */     Iterator itKey = sequenceMap.keySet().iterator();
/* 197 */     while (itKey.hasNext()) {
/* 198 */       Object key = itKey.next();
/* 199 */       Entry sequenceEntry = (Entry)sequenceMap.get(key);
/* 200 */       if (sequenceEntry.isExpired()) {
/* 201 */         sequenceMap.remove(key);
/*     */       }
/*     */     } 
/*     */   }
/*     */   
/*     */   public boolean isSingle() {
/* 207 */     if (getSingle() != null && getSingle().booleanValue()) {
/* 208 */       return true;
/*     */     }
/*     */     
/* 211 */     return false;
/*     */   }
/*     */ 
/*     */ 
/*     */   
/* 216 */   public SynapseXPath getCorrelation() { return this.correlation; }
/*     */ 
/*     */ 
/*     */   
/* 220 */   public void setCorrelation(SynapseXPath correlation) { this.correlation = correlation; }
/*     */ 
/*     */ 
/*     */   
/* 224 */   public SynapseXPath getLastMessage() { return this.lastMessage; }
/*     */ 
/*     */ 
/*     */   
/* 228 */   public void setLastMessage(SynapseXPath lastMessage) { this.lastMessage = lastMessage; }
/*     */ 
/*     */ 
/*     */   
/* 232 */   public Boolean getSingle() { return this.single; }
/*     */ 
/*     */ 
/*     */   
/* 236 */   public void setSingle(Boolean single) { this.single = single; }
/*     */ 
/*     */ 
/*     */   
/* 240 */   public String getVersion() { return this.version; }
/*     */ 
/*     */ 
/*     */   
/* 244 */   public void setVersion(String version) { this.version = version; }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\mediators\builtin\RMSequenceMediator.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.mediators.builtin.SendMediator,"/*     */ package org.apache.synapse.mediators.builtin;
/*     */ 
/*     */ import java.util.List;
/*     */ import org.apache.axis2.clustering.ClusterManager;
/*     */ import org.apache.axis2.context.ConfigurationContext;
/*     */ import org.apache.axis2.context.MessageContext;
/*     */ import org.apache.axis2.context.OperationContext;
/*     */ import org.apache.synapse.MessageContext;
/*     */ import org.apache.synapse.core.axis2.Axis2MessageContext;
/*     */ import org.apache.synapse.endpoints.Endpoint;
/*     */ import org.apache.synapse.endpoints.SALoadbalanceEndpoint;
/*     */ import org.apache.synapse.mediators.AbstractMediator;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class SendMediator
/*     */   extends AbstractMediator
/*     */ {
/*  45 */   private Endpoint endpoint = null;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public boolean mediate(MessageContext synCtx) {
/*  56 */     boolean traceOn = isTraceOn(synCtx);
/*  57 */     boolean traceOrDebugOn = isTraceOrDebugOn(traceOn);
/*     */     
/*  59 */     if (traceOrDebugOn) {
/*  60 */       traceOrDebug(traceOn, ""Start : Send mediator"");
/*     */       
/*  62 */       if (traceOn && trace.isTraceEnabled()) {
/*  63 */         trace.trace(""Message : "" + synCtx.getEnvelope());
/*     */       }
/*     */     } 
/*     */     
/*  67 */     if (synCtx.isResponse()) {
/*     */       
/*  69 */       Axis2MessageContext axis2MsgCtx = (Axis2MessageContext)synCtx;
/*  70 */       OperationContext opCtx = axis2MsgCtx.getAxis2MessageContext().getOperationContext();
/*     */       
/*  72 */       boolean isClusteringEnable = false;
/*     */ 
/*     */       
/*  75 */       MessageContext axisMC = axis2MsgCtx.getAxis2MessageContext();
/*     */       
/*  77 */       ConfigurationContext cc = axisMC.getConfigurationContext();
/*     */ 
/*     */ 
/*     */       
/*  81 */       ClusterManager clusterManager = cc.getAxisConfiguration().getClusterManager();
/*  82 */       if (clusterManager != null && clusterManager.getContextManager() != null)
/*     */       {
/*  84 */         isClusteringEnable = true;
/*     */       }
/*     */       
/*  87 */       if (isClusteringEnable) {
/*     */ 
/*     */ 
/*     */         
/*  91 */         Object epNames = opCtx.getPropertyNonReplicable(""endpointNameList"");
/*  92 */         if (epNames != null && epNames instanceof List) {
/*     */           
/*  94 */           List epNameList = (List)epNames;
/*  95 */           Object obj = epNameList.remove(0);
/*  96 */           if (obj != null && obj instanceof String) {
/*  97 */             Object rootEPObj = opCtx.getPropertyNonReplicable(""rootendpoint"");
/*     */ 
/*     */             
/* 100 */             if (rootEPObj != null && rootEPObj instanceof Endpoint) {
/* 101 */               String name = ((Endpoint)rootEPObj).getName();
/*     */               
/* 103 */               if (name != null && name.equals(obj)) {
/* 104 */                 Endpoint rootEP = (Endpoint)rootEPObj;
/*     */                 
/* 106 */                 if (rootEP instanceof SALoadbalanceEndpoint) {
/* 107 */                   SALoadbalanceEndpoint salEP = (SALoadbalanceEndpoint)rootEP;
/* 108 */                   salEP.updateSession(synCtx, epNameList, isClusteringEnable);
/*     */                 } 
/*     */               } 
/*     */             } 
/*     */           } 
/*     */ 
/*     */           
/* 115 */           opCtx.setProperty(""endpointNameList"", epNames);
/*     */         } 
/*     */       } else {
/*     */         
/* 119 */         Object o = opCtx.getProperty(""endpointList"");
/* 120 */         if (o != null && o instanceof List) {
/*     */ 
/*     */           
/* 123 */           List epList = (List)o;
/* 124 */           Object e = epList.remove(0);
/*     */           
/* 126 */           if (e != null && 
/* 127 */             e instanceof SALoadbalanceEndpoint) {
/* 128 */             SALoadbalanceEndpoint salEP = (SALoadbalanceEndpoint)e;
/* 129 */             salEP.updateSession(synCtx, epList, isClusteringEnable);
/*     */           } 
/*     */         } 
/*     */       } 
/*     */     } 
/*     */ 
/*     */ 
/*     */ 
/*     */     
/* 138 */     if (this.endpoint == null) {
/*     */       
/* 140 */       if (traceOrDebugOn) {
/* 141 */         StringBuffer sb = new StringBuffer();
/* 142 */         sb.append(""Sending "" + (synCtx.isResponse() ? ""response"" : ""request"") + "" message using implicit message properties.."");
/*     */         
/* 144 */         sb.append(""\nSending To: "" + ((synCtx.getTo() != null) ? synCtx.getTo().getAddress() : ""null""));
/*     */         
/* 146 */         sb.append(""\nSOAPAction: "" + ((synCtx.getWSAAction() != null) ? synCtx.getWSAAction() : ""null""));
/*     */         
/* 148 */         traceOrDebug(traceOn, sb.toString());
/*     */       } 
/*     */       
/* 151 */       if (traceOn && trace.isTraceEnabled()) {
/* 152 */         trace.trace(""Envelope : "" + synCtx.getEnvelope());
/*     */       }
/* 154 */       synCtx.getEnvironment().send(null, synCtx);
/*     */     } else {
/*     */       
/* 157 */       this.endpoint.send(synCtx);
/*     */     } 
/*     */     
/* 160 */     if (traceOrDebugOn) {
/* 161 */       traceOrDebug(traceOn, ""End : Send mediator"");
/*     */     }
/*     */     
/* 164 */     return true;
/*     */   }
/*     */ 
/*     */   
/* 168 */   public Endpoint getEndpoint() { return this.endpoint; }
/*     */ 
/*     */ 
/*     */   
/* 172 */   public void setEndpoint(Endpoint endpoint) { this.endpoint = endpoint; }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\mediators\builtin\SendMediator.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.mediators.builtin.ValidateMediator,"/*     */ package org.apache.synapse.mediators.builtin;
/*     */ 
/*     */ import java.io.IOException;
/*     */ import java.util.ArrayList;
/*     */ import java.util.List;
/*     */ import javax.xml.transform.Source;
/*     */ import javax.xml.transform.stream.StreamSource;
/*     */ import javax.xml.validation.Schema;
/*     */ import javax.xml.validation.SchemaFactory;
/*     */ import javax.xml.validation.Validator;
/*     */ import org.apache.axiom.om.OMNode;
/*     */ import org.apache.synapse.FaultHandler;
/*     */ import org.apache.synapse.MessageContext;
/*     */ import org.apache.synapse.SynapseException;
/*     */ import org.apache.synapse.config.Entry;
/*     */ import org.apache.synapse.config.SynapseConfigUtils;
/*     */ import org.apache.synapse.mediators.AbstractListMediator;
/*     */ import org.apache.synapse.mediators.MediatorProperty;
/*     */ import org.apache.synapse.util.AXIOMUtils;
/*     */ import org.apache.synapse.util.xpath.SynapseXPath;
/*     */ import org.jaxen.JaxenException;
/*     */ import org.xml.sax.SAXException;
/*     */ import org.xml.sax.SAXParseException;
/*     */ import org.xml.sax.helpers.DefaultHandler;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class ValidateMediator
/*     */   extends AbstractListMediator
/*     */ {
/*  63 */   private List<String> schemaKeys = new ArrayList<String>();
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  70 */   private SynapseXPath source = null;
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  75 */   private List<MediatorProperty> explicityFeatures = new ArrayList<MediatorProperty>();
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   private Schema cachedSchema;
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  86 */   private final Object validatorLock = new Object();
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  91 */   private SchemaFactory factory = SchemaFactory.newInstance(""http://www.w3.org/2001/XMLSchema"");
/*     */ 
/*     */ 
/*     */   
/*     */   public static final String DEFAULT_XPATH = ""s11:Body/child::*[position()=1] | s12:Body/child::*[position()=1]"";
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public ValidateMediator() {
/*     */     try {
/* 102 */       this.source = new SynapseXPath(""s11:Body/child::*[position()=1] | s12:Body/child::*[position()=1]"");
/* 103 */       this.source.addNamespace(""s11"", ""http://schemas.xmlsoap.org/soap/envelope/"");
/* 104 */       this.source.addNamespace(""s12"", ""http://www.w3.org/2003/05/soap-envelope"");
/* 105 */     } catch (JaxenException e) {
/* 106 */       String msg = ""Error creating default source XPath expression : s11:Body/child::*[position()=1] | s12:Body/child::*[position()=1]"";
/* 107 */       this.log.error(msg, (Throwable)e);
/* 108 */       throw new SynapseException(msg, (Throwable)e);
/*     */     } 
/*     */   }
/*     */ 
/*     */   
/*     */   public boolean mediate(MessageContext synCtx) {
/* 114 */     boolean traceOn = isTraceOn(synCtx);
/* 115 */     boolean traceOrDebugOn = isTraceOrDebugOn(traceOn);
/*     */     
/* 117 */     if (traceOrDebugOn) {
/* 118 */       traceOrDebug(traceOn, ""Start : Validate mediator"");
/*     */       
/* 120 */       if (traceOn && trace.isTraceEnabled()) {
/* 121 */         trace.trace(""Message : "" + synCtx.getEnvelope());
/*     */       }
/*     */     } 
/*     */ 
/*     */     
/* 126 */     Source validateSrc = getValidationSource(synCtx, traceOrDebugOn, traceOn);
/*     */ 
/*     */     
/* 129 */     boolean reCreate = false;
/*     */     
/* 131 */     for (String propKey : this.schemaKeys) {
/* 132 */       Entry dp = synCtx.getConfiguration().getEntryDefinition(propKey);
/* 133 */       if (dp != null && dp.isDynamic() && (
/* 134 */         !dp.isCached() || dp.isExpired())) {
/* 135 */         reCreate = true;
/*     */       }
/*     */     } 
/*     */ 
/*     */ 
/*     */     
/* 141 */     MyErrorHandler errorHandler = new MyErrorHandler();
/*     */ 
/*     */     
/* 144 */     synchronized (this.validatorLock) {
/* 145 */       if (reCreate || this.cachedSchema == null) {
/*     */         
/* 147 */         this.factory.setErrorHandler(errorHandler);
/* 148 */         StreamSource[] sources = new StreamSource[this.schemaKeys.size()];
/* 149 */         int i = 0;
/* 150 */         for (String propName : this.schemaKeys) {
/* 151 */           sources[i++] = SynapseConfigUtils.getStreamSource(synCtx.getEntry(propName));
/*     */         }
/*     */         
/*     */         try {
/* 155 */           this.cachedSchema = this.factory.newSchema((Source[])sources);
/* 156 */         } catch (SAXException e) {
/* 157 */           handleException(""Error creating a new schema objects for schemas : "" + this.schemaKeys.toString(), e, synCtx);
/*     */         } 
/*     */ 
/*     */         
/* 161 */         if (errorHandler.isValidationError()) {
/*     */           
/* 163 */           errorHandler.setValidationError(false);
/*     */           
/* 165 */           if (traceOrDebugOn) {
/* 166 */             traceOrDebug(traceOn, ""Error creating a new schema objects for schemas : "" + this.schemaKeys.toString());
/*     */           }
/*     */         } 
/*     */       } 
/*     */     } 
/*     */ 
/*     */ 
/*     */     
/*     */     try {
/* 175 */       Validator validator = this.cachedSchema.newValidator();
/* 176 */       validator.setErrorHandler(errorHandler);
/*     */ 
/*     */       
/* 179 */       validator.validate(validateSrc);
/*     */       
/* 181 */       if (errorHandler.isValidationError()) {
/*     */         
/* 183 */         if (traceOrDebugOn) {
/* 184 */           String msg = ""Validation of element returned by XPath : "" + this.source + "" failed against the given schema(s) "" + this.schemaKeys + ""with error : "" + errorHandler.getSaxParseException().getMessage() + "" Executing 'on-fail' sequence"";
/*     */ 
/*     */ 
/*     */           
/* 188 */           traceOrDebug(traceOn, msg);
/*     */ 
/*     */           
/* 191 */           synCtx.getServiceLog().warn(msg);
/*     */           
/* 193 */           if (traceOn && trace.isTraceEnabled()) {
/* 194 */             this.log.debug(""Failed message envelope : "" + synCtx.getEnvelope());
/*     */           }
/*     */         } 
/*     */ 
/*     */         
/* 199 */         synCtx.setProperty(""ERROR_MESSAGE"", errorHandler.getSaxParseException().getMessage());
/*     */         
/* 201 */         synCtx.setProperty(""ERROR_EXCEPTION"", errorHandler.getSaxParseException());
/*     */         
/* 203 */         synCtx.setProperty(""ERROR_DETAIL"", FaultHandler.getStackTrace(errorHandler.getSaxParseException()));
/*     */ 
/*     */ 
/*     */         
/* 207 */         return super.mediate(synCtx);
/*     */       } 
/* 209 */     } catch (SAXException e) {
/* 210 */       handleException(""Error validating "" + this.source + "" element"", e, synCtx);
/* 211 */     } catch (IOException e) {
/* 212 */       handleException(""Error validating "" + this.source + "" element"", e, synCtx);
/*     */     } 
/*     */     
/* 215 */     if (traceOrDebugOn) {
/* 216 */       traceOrDebug(traceOn, ""Validation of element returned by the XPath expression : "" + this.source + "" succeeded against the given schemas and the current message"");
/*     */     }
/*     */ 
/*     */     
/* 220 */     if (traceOrDebugOn) {
/* 221 */       traceOrDebug(traceOn, ""End : Validate mediator"");
/*     */     }
/*     */     
/* 224 */     return true;
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   private Source getValidationSource(MessageContext synCtx, boolean traceOrDebugOn, boolean traceOn) {
/*     */     try {
/* 239 */       OMNode validateSource = getValidateSource(synCtx);
/* 240 */       if (traceOrDebugOn) {
/* 241 */         traceOrDebug(traceOn, ""Validation source : "" + validateSource.toString());
/*     */       }
/*     */       
/* 244 */       return AXIOMUtils.asSource(validateSource);
/*     */     }
/* 246 */     catch (Exception e) {
/* 247 */       handleException(""Error accessing source element : "" + this.source, e, synCtx);
/*     */       
/* 249 */       return null;
/*     */     } 
/*     */   }
/*     */ 
/*     */   
/*     */   private class MyErrorHandler
/*     */     extends DefaultHandler
/*     */   {
/*     */     private boolean validationError = false;
/* 258 */     private SAXParseException saxParseException = null;
/*     */     
/*     */     public void error(SAXParseException exception) throws SAXException {
/* 261 */       this.validationError = true;
/* 262 */       this.saxParseException = exception;
/*     */     }
/*     */     
/*     */     public void fatalError(SAXParseException exception) throws SAXException {
/* 266 */       this.validationError = true;
/* 267 */       this.saxParseException = exception;
/*     */     }
/*     */ 
/*     */     
/*     */     public void warning(SAXParseException exception) throws SAXException {}
/*     */ 
/*     */     
/* 274 */     public boolean isValidationError() { return this.validationError; }
/*     */ 
/*     */ 
/*     */     
/* 278 */     public SAXParseException getSaxParseException() { return this.saxParseException; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */     
/* 286 */     public void setValidationError(boolean validationError) { this.validationError = validationError; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */     
/*     */     private MyErrorHandler() {}
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   private OMNode getValidateSource(MessageContext synCtx) {
/*     */     try {
/* 300 */       Object o = this.source.evaluate(synCtx);
/* 301 */       if (o instanceof OMNode)
/* 302 */         return (OMNode)o; 
/* 303 */       if (o instanceof List && !((List)o).isEmpty()) {
/* 304 */         return ((List<OMNode>)o).get(0);
/*     */       }
/* 306 */       handleException(""The evaluation of the XPath expression "" + this.source + "" did not result in an OMNode : "" + o, synCtx);
/*     */     
/*     */     }
/* 309 */     catch (JaxenException e) {
/* 310 */       handleException(""Error evaluating XPath expression : "" + this.source, (Exception)e, synCtx);
/*     */     } 
/* 312 */     return null;
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public Object getFeature(String key) {
/* 325 */     for (MediatorProperty prop : this.explicityFeatures) {
/* 326 */       if (key.equals(prop.getName())) {
/* 327 */         return prop.getValue();
/*     */       }
/*     */     } 
/* 330 */     return null;
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public void addFeature(String featureName, boolean isFeatureEnable) throws SAXException {
/* 342 */     MediatorProperty mp = new MediatorProperty();
/* 343 */     mp.setName(featureName);
/* 344 */     if (isFeatureEnable) {
/* 345 */       mp.setValue(""true"");
/*     */     } else {
/* 347 */       mp.setValue(""false"");
/*     */     } 
/* 349 */     this.explicityFeatures.add(mp);
/* 350 */     this.factory.setFeature(featureName, isFeatureEnable);
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 360 */   public void setSchemaKeys(List<String> schemaKeys) { this.schemaKeys = schemaKeys; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 368 */   public void setSource(SynapseXPath source) { this.source = source; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 376 */   public SynapseXPath getSource() { return this.source; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 384 */   public List<String> getSchemaKeys() { return this.schemaKeys; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 392 */   public List<MediatorProperty> getFeatures() { return this.explicityFeatures; }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\mediators\builtin\ValidateMediator.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.mediators.db.AbstractDBMediator,"/*     */ package org.apache.synapse.mediators.db;
/*     */ 
/*     */ import java.math.BigDecimal;
/*     */ import java.sql.Connection;
/*     */ import java.sql.Date;
/*     */ import java.sql.PreparedStatement;
/*     */ import java.sql.SQLException;
/*     */ import java.sql.Time;
/*     */ import java.sql.Timestamp;
/*     */ import java.util.ArrayList;
/*     */ import java.util.HashMap;
/*     */ import java.util.Iterator;
/*     */ import java.util.List;
/*     */ import java.util.Map;
/*     */ import javax.sql.DataSource;
/*     */ import javax.xml.namespace.QName;
/*     */ import org.apache.commons.dbcp.BasicDataSource;
/*     */ import org.apache.commons.dbcp.datasources.PerUserPoolDataSource;
/*     */ import org.apache.commons.logging.Log;
/*     */ import org.apache.synapse.ManagedLifecycle;
/*     */ import org.apache.synapse.MessageContext;
/*     */ import org.apache.synapse.config.xml.AbstractDBMediatorFactory;
/*     */ import org.apache.synapse.core.SynapseEnvironment;
/*     */ import org.apache.synapse.mediators.AbstractMediator;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public abstract class AbstractDBMediator
/*     */   extends AbstractMediator
/*     */   implements ManagedLifecycle
/*     */ {
/*  44 */   protected Map dataSourceProps = new HashMap<Object, Object>();
/*     */   
/*  46 */   private DataSource dataSource = null;
/*     */   
/*  48 */   List statementList = new ArrayList();
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public void init(SynapseEnvironment se) {}
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public void destroy() {
/*  63 */     if (this.dataSource instanceof BasicDataSource) {
/*     */       try {
/*  65 */         ((BasicDataSource)this.dataSource).close();
/*  66 */         this.log.info(""Successfully shut down DB connection pool for URL : "" + getDSName());
/*  67 */       } catch (SQLException e) {
/*  68 */         this.log.warn(""Error shutting down DB connection pool for URL : "" + getDSName());
/*     */       } 
/*  70 */     } else if (this.dataSource instanceof PerUserPoolDataSource) {
/*  71 */       ((PerUserPoolDataSource)this.dataSource).close();
/*  72 */       this.log.info(""Successfully shut down DB connection pool for URL : "" + getDSName());
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public boolean mediate(MessageContext synCtx) {
/*  83 */     String name = (this instanceof DBLookupMediator) ? ""DBLookup"" : ""DBReport"";
/*  84 */     boolean traceOn = isTraceOn(synCtx);
/*  85 */     boolean traceOrDebugOn = isTraceOrDebugOn(traceOn);
/*     */     
/*  87 */     if (traceOrDebugOn) {
/*  88 */       traceOrDebug(traceOn, ""Start : "" + name + "" mediator"");
/*     */       
/*  90 */       if (traceOn && trace.isTraceEnabled()) {
/*  91 */         trace.trace(""Message : "" + synCtx.getEnvelope());
/*     */       }
/*     */     } 
/*     */     
/*  95 */     for (Iterator<Statement> iter = this.statementList.iterator(); iter.hasNext();) {
/*  96 */       processStatement(iter.next(), synCtx);
/*     */     }
/*     */     
/*  99 */     if (traceOrDebugOn) {
/* 100 */       traceOrDebug(traceOn, ""End : "" + name + "" mediator"");
/*     */     }
/* 102 */     return true;
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   protected abstract void processStatement(Statement paramStatement, MessageContext paramMessageContext);
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 118 */   protected String getDSName() { return (String)this.dataSourceProps.get(AbstractDBMediatorFactory.URL_Q); }
/*     */ 
/*     */ 
/*     */   
/* 122 */   public DataSource getDataSource() { return this.dataSource; }
/*     */ 
/*     */ 
/*     */   
/* 126 */   public void setDataSource(DataSource dataSource) { this.dataSource = dataSource; }
/*     */ 
/*     */ 
/*     */   
/* 130 */   public void addDataSourceProperty(QName name, String value) { this.dataSourceProps.put(name, value); }
/*     */ 
/*     */ 
/*     */   
/* 134 */   public void addDataSourceProperty(String name, String value) { this.dataSourceProps.put(name, value); }
/*     */ 
/*     */ 
/*     */   
/* 138 */   public Map getDataSourceProps() { return this.dataSourceProps; }
/*     */ 
/*     */ 
/*     */   
/* 142 */   public void addStatement(Statement stmnt) { this.statementList.add(stmnt); }
/*     */ 
/*     */ 
/*     */   
/* 146 */   public List getStatementList() { return this.statementList; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   protected PreparedStatement getPreparedStatement(Statement stmnt, MessageContext msgCtx) throws SQLException {
/* 158 */     boolean traceOn = isTraceOn(msgCtx);
/* 159 */     boolean traceOrDebugOn = isTraceOrDebugOn(traceOn);
/*     */     
/* 161 */     Log serviceLog = msgCtx.getServiceLog();
/*     */     
/* 163 */     if (traceOrDebugOn) {
/* 164 */       traceOrDebug(traceOn, ""Getting a connection from DataSource "" + getDSName() + "" and preparing statement : "" + stmnt.getRawStatement());
/*     */     }
/*     */     
/* 167 */     Connection con = getDataSource().getConnection();
/* 168 */     PreparedStatement ps = con.prepareStatement(stmnt.getRawStatement());
/*     */ 
/*     */     
/* 171 */     List params = stmnt.getParameters();
/* 172 */     int column = 1;
/*     */     
/* 174 */     for (Iterator<Statement.Parameter> pi = params.iterator(); pi.hasNext(); ) {
/*     */       
/* 176 */       Statement.Parameter param = pi.next();
/* 177 */       String value = (param.getPropertyName() != null) ? param.getPropertyName() : param.getXpath().stringValueOf(msgCtx);
/*     */ 
/*     */       
/* 180 */       if (traceOrDebugOn) {
/* 181 */         traceOrDebug(traceOn, ""Setting as parameter : "" + column + "" value : "" + value + "" as JDBC Type : "" + param.getType() + ""(see java.sql.Types for valid types)"");
/*     */       }
/*     */ 
/*     */       
/* 185 */       switch (param.getType()) {
/*     */         
/*     */         case -1:
/*     */         case 1:
/*     */         case 12:
/* 190 */           ps.setString(column++, value);
/*     */           continue;
/*     */         
/*     */         case 2:
/*     */         case 3:
/* 195 */           ps.setBigDecimal(column++, new BigDecimal(value));
/*     */           continue;
/*     */         
/*     */         case -7:
/* 199 */           ps.setBoolean(column++, Boolean.parseBoolean(value));
/*     */           continue;
/*     */         
/*     */         case -6:
/* 203 */           ps.setByte(column++, Byte.parseByte(value));
/*     */           continue;
/*     */         
/*     */         case 5:
/* 207 */           ps.setShort(column++, Short.parseShort(value));
/*     */           continue;
/*     */         
/*     */         case 4:
/* 211 */           ps.setInt(column++, Integer.parseInt(value));
/*     */           continue;
/*     */         
/*     */         case -5:
/* 215 */           ps.setLong(column++, Long.parseLong(value));
/*     */           continue;
/*     */         
/*     */         case 7:
/* 219 */           ps.setFloat(column++, Float.parseFloat(value));
/*     */           continue;
/*     */         
/*     */         case 6:
/* 223 */           ps.setDouble(column++, Double.parseDouble(value));
/*     */           continue;
/*     */         
/*     */         case 8:
/* 227 */           ps.setDouble(column++, Double.parseDouble(value));
/*     */           continue;
/*     */ 
/*     */         
/*     */         case 91:
/* 232 */           ps.setDate(column++, Date.valueOf(value));
/*     */           continue;
/*     */         
/*     */         case 92:
/* 236 */           ps.setTime(column++, Time.valueOf(value));
/*     */           continue;
/*     */         
/*     */         case 93:
/* 240 */           ps.setTimestamp(column++, Timestamp.valueOf(value));
/*     */           continue;
/*     */       } 
/*     */ 
/*     */       
/* 245 */       String msg = ""Trying to set an un-supported JDBC Type : "" + param.getType() + "" against column : "" + column + "" and statement : "" + stmnt.getRawStatement() + "" used by a DB mediator against DataSource : "" + getDSName() + "" (see java.sql.Types for valid type values)"";
/*     */ 
/*     */ 
/*     */       
/* 249 */       handleException(msg, msgCtx);
/*     */     } 
/*     */ 
/*     */ 
/*     */     
/* 254 */     if (traceOrDebugOn) {
/* 255 */       traceOrDebug(traceOn, ""Successfully prepared statement : "" + stmnt.getRawStatement() + "" against DataSource : "" + getDSName());
/*     */     }
/*     */     
/* 258 */     return ps;
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\mediators\db\AbstractDBMediator.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.mediators.db.DBLookupMediator,"/*    */ package org.apache.synapse.mediators.db;
/*    */ 
/*    */ import java.sql.Connection;
/*    */ import java.sql.PreparedStatement;
/*    */ import java.sql.ResultSet;
/*    */ import java.sql.SQLException;
/*    */ import java.util.Iterator;
/*    */ import org.apache.synapse.MessageContext;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class DBLookupMediator
/*    */   extends AbstractDBMediator
/*    */ {
/*    */   protected void processStatement(Statement stmnt, MessageContext msgCtx) {
/* 37 */     boolean traceOn = isTraceOn(msgCtx);
/* 38 */     boolean traceOrDebugOn = isTraceOrDebugOn(traceOn);
/*    */ 
/*    */ 
/*    */     
/* 42 */     Connection con = null;
/*    */     try {
/* 44 */       PreparedStatement ps = getPreparedStatement(stmnt, msgCtx);
/* 45 */       con = ps.getConnection();
/* 46 */       ResultSet rs = ps.executeQuery();
/*    */       
/* 48 */       if (rs.next()) {
/* 49 */         if (traceOrDebugOn) {
/* 50 */           traceOrDebug(traceOn, ""Processing the first row returned : "" + stmnt.getRawStatement());
/*    */         }
/*    */ 
/*    */         
/* 54 */         Iterator<String> propNameIter = stmnt.getResultsMap().keySet().iterator();
/* 55 */         while (propNameIter.hasNext())
/*    */         {
/* 57 */           String propName = propNameIter.next();
/* 58 */           String columnStr = (String)stmnt.getResultsMap().get(propName);
/*    */           
/* 60 */           Object obj = null;
/*    */           try {
/* 62 */             int colNum = Integer.parseInt(columnStr);
/* 63 */             obj = rs.getObject(colNum);
/* 64 */           } catch (NumberFormatException ignore) {
/* 65 */             obj = rs.getObject(columnStr);
/*    */           } 
/*    */           
/* 68 */           if (obj != null) {
/* 69 */             if (traceOrDebugOn) {
/* 70 */               traceOrDebug(traceOn, ""Column : "" + columnStr + "" returned value : "" + obj + "" Setting this as the message property : "" + propName);
/*    */             }
/*    */ 
/*    */             
/* 74 */             msgCtx.setProperty(propName, obj.toString()); continue;
/*    */           } 
/* 76 */           if (traceOrDebugOn) {
/* 77 */             traceOrDebugWarn(traceOn, ""Column : "" + columnStr + "" returned null Skip setting message property : "" + propName);
/*    */           
/*    */           }
/*    */         }
/*    */       
/*    */       }
/* 83 */       else if (traceOrDebugOn) {
/* 84 */         traceOrDebug(traceOn, ""Statement : "" + stmnt.getRawStatement() + "" returned 0 rows"");
/*    */       
/*    */       }
/*    */     
/*    */     }
/* 89 */     catch (SQLException e) {
/* 90 */       handleException(""Error executing statement : "" + stmnt.getRawStatement() + "" against DataSource : "" + getDSName(), e, msgCtx);
/*    */     } finally {
/*    */       
/* 93 */       if (con != null)
/*    */         try {
/* 95 */           con.close();
/* 96 */         } catch (SQLException ignore) {} 
/*    */     } 
/*    */   }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\mediators\db\DBLookupMediator.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.mediators.db.DBReportMediator,"/*    */ package org.apache.synapse.mediators.db;
/*    */ 
/*    */ import java.sql.Connection;
/*    */ import java.sql.PreparedStatement;
/*    */ import java.sql.SQLException;
/*    */ import org.apache.synapse.MessageContext;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class DBReportMediator
/*    */   extends AbstractDBMediator
/*    */ {
/*    */   protected void processStatement(Statement stmnt, MessageContext msgCtx) {
/* 35 */     boolean traceOn = isTraceOn(msgCtx);
/* 36 */     boolean traceOrDebugOn = isTraceOrDebugOn(traceOn);
/*    */     
/* 38 */     Connection con = null;
/*    */     try {
/* 40 */       PreparedStatement ps = getPreparedStatement(stmnt, msgCtx);
/* 41 */       con = ps.getConnection();
/* 42 */       int count = ps.executeUpdate();
/*    */       
/* 44 */       if (count > 0) {
/* 45 */         if (traceOrDebugOn) {
/* 46 */           traceOrDebug(traceOn, ""Inserted "" + count + "" row/s using statement : "" + stmnt.getRawStatement());
/*    */         
/*    */         }
/*    */       }
/* 50 */       else if (traceOrDebugOn) {
/* 51 */         traceOrDebug(traceOn, ""No rows were inserted for statement : "" + stmnt.getRawStatement());
/*    */       } 
/*    */ 
/*    */       
/* 55 */       con.commit();
/*    */     }
/* 57 */     catch (SQLException e) {
/* 58 */       handleException(""Error execuring insert statement : "" + stmnt.getRawStatement() + "" against DataSource : "" + getDSName(), e, msgCtx);
/*    */     } finally {
/*    */       
/* 61 */       if (con != null)
/*    */         try {
/* 63 */           con.close();
/* 64 */         } catch (SQLException ignore) {} 
/*    */     } 
/*    */   }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\mediators\db\DBReportMediator.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.mediators.db.Statement,"/*     */ package org.apache.synapse.mediators.db;
/*     */ 
/*     */ import java.util.ArrayList;
/*     */ import java.util.HashMap;
/*     */ import java.util.List;
/*     */ import java.util.Map;
/*     */ import org.apache.synapse.SynapseException;
/*     */ import org.apache.synapse.util.xpath.SynapseXPath;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class Statement
/*     */ {
/*  37 */   String rawStatement = null;
/*  38 */   List parameters = new ArrayList();
/*  39 */   Map resultsMap = new HashMap<Object, Object>();
/*     */ 
/*     */   
/*  42 */   public Statement(String rawStatement) { this.rawStatement = rawStatement; }
/*     */ 
/*     */ 
/*     */   
/*  46 */   public String getRawStatement() { return this.rawStatement; }
/*     */ 
/*     */ 
/*     */   
/*  50 */   public void addParameter(String propertyName, SynapseXPath xpath, String type) { this.parameters.add(new Parameter(propertyName, xpath, type)); }
/*     */ 
/*     */ 
/*     */   
/*  54 */   public void addResult(String propertyName, String column) { this.resultsMap.put(propertyName, column); }
/*     */ 
/*     */ 
/*     */   
/*  58 */   public List getParameters() { return this.parameters; }
/*     */ 
/*     */ 
/*     */   
/*  62 */   public Map getResultsMap() { return this.resultsMap; }
/*     */   
/*     */   public class Parameter
/*     */   {
/*  66 */     String propertyName = null;
/*  67 */     SynapseXPath xpath = null;
/*  68 */     int type = 0;
/*     */ 
/*     */     
/*     */     Parameter(String value, SynapseXPath xpath, String type) {
/*  72 */       this.propertyName = value;
/*  73 */       this.xpath = xpath;
/*  74 */       if (""CHAR"".equals(type)) {
/*  75 */         this.type = 1;
/*  76 */       } else if (""VARCHAR"".equals(type)) {
/*  77 */         this.type = 12;
/*  78 */       } else if (""LONGVARCHAR"".equals(type)) {
/*  79 */         this.type = -1;
/*  80 */       } else if (""NUMERIC"".equals(type)) {
/*  81 */         this.type = 2;
/*  82 */       } else if (""DECIMAL"".equals(type)) {
/*  83 */         this.type = 3;
/*  84 */       } else if (""BIT"".equals(type)) {
/*  85 */         this.type = -7;
/*  86 */       } else if (""TINYINT"".equals(type)) {
/*  87 */         this.type = -6;
/*  88 */       } else if (""SMALLINT"".equals(type)) {
/*  89 */         this.type = 5;
/*  90 */       } else if (""INTEGER"".equals(type)) {
/*  91 */         this.type = 4;
/*  92 */       } else if (""BIGINT"".equals(type)) {
/*  93 */         this.type = -5;
/*  94 */       } else if (""REAL"".equals(type)) {
/*  95 */         this.type = 7;
/*  96 */       } else if (""FLOAT"".equals(type)) {
/*  97 */         this.type = 6;
/*  98 */       } else if (""DOUBLE"".equals(type)) {
/*  99 */         this.type = 8;
/* 100 */       } else if (""DATE"".equals(type)) {
/* 101 */         this.type = 91;
/* 102 */       } else if (""TIME"".equals(type)) {
/* 103 */         this.type = 92;
/* 104 */       } else if (""TIMESTAMP"".equals(type)) {
/* 105 */         this.type = 93;
/*     */       } else {
/* 107 */         throw new SynapseException(""Unknown or unsupported JDBC type : "" + type);
/*     */       } 
/*     */     }
/*     */ 
/*     */     
/* 112 */     public String getPropertyName() { return this.propertyName; }
/*     */ 
/*     */ 
/*     */     
/* 116 */     public SynapseXPath getXpath() { return this.xpath; }
/*     */ 
/*     */ 
/*     */     
/* 120 */     public int getType() { return this.type; }
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\mediators\db\Statement.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.mediators.eip.EIPConstants,"package org.apache.synapse.mediators.eip;
public final class EIPConstants {
  public static final String AGGREGATE_CORRELATION = ""aggregateCorelation"";
  public static final String MESSAGE_SEQUENCE = ""messageSequence"";
  public static final String MESSAGE_SEQUENCE_DELEMITER = ""/"";
}
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\mediators\eip\EIPConstants.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.mediators.eip.EIPUtils,"/*     */ package org.apache.synapse.mediators.eip;
/*     */ 
/*     */ import java.util.ArrayList;
/*     */ import java.util.Iterator;
/*     */ import java.util.List;
/*     */ import org.apache.axiom.om.OMElement;
/*     */ import org.apache.axiom.om.OMNode;
/*     */ import org.apache.axiom.soap.SOAPEnvelope;
/*     */ import org.apache.commons.logging.Log;
/*     */ import org.apache.commons.logging.LogFactory;
/*     */ import org.apache.synapse.util.xpath.SynapseXPath;
/*     */ import org.jaxen.JaxenException;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class EIPUtils
/*     */ {
/*  39 */   private static final Log log = LogFactory.getLog(EIPUtils.class);
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public static List getMatchingElements(SOAPEnvelope envelope, SynapseXPath expression) throws JaxenException {
/*  52 */     Object o = expression.evaluate(envelope);
/*  53 */     if (o instanceof OMNode) {
/*  54 */       List<Object> list = new ArrayList();
/*  55 */       list.add(o);
/*  56 */       return list;
/*  57 */     }  if (o instanceof List) {
/*  58 */       return (List)o;
/*     */     }
/*  60 */     return new ArrayList();
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public static List<OMNode> getDetachedMatchingElements(SOAPEnvelope envelope, SynapseXPath expression) throws JaxenException {
/*  75 */     List<OMNode> elementList = new ArrayList<OMNode>();
/*  76 */     Object o = expression.evaluate(envelope);
/*  77 */     if (o instanceof OMNode) {
/*  78 */       elementList.add(((OMNode)o).detach());
/*  79 */     } else if (o instanceof List) {
/*  80 */       for (Object elem : o) {
/*  81 */         if (elem instanceof OMNode) {
/*  82 */           elementList.add(((OMNode)elem).detach());
/*     */         }
/*     */       } 
/*     */     } 
/*  86 */     return elementList;
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public static void enrichEnvelope(SOAPEnvelope envelope, SOAPEnvelope enricher, SynapseXPath expression) throws JaxenException {
/* 102 */     List elementList = getMatchingElements(envelope, expression);
/*     */     
/* 104 */     if (elementList != null && !elementList.isEmpty()) {
/*     */ 
/*     */       
/* 107 */       Object object, o = elementList.get(0);
/*     */       
/* 109 */       if (o instanceof OMElement && ((OMElement)o).getParent() != null && ((OMElement)o).getParent() instanceof OMElement) {
/*     */ 
/*     */         
/* 112 */         object = ((OMElement)o).getParent();
/*     */       } else {
/* 114 */         object = envelope.getBody();
/*     */       } 
/*     */       
/* 117 */       List list = getMatchingElements(enricher, expression);
/* 118 */       if (list != null) {
/* 119 */         Iterator itr = list.iterator();
/* 120 */         while (itr.hasNext()) {
/* 121 */           o = itr.next();
/* 122 */           if (o != null && o instanceof OMElement)
/* 123 */             object.addChild((OMNode)o); 
/*     */         } 
/*     */       } 
/*     */     } 
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\mediators\eip\EIPUtils.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.mediators.eip.Target,"/*     */ package org.apache.synapse.mediators.eip;
/*     */ 
/*     */ import org.apache.axis2.addressing.EndpointReference;
/*     */ import org.apache.synapse.MessageContext;
/*     */ import org.apache.synapse.endpoints.Endpoint;
/*     */ import org.apache.synapse.mediators.base.SequenceMediator;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class Target
/*     */ {
/*  34 */   private String toAddress = null;
/*     */ 
/*     */   
/*  37 */   private String soapAction = null;
/*     */ 
/*     */   
/*  40 */   private SequenceMediator sequence = null;
/*     */ 
/*     */   
/*  43 */   private String sequenceRef = null;
/*     */ 
/*     */   
/*  46 */   private Endpoint endpoint = null;
/*     */ 
/*     */   
/*  49 */   private String endpointRef = null;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public void mediate(MessageContext synCtx) {
/*  59 */     if (this.soapAction != null) {
/*  60 */       synCtx.setSoapAction(this.soapAction);
/*     */     }
/*     */     
/*  63 */     if (this.toAddress != null) {
/*  64 */       if (synCtx.getTo() != null) {
/*  65 */         synCtx.getTo().setAddress(this.toAddress);
/*     */       } else {
/*  67 */         synCtx.setTo(new EndpointReference(this.toAddress));
/*     */       } 
/*     */     }
/*     */ 
/*     */ 
/*     */     
/*  73 */     if (this.sequence != null) {
/*  74 */       synCtx.getEnvironment().injectAsync(synCtx, this.sequence);
/*  75 */     } else if (this.sequenceRef != null) {
/*  76 */       SequenceMediator refSequence = (SequenceMediator)synCtx.getSequence(this.sequenceRef);
/*  77 */       if (refSequence != null) {
/*  78 */         synCtx.getEnvironment().injectAsync(synCtx, refSequence);
/*     */       }
/*  80 */     } else if (this.endpoint != null) {
/*  81 */       this.endpoint.send(synCtx);
/*  82 */     } else if (this.endpointRef != null) {
/*  83 */       Endpoint epr = synCtx.getConfiguration().getEndpoint(this.endpointRef);
/*  84 */       if (epr != null) {
/*  85 */         epr.send(synCtx);
/*     */       }
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  95 */   public String getToAddress() { return this.toAddress; }
/*     */ 
/*     */ 
/*     */   
/*  99 */   public void setToAddress(String toAddress) { this.toAddress = toAddress; }
/*     */ 
/*     */ 
/*     */   
/* 103 */   public String getSoapAction() { return this.soapAction; }
/*     */ 
/*     */ 
/*     */   
/* 107 */   public void setSoapAction(String soapAction) { this.soapAction = soapAction; }
/*     */ 
/*     */ 
/*     */   
/* 111 */   public SequenceMediator getSequence() { return this.sequence; }
/*     */ 
/*     */ 
/*     */   
/* 115 */   public void setSequence(SequenceMediator sequence) { this.sequence = sequence; }
/*     */ 
/*     */ 
/*     */   
/* 119 */   public String getSequenceRef() { return this.sequenceRef; }
/*     */ 
/*     */ 
/*     */   
/* 123 */   public void setSequenceRef(String sequenceRef) { this.sequenceRef = sequenceRef; }
/*     */ 
/*     */ 
/*     */   
/* 127 */   public Endpoint getEndpoint() { return this.endpoint; }
/*     */ 
/*     */ 
/*     */   
/* 131 */   public void setEndpoint(Endpoint endpoint) { this.endpoint = endpoint; }
/*     */ 
/*     */ 
/*     */   
/* 135 */   public String getEndpointRef() { return this.endpointRef; }
/*     */ 
/*     */ 
/*     */   
/* 139 */   public void setEndpointRef(String endpointRef) { this.endpointRef = endpointRef; }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\mediators\eip\Target.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.mediators.eip.aggregator.Aggregate,"/*     */ package org.apache.synapse.mediators.eip.aggregator;
/*     */ 
/*     */ import java.util.ArrayList;
/*     */ import java.util.List;
/*     */ import java.util.TimerTask;
/*     */ import org.apache.commons.logging.Log;
/*     */ import org.apache.commons.logging.LogFactory;
/*     */ import org.apache.synapse.MessageContext;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class Aggregate
/*     */   extends TimerTask
/*     */ {
/*  39 */   private static final Log log = LogFactory.getLog(Aggregate.class);
/*  40 */   private static final Log trace = LogFactory.getLog(""TRACE_LOGGER"");
/*     */   
/*  42 */   private long timeoutMillis = 0L;
/*     */   
/*  44 */   private long expiryTimeMillis = 0L;
/*     */   
/*  46 */   private int minCount = -1;
/*     */   
/*  48 */   private int maxCount = -1;
/*  49 */   private String correlation = null;
/*     */   
/*  51 */   private AggregateMediator aggregateMediator = null;
/*  52 */   private List<MessageContext> messages = new ArrayList<MessageContext>();
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   private boolean locked = false;
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   private boolean completed = false;
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public Aggregate(String corelation, long timeoutMillis, int min, int max, AggregateMediator mediator) {
/*  68 */     this.correlation = corelation;
/*  69 */     if (timeoutMillis > 0L) {
/*  70 */       this.expiryTimeMillis = System.currentTimeMillis() + timeoutMillis;
/*     */     }
/*  72 */     if (min > 0) {
/*  73 */       this.minCount = min;
/*     */     }
/*  75 */     if (max > 0) {
/*  76 */       this.maxCount = max;
/*     */     }
/*  78 */     this.aggregateMediator = mediator;
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public synchronized boolean addMessage(MessageContext synCtx) {
/*  88 */     if (this.maxCount <= 0 || (this.maxCount > 0 && this.messages.size() < this.maxCount)) {
/*  89 */       this.messages.add(synCtx);
/*  90 */       return true;
/*     */     } 
/*  92 */     return false;
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public synchronized boolean isComplete(boolean traceOn, boolean traceOrDebugOn, Log trace, Log log) {
/* 109 */     if (!this.completed) {
/*     */ 
/*     */       
/* 112 */       if (!this.messages.isEmpty()) {
/*     */ 
/*     */         
/* 115 */         MessageContext mc = this.messages.get(0);
/* 116 */         Object prop = mc.getProperty(""messageSequence"");
/*     */         
/* 118 */         if (prop != null && prop instanceof String) {
/* 119 */           String[] msgSequence = prop.toString().split(""/"");
/*     */           
/* 121 */           int total = Integer.parseInt(msgSequence[1]);
/*     */           
/* 123 */           if (traceOrDebugOn) {
/* 124 */             traceOrDebug(traceOn, trace, log, this.messages.size() + "" messages of "" + total + "" collected in current aggregation"");
/*     */           }
/*     */ 
/*     */           
/* 128 */           if (this.messages.size() >= total) {
/* 129 */             if (traceOrDebugOn) {
/* 130 */               traceOrDebug(traceOn, trace, log, ""Aggregation complete"");
/*     */             }
/* 132 */             return true;
/*     */           }
/*     */         
/*     */         } 
/* 136 */       } else if (traceOrDebugOn) {
/* 137 */         traceOrDebug(traceOn, trace, log, ""No messages collected in current aggregation"");
/*     */       } 
/*     */ 
/*     */ 
/*     */       
/* 142 */       if (this.minCount > 0 && this.messages.size() >= this.minCount) {
/* 143 */         if (traceOrDebugOn) {
/* 144 */           traceOrDebug(traceOn, trace, log, ""Aggregation complete - the minimum : "" + this.minCount + "" messages has been reached"");
/*     */         }
/*     */ 
/*     */         
/* 148 */         return true;
/*     */       } 
/*     */       
/* 151 */       if (this.maxCount > 0 && this.messages.size() >= this.maxCount) {
/* 152 */         if (traceOrDebugOn) {
/* 153 */           traceOrDebug(traceOn, trace, log, ""Aggregation complete - the maximum : "" + this.maxCount + "" messages has been reached"");
/*     */         }
/*     */ 
/*     */ 
/*     */         
/* 158 */         return true;
/*     */       } 
/*     */ 
/*     */       
/* 162 */       if (this.expiryTimeMillis > 0L && System.currentTimeMillis() >= this.expiryTimeMillis) {
/* 163 */         if (traceOrDebugOn) {
/* 164 */           traceOrDebug(traceOn, trace, log, ""Aggregation complete - the aggregation has timed out"");
/*     */         }
/*     */ 
/*     */         
/* 168 */         return true;
/*     */       }
/*     */     
/* 171 */     } else if (traceOrDebugOn) {
/* 172 */       traceOrDebug(traceOn, trace, log, ""Aggregation already completed - this message will not be processed in aggregation"");
/*     */     } 
/*     */ 
/*     */ 
/*     */     
/* 177 */     return false;
/*     */   }
/*     */   
/*     */   private void traceOrDebug(boolean traceOn, Log trace, Log log, String msg) {
/* 181 */     if (traceOn) {
/* 182 */       trace.info(msg);
/*     */     }
/* 184 */     if (log.isDebugEnabled()) {
/* 185 */       log.debug(msg);
/*     */     }
/*     */   }
/*     */ 
/*     */   
/* 190 */   public long getTimeoutMillis() { return this.timeoutMillis; }
/*     */ 
/*     */ 
/*     */   
/* 194 */   public void setTimeoutMillis(long timeoutMillis) { this.timeoutMillis = timeoutMillis; }
/*     */ 
/*     */ 
/*     */   
/* 198 */   public int getMinCount() { return this.minCount; }
/*     */ 
/*     */ 
/*     */   
/* 202 */   public void setMinCount(int minCount) { this.minCount = minCount; }
/*     */ 
/*     */ 
/*     */   
/* 206 */   public int getMaxCount() { return this.maxCount; }
/*     */ 
/*     */ 
/*     */   
/* 210 */   public void setMaxCount(int maxCount) { this.maxCount = maxCount; }
/*     */ 
/*     */ 
/*     */   
/* 214 */   public String getCorrelation() { return this.correlation; }
/*     */ 
/*     */ 
/*     */   
/* 218 */   public void setCorrelation(String correlation) { this.correlation = correlation; }
/*     */ 
/*     */ 
/*     */   
/* 222 */   public List<MessageContext> getMessages() { return this.messages; }
/*     */ 
/*     */ 
/*     */   
/* 226 */   public void setMessages(List<MessageContext> messages) { this.messages = messages; }
/*     */ 
/*     */ 
/*     */   
/* 230 */   public long getExpiryTimeMillis() { return this.expiryTimeMillis; }
/*     */ 
/*     */ 
/*     */   
/* 234 */   public void setExpiryTimeMillis(long expiryTimeMillis) { this.expiryTimeMillis = expiryTimeMillis; }
/*     */ 
/*     */ 
/*     */   
/*     */   public void run() {
/* 239 */     while (!this.completed) {
/*     */ 
/*     */       
/* 242 */       if (getLock()) {
/* 243 */         if (log.isDebugEnabled()) {
/* 244 */           log.debug(""Time : "" + System.currentTimeMillis() + "" and this aggregator "" + ""expired at : "" + this.expiryTimeMillis);
/*     */         }
/*     */         
/* 247 */         this.aggregateMediator.completeAggregate(this);
/*     */         break;
/*     */       } 
/*     */     } 
/*     */   }
/*     */ 
/*     */   
/* 254 */   public synchronized boolean getLock() { return !this.locked; }
/*     */ 
/*     */ 
/*     */   
/* 258 */   public void releaseLock() { this.locked = false; }
/*     */ 
/*     */ 
/*     */   
/* 262 */   public boolean isCompleted() { return this.completed; }
/*     */ 
/*     */ 
/*     */   
/* 266 */   public void setCompleted(boolean completed) { this.completed = completed; }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\mediators\eip\aggregator\Aggregate.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.mediators.eip.aggregator.AggregateMediator,"/*     */ package org.apache.synapse.mediators.eip.aggregator;
/*     */ 
/*     */ import java.util.Collections;
/*     */ import java.util.HashMap;
/*     */ import java.util.Map;
/*     */ import org.apache.commons.logging.Log;
/*     */ import org.apache.commons.logging.LogFactory;
/*     */ import org.apache.synapse.MessageContext;
/*     */ import org.apache.synapse.mediators.AbstractMediator;
/*     */ import org.apache.synapse.mediators.base.SequenceMediator;
/*     */ import org.apache.synapse.mediators.eip.EIPUtils;
/*     */ import org.apache.synapse.util.xpath.SynapseXPath;
/*     */ import org.jaxen.JaxenException;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class AggregateMediator
/*     */   extends AbstractMediator
/*     */ {
/*  51 */   private static final Log log = LogFactory.getLog(AggregateMediator.class);
/*  52 */   private static final Log trace = LogFactory.getLog(""TRACE_LOGGER"");
/*     */ 
/*     */   
/*  55 */   private long completionTimeoutMillis = 0L;
/*     */   
/*  57 */   private int minMessagesToComplete = -1;
/*     */   
/*  59 */   private int maxMessagesToComplete = -1;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  65 */   private SynapseXPath correlateExpression = null;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  72 */   private SynapseXPath aggregationExpression = null;
/*     */ 
/*     */   
/*  75 */   private String onCompleteSequenceRef = null;
/*     */   
/*  77 */   private SequenceMediator onCompleteSequence = null;
/*     */ 
/*     */   
/*  80 */   private Map<String, Aggregate> activeAggregates = Collections.synchronizedMap(new HashMap<String, Aggregate>());
/*     */ 
/*     */ 
/*     */   
/*  84 */   private final Object lock = new Object();
/*     */   
/*     */   public AggregateMediator() {
/*     */     try {
/*  88 */       this.aggregationExpression = new SynapseXPath(""s11:Body/child::*[position()=1] | s12:Body/child::*[position()=1]"");
/*     */       
/*  90 */       this.aggregationExpression.addNamespace(""s11"", ""http://schemas.xmlsoap.org/soap/envelope/"");
/*  91 */       this.aggregationExpression.addNamespace(""s12"", ""http://www.w3.org/2003/05/soap-envelope"");
/*  92 */     } catch (JaxenException e) {
/*  93 */       if (log.isDebugEnabled()) {
/*  94 */         handleException(""Unable to set the default aggregationExpression for the aggregation"", (Exception)e, null);
/*     */       }
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public boolean mediate(MessageContext synCtx) {
/* 109 */     boolean traceOn = isTraceOn(synCtx);
/* 110 */     boolean traceOrDebugOn = isTraceOrDebugOn(traceOn);
/*     */     
/* 112 */     if (traceOrDebugOn) {
/* 113 */       traceOrDebug(traceOn, ""Start : Aggregate mediator"");
/*     */       
/* 115 */       if (traceOn && trace.isTraceEnabled()) {
/* 116 */         trace.trace(""Message : "" + synCtx.getEnvelope());
/*     */       }
/*     */     } 
/*     */     
/*     */     try {
/* 121 */       Aggregate aggregate = null;
/*     */ 
/*     */ 
/*     */       
/* 125 */       if (this.correlateExpression != null && this.correlateExpression.evaluate(synCtx) != null) {
/*     */ 
/*     */         
/* 128 */         while (aggregate == null) {
/*     */           
/* 130 */           synchronized (this.lock) {
/*     */             
/* 132 */             if (this.activeAggregates.containsKey(this.correlateExpression.toString()))
/*     */             {
/* 134 */               aggregate = this.activeAggregates.get(this.correlateExpression.toString());
/* 135 */               if (aggregate != null && 
/* 136 */                 !aggregate.getLock()) {
/* 137 */                 aggregate = null;
/*     */               
/*     */               }
/*     */             }
/*     */             else
/*     */             {
/* 143 */               if (traceOrDebugOn) {
/* 144 */                 traceOrDebug(traceOn, ""Creating new Aggregator - "" + ((this.completionTimeoutMillis > 0L) ? (""expires in : "" + (this.completionTimeoutMillis / 1000L) + ""secs"") : ""without expiry time""));
/*     */               }
/*     */ 
/*     */ 
/*     */ 
/*     */               
/* 150 */               aggregate = new Aggregate(this.correlateExpression.toString(), this.completionTimeoutMillis, this.minMessagesToComplete, this.maxMessagesToComplete, this);
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */               
/* 156 */               if (this.completionTimeoutMillis > 0L) {
/* 157 */                 synCtx.getConfiguration().getSynapseTimer().schedule(aggregate, this.completionTimeoutMillis);
/*     */               }
/*     */               
/* 160 */               aggregate.getLock();
/* 161 */               this.activeAggregates.put(this.correlateExpression.toString(), aggregate);
/*     */             }
/*     */           
/*     */           } 
/*     */         } 
/* 166 */       } else if (synCtx.getProperty(""aggregateCorelation"") != null) {
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */         
/* 172 */         Object o = synCtx.getProperty(""aggregateCorelation"");
/*     */ 
/*     */         
/* 175 */         if (o != null && o instanceof String) {
/* 176 */           String correlation = (String)o;
/* 177 */           while (aggregate == null) {
/* 178 */             synchronized (this.lock) {
/* 179 */               if (this.activeAggregates.containsKey(correlation)) {
/* 180 */                 aggregate = this.activeAggregates.get(correlation);
/* 181 */                 if (aggregate != null) {
/* 182 */                   if (!aggregate.getLock()) {
/* 183 */                     aggregate = null;
/*     */                   }
/*     */                 } else {
/*     */                   break;
/*     */                 } 
/*     */               } else {
/* 189 */                 if (traceOrDebugOn) {
/* 190 */                   traceOrDebug(traceOn, ""Creating new Aggregator - "" + ((this.completionTimeoutMillis > 0L) ? (""expires in : "" + (this.completionTimeoutMillis / 1000L) + ""secs"") : ""without expiry time""));
/*     */                 }
/*     */ 
/*     */ 
/*     */ 
/*     */                 
/* 196 */                 aggregate = new Aggregate(correlation, this.completionTimeoutMillis, this.minMessagesToComplete, this.maxMessagesToComplete, this);
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */                 
/* 202 */                 if (this.completionTimeoutMillis > 0L) {
/* 203 */                   synCtx.getConfiguration().getSynapseTimer().schedule(aggregate, this.completionTimeoutMillis);
/*     */                 }
/*     */                 
/* 206 */                 aggregate.getLock();
/* 207 */                 this.activeAggregates.put(correlation, aggregate);
/*     */               } 
/*     */             } 
/*     */           } 
/*     */         } else {
/*     */           
/* 213 */           if (traceOrDebugOn) {
/* 214 */             traceOrDebug(traceOn, ""Unable to find aggrgation correlation property"");
/*     */           }
/* 216 */           return true;
/*     */         } 
/*     */       } else {
/* 219 */         if (traceOrDebugOn) {
/* 220 */           traceOrDebug(traceOn, ""Unable to find aggrgation correlation XPath or property"");
/*     */         }
/*     */         
/* 223 */         return true;
/*     */       } 
/*     */ 
/*     */       
/* 227 */       if (aggregate != null) {
/* 228 */         boolean collected = aggregate.addMessage(synCtx);
/* 229 */         if (traceOrDebugOn && 
/* 230 */           collected) {
/* 231 */           traceOrDebug(traceOn, ""Collected a message during aggregation"");
/* 232 */           if (traceOn && trace.isTraceEnabled()) {
/* 233 */             trace.trace(""Collected message : "" + synCtx);
/*     */           }
/*     */         } 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */         
/* 241 */         if (aggregate.isComplete(traceOn, traceOrDebugOn, trace, log)) {
/* 242 */           if (traceOrDebugOn) {
/* 243 */             traceOrDebug(traceOn, ""Aggregation completed - invoking onComplete"");
/*     */           }
/* 245 */           completeAggregate(aggregate);
/*     */           
/* 247 */           if (traceOrDebugOn) {
/* 248 */             traceOrDebug(traceOn, ""End : Aggregate mediator"");
/*     */           }
/* 250 */           return true;
/*     */         } 
/* 252 */         aggregate.releaseLock();
/*     */ 
/*     */       
/*     */       }
/*     */       else {
/*     */ 
/*     */         
/* 259 */         if (traceOrDebugOn) {
/* 260 */           traceOrDebug(traceOn, ""Unable to find an aggregate for this message - skip"");
/*     */         }
/* 262 */         return true;
/*     */       }
/*     */     
/* 265 */     } catch (JaxenException e) {
/* 266 */       handleException(""Unable to execute the XPATH over the message"", (Exception)e, synCtx);
/*     */     } 
/*     */     
/* 269 */     if (traceOrDebugOn) {
/* 270 */       traceOrDebug(traceOn, ""End : Aggregate mediator"");
/*     */     }
/*     */     
/* 273 */     return false;
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public synchronized void completeAggregate(Aggregate aggregate) {
/* 283 */     if (log.isDebugEnabled()) {
/* 284 */       log.debug(""Aggregation completed or timed out"");
/*     */     }
/*     */ 
/*     */     
/* 288 */     aggregate.cancel();
/* 289 */     aggregate.setCompleted(true);
/*     */     
/* 291 */     MessageContext newSynCtx = getAggregatedMessage(aggregate);
/* 292 */     if (newSynCtx == null) {
/* 293 */       log.warn(""An aggregation of messages timed out with no aggregated messages"", null);
/*     */       
/*     */       return;
/*     */     } 
/* 297 */     this.activeAggregates.remove(aggregate.getCorrelation());
/*     */     
/* 299 */     if ((this.correlateExpression != null && !this.correlateExpression.toString().equals(aggregate.getCorrelation())) || this.correlateExpression == null)
/*     */     {
/*     */ 
/*     */       
/* 303 */       if (this.onCompleteSequence != null) {
/* 304 */         this.onCompleteSequence.mediate(newSynCtx);
/*     */       }
/* 306 */       else if (this.onCompleteSequenceRef != null && newSynCtx.getSequence(this.onCompleteSequenceRef) != null) {
/*     */         
/* 308 */         newSynCtx.getSequence(this.onCompleteSequenceRef).mediate(newSynCtx);
/*     */       } else {
/*     */         
/* 311 */         handleException(""Unable to find the sequence for the mediation of the aggregated message"", newSynCtx);
/*     */       } 
/*     */     }
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   private MessageContext getAggregatedMessage(Aggregate aggregate) {
/* 326 */     MessageContext newCtx = null;
/*     */     
/* 328 */     for (MessageContext synCtx : aggregate.getMessages()) {
/*     */       
/* 330 */       if (newCtx == null) {
/* 331 */         newCtx = synCtx;
/*     */         
/* 333 */         if (log.isDebugEnabled()) {
/* 334 */           log.debug(""Generating Aggregated message from : "" + newCtx.getEnvelope());
/*     */         }
/*     */         continue;
/*     */       } 
/*     */       try {
/* 339 */         if (log.isDebugEnabled()) {
/* 340 */           log.debug(""Merging message : "" + synCtx.getEnvelope() + "" using XPath : "" + this.aggregationExpression);
/*     */         }
/*     */ 
/*     */         
/* 344 */         EIPUtils.enrichEnvelope(newCtx.getEnvelope(), synCtx.getEnvelope(), this.aggregationExpression);
/*     */ 
/*     */         
/* 347 */         if (log.isDebugEnabled()) {
/* 348 */           log.debug(""Merged result : "" + newCtx.getEnvelope());
/*     */         }
/*     */       }
/* 351 */       catch (JaxenException e) {
/* 352 */         handleException(""Error merging aggregation results using XPath : "" + this.aggregationExpression.toString(), (Exception)e, synCtx);
/*     */       } 
/*     */     } 
/*     */ 
/*     */     
/* 357 */     return newCtx;
/*     */   }
/*     */ 
/*     */   
/* 361 */   public SynapseXPath getCorrelateExpression() { return this.correlateExpression; }
/*     */ 
/*     */ 
/*     */   
/* 365 */   public void setCorrelateExpression(SynapseXPath correlateExpression) { this.correlateExpression = correlateExpression; }
/*     */ 
/*     */ 
/*     */   
/* 369 */   public long getCompletionTimeoutMillis() { return this.completionTimeoutMillis; }
/*     */ 
/*     */ 
/*     */   
/* 373 */   public void setCompletionTimeoutMillis(long completionTimeoutMillis) { this.completionTimeoutMillis = completionTimeoutMillis; }
/*     */ 
/*     */ 
/*     */   
/* 377 */   public int getMinMessagesToComplete() { return this.minMessagesToComplete; }
/*     */ 
/*     */ 
/*     */   
/* 381 */   public void setMinMessagesToComplete(int minMessagesToComplete) { this.minMessagesToComplete = minMessagesToComplete; }
/*     */ 
/*     */ 
/*     */   
/* 385 */   public int getMaxMessagesToComplete() { return this.maxMessagesToComplete; }
/*     */ 
/*     */ 
/*     */   
/* 389 */   public void setMaxMessagesToComplete(int maxMessagesToComplete) { this.maxMessagesToComplete = maxMessagesToComplete; }
/*     */ 
/*     */ 
/*     */   
/* 393 */   public SynapseXPath getAggregationExpression() { return this.aggregationExpression; }
/*     */ 
/*     */ 
/*     */   
/* 397 */   public void setAggregationExpression(SynapseXPath aggregationExpression) { this.aggregationExpression = aggregationExpression; }
/*     */ 
/*     */ 
/*     */   
/* 401 */   public String getOnCompleteSequenceRef() { return this.onCompleteSequenceRef; }
/*     */ 
/*     */ 
/*     */   
/* 405 */   public void setOnCompleteSequenceRef(String onCompleteSequenceRef) { this.onCompleteSequenceRef = onCompleteSequenceRef; }
/*     */ 
/*     */ 
/*     */   
/* 409 */   public SequenceMediator getOnCompleteSequence() { return this.onCompleteSequence; }
/*     */ 
/*     */ 
/*     */   
/* 413 */   public void setOnCompleteSequence(SequenceMediator onCompleteSequence) { this.onCompleteSequence = onCompleteSequence; }
/*     */ 
/*     */ 
/*     */   
/* 417 */   public Map getActiveAggregates() { return this.activeAggregates; }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\mediators\eip\aggregator\AggregateMediator.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.mediators.eip.splitter.CloneMediator,"/*     */ package org.apache.synapse.mediators.eip.splitter;
/*     */ 
/*     */ import java.util.ArrayList;
/*     */ import java.util.Iterator;
/*     */ import java.util.List;
/*     */ import org.apache.axis2.AxisFault;
/*     */ import org.apache.axis2.context.OperationContext;
/*     */ import org.apache.synapse.ManagedLifecycle;
/*     */ import org.apache.synapse.MessageContext;
/*     */ import org.apache.synapse.core.SynapseEnvironment;
/*     */ import org.apache.synapse.core.axis2.Axis2MessageContext;
/*     */ import org.apache.synapse.mediators.AbstractMediator;
/*     */ import org.apache.synapse.mediators.base.SequenceMediator;
/*     */ import org.apache.synapse.mediators.eip.Target;
/*     */ import org.apache.synapse.util.MessageHelper;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class CloneMediator
/*     */   extends AbstractMediator
/*     */   implements ManagedLifecycle
/*     */ {
/*     */   private boolean continueParent = false;
/*  54 */   private List<Target> targets = new ArrayList<Target>();
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public boolean mediate(MessageContext synCtx) {
/*  65 */     boolean traceOn = isTraceOn(synCtx);
/*  66 */     boolean traceOrDebugOn = isTraceOrDebugOn(traceOn);
/*     */     
/*  68 */     if (traceOrDebugOn) {
/*  69 */       traceOrDebug(traceOn, ""Start : Clone mediator"");
/*     */       
/*  71 */       if (traceOn && trace.isTraceEnabled()) {
/*  72 */         trace.trace(""Message : "" + synCtx.getEnvelope());
/*     */       }
/*     */     } 
/*     */ 
/*     */ 
/*     */     
/*  78 */     Iterator<Target> iter = this.targets.iterator();
/*  79 */     int i = 0;
/*  80 */     while (iter.hasNext()) {
/*  81 */       if (traceOrDebugOn) {
/*  82 */         traceOrDebug(traceOn, ""Submitting "" + (i + 1) + "" of "" + this.targets.size() + "" messages for processing in parallel"");
/*     */       }
/*     */ 
/*     */       
/*  86 */       ((Target)iter.next()).mediate(getClonedMessageContext(synCtx, i++, this.targets.size()));
/*     */     } 
/*     */ 
/*     */ 
/*     */     
/*  91 */     OperationContext opCtx = ((Axis2MessageContext)synCtx).getAxis2MessageContext().getOperationContext();
/*     */     
/*  93 */     if (!this.continueParent && opCtx != null) {
/*  94 */       opCtx.setProperty(""RESPONSE_WRITTEN"", ""SKIP"");
/*     */     }
/*     */ 
/*     */     
/*  98 */     if (traceOrDebugOn) {
/*  99 */       traceOrDebug(traceOn, ""End : Clone mediator"");
/*     */     }
/*     */ 
/*     */ 
/*     */     
/* 104 */     return this.continueParent;
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   private MessageContext getClonedMessageContext(MessageContext synCtx, int messageSequence, int messageCount) {
/* 119 */     MessageContext newCtx = null;
/*     */     try {
/* 121 */       newCtx = MessageHelper.cloneMessageContext(synCtx);
/*     */ 
/*     */       
/* 124 */       newCtx.setProperty(""messageSequence"", String.valueOf(messageSequence) + ""/"" + messageCount);
/*     */     
/*     */     }
/* 127 */     catch (AxisFault axisFault) {
/* 128 */       handleException(""Error cloning the message context"", (Exception)axisFault, synCtx);
/*     */     } 
/*     */     
/* 131 */     return newCtx;
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 139 */   public boolean isContinueParent() { return this.continueParent; }
/*     */ 
/*     */ 
/*     */   
/* 143 */   public void setContinueParent(boolean continueParent) { this.continueParent = continueParent; }
/*     */ 
/*     */ 
/*     */   
/* 147 */   public List<Target> getTargets() { return this.targets; }
/*     */ 
/*     */ 
/*     */   
/* 151 */   public void setTargets(List<Target> targets) { this.targets = targets; }
/*     */ 
/*     */ 
/*     */   
/* 155 */   public void addTarget(Target target) { this.targets.add(target); }
/*     */ 
/*     */ 
/*     */   
/*     */   public void init(SynapseEnvironment se) {
/* 160 */     for (Target target : this.targets) {
/* 161 */       SequenceMediator seq = target.getSequence();
/* 162 */       if (seq != null) {
/* 163 */         seq.init(se);
/*     */       }
/*     */     } 
/*     */   }
/*     */ 
/*     */   
/*     */   public void destroy() {
/* 170 */     for (Target target : this.targets) {
/* 171 */       SequenceMediator seq = target.getSequence();
/* 172 */       if (seq != null)
/* 173 */         seq.destroy(); 
/*     */     } 
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\mediators\eip\splitter\CloneMediator.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.mediators.eip.splitter.IterateMediator,"/*     */ package org.apache.synapse.mediators.eip.splitter;
/*     */ 
/*     */ import java.util.Iterator;
/*     */ import java.util.List;
/*     */ import org.apache.axiom.om.OMElement;
/*     */ import org.apache.axiom.om.OMNode;
/*     */ import org.apache.axiom.soap.SOAPEnvelope;
/*     */ import org.apache.axis2.AxisFault;
/*     */ import org.apache.axis2.context.OperationContext;
/*     */ import org.apache.synapse.ManagedLifecycle;
/*     */ import org.apache.synapse.MessageContext;
/*     */ import org.apache.synapse.core.SynapseEnvironment;
/*     */ import org.apache.synapse.core.axis2.Axis2MessageContext;
/*     */ import org.apache.synapse.mediators.AbstractMediator;
/*     */ import org.apache.synapse.mediators.eip.EIPUtils;
/*     */ import org.apache.synapse.mediators.eip.Target;
/*     */ import org.apache.synapse.util.MessageHelper;
/*     */ import org.apache.synapse.util.xpath.SynapseXPath;
/*     */ import org.jaxen.JaxenException;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class IterateMediator
/*     */   extends AbstractMediator
/*     */   implements ManagedLifecycle
/*     */ {
/*     */   private boolean continueParent = false;
/*     */   private boolean preservePayload = false;
/*  61 */   private SynapseXPath expression = null;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  67 */   private SynapseXPath attachPath = null;
/*     */ 
/*     */   
/*  70 */   private Target target = null;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public boolean mediate(MessageContext synCtx) {
/*  80 */     boolean traceOn = isTraceOn(synCtx);
/*  81 */     boolean traceOrDebugOn = isTraceOrDebugOn(traceOn);
/*     */     
/*  83 */     if (traceOrDebugOn) {
/*  84 */       traceOrDebug(traceOn, ""Start : Iterate mediator"");
/*     */       
/*  86 */       if (traceOn && trace.isTraceEnabled()) {
/*  87 */         trace.trace(""Message : "" + synCtx.getEnvelope());
/*     */       }
/*     */     } 
/*     */ 
/*     */ 
/*     */ 
/*     */     
/*     */     try {
/*  95 */       SOAPEnvelope envelope = MessageHelper.cloneSOAPEnvelope(synCtx.getEnvelope());
/*     */ 
/*     */ 
/*     */       
/*  99 */       List splitElements = EIPUtils.getDetachedMatchingElements(envelope, this.expression);
/*     */       
/* 101 */       if (traceOrDebugOn) {
/* 102 */         traceOrDebug(traceOn, ""Splitting with XPath : "" + this.expression + "" resulted in "" + splitElements.size() + "" elements"");
/*     */       }
/*     */ 
/*     */ 
/*     */       
/* 107 */       if (!this.preservePayload && envelope.getBody() != null) {
/* 108 */         for (Iterator<OMNode> itr = envelope.getBody().getChildren(); itr.hasNext();) {
/* 109 */           ((OMNode)itr.next()).detach();
/*     */         }
/*     */       }
/*     */       
/* 113 */       int msgCount = splitElements.size();
/* 114 */       int msgNumber = 0;
/*     */ 
/*     */       
/* 117 */       for (Object o : splitElements)
/*     */       {
/*     */         
/* 120 */         if (!(o instanceof OMNode)) {
/* 121 */           handleException(""Error splitting message with XPath : "" + this.expression + "" - result not an OMNode"", synCtx);
/*     */         }
/*     */ 
/*     */         
/* 125 */         if (traceOrDebugOn) {
/* 126 */           traceOrDebug(traceOn, ""Submitting "" + (msgNumber + 1) + "" of "" + msgNumber + "" messages for processing in parallel"");
/*     */         }
/*     */ 
/*     */         
/* 130 */         this.target.mediate(getIteratedMessage(synCtx, msgNumber++, msgCount, envelope, (OMNode)o));
/*     */       }
/*     */     
/*     */     }
/* 134 */     catch (JaxenException e) {
/* 135 */       handleException(""Error evaluating split XPath expression : "" + this.expression, (Exception)e, synCtx);
/* 136 */     } catch (AxisFault af) {
/* 137 */       handleException(""Error creating an iterated copy of the message"", (Exception)af, synCtx);
/*     */     } 
/*     */ 
/*     */ 
/*     */     
/* 142 */     OperationContext opCtx = ((Axis2MessageContext)synCtx).getAxis2MessageContext().getOperationContext();
/*     */     
/* 144 */     if (!this.continueParent && opCtx != null) {
/* 145 */       opCtx.setProperty(""RESPONSE_WRITTEN"", ""SKIP"");
/*     */     }
/*     */     
/* 148 */     if (traceOrDebugOn) {
/* 149 */       traceOrDebug(traceOn, ""End : Iterate mediator"");
/*     */     }
/*     */ 
/*     */     
/* 153 */     return this.continueParent;
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   private MessageContext getIteratedMessage(MessageContext synCtx, int msgNumber, int msgCount, SOAPEnvelope envelope, OMNode o) throws AxisFault, JaxenException {
/* 173 */     MessageContext newCtx = MessageHelper.cloneMessageContext(synCtx);
/*     */ 
/*     */     
/* 176 */     newCtx.setProperty(""messageSequence"", msgNumber + ""/"" + msgCount);
/*     */ 
/*     */ 
/*     */ 
/*     */     
/* 181 */     SOAPEnvelope newEnvelope = MessageHelper.cloneSOAPEnvelope(envelope);
/*     */ 
/*     */ 
/*     */     
/* 185 */     if (this.preservePayload) {
/*     */       
/* 187 */       Object attachElem = this.attachPath.evaluate(newEnvelope);
/* 188 */       if (attachElem != null && attachElem instanceof List && !((List)attachElem).isEmpty())
/*     */       {
/* 190 */         attachElem = ((List)attachElem).get(0);
/*     */       }
/*     */ 
/*     */       
/* 194 */       if (attachElem != null && attachElem instanceof OMElement) {
/* 195 */         ((OMElement)attachElem).addChild(o);
/*     */       } else {
/* 197 */         handleException(""Error in attaching the splitted elements :: Unable to get the attach path specified by the expression "" + this.attachPath, synCtx);
/*     */       
/*     */       }
/*     */     
/*     */     }
/* 202 */     else if (newEnvelope.getBody() != null) {
/*     */       
/* 204 */       newEnvelope.getBody().addChild(o);
/*     */     } 
/*     */ 
/*     */     
/* 208 */     newCtx.setEnvelope(newEnvelope);
/*     */     
/* 210 */     return newCtx;
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 218 */   public boolean isContinueParent() { return this.continueParent; }
/*     */ 
/*     */ 
/*     */   
/* 222 */   public void setContinueParent(boolean continueParent) { this.continueParent = continueParent; }
/*     */ 
/*     */ 
/*     */   
/* 226 */   public boolean isPreservePayload() { return this.preservePayload; }
/*     */ 
/*     */ 
/*     */   
/* 230 */   public void setPreservePayload(boolean preservePayload) { this.preservePayload = preservePayload; }
/*     */ 
/*     */ 
/*     */   
/* 234 */   public SynapseXPath getExpression() { return this.expression; }
/*     */ 
/*     */ 
/*     */   
/* 238 */   public void setExpression(SynapseXPath expression) { this.expression = expression; }
/*     */ 
/*     */ 
/*     */   
/* 242 */   public SynapseXPath getAttachPath() { return this.attachPath; }
/*     */ 
/*     */ 
/*     */   
/* 246 */   public void setAttachPath(SynapseXPath attachPath) { this.attachPath = attachPath; }
/*     */ 
/*     */ 
/*     */   
/* 250 */   public Target getTarget() { return this.target; }
/*     */ 
/*     */ 
/*     */   
/* 254 */   public void setTarget(Target target) { this.target = target; }
/*     */ 
/*     */   
/*     */   public void init(SynapseEnvironment se) {
/* 258 */     if (this.target.getSequence() != null) {
/* 259 */       this.target.getSequence().init(se);
/*     */     }
/*     */   }
/*     */   
/*     */   public void destroy() {
/* 264 */     if (this.target.getSequence() != null)
/* 265 */       this.target.getSequence().destroy(); 
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\mediators\eip\splitter\IterateMediator.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.mediators.ext.AnnotatedCommandMediator,"/*     */ package org.apache.synapse.mediators.ext;
/*     */ 
/*     */ import java.lang.reflect.Field;
/*     */ import java.lang.reflect.Method;
/*     */ import java.util.HashMap;
/*     */ import java.util.Iterator;
/*     */ import java.util.Map;
/*     */ import org.apache.synapse.Command;
/*     */ import org.apache.synapse.MessageContext;
/*     */ import org.apache.synapse.mediators.annotations.Namespaces;
/*     */ import org.apache.synapse.mediators.annotations.ReadAndUpdate;
/*     */ import org.apache.synapse.mediators.annotations.ReadFromMessage;
/*     */ import org.apache.synapse.mediators.annotations.UpdateMessage;
/*     */ import org.apache.synapse.util.xpath.SynapseXPath;
/*     */ import org.jaxen.JaxenException;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class AnnotatedCommandMediator
/*     */   extends POJOCommandMediator
/*     */ {
/*     */   protected Map<Field, SynapseXPath> beforeFields;
/*     */   protected Map<Method, SynapseXPath> beforeMethods;
/*     */   protected Map<Field, SynapseXPath> afterFields;
/*     */   protected Map<Method, SynapseXPath> afterMethods;
/*     */   
/*     */   public boolean mediate(MessageContext synCtx) {
/*  48 */     boolean traceOn = isTraceOn(synCtx);
/*  49 */     boolean traceOrDebugOn = isTraceOrDebugOn(traceOn);
/*     */     
/*  51 */     if (traceOrDebugOn) {
/*  52 */       traceOrDebug(traceOn, ""Start : POJOCommand mediator"");
/*     */       
/*  54 */       if (traceOn && trace.isTraceEnabled()) {
/*  55 */         trace.trace(""Message : "" + synCtx.getEnvelope());
/*     */       }
/*     */     } 
/*     */     
/*  59 */     if (traceOrDebugOn) {
/*  60 */       traceOrDebug(traceOn, ""Creating a new instance of POJO class : "" + getCommand().getClass());
/*     */     }
/*     */     
/*  63 */     Object commandObject = null;
/*     */     
/*     */     try {
/*  66 */       commandObject = getCommand().newInstance();
/*  67 */     } catch (Exception e) {
/*  68 */       handleException(""Error creating an instance of the POJO command class : "" + getCommand().getClass(), e, synCtx);
/*     */     } 
/*     */ 
/*     */     
/*  72 */     if (traceOrDebugOn) {
/*  73 */       traceOrDebug(traceOn, ""Instance created, setting static and dynamic properties"");
/*     */     }
/*     */ 
/*     */     
/*  77 */     for (Iterator<String> iter = getStaticSetterProperties().keySet().iterator(); iter.hasNext(); ) {
/*  78 */       String name = iter.next();
/*  79 */       setInstanceProperty(name, getStaticSetterProperties().get(name), commandObject, synCtx);
/*     */     } 
/*     */ 
/*     */     
/*  83 */     for (Field f : this.beforeFields.keySet()) {
/*  84 */       Object v; SynapseXPath xpath = this.beforeFields.get(f);
/*     */       
/*  86 */       if (f.getType().equals(String.class)) {
/*  87 */         v = xpath.stringValueOf(synCtx);
/*     */       } else {
/*  89 */         throw new UnsupportedOperationException(""non-String types not supportted yet"");
/*     */       } 
/*     */       try {
/*  92 */         f.set(commandObject, v);
/*  93 */       } catch (Exception e) {
/*  94 */         e.printStackTrace();
/*     */       } 
/*     */     } 
/*     */     
/*  98 */     for (Method m : this.beforeMethods.keySet()) {
/*  99 */       Object v; SynapseXPath xpath = this.beforeMethods.get(m);
/*     */       
/* 101 */       if ((m.getParameterTypes()).length == 1 && m.getParameterTypes()[0].equals(String.class)) {
/* 102 */         v = xpath.stringValueOf(synCtx);
/*     */       } else {
/* 104 */         throw new UnsupportedOperationException(""non-String types not supportted yet"");
/*     */       } 
/*     */       try {
/* 107 */         m.invoke(commandObject, new Object[] { v });
/* 108 */       } catch (Exception e) {
/* 109 */         e.printStackTrace();
/*     */       } 
/*     */     } 
/*     */     
/* 113 */     if (traceOrDebugOn) {
/* 114 */       traceOrDebug(traceOn, ""POJO initialized successfully, invoking the execute() method"");
/*     */     }
/*     */ 
/*     */     
/* 118 */     if (commandObject instanceof Command) {
/*     */       try {
/* 120 */         ((Command)commandObject).execute();
/* 121 */       } catch (Exception e) {
/* 122 */         handleException(""Error invoking POJO command class : "" + getCommand().getClass(), e, synCtx);
/*     */       }
/*     */     
/*     */     }
/*     */     else {
/*     */       
/* 128 */       Method exeMethod = null;
/*     */       try {
/* 130 */         exeMethod = getCommand().getMethod(""execute"", new Class[0]);
/* 131 */         exeMethod.invoke(commandObject, new Object[0]);
/* 132 */       } catch (NoSuchMethodException e) {
/* 133 */         handleException(""Cannot locate an execute() method on POJO class : "" + getCommand().getClass(), e, synCtx);
/*     */       }
/* 135 */       catch (Exception e) {
/* 136 */         handleException(""Error invoking the execute() method on POJO class : "" + getCommand().getClass(), e, synCtx);
/*     */       } 
/*     */     } 
/*     */ 
/*     */ 
/*     */ 
/*     */     
/* 143 */     if (traceOrDebugOn) {
/* 144 */       traceOrDebug(traceOn, ""End : POJOCommand mediator"");
/*     */     }
/* 146 */     return true;
/*     */   }
/*     */ 
/*     */   
/*     */   public void setCommand(Class<?> commandClass) {
/* 151 */     super.setCommand(commandClass);
/* 152 */     introspectClass(commandClass);
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   protected void introspectClass(Class<?> commandClass) {
/* 160 */     this.beforeFields = new HashMap<Field, SynapseXPath>();
/* 161 */     this.afterFields = new HashMap<Field, SynapseXPath>();
/* 162 */     this.beforeMethods = new HashMap<Method, SynapseXPath>();
/* 163 */     this.afterMethods = new HashMap<Method, SynapseXPath>();
/*     */     
/* 165 */     for (Field f : commandClass.getDeclaredFields()) {
/*     */       
/* 167 */       ReadFromMessage readFromMessage = f.getAnnotation(ReadFromMessage.class);
/* 168 */       if (readFromMessage != null) {
/* 169 */         SynapseXPath axiomXpath = createSynapseXPATH(readFromMessage.value(), f.getAnnotation(Namespaces.class));
/* 170 */         this.beforeFields.put(f, axiomXpath);
/*     */       } 
/*     */       
/* 173 */       UpdateMessage updateMessage = f.getAnnotation(UpdateMessage.class);
/* 174 */       if (updateMessage != null) {
/* 175 */         SynapseXPath axiomXpath = createSynapseXPATH(updateMessage.value(), f.getAnnotation(Namespaces.class));
/* 176 */         this.afterFields.put(f, axiomXpath);
/*     */       } 
/*     */       
/* 179 */       ReadAndUpdate readAndUpdate = f.getAnnotation(ReadAndUpdate.class);
/* 180 */       if (readAndUpdate != null) {
/* 181 */         SynapseXPath axiomXpath = createSynapseXPATH(readAndUpdate.value(), f.getAnnotation(Namespaces.class));
/* 182 */         this.beforeFields.put(f, axiomXpath);
/* 183 */         this.afterFields.put(f, axiomXpath);
/*     */       } 
/*     */     } 
/*     */     
/* 187 */     for (Method m : commandClass.getDeclaredMethods()) {
/*     */       
/* 189 */       ReadFromMessage readFromMessage = m.getAnnotation(ReadFromMessage.class);
/* 190 */       if (readFromMessage != null) {
/* 191 */         SynapseXPath axiomXpath = createSynapseXPATH(readFromMessage.value(), m.getAnnotation(Namespaces.class));
/* 192 */         this.beforeMethods.put(m, axiomXpath);
/*     */       } 
/*     */       
/* 195 */       UpdateMessage updateMessage = m.getAnnotation(UpdateMessage.class);
/* 196 */       if (updateMessage != null) {
/* 197 */         SynapseXPath axiomXpath = createSynapseXPATH(updateMessage.value(), m.getAnnotation(Namespaces.class));
/* 198 */         this.afterMethods.put(m, axiomXpath);
/*     */       } 
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   protected SynapseXPath createSynapseXPATH(String xpath, Namespaces nsAnnotation) {
/* 209 */     Map<String, String> namespaces = getNamespaces(nsAnnotation);
/*     */     
/*     */     try {
/* 212 */       SynapseXPath axiomXPath = new SynapseXPath(xpath);
/*     */       
/* 214 */       for (String prefix : namespaces.keySet()) {
/* 215 */         axiomXPath.addNamespace(prefix, namespaces.get(prefix));
/*     */       }
/*     */       
/* 218 */       return axiomXPath;
/*     */     }
/* 220 */     catch (JaxenException e) {
/* 221 */       throw new RuntimeException(""Error creating SynapseXPath: "" + xpath, (Throwable)e);
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   protected Map<String, String> getNamespaces(Namespaces namespaces) {
/* 230 */     Map<String, String> allNamespaces = new HashMap<String, String>();
/*     */     
/* 232 */     Namespaces defaultNamespaces = (Namespaces)getCommand().getAnnotation(Namespaces.class);
/*     */ 
/*     */     
/* 235 */     if (defaultNamespaces != null) {
/* 236 */       for (String namespaceValue : defaultNamespaces.value()) {
/* 237 */         int i = namespaceValue.indexOf(':');
/* 238 */         if (i > 0) {
/* 239 */           String prefix = namespaceValue.substring(0, i);
/* 240 */           String namespace = namespaceValue.substring(i + 1);
/* 241 */           allNamespaces.put(prefix, namespace);
/*     */         } 
/*     */       } 
/*     */     }
/*     */ 
/*     */     
/* 247 */     if (namespaces != null) {
/* 248 */       for (String namespaceValue : namespaces.value()) {
/* 249 */         int i = namespaceValue.indexOf(':');
/* 250 */         if (i > 0) {
/* 251 */           String prefix = namespaceValue.substring(0, i);
/* 252 */           String namespace = namespaceValue.substring(i + 1);
/* 253 */           allNamespaces.put(prefix, namespace);
/*     */         } 
/*     */       } 
/*     */     }
/* 257 */     return allNamespaces;
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\mediators\ext\AnnotatedCommandMediator.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.mediators.ext.ClassMediator,"/*     */ package org.apache.synapse.mediators.ext;
/*     */ 
/*     */ import java.util.HashMap;
/*     */ import java.util.Map;
/*     */ import org.apache.synapse.ManagedLifecycle;
/*     */ import org.apache.synapse.Mediator;
/*     */ import org.apache.synapse.MessageContext;
/*     */ import org.apache.synapse.SynapseException;
/*     */ import org.apache.synapse.core.SynapseEnvironment;
/*     */ import org.apache.synapse.mediators.AbstractMediator;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class ClassMediator
/*     */   extends AbstractMediator
/*     */   implements ManagedLifecycle
/*     */ {
/*  46 */   private Mediator mediator = null;
/*     */   
/*  48 */   private Map<String, Object> properties = new HashMap<String, Object>();
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public boolean mediate(MessageContext synCtx) {
/*  60 */     boolean result, traceOn = isTraceOn(synCtx);
/*  61 */     boolean traceOrDebugOn = isTraceOrDebugOn(traceOn);
/*     */     
/*  63 */     if (traceOrDebugOn) {
/*  64 */       traceOrDebug(traceOn, ""Start : Class mediator"");
/*     */       
/*  66 */       if (traceOn && trace.isTraceEnabled()) {
/*  67 */         trace.trace(""Message : "" + synCtx.getEnvelope());
/*     */       }
/*     */     } 
/*     */     
/*  71 */     if (traceOrDebugOn) {
/*  72 */       traceOrDebug(traceOn, ""invoking : "" + this.mediator.getClass() + "".mediate()"");
/*     */     }
/*     */ 
/*     */ 
/*     */     
/*     */     try {
/*  78 */       result = this.mediator.mediate(synCtx);
/*  79 */     } catch (Exception e) {
/*     */ 
/*     */       
/*  82 */       throw new SynapseException(""Error occured in the mediation of the class mediator"", e);
/*     */     } 
/*     */     
/*  85 */     if (traceOrDebugOn) {
/*  86 */       traceOrDebug(traceOn, ""End : Class mediator"");
/*     */     }
/*     */     
/*  89 */     return result;
/*     */   }
/*     */   
/*     */   public void destroy() {
/*  93 */     if (this.log.isDebugEnabled()) {
/*  94 */       this.log.debug(""Destroying class mediator instance for : "" + this.mediator.getClass());
/*     */     }
/*  96 */     if (this.mediator instanceof ManagedLifecycle) {
/*  97 */       ((ManagedLifecycle)this.mediator).destroy();
/*     */     }
/*     */   }
/*     */   
/*     */   public void init(SynapseEnvironment se) {
/* 102 */     if (this.log.isDebugEnabled()) {
/* 103 */       this.log.debug(""Initializing class mediator instance for : "" + this.mediator.getClass());
/*     */     }
/* 105 */     if (this.mediator == null) {
/* 106 */       this.log.warn(""init() called before mediator reference set"");
/*     */       
/*     */       return;
/*     */     } 
/* 110 */     if (this.mediator instanceof ManagedLifecycle) {
/* 111 */       ((ManagedLifecycle)this.mediator).init(se);
/*     */     }
/*     */   }
/*     */ 
/*     */   
/* 116 */   public void setMediator(Mediator mediator) { this.mediator = mediator; }
/*     */ 
/*     */ 
/*     */   
/* 120 */   public Mediator getMediator() { return this.mediator; }
/*     */ 
/*     */ 
/*     */   
/* 124 */   public void addProperty(String name, Object value) { this.properties.put(name, value); }
/*     */ 
/*     */ 
/*     */   
/* 128 */   public Map getProperties() { return this.properties; }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\mediators\ext\ClassMediator.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.mediators.ext.POJOCommandMediator,"/*     */ package org.apache.synapse.mediators.ext;
/*     */ 
/*     */ import java.lang.reflect.InvocationTargetException;
/*     */ import java.lang.reflect.Method;
/*     */ import java.util.HashMap;
/*     */ import java.util.List;
/*     */ import java.util.Map;
/*     */ import org.apache.axiom.om.OMAbstractFactory;
/*     */ import org.apache.axiom.om.OMElement;
/*     */ import org.apache.axiom.om.OMNode;
/*     */ import org.apache.synapse.Command;
/*     */ import org.apache.synapse.MessageContext;
/*     */ import org.apache.synapse.mediators.AbstractMediator;
/*     */ import org.apache.synapse.mediators.eip.EIPUtils;
/*     */ import org.apache.synapse.util.xpath.SynapseXPath;
/*     */ import org.jaxen.JaxenException;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class POJOCommandMediator
/*     */   extends AbstractMediator
/*     */ {
/*  51 */   private Class command = null;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  57 */   private Map<String, Object> staticSetterProperties = new HashMap<String, Object>();
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  63 */   private Map<String, SynapseXPath> messageSetterProperties = new HashMap<String, SynapseXPath>();
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  69 */   private Map<String, String> contextSetterProperties = new HashMap<String, String>();
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  75 */   private Map<String, String> contextGetterProperties = new HashMap<String, String>();
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  81 */   private Map<String, SynapseXPath> messageGetterProperties = new HashMap<String, SynapseXPath>();
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public boolean mediate(MessageContext synCtx) {
/*  93 */     boolean traceOn = isTraceOn(synCtx);
/*  94 */     boolean traceOrDebugOn = isTraceOrDebugOn(traceOn);
/*     */     
/*  96 */     if (traceOrDebugOn) {
/*  97 */       traceOrDebug(traceOn, ""Start : POJOCommand mediator"");
/*     */       
/*  99 */       if (traceOn && trace.isTraceEnabled()) {
/* 100 */         trace.trace(""Message : "" + synCtx.getEnvelope());
/*     */       }
/*     */     } 
/*     */     
/* 104 */     if (traceOrDebugOn) {
/* 105 */       traceOrDebug(traceOn, ""Creating a new instance of POJO class : "" + this.command.getClass());
/*     */     }
/*     */     
/* 108 */     Object commandObject = null;
/*     */     
/*     */     try {
/* 111 */       commandObject = this.command.newInstance();
/* 112 */     } catch (Exception e) {
/* 113 */       handleException(""Error creating an instance of the POJO command class : "" + this.command.getClass(), e, synCtx);
/*     */     } 
/*     */ 
/*     */     
/* 117 */     if (traceOrDebugOn) {
/* 118 */       traceOrDebug(traceOn, ""Instance created, setting static and dynamic properties"");
/*     */     }
/*     */ 
/*     */     
/* 122 */     for (String name : this.staticSetterProperties.keySet()) {
/* 123 */       setInstanceProperty(name, this.staticSetterProperties.get(name), commandObject, synCtx);
/*     */     }
/*     */ 
/*     */     
/* 127 */     for (String name : this.contextSetterProperties.keySet()) {
/* 128 */       setInstanceProperty(name, synCtx.getProperty(this.contextSetterProperties.get(name)), commandObject, synCtx);
/*     */     }
/*     */ 
/*     */ 
/*     */     
/* 133 */     for (String name : this.messageSetterProperties.keySet()) {
/* 134 */       SynapseXPath xpath = this.messageSetterProperties.get(name);
/* 135 */       String value = xpath.stringValueOf(synCtx);
/*     */       
/* 137 */       setInstanceProperty(name, value, commandObject, synCtx);
/*     */     } 
/*     */     
/* 140 */     if (traceOrDebugOn) {
/* 141 */       traceOrDebug(traceOn, ""POJO initialized successfully, invoking the execute() method"");
/*     */     }
/*     */ 
/*     */     
/* 145 */     if (commandObject instanceof Command) {
/*     */       try {
/* 147 */         ((Command)commandObject).execute();
/* 148 */       } catch (Exception e) {
/* 149 */         handleException(""Error invoking POJO command class : "" + this.command.getClass(), e, synCtx);
/*     */       }
/*     */     
/*     */     }
/*     */     else {
/*     */       
/* 155 */       Method exeMethod = null;
/*     */       try {
/* 157 */         exeMethod = this.command.getMethod(""execute"", new Class[0]);
/* 158 */         exeMethod.invoke(commandObject, new Object[0]);
/* 159 */       } catch (NoSuchMethodException e) {
/* 160 */         handleException(""Cannot locate an execute() method on POJO class : "" + this.command.getClass(), e, synCtx);
/*     */       }
/* 162 */       catch (Exception e) {
/* 163 */         handleException(""Error invoking the execute() method on POJO class : "" + this.command.getClass(), e, synCtx);
/*     */       } 
/*     */     } 
/*     */ 
/*     */ 
/*     */     
/* 169 */     for (String name : this.contextGetterProperties.keySet()) {
/* 170 */       synCtx.setProperty(this.contextGetterProperties.get(name), getInstanceProperty(name, commandObject, synCtx));
/*     */     }
/*     */ 
/*     */ 
/*     */ 
/*     */     
/* 176 */     for (String name : this.messageGetterProperties.keySet()) {
/* 177 */       SynapseXPath xpath = this.messageGetterProperties.get(name);
/*     */       
/* 179 */       Object resultValue = getInstanceProperty(name, commandObject, synCtx);
/*     */       
/*     */       try {
/* 182 */         List list = EIPUtils.getMatchingElements(synCtx.getEnvelope(), xpath);
/* 183 */         if (list.size() > 0) {
/* 184 */           Object o = list.get(0);
/* 185 */           if (resultValue instanceof String) {
/* 186 */             OMAbstractFactory.getOMFactory().createOMText(((OMNode)o).getParent(), (String)resultValue);
/*     */             
/* 188 */             ((OMNode)o).detach(); continue;
/* 189 */           }  if (resultValue instanceof OMNode) {
/* 190 */             ((OMNode)o).insertSiblingAfter((OMNode)resultValue);
/* 191 */             ((OMNode)o).detach();
/*     */           } 
/*     */           continue;
/*     */         } 
/* 195 */         if (traceOrDebugOn) {
/* 196 */           traceOrDebug(traceOn, ""Unable to set the message property "" + resultValue + ""back to the message : Specified element by the xpath "" + xpath + "" can not be found"");
/*     */         
/*     */         }
/*     */       
/*     */       }
/* 201 */       catch (JaxenException e) {
/* 202 */         handleException(""Unable to set the command property "" + name + "" back to the message"", (Exception)e, synCtx);
/*     */       } 
/*     */     } 
/*     */ 
/*     */     
/* 207 */     if (traceOrDebugOn) {
/* 208 */       traceOrDebug(traceOn, ""End : POJOCommand mediator"");
/*     */     }
/* 210 */     return true;
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   private Object getInstanceProperty(String name, Object obj, MessageContext synCtx) {
/* 224 */     String mName = ""get"" + Character.toUpperCase(name.charAt(0)) + name.substring(1);
/*     */     try {
/* 226 */       Method[] methods = obj.getClass().getMethods();
/*     */       
/* 228 */       for (Method method : methods) {
/* 229 */         if (mName.equals(method.getName())) {
/* 230 */           return method.invoke(obj, new Object[0]);
/*     */         }
/*     */       } 
/* 233 */     } catch (InvocationTargetException e) {
/* 234 */       handleException(""Unable to get the command property '"" + name + ""' back to the message"", e, synCtx);
/*     */     }
/* 236 */     catch (IllegalAccessException e) {
/* 237 */       handleException(""Unable to get the command property '"" + name + ""' back to the message"", e, synCtx);
/*     */     } 
/*     */ 
/*     */     
/* 241 */     return null;
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   protected void setInstanceProperty(String name, Object value, Object obj, MessageContext synCtx) {
/* 256 */     String mName = ""set"" + Character.toUpperCase(name.charAt(0)) + name.substring(1);
/* 257 */     Method method = null;
/*     */     
/*     */     try {
/* 260 */       Method[] methods = obj.getClass().getMethods();
/* 261 */       boolean invoked = false;
/*     */       
/* 263 */       for (int i = 0; i < methods.length; i++) {
/* 264 */         if (mName.equals(methods[i].getName())) {
/* 265 */           Class[] params = methods[i].getParameterTypes();
/* 266 */           if (params.length != 1) {
/* 267 */             handleException(""Did not find a setter method named : "" + mName + ""() that takes a single String, int, long, float, double "" + ""or boolean or OMElement parameter"", synCtx);
/*     */           
/*     */           }
/* 270 */           else if (value instanceof String) {
/* 271 */             if (params[0].equals(String.class)) {
/* 272 */               method = obj.getClass().getMethod(mName, new Class[] { String.class });
/* 273 */               method.invoke(obj, (Object[])new String[] { (String)value });
/* 274 */             } else if (params[0].equals(int.class)) {
/* 275 */               method = obj.getClass().getMethod(mName, new Class[] { int.class });
/* 276 */               method.invoke(obj, (Object[])new Integer[] { new Integer((String)value) });
/* 277 */             } else if (params[0].equals(long.class)) {
/* 278 */               method = obj.getClass().getMethod(mName, new Class[] { long.class });
/* 279 */               method.invoke(obj, (Object[])new Long[] { new Long((String)value) });
/* 280 */             } else if (params[0].equals(float.class)) {
/* 281 */               method = obj.getClass().getMethod(mName, new Class[] { float.class });
/* 282 */               method.invoke(obj, (Object[])new Float[] { new Float((String)value) });
/* 283 */             } else if (params[0].equals(double.class)) {
/* 284 */               method = obj.getClass().getMethod(mName, new Class[] { double.class });
/* 285 */               method.invoke(obj, (Object[])new Double[] { new Double((String)value) });
/* 286 */             } else if (params[0].equals(boolean.class)) {
/* 287 */               method = obj.getClass().getMethod(mName, new Class[] { boolean.class });
/* 288 */               method.invoke(obj, (Object[])new Boolean[] { new Boolean((String)value) });
/*     */             } else {
/* 290 */               handleException(""Did not find a setter method named : "" + mName + ""() that takes a single String, int, long, float, double "" + ""or boolean parameter"", synCtx);
/*     */             }
/*     */           
/*     */           }
/* 294 */           else if (value instanceof OMElement) {
/* 295 */             if (params[0].equals(OMElement.class)) {
/* 296 */               method = obj.getClass().getMethod(mName, new Class[] { OMElement.class });
/* 297 */               method.invoke(obj, (Object[])new OMElement[] { (OMElement)value });
/*     */             } else {
/* 299 */               handleException(""Did not find a setter method named : "" + mName + ""() that takes an OMElement as the parameter"", synCtx);
/*     */             } 
/*     */           } else {
/*     */             
/* 303 */             handleException(""Can not handle the value type : "" + value.getClass(), synCtx);
/*     */           } 
/*     */           
/* 306 */           invoked = true;
/*     */         } 
/*     */       } 
/*     */       
/* 310 */       if (!invoked) {
/* 311 */         handleException(""Did not find a setter method named : "" + mName + ""() that takes a single String, int, long, float, double "" + ""or boolean parameter"", synCtx);
/*     */       
/*     */       }
/*     */     
/*     */     }
/* 316 */     catch (Exception e) {
/* 317 */       handleException(""Error invoking setter method named : "" + mName + ""() that takes a single String, int, long, float, double "" + ""or boolean parameter"", e, synCtx);
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 324 */   public Class getCommand() { return this.command; }
/*     */ 
/*     */ 
/*     */   
/* 328 */   public void setCommand(Class command) { this.command = command; }
/*     */ 
/*     */ 
/*     */   
/* 332 */   public void addStaticSetterProperty(String name, Object value) { this.staticSetterProperties.put(name, value); }
/*     */ 
/*     */ 
/*     */   
/* 336 */   public void addMessageSetterProperty(String name, SynapseXPath xpath) { this.messageSetterProperties.put(name, xpath); }
/*     */ 
/*     */ 
/*     */   
/* 340 */   public void addContextSetterProperty(String name, String ctxName) { this.contextSetterProperties.put(name, ctxName); }
/*     */ 
/*     */ 
/*     */   
/* 344 */   public void addContextGetterProperty(String name, String value) { this.contextGetterProperties.put(name, value); }
/*     */ 
/*     */ 
/*     */   
/* 348 */   public void addMessageGetterProperty(String name, SynapseXPath xpath) { this.messageGetterProperties.put(name, xpath); }
/*     */ 
/*     */ 
/*     */   
/* 352 */   public Map<String, Object> getStaticSetterProperties() { return this.staticSetterProperties; }
/*     */ 
/*     */ 
/*     */   
/* 356 */   public Map<String, SynapseXPath> getMessageSetterProperties() { return this.messageSetterProperties; }
/*     */ 
/*     */ 
/*     */   
/* 360 */   public Map<String, String> getContextSetterProperties() { return this.contextSetterProperties; }
/*     */ 
/*     */ 
/*     */   
/* 364 */   public Map<String, String> getContextGetterProperties() { return this.contextGetterProperties; }
/*     */ 
/*     */ 
/*     */   
/* 368 */   public Map<String, SynapseXPath> getMessageGetterProperties() { return this.messageGetterProperties; }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\mediators\ext\POJOCommandMediator.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.mediators.filters.FilterMediator,"/*     */ package org.apache.synapse.mediators.filters;
/*     */ 
/*     */ import java.util.regex.Matcher;
/*     */ import java.util.regex.Pattern;
/*     */ import org.apache.synapse.Mediator;
/*     */ import org.apache.synapse.MessageContext;
/*     */ import org.apache.synapse.mediators.AbstractListMediator;
/*     */ import org.apache.synapse.mediators.FilterMediator;
/*     */ import org.apache.synapse.mediators.ListMediator;
/*     */ import org.apache.synapse.util.xpath.SynapseXPath;
/*     */ import org.jaxen.JaxenException;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class FilterMediator
/*     */   extends AbstractListMediator
/*     */   implements FilterMediator
/*     */ {
/*  39 */   private SynapseXPath source = null;
/*  40 */   private Pattern regex = null;
/*  41 */   private SynapseXPath xpath = null;
/*  42 */   private ListMediator elseMediator = null;
/*     */   private boolean thenElementPresent = false;
/*  44 */   private String thenKey = null;
/*  45 */   private String elseKey = null;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public boolean mediate(MessageContext synCtx) {
/*  55 */     boolean traceOn = isTraceOn(synCtx);
/*  56 */     boolean traceOrDebugOn = isTraceOrDebugOn(traceOn);
/*     */     
/*  58 */     if (traceOrDebugOn) {
/*  59 */       traceOrDebug(traceOn, ""Start : Filter mediator"");
/*     */       
/*  61 */       if (traceOn && trace.isTraceEnabled()) {
/*  62 */         trace.trace(""Message : "" + synCtx.getEnvelope());
/*     */       }
/*     */     } 
/*     */     
/*  66 */     boolean result = false;
/*  67 */     if (test(synCtx)) {
/*     */       
/*  69 */       if (this.thenKey != null)
/*     */       {
/*  71 */         if (traceOrDebugOn) {
/*  72 */           traceOrDebug(traceOn, ((this.xpath == null) ? (""Source : "" + this.source + "" against : "" + this.regex.pattern() + "" matches"") : (""XPath expression : "" + this.xpath + "" evaluates to true"")) + "" - executing then sequence with key : "" + this.thenKey);
/*     */         }
/*     */ 
/*     */ 
/*     */ 
/*     */         
/*  78 */         Mediator seq = synCtx.getSequence(this.thenKey);
/*  79 */         if (seq != null) {
/*  80 */           result = seq.mediate(synCtx);
/*     */         } else {
/*  82 */           handleException(""Couldn't find the referred then sequence with key : "" + this.thenKey, synCtx);
/*     */         }
/*     */       
/*     */       }
/*     */       else
/*     */       {
/*  88 */         if (traceOrDebugOn) {
/*  89 */           traceOrDebug(traceOn, ((this.xpath == null) ? (""Source : "" + this.source + "" against : "" + this.regex.pattern() + "" matches"") : (""XPath expression : "" + this.xpath + "" evaluates to true"")) + "" - executing child mediators"");
/*     */         }
/*     */ 
/*     */ 
/*     */ 
/*     */         
/*  95 */         result = super.mediate(synCtx);
/*     */       
/*     */       }
/*     */     
/*     */     }
/* 100 */     else if (this.elseKey != null) {
/*     */       
/* 102 */       if (traceOrDebugOn) {
/* 103 */         traceOrDebug(traceOn, ((this.xpath == null) ? (""Source : "" + this.source + "" against : "" + this.regex.pattern() + "" does not match"") : (""XPath expression : "" + this.xpath + "" evaluates to false"")) + "" - executing the else sequence with key : "" + this.elseKey);
/*     */       }
/*     */ 
/*     */ 
/*     */ 
/*     */       
/* 109 */       Mediator elseSeq = synCtx.getSequence(this.elseKey);
/*     */       
/* 111 */       if (elseSeq != null) {
/* 112 */         result = elseSeq.mediate(synCtx);
/*     */       } else {
/* 114 */         handleException(""Couldn't find the referred else sequence with key : "" + this.elseKey, synCtx);
/*     */       }
/*     */     
/*     */     }
/* 118 */     else if (this.elseMediator != null) {
/*     */       
/* 120 */       if (traceOrDebugOn) {
/* 121 */         traceOrDebug(traceOn, ((this.xpath == null) ? (""Source : "" + this.source + "" against : "" + this.regex.pattern() + "" does not match"") : (""XPath expression : "" + this.xpath + "" evaluates to false"")) + "" - executing the else path child mediators"");
/*     */       }
/*     */ 
/*     */ 
/*     */       
/* 126 */       result = this.elseMediator.mediate(synCtx);
/*     */     }
/*     */     else {
/*     */       
/* 130 */       if (traceOrDebugOn) {
/* 131 */         traceOrDebug(traceOn, ((this.xpath == null) ? (""Source : "" + this.source + "" against : "" + this.regex.pattern() + "" does not match"") : (""XPath expression : "" + this.xpath + "" evaluates to false and no else path"")) + "" - skipping child mediators"");
/*     */       }
/*     */ 
/*     */ 
/*     */       
/* 136 */       result = true;
/*     */     } 
/*     */ 
/*     */     
/* 140 */     if (traceOrDebugOn) {
/* 141 */       trace.trace(""End : Filter mediator "");
/*     */     }
/* 143 */     return result;
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public boolean test(MessageContext synCtx) {
/* 157 */     boolean traceOn = isTraceOn(synCtx);
/* 158 */     boolean traceOrDebugOn = isTraceOrDebugOn(traceOn);
/*     */     
/* 160 */     if (this.xpath != null) {
/*     */       try {
/* 162 */         return this.xpath.booleanValueOf(synCtx);
/* 163 */       } catch (JaxenException e) {
/* 164 */         handleException(""Error evaluating XPath expression : "" + this.xpath, (Exception)e, synCtx);
/*     */       }
/*     */     
/* 167 */     } else if (this.source != null && this.regex != null) {
/* 168 */       String sourceString = this.source.stringValueOf(synCtx);
/* 169 */       if (sourceString == null) {
/* 170 */         if (traceOrDebugOn) {
/* 171 */           traceOrDebug(traceOn, ""Source String : "" + this.source + "" evaluates to null"");
/*     */         }
/* 173 */         return false;
/*     */       } 
/* 175 */       Matcher matcher = this.regex.matcher(sourceString);
/* 176 */       if (matcher == null) {
/* 177 */         if (traceOrDebugOn) {
/* 178 */           traceOrDebug(traceOn, ""Regex pattren matcher for : "" + this.regex.pattern() + ""against source : "" + sourceString + "" is null"");
/*     */         }
/*     */         
/* 181 */         return false;
/*     */       } 
/* 183 */       return matcher.matches();
/*     */     } 
/*     */     
/* 186 */     return false;
/*     */   }
/*     */ 
/*     */ 
/*     */   
/* 191 */   public SynapseXPath getSource() { return this.source; }
/*     */ 
/*     */ 
/*     */   
/* 195 */   public void setSource(SynapseXPath source) { this.source = source; }
/*     */ 
/*     */ 
/*     */   
/* 199 */   public Pattern getRegex() { return this.regex; }
/*     */ 
/*     */ 
/*     */   
/* 203 */   public void setRegex(Pattern regex) { this.regex = regex; }
/*     */ 
/*     */ 
/*     */   
/* 207 */   public SynapseXPath getXpath() { return this.xpath; }
/*     */ 
/*     */ 
/*     */   
/* 211 */   public void setXpath(SynapseXPath xpath) { this.xpath = xpath; }
/*     */ 
/*     */ 
/*     */   
/* 215 */   public ListMediator getElseMediator() { return this.elseMediator; }
/*     */ 
/*     */ 
/*     */   
/* 219 */   public void setElseMediator(ListMediator elseMediator) { this.elseMediator = elseMediator; }
/*     */ 
/*     */ 
/*     */   
/* 223 */   public boolean isThenElementPresent() { return this.thenElementPresent; }
/*     */ 
/*     */ 
/*     */   
/* 227 */   public void setThenElementPresent(boolean thenElementPresent) { this.thenElementPresent = thenElementPresent; }
/*     */ 
/*     */ 
/*     */   
/* 231 */   public String getThenKey() { return this.thenKey; }
/*     */ 
/*     */ 
/*     */   
/* 235 */   public void setThenKey(String thenKey) { this.thenKey = thenKey; }
/*     */ 
/*     */ 
/*     */   
/* 239 */   public String getElseKey() { return this.elseKey; }
/*     */ 
/*     */ 
/*     */   
/* 243 */   public void setElseKey(String elseKey) { this.elseKey = elseKey; }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\mediators\filters\FilterMediator.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.mediators.filters.InMediator,"/*    */ package org.apache.synapse.mediators.filters;
/*    */ 
/*    */ import org.apache.synapse.MessageContext;
/*    */ import org.apache.synapse.mediators.AbstractListMediator;
/*    */ import org.apache.synapse.mediators.FilterMediator;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class InMediator
/*    */   extends AbstractListMediator
/*    */   implements FilterMediator
/*    */ {
/*    */   public boolean mediate(MessageContext synCtx) {
/* 44 */     boolean traceOn = isTraceOn(synCtx);
/* 45 */     boolean traceOrDebugOn = isTraceOrDebugOn(traceOn);
/*    */     
/* 47 */     if (traceOrDebugOn) {
/* 48 */       traceOrDebug(traceOn, ""Start : In mediator"");
/*    */       
/* 50 */       if (traceOn && trace.isTraceEnabled()) {
/* 51 */         trace.trace(""Message : "" + synCtx.getEnvelope());
/*    */       }
/*    */     } 
/*    */     
/* 55 */     boolean result = true;
/* 56 */     if (test(synCtx)) {
/* 57 */       if (traceOrDebugOn) {
/* 58 */         traceOrDebug(traceOn, ""Current message is incoming - executing child mediators"");
/*    */       }
/* 60 */       result = super.mediate(synCtx);
/*    */     
/*    */     }
/* 63 */     else if (traceOrDebugOn) {
/* 64 */       traceOrDebug(traceOn, ""Current message is a response - skipping child mediators"");
/*    */     } 
/*    */ 
/*    */     
/* 68 */     if (traceOrDebugOn) {
/* 69 */       traceOrDebug(traceOn, ""End : In mediator"");
/*    */     }
/*    */     
/* 72 */     return result;
/*    */   }
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */   
/* 82 */   public boolean test(MessageContext synCtx) { return !synCtx.isResponse(); }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\mediators\filters\InMediator.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.mediators.filters.OutMediator,"/*    */ package org.apache.synapse.mediators.filters;
/*    */ 
/*    */ import org.apache.synapse.MessageContext;
/*    */ import org.apache.synapse.mediators.AbstractListMediator;
/*    */ import org.apache.synapse.mediators.FilterMediator;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class OutMediator
/*    */   extends AbstractListMediator
/*    */   implements FilterMediator
/*    */ {
/*    */   public boolean mediate(MessageContext synCtx) {
/* 44 */     boolean traceOn = isTraceOn(synCtx);
/* 45 */     boolean traceOrDebugOn = isTraceOrDebugOn(traceOn);
/*    */     
/* 47 */     if (traceOrDebugOn) {
/* 48 */       traceOrDebug(traceOn, ""Start : Out mediator"");
/*    */       
/* 50 */       if (traceOn && trace.isTraceEnabled()) {
/* 51 */         trace.trace(""Message : "" + synCtx.getEnvelope());
/*    */       }
/*    */     } 
/*    */     
/* 55 */     boolean result = true;
/* 56 */     if (test(synCtx)) {
/* 57 */       if (traceOrDebugOn) {
/* 58 */         traceOrDebug(traceOn, ""Current message is outgoing - executing child mediators"");
/*    */       }
/* 60 */       result = super.mediate(synCtx);
/*    */     
/*    */     }
/* 63 */     else if (traceOrDebugOn) {
/* 64 */       traceOrDebug(traceOn, ""Current message is a request - skipping child mediators"");
/*    */     } 
/*    */ 
/*    */     
/* 68 */     if (traceOrDebugOn) {
/* 69 */       traceOrDebug(traceOn, ""End : Out mediator"");
/*    */     }
/*    */     
/* 72 */     return result;
/*    */   }
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */   
/* 82 */   public boolean test(MessageContext synCtx) { return synCtx.isResponse(); }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\mediators\filters\OutMediator.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.mediators.filters.SwitchMediator,"/*     */ package org.apache.synapse.mediators.filters;
/*     */ 
/*     */ import java.util.ArrayList;
/*     */ import java.util.Iterator;
/*     */ import java.util.List;
/*     */ import org.apache.synapse.MessageContext;
/*     */ import org.apache.synapse.config.xml.SwitchCase;
/*     */ import org.apache.synapse.mediators.AbstractMediator;
/*     */ import org.apache.synapse.util.xpath.SynapseXPath;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class SwitchMediator
/*     */   extends AbstractMediator
/*     */ {
/*  40 */   private SynapseXPath source = null;
/*     */   
/*  42 */   private List cases = new ArrayList();
/*     */   
/*  44 */   private SwitchCase defaultCase = null;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public boolean mediate(MessageContext synCtx) {
/*  54 */     boolean traceOn = isTraceOn(synCtx);
/*  55 */     boolean traceOrDebugOn = isTraceOrDebugOn(traceOn);
/*     */     
/*  57 */     if (traceOrDebugOn) {
/*  58 */       traceOrDebug(traceOn, ""Start : Switch mediator"");
/*     */       
/*  60 */       if (traceOn && trace.isTraceEnabled()) {
/*  61 */         trace.trace(""Message : "" + synCtx.getEnvelope());
/*     */       }
/*     */     } 
/*     */     
/*  65 */     int parentsEffectiveTraceState = synCtx.getTracingState();
/*     */ 
/*     */     
/*  68 */     setEffectiveTraceState(synCtx);
/*  69 */     int myEffectiveTraceState = synCtx.getTracingState();
/*     */     
/*  71 */     String sourceText = this.source.stringValueOf(synCtx);
/*  72 */     if (traceOrDebugOn) {
/*  73 */       traceOrDebug(traceOn, ""XPath : "" + this.source + "" evaluates to : "" + sourceText);
/*     */     }
/*     */     
/*     */     try {
/*  77 */       if ((sourceText == null || this.cases.isEmpty()) && this.defaultCase != null) {
/*  78 */         if (traceOrDebugOn) {
/*  79 */           traceOrDebug(traceOn, ""Source XPath evaluated to : null or no switch cases found. Executing the default case"");
/*     */         }
/*     */ 
/*     */         
/*  83 */         return this.defaultCase.mediate(synCtx);
/*     */       } 
/*     */       
/*  86 */       for (Iterator<SwitchCase> iter = this.cases.iterator(); iter.hasNext(); ) {
/*  87 */         SwitchCase swCase = iter.next();
/*     */         
/*  89 */         if (swCase != null && 
/*  90 */           swCase.matches(sourceText)) {
/*  91 */           if (traceOrDebugOn) {
/*  92 */             traceOrDebug(traceOn, ""Matching case found : "" + swCase.getRegex());
/*     */           }
/*  94 */           return swCase.mediate(synCtx);
/*     */         } 
/*     */       } 
/*     */ 
/*     */       
/*  99 */       if (this.defaultCase != null) {
/*     */         
/* 101 */         if (traceOrDebugOn) {
/* 102 */           traceOrDebug(traceOn, ""None of the switch cases matched - executing default"");
/*     */         }
/* 104 */         return this.defaultCase.mediate(synCtx);
/*     */       } 
/* 106 */       if (traceOrDebugOn) {
/* 107 */         traceOrDebug(traceOn, ""None of the switch cases matched - no default case"");
/*     */       
/*     */       }
/*     */     }
/*     */     finally {
/*     */       
/* 113 */       synCtx.setTracingState(parentsEffectiveTraceState);
/*     */     } 
/*     */     
/* 116 */     if (traceOrDebugOn) {
/* 117 */       traceOrDebug(traceOn, ""End : Switch mediator"");
/*     */     }
/* 119 */     return true;
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 129 */   public void addCase(SwitchCase m) { this.cases.add(m); }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 138 */   public List getCases() { return this.cases; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 147 */   public SynapseXPath getSource() { return this.source; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 156 */   public void setSource(SynapseXPath source) { this.source = source; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 165 */   public SwitchCase getDefaultCase() { return this.defaultCase; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 173 */   public void setDefaultCase(SwitchCase defaultCase) { this.defaultCase = defaultCase; }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\mediators\filters\SwitchMediator.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.mediators.transform.FaultMediator,"/*     */ package org.apache.synapse.mediators.transform;
/*     */ 
/*     */ import java.net.URI;
/*     */ import java.util.Iterator;
/*     */ import javax.xml.namespace.QName;
/*     */ import org.apache.axiom.om.OMAbstractFactory;
/*     */ import org.apache.axiom.om.OMDocument;
/*     */ import org.apache.axiom.om.OMElement;
/*     */ import org.apache.axiom.om.OMFactory;
/*     */ import org.apache.axiom.om.OMNode;
/*     */ import org.apache.axiom.soap.SOAPBody;
/*     */ import org.apache.axiom.soap.SOAPEnvelope;
/*     */ import org.apache.axiom.soap.SOAPFactory;
/*     */ import org.apache.axiom.soap.SOAPFault;
/*     */ import org.apache.axiom.soap.SOAPFaultCode;
/*     */ import org.apache.axiom.soap.SOAPFaultDetail;
/*     */ import org.apache.axiom.soap.SOAPFaultNode;
/*     */ import org.apache.axiom.soap.SOAPFaultReason;
/*     */ import org.apache.axiom.soap.SOAPFaultRole;
/*     */ import org.apache.axiom.soap.SOAPFaultText;
/*     */ import org.apache.axiom.soap.SOAPFaultValue;
/*     */ import org.apache.axiom.soap.SOAPHeader;
/*     */ import org.apache.axiom.soap.SOAPHeaderBlock;
/*     */ import org.apache.axis2.AxisFault;
/*     */ import org.apache.axis2.addressing.RelatesTo;
/*     */ import org.apache.synapse.MessageContext;
/*     */ import org.apache.synapse.SynapseException;
/*     */ import org.apache.synapse.core.axis2.Axis2MessageContext;
/*     */ import org.apache.synapse.mediators.AbstractMediator;
/*     */ import org.apache.synapse.util.xpath.SynapseXPath;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class FaultMediator
/*     */   extends AbstractMediator
/*     */ {
/*     */   public static final String WSA_ACTION = ""Action"";
/*     */   public static final int SOAP11 = 1;
/*     */   public static final int SOAP12 = 2;
/*     */   public static final int POX = 3;
/*     */   private int soapVersion;
/*  64 */   private QName faultCodeValue = null;
/*     */   
/*  66 */   private SynapseXPath faultCodeExpr = null;
/*     */   
/*  68 */   private String faultReasonValue = null;
/*     */   
/*  70 */   private SynapseXPath faultReasonExpr = null;
/*     */   
/*  72 */   private URI faultNode = null;
/*     */   
/*  74 */   private URI faultRole = null;
/*     */   
/*  76 */   private String faultDetail = null;
/*     */   
/*  78 */   private SynapseXPath faultDetailExpr = null;
/*     */ 
/*     */   
/*     */   public boolean mediate(MessageContext synCtx) {
/*  82 */     boolean traceOn = isTraceOn(synCtx);
/*  83 */     boolean traceOrDebugOn = isTraceOrDebugOn(traceOn);
/*     */     
/*  85 */     if (traceOrDebugOn) {
/*  86 */       traceOrDebug(traceOn, ""Start : Fault mediator"");
/*     */       
/*  88 */       if (traceOn && trace.isTraceEnabled()) {
/*  89 */         trace.trace(""Message : "" + synCtx.getEnvelope());
/*     */       }
/*     */     } 
/*     */     
/*  93 */     switch (this.soapVersion) {
/*     */       case 1:
/*  95 */         return makeSOAPFault(synCtx, 1, traceOrDebugOn, traceOn);
/*     */       case 2:
/*  97 */         return makeSOAPFault(synCtx, 2, traceOrDebugOn, traceOn);
/*     */       case 3:
/*  99 */         return makePOXFault(synCtx, traceOrDebugOn, traceOn);
/*     */     } 
/*     */ 
/*     */     
/* 103 */     if (synCtx.isDoingPOX() || synCtx.isDoingGET())
/*     */     {
/* 105 */       return makePOXFault(synCtx, traceOrDebugOn, traceOn);
/*     */     }
/*     */ 
/*     */ 
/*     */     
/* 110 */     SOAPEnvelope envelop = synCtx.getEnvelope();
/* 111 */     if (envelop != null) {
/*     */       
/* 113 */       if (""http://www.w3.org/2003/05/soap-envelope"".equals(envelop.getNamespace().getNamespaceURI())) {
/*     */ 
/*     */         
/* 116 */         this.soapVersion = 2;
/* 117 */         return makeSOAPFault(synCtx, 2, traceOrDebugOn, traceOn);
/*     */       } 
/*     */       
/* 120 */       this.soapVersion = 1;
/* 121 */       return makeSOAPFault(synCtx, 1, traceOrDebugOn, traceOn);
/*     */     } 
/*     */ 
/*     */ 
/*     */     
/* 126 */     return makeSOAPFault(synCtx, 1, traceOrDebugOn, traceOn);
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   private boolean makePOXFault(MessageContext synCtx, boolean traceOrDebugOn, boolean traceOn) {
/* 135 */     OMFactory fac = synCtx.getEnvelope().getOMFactory();
/* 136 */     OMElement faultPayload = fac.createOMElement(new QName(""Exception""));
/*     */     
/* 138 */     if (this.faultDetail != null) {
/*     */       
/* 140 */       if (traceOrDebugOn) {
/* 141 */         traceOrDebug(traceOn, ""Setting the fault detail : "" + this.faultDetail + "" as the POX Fault"");
/*     */       }
/*     */ 
/*     */       
/* 145 */       faultPayload.setText(this.faultDetail);
/*     */     }
/* 147 */     else if (this.faultDetailExpr != null) {
/*     */       
/* 149 */       String faultDetail = this.faultDetailExpr.stringValueOf(synCtx);
/*     */       
/* 151 */       if (traceOrDebugOn) {
/* 152 */         traceOrDebug(traceOn, ""Setting the fault detail : "" + faultDetail + "" as the POX Fault"");
/*     */       }
/*     */ 
/*     */       
/* 156 */       faultPayload.setText(faultDetail);
/*     */     }
/* 158 */     else if (this.faultReasonValue != null) {
/*     */       
/* 160 */       if (traceOrDebugOn) {
/* 161 */         traceOrDebug(traceOn, ""Setting the fault reason : "" + this.faultReasonValue + "" as the POX Fault"");
/*     */       }
/*     */ 
/*     */       
/* 165 */       faultPayload.setText(this.faultReasonValue);
/*     */     }
/* 167 */     else if (this.faultReasonExpr != null) {
/*     */       
/* 169 */       String faultReason = this.faultReasonExpr.stringValueOf(synCtx);
/* 170 */       faultPayload.setText(faultReason);
/*     */       
/* 172 */       if (traceOrDebugOn) {
/* 173 */         traceOrDebug(traceOn, ""Setting the fault reason : "" + faultReason + "" as the POX Fault"");
/*     */       }
/*     */     } 
/*     */ 
/*     */     
/* 178 */     SOAPBody body = synCtx.getEnvelope().getBody();
/* 179 */     if (body != null) {
/*     */       
/* 181 */       if (body.getFirstElement() != null) {
/* 182 */         body.getFirstElement().detach();
/*     */       }
/*     */       
/* 185 */       synCtx.setFaultResponse(true);
/* 186 */       ((Axis2MessageContext)synCtx).getAxis2MessageContext().setProcessingFault(true);
/*     */       
/* 188 */       if (traceOrDebugOn) {
/* 189 */         String msg = ""Original SOAP Message : "" + synCtx.getEnvelope().toString() + ""POXFault Message created : "" + faultPayload.toString();
/*     */         
/* 191 */         if (traceOn && trace.isTraceEnabled()) {
/* 192 */           trace.trace(msg);
/*     */         }
/* 194 */         if (this.log.isTraceEnabled()) {
/* 195 */           this.log.trace(msg);
/*     */         }
/*     */       } 
/*     */       
/* 199 */       body.addChild((OMNode)faultPayload);
/*     */     } 
/*     */     
/* 202 */     return true;
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   private boolean makeSOAPFault(MessageContext synCtx, int soapVersion, boolean traceOrDebugOn, boolean traceOn) {
/* 216 */     if (traceOrDebugOn) {
/* 217 */       traceOrDebug(traceOn, ""Creating a SOAP "" + ((soapVersion == 1) ? ""1.1"" : ""1.2"") + "" fault"");
/*     */     }
/*     */ 
/*     */ 
/*     */     
/* 222 */     SOAPFactory factory = (soapVersion == 1) ? OMAbstractFactory.getSOAP11Factory() : OMAbstractFactory.getSOAP12Factory();
/*     */ 
/*     */ 
/*     */     
/* 226 */     OMDocument soapFaultDocument = factory.createOMDocument();
/* 227 */     SOAPEnvelope faultEnvelope = factory.getDefaultFaultEnvelope();
/* 228 */     soapFaultDocument.addChild((OMNode)faultEnvelope);
/*     */ 
/*     */     
/* 231 */     SOAPFault fault = faultEnvelope.getBody().getFault();
/* 232 */     if (fault == null) {
/* 233 */       fault = factory.createSOAPFault();
/*     */     }
/*     */ 
/*     */     
/* 237 */     setFaultCode(synCtx, factory, fault);
/* 238 */     setFaultResaon(synCtx, factory, fault);
/* 239 */     setFaultNode(factory, fault);
/* 240 */     setFaultRole(factory, fault);
/* 241 */     setFaultDetail(synCtx, factory, fault);
/*     */ 
/*     */     
/* 244 */     if (synCtx.getEnvelope() != null) {
/* 245 */       SOAPHeader soapHeader = synCtx.getEnvelope().getHeader();
/* 246 */       if (soapHeader != null) {
/* 247 */         for (Iterator iter = soapHeader.examineAllHeaderBlocks(); iter.hasNext(); ) {
/* 248 */           Object o = iter.next();
/* 249 */           if (o instanceof SOAPHeaderBlock) {
/* 250 */             SOAPHeaderBlock header = (SOAPHeaderBlock)o;
/* 251 */             faultEnvelope.getHeader().addChild((OMNode)header); continue;
/* 252 */           }  if (o instanceof OMElement) {
/* 253 */             faultEnvelope.getHeader().addChild((OMNode)o);
/*     */           }
/*     */         } 
/*     */       }
/*     */     } 
/*     */     
/* 259 */     if (traceOrDebugOn) {
/* 260 */       String msg = ""Original SOAP Message : "" + synCtx.getEnvelope().toString() + ""Fault Message created : "" + faultEnvelope.toString();
/*     */ 
/*     */       
/* 263 */       if (traceOn && trace.isTraceEnabled()) {
/* 264 */         trace.trace(msg);
/*     */       }
/* 266 */       if (this.log.isTraceEnabled()) {
/* 267 */         this.log.trace(msg);
/*     */       }
/*     */     } 
/*     */ 
/*     */     
/*     */     try {
/* 273 */       synCtx.setEnvelope(faultEnvelope);
/* 274 */     } catch (AxisFault af) {
/* 275 */       handleException(""Error replacing current SOAP envelope with the fault envelope"", (Exception)af, synCtx);
/*     */     } 
/*     */ 
/*     */     
/* 279 */     if (synCtx.getFaultTo() != null) {
/* 280 */       synCtx.setTo(synCtx.getFaultTo());
/* 281 */     } else if (synCtx.getReplyTo() != null) {
/* 282 */       synCtx.setTo(synCtx.getReplyTo());
/*     */     } else {
/* 284 */       synCtx.setTo(null);
/*     */     } 
/*     */ 
/*     */     
/* 288 */     if (synCtx.getMessageID() != null) {
/* 289 */       RelatesTo relatesTo = new RelatesTo(synCtx.getMessageID());
/* 290 */       synCtx.setRelatesTo(new RelatesTo[] { relatesTo });
/*     */     } 
/*     */     
/* 293 */     if (traceOrDebugOn) {
/* 294 */       traceOrDebug(traceOn, ""End : Fault mediator"");
/*     */     }
/*     */     
/* 297 */     return true;
/*     */   }
/*     */   
/*     */   private void setFaultCode(MessageContext synCtx, SOAPFactory factory, SOAPFault fault) {
/*     */     SOAPFaultValue value;
/* 302 */     QName fault_code = null;
/*     */     
/* 304 */     if (this.faultCodeValue == null && this.faultCodeExpr == null) {
/* 305 */       handleException(""A valid fault code QName value or expression is required"", synCtx);
/* 306 */     } else if (this.faultCodeValue != null) {
/* 307 */       fault_code = this.faultCodeValue;
/*     */     } else {
/* 309 */       fault_code = QName.valueOf(this.faultCodeExpr.stringValueOf(synCtx));
/*     */     } 
/*     */     
/* 312 */     SOAPFaultCode code = factory.createSOAPFaultCode();
/* 313 */     switch (this.soapVersion) {
/*     */       case 1:
/* 315 */         code.setText(fault_code);
/*     */         break;
/*     */       case 2:
/* 318 */         value = factory.createSOAPFaultValue(code);
/* 319 */         value.setText(fault_code);
/*     */         break;
/*     */     } 
/* 322 */     fault.setCode(code);
/*     */   }
/*     */   private void setFaultResaon(MessageContext synCtx, SOAPFactory factory, SOAPFault fault) {
/*     */     SOAPFaultText text;
/* 326 */     String reasonString = null;
/*     */     
/* 328 */     if (this.faultReasonValue == null && this.faultReasonExpr == null) {
/* 329 */       handleException(""A valid fault reason value or expression is required"", synCtx);
/* 330 */     } else if (this.faultReasonValue != null) {
/* 331 */       reasonString = this.faultReasonValue;
/*     */     } else {
/* 333 */       reasonString = this.faultReasonExpr.stringValueOf(synCtx);
/*     */     } 
/*     */     
/* 336 */     SOAPFaultReason reason = factory.createSOAPFaultReason();
/* 337 */     switch (this.soapVersion) {
/*     */       case 1:
/* 339 */         reason.setText(reasonString);
/*     */         break;
/*     */       case 2:
/* 342 */         text = factory.createSOAPFaultText();
/* 343 */         text.setText(reasonString);
/* 344 */         reason.addSOAPText(text);
/*     */         break;
/*     */     } 
/* 347 */     fault.setReason(reason);
/*     */   }
/*     */   
/*     */   private void setFaultNode(SOAPFactory factory, SOAPFault fault) {
/* 351 */     if (this.faultNode != null) {
/* 352 */       SOAPFaultNode soapfaultNode = factory.createSOAPFaultNode();
/* 353 */       soapfaultNode.setNodeValue(this.faultNode.toString());
/* 354 */       fault.setNode(soapfaultNode);
/*     */     } 
/*     */   }
/*     */   
/*     */   private void setFaultRole(SOAPFactory factory, SOAPFault fault) {
/* 359 */     if (this.faultRole != null) {
/* 360 */       SOAPFaultRole soapFaultRole = factory.createSOAPFaultRole();
/* 361 */       soapFaultRole.setRoleValue(this.faultRole.toString());
/* 362 */       fault.setRole(soapFaultRole);
/*     */     } 
/*     */   }
/*     */   
/*     */   private void setFaultDetail(MessageContext synCtx, SOAPFactory factory, SOAPFault fault) {
/* 367 */     if (this.faultDetail != null) {
/* 368 */       SOAPFaultDetail soapFaultDetail = factory.createSOAPFaultDetail();
/* 369 */       soapFaultDetail.setText(this.faultDetail);
/* 370 */       fault.setDetail(soapFaultDetail);
/* 371 */     } else if (this.faultDetailExpr != null) {
/* 372 */       SOAPFaultDetail soapFaultDetail = factory.createSOAPFaultDetail();
/* 373 */       soapFaultDetail.setText(this.faultDetailExpr.stringValueOf(synCtx));
/* 374 */       fault.setDetail(soapFaultDetail);
/* 375 */     } else if (fault.getDetail() != null) {
/*     */ 
/*     */       
/* 378 */       fault.getDetail().detach();
/*     */     } 
/*     */   }
/*     */ 
/*     */   
/* 383 */   public int getSoapVersion() { return this.soapVersion; }
/*     */ 
/*     */ 
/*     */   
/* 387 */   public void setSoapVersion(int soapVersion) { this.soapVersion = soapVersion; }
/*     */ 
/*     */ 
/*     */   
/* 391 */   public QName getFaultCodeValue() { return this.faultCodeValue; }
/*     */ 
/*     */ 
/*     */   
/*     */   public void setFaultCodeValue(QName faultCodeValue) {
/* 396 */     if (this.soapVersion == 1) {
/* 397 */       this.faultCodeValue = faultCodeValue;
/*     */     }
/* 399 */     else if (""http://www.w3.org/2003/05/soap-envelope"".equals(faultCodeValue.getNamespaceURI()) && (""DataEncodingUnknown"".equals(faultCodeValue.getLocalPart()) || ""MustUnderstand"".equals(faultCodeValue.getLocalPart()) || ""Receiver"".equals(faultCodeValue.getLocalPart()) || ""Sender"".equals(faultCodeValue.getLocalPart()) || ""VersionMismatch"".equals(faultCodeValue.getLocalPart()))) {
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */       
/* 412 */       this.faultCodeValue = faultCodeValue;
/*     */     } else {
/*     */       
/* 415 */       handleException(""Invalid Fault code value for a SOAP 1.2 fault : "" + faultCodeValue);
/*     */     } 
/*     */   }
/*     */ 
/*     */   
/* 420 */   public SynapseXPath getFaultCodeExpr() { return this.faultCodeExpr; }
/*     */ 
/*     */ 
/*     */   
/* 424 */   public void setFaultCodeExpr(SynapseXPath faultCodeExpr) { this.faultCodeExpr = faultCodeExpr; }
/*     */ 
/*     */ 
/*     */   
/* 428 */   public String getFaultReasonValue() { return this.faultReasonValue; }
/*     */ 
/*     */ 
/*     */   
/* 432 */   public void setFaultReasonValue(String faultReasonValue) { this.faultReasonValue = faultReasonValue; }
/*     */ 
/*     */ 
/*     */   
/* 436 */   public SynapseXPath getFaultReasonExpr() { return this.faultReasonExpr; }
/*     */ 
/*     */ 
/*     */   
/* 440 */   public void setFaultReasonExpr(SynapseXPath faultReasonExpr) { this.faultReasonExpr = faultReasonExpr; }
/*     */ 
/*     */ 
/*     */   
/* 444 */   public URI getFaultNode() { return this.faultNode; }
/*     */ 
/*     */   
/*     */   public void setFaultNode(URI faultNode) {
/* 448 */     if (this.soapVersion == 1) {
/* 449 */       handleException(""A fault node does not apply to a SOAP 1.1 fault"");
/*     */     }
/* 451 */     this.faultNode = faultNode;
/*     */   }
/*     */ 
/*     */   
/* 455 */   public URI getFaultRole() { return this.faultRole; }
/*     */ 
/*     */ 
/*     */   
/* 459 */   public void setFaultRole(URI faultRole) { this.faultRole = faultRole; }
/*     */ 
/*     */ 
/*     */   
/* 463 */   public String getFaultDetail() { return this.faultDetail; }
/*     */ 
/*     */ 
/*     */   
/* 467 */   public void setFaultDetail(String faultDetail) { this.faultDetail = faultDetail; }
/*     */ 
/*     */ 
/*     */   
/* 471 */   public SynapseXPath getFaultDetailExpr() { return this.faultDetailExpr; }
/*     */ 
/*     */ 
/*     */   
/* 475 */   public void setFaultDetailExpr(SynapseXPath faultDetailExpr) { this.faultDetailExpr = faultDetailExpr; }
/*     */ 
/*     */   
/*     */   private void handleException(String msg) {
/* 479 */     this.log.error(msg);
/* 480 */     throw new SynapseException(msg);
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\mediators\transform\FaultMediator.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.mediators.transform.HeaderMediator,"/*     */ package org.apache.synapse.mediators.transform;
/*     */ 
/*     */ import java.util.Iterator;
/*     */ import java.util.List;
/*     */ import javax.xml.namespace.QName;
/*     */ import org.apache.axiom.om.OMElement;
/*     */ import org.apache.axiom.soap.SOAPEnvelope;
/*     */ import org.apache.axiom.soap.SOAPFactory;
/*     */ import org.apache.axiom.soap.SOAPHeader;
/*     */ import org.apache.axiom.soap.SOAPHeaderBlock;
/*     */ import org.apache.axis2.addressing.EndpointReference;
/*     */ import org.apache.axis2.addressing.RelatesTo;
/*     */ import org.apache.synapse.MessageContext;
/*     */ import org.apache.synapse.mediators.AbstractMediator;
/*     */ import org.apache.synapse.util.xpath.SynapseXPath;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class HeaderMediator
/*     */   extends AbstractMediator
/*     */ {
/*     */   public static final int ACTION_SET = 0;
/*     */   public static final int ACTION_REMOVE = 1;
/*  51 */   private QName qName = null;
/*     */   
/*  53 */   private String value = null;
/*     */   
/*  55 */   private int action = 0;
/*     */   
/*  57 */   private SynapseXPath expression = null;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public boolean mediate(MessageContext synCtx) {
/*  67 */     boolean traceOn = isTraceOn(synCtx);
/*  68 */     boolean traceOrDebugOn = isTraceOrDebugOn(traceOn);
/*     */     
/*  70 */     if (traceOrDebugOn) {
/*  71 */       traceOrDebug(traceOn, ""Start : Header mediator"");
/*     */       
/*  73 */       if (traceOn && trace.isTraceEnabled()) {
/*  74 */         trace.trace(""Message : "" + synCtx.getEnvelope());
/*     */       }
/*     */     } 
/*     */     
/*  78 */     if (this.action == 0) {
/*     */       
/*  80 */       String value = (getExpression() == null) ? getValue() : this.expression.stringValueOf(synCtx);
/*     */ 
/*     */       
/*  83 */       if (traceOrDebugOn) {
/*  84 */         traceOrDebug(traceOn, ""Set SOAP header : "" + this.qName + "" to : "" + value);
/*     */       }
/*     */       
/*  87 */       if (this.qName.getNamespaceURI() == null || """".equals(this.qName.getNamespaceURI())) {
/*     */ 
/*     */         
/*  90 */         if (""To"".equals(this.qName.getLocalPart())) {
/*  91 */           synCtx.setTo(new EndpointReference(value));
/*  92 */         } else if (""From"".equals(this.qName.getLocalPart())) {
/*  93 */           synCtx.setFrom(new EndpointReference(value));
/*  94 */         } else if (""Action"".equals(this.qName.getLocalPart())) {
/*  95 */           synCtx.setWSAAction(value);
/*  96 */         } else if (""FaultTo"".equals(this.qName.getLocalPart())) {
/*  97 */           synCtx.setFaultTo(new EndpointReference(value));
/*  98 */         } else if (""ReplyTo"".equals(this.qName.getLocalPart())) {
/*  99 */           synCtx.setReplyTo(new EndpointReference(value));
/* 100 */         } else if (""RelatesTo"".equals(this.qName.getLocalPart())) {
/* 101 */           synCtx.setRelatesTo(new RelatesTo[] { new RelatesTo(value) });
/*     */         } else {
/* 103 */           addCustomHeader(synCtx, value);
/*     */         } 
/*     */       } else {
/* 106 */         addCustomHeader(synCtx, value);
/*     */       }
/*     */     
/*     */     } else {
/*     */       
/* 111 */       if (traceOrDebugOn) {
/* 112 */         traceOrDebug(traceOn, ""Removing SOAP Header : "" + this.qName);
/*     */       }
/*     */       
/* 115 */       if (this.qName.getNamespaceURI() == null || """".equals(this.qName.getNamespaceURI())) {
/*     */ 
/*     */         
/* 118 */         if (""To"".equals(this.qName.getLocalPart())) {
/* 119 */           synCtx.setTo(null);
/* 120 */         } else if (""From"".equals(this.qName.getLocalPart())) {
/* 121 */           synCtx.setFrom(null);
/* 122 */         } else if (""Action"".equals(this.qName.getLocalPart())) {
/* 123 */           synCtx.setWSAAction(null);
/* 124 */         } else if (""FaultTo"".equals(this.qName.getLocalPart())) {
/* 125 */           synCtx.setFaultTo(null);
/* 126 */         } else if (""ReplyTo"".equals(this.qName.getLocalPart())) {
/* 127 */           synCtx.setReplyTo(null);
/* 128 */         } else if (""RelatesTo"".equals(this.qName.getLocalPart())) {
/* 129 */           synCtx.setRelatesTo(null);
/*     */         } else {
/* 131 */           SOAPEnvelope envelope = synCtx.getEnvelope();
/* 132 */           if (envelope != null) {
/* 133 */             SOAPHeader header = envelope.getHeader();
/* 134 */             if (header != null) {
/* 135 */               removeFromHeaderList(header.getHeaderBlocksWithNSURI(""""));
/*     */             }
/*     */           }
/*     */         
/*     */         } 
/*     */       } else {
/*     */         
/* 142 */         SOAPEnvelope envelope = synCtx.getEnvelope();
/* 143 */         if (envelope != null) {
/* 144 */           SOAPHeader header = envelope.getHeader();
/* 145 */           if (header != null) {
/* 146 */             removeFromHeaderList(header.getHeaderBlocksWithNSURI(this.qName.getNamespaceURI()));
/*     */           }
/*     */         } 
/*     */       } 
/*     */     } 
/*     */ 
/*     */     
/* 153 */     if (traceOrDebugOn) {
/* 154 */       traceOrDebug(traceOn, ""End : Header mediator"");
/*     */     }
/* 156 */     return true;
/*     */   }
/*     */   
/*     */   private void addCustomHeader(MessageContext synCtx, String value) {
/* 160 */     SOAPEnvelope env = synCtx.getEnvelope();
/* 161 */     if (env == null) {
/*     */       return;
/*     */     }
/* 164 */     SOAPFactory fac = (SOAPFactory)env.getOMFactory();
/* 165 */     SOAPHeader header = env.getHeader();
/* 166 */     if (header == null) {
/* 167 */       header = fac.createSOAPHeader(env);
/*     */     }
/* 169 */     SOAPHeaderBlock hb = header.addHeaderBlock(this.qName.getLocalPart(), fac.createOMNamespace(this.qName.getNamespaceURI(), this.qName.getPrefix()));
/*     */     
/* 171 */     hb.setText(value);
/*     */   }
/*     */   
/*     */   private void removeFromHeaderList(List headersList) {
/* 175 */     if (headersList == null || headersList.isEmpty()) {
/*     */       return;
/*     */     }
/* 178 */     for (Iterator iter = headersList.iterator(); iter.hasNext(); ) {
/* 179 */       Object o = iter.next();
/* 180 */       if (o instanceof SOAPHeaderBlock) {
/* 181 */         SOAPHeaderBlock header = (SOAPHeaderBlock)o;
/* 182 */         if (header.getLocalName().equals(this.qName.getLocalPart()))
/* 183 */           header.detach();  continue;
/*     */       } 
/* 185 */       if (o instanceof OMElement) {
/* 186 */         OMElement omElem = (OMElement)o;
/* 187 */         if (omElem.getLocalName().equals(this.qName.getLocalPart())) {
/* 188 */           omElem.detach();
/*     */         }
/*     */       } 
/*     */     } 
/*     */   }
/*     */ 
/*     */   
/* 195 */   public int getAction() { return this.action; }
/*     */ 
/*     */ 
/*     */   
/* 199 */   public void setAction(int action) { this.action = action; }
/*     */ 
/*     */ 
/*     */   
/* 203 */   public QName getQName() { return this.qName; }
/*     */ 
/*     */ 
/*     */   
/* 207 */   public void setQName(QName qName) { this.qName = qName; }
/*     */ 
/*     */ 
/*     */   
/* 211 */   public String getValue() { return this.value; }
/*     */ 
/*     */ 
/*     */   
/* 215 */   public void setValue(String value) { this.value = value; }
/*     */ 
/*     */ 
/*     */   
/* 219 */   public SynapseXPath getExpression() { return this.expression; }
/*     */ 
/*     */ 
/*     */   
/* 223 */   public void setExpression(SynapseXPath expression) { this.expression = expression; }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\mediators\transform\HeaderMediator.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.mediators.transform.XSLTMediator,"/*     */ package org.apache.synapse.mediators.transform;
/*     */ 
/*     */ import java.io.IOException;
/*     */ import java.io.OutputStream;
/*     */ import java.nio.charset.Charset;
/*     */ import java.util.ArrayList;
/*     */ import java.util.Iterator;
/*     */ import java.util.List;
/*     */ import javax.xml.parsers.ParserConfigurationException;
/*     */ import javax.xml.stream.XMLStreamException;
/*     */ import javax.xml.stream.XMLStreamReader;
/*     */ import javax.xml.transform.ErrorListener;
/*     */ import javax.xml.transform.Result;
/*     */ import javax.xml.transform.Source;
/*     */ import javax.xml.transform.Templates;
/*     */ import javax.xml.transform.Transformer;
/*     */ import javax.xml.transform.TransformerConfigurationException;
/*     */ import javax.xml.transform.TransformerException;
/*     */ import javax.xml.transform.TransformerFactory;
/*     */ import javax.xml.transform.dom.DOMResult;
/*     */ import javax.xml.transform.dom.DOMSource;
/*     */ import javax.xml.transform.stream.StreamResult;
/*     */ import org.apache.axiom.om.OMAbstractFactory;
/*     */ import org.apache.axiom.om.OMElement;
/*     */ import org.apache.axiom.om.OMNode;
/*     */ import org.apache.axiom.om.impl.builder.StAXOMBuilder;
/*     */ import org.apache.axiom.om.impl.dom.DOOMAbstractFactory;
/*     */ import org.apache.axiom.om.impl.dom.jaxp.DocumentBuilderFactoryImpl;
/*     */ import org.apache.axiom.om.util.ElementHelper;
/*     */ import org.apache.axiom.om.util.StAXUtils;
/*     */ import org.apache.axiom.soap.SOAPEnvelope;
/*     */ import org.apache.axiom.soap.impl.builder.StAXSOAPModelBuilder;
/*     */ import org.apache.axis2.AxisFault;
/*     */ import org.apache.commons.logging.Log;
/*     */ import org.apache.synapse.MessageContext;
/*     */ import org.apache.synapse.SynapseException;
/*     */ import org.apache.synapse.config.Entry;
/*     */ import org.apache.synapse.config.SynapseConfigUtils;
/*     */ import org.apache.synapse.mediators.AbstractMediator;
/*     */ import org.apache.synapse.mediators.MediatorProperty;
/*     */ import org.apache.synapse.util.AXIOMUtils;
/*     */ import org.apache.synapse.util.TemporaryData;
/*     */ import org.apache.synapse.util.TextFileDataSource;
/*     */ import org.apache.synapse.util.xpath.SynapseXPath;
/*     */ import org.jaxen.JaxenException;
/*     */ import org.w3c.dom.Element;
/*     */ import org.w3c.dom.Node;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class XSLTMediator
/*     */   extends AbstractMediator
/*     */ {
/*     */   public static final String USE_DOM_SOURCE_AND_RESULTS = ""http://ws.apache.org/ns/synapse/transform/feature/dom"";
/*  89 */   private String xsltKey = null;
/*     */ 
/*     */   
/*  92 */   private String sourceXPathString = null;
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  97 */   private SynapseXPath source = null;
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 102 */   private String targetPropertyName = null;
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 107 */   private List<MediatorProperty> properties = new ArrayList<MediatorProperty>();
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 112 */   private List<MediatorProperty> explicitFeatures = new ArrayList<MediatorProperty>();
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 119 */   private Templates cachedTemplates = null;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 125 */   private final TransformerFactory transFact = TransformerFactory.newInstance();
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 130 */   private final Object transformerLock = new Object();
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   private boolean useDOMSourceAndResults = false;
/*     */ 
/*     */ 
/*     */   
/*     */   public static final String DEFAULT_XPATH = ""s11:Body/child::*[position()=1] | s12:Body/child::*[position()=1]"";
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public XSLTMediator() {
/*     */     try {
/* 146 */       this.source = new SynapseXPath(""s11:Body/child::*[position()=1] | s12:Body/child::*[position()=1]"");
/* 147 */       this.source.addNamespace(""s11"", ""http://schemas.xmlsoap.org/soap/envelope/"");
/* 148 */       this.source.addNamespace(""s12"", ""http://www.w3.org/2003/05/soap-envelope"");
/* 149 */     } catch (JaxenException e) {
/* 150 */       String msg = ""Error creating default source XPath expression : s11:Body/child::*[position()=1] | s12:Body/child::*[position()=1]"";
/* 151 */       this.log.error(msg, (Throwable)e);
/* 152 */       throw new SynapseException(msg, (Throwable)e);
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public boolean mediate(MessageContext synCtx) {
/* 165 */     boolean traceOn = isTraceOn(synCtx);
/* 166 */     boolean traceOrDebugOn = isTraceOrDebugOn(traceOn);
/*     */     
/* 168 */     if (traceOrDebugOn) {
/* 169 */       traceOrDebug(traceOn, ""Start : XSLT mediator"");
/*     */       
/* 171 */       if (traceOn && trace.isTraceEnabled()) {
/* 172 */         trace.trace(""Message : "" + synCtx.getEnvelope());
/*     */       }
/*     */     } 
/*     */     
/*     */     try {
/* 177 */       performXSLT(synCtx, traceOrDebugOn, traceOn);
/*     */     }
/* 179 */     catch (Exception e) {
/* 180 */       handleException(""Unable to perform XSLT transformation using : "" + this.xsltKey + "" against source XPath : "" + ((this.sourceXPathString == null) ? ""s11:Body/child::*[position()=1] | s12:Body/child::*[position()=1]"" : ("" source XPath : "" + this.sourceXPathString)), e, synCtx);
/*     */     } 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */     
/* 187 */     if (traceOrDebugOn) {
/* 188 */       traceOrDebug(traceOn, ""End : XSLT mediator"");
/*     */     }
/*     */     
/* 191 */     return true;
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   private void performXSLT(MessageContext synCtx, final boolean traceOrDebugOn, final boolean traceOn) {
/*     */     Source transformSrc;
/* 203 */     boolean reCreate = false;
/* 204 */     OMNode sourceNode = getTransformSource(synCtx);
/* 205 */     TemporaryData tempTargetData = null;
/*     */     
/* 207 */     boolean isSoapEnvelope = (sourceNode == synCtx.getEnvelope());
/* 208 */     boolean isSoapBody = (sourceNode == synCtx.getEnvelope().getBody());
/*     */     
/* 210 */     if (traceOrDebugOn) {
/* 211 */       trace.trace(""Transformation source : "" + sourceNode.toString());
/*     */     }
/*     */ 
/*     */     
/* 215 */     Result transformTgt = null;
/*     */     
/* 217 */     if (this.useDOMSourceAndResults) {
/* 218 */       if (traceOrDebugOn) {
/* 219 */         traceOrDebug(traceOn, ""Using a DOMSource for transformation"");
/*     */       }
/*     */ 
/*     */       
/* 223 */       transformSrc = new DOMSource(((Element)ElementHelper.importOMElement((OMElement)sourceNode, DOOMAbstractFactory.getOMFactory())).getOwnerDocument());
/*     */ 
/*     */       
/* 226 */       DocumentBuilderFactoryImpl.setDOOMRequired(true);
/*     */       
/*     */       try {
/* 229 */         transformTgt = new DOMResult(DocumentBuilderFactoryImpl.newInstance().newDocumentBuilder().newDocument());
/*     */       }
/* 231 */       catch (ParserConfigurationException e) {
/* 232 */         handleException(""Error creating a DOMResult for the transformation, Consider setting optimization feature : http://ws.apache.org/ns/synapse/transform/feature/dom off"", e, synCtx);
/*     */       }
/*     */     
/*     */     }
/*     */     else {
/*     */       
/* 238 */       if (traceOrDebugOn) {
/* 239 */         traceOrDebug(traceOn, ""Using byte array serialization for transformation"");
/*     */       }
/*     */       
/* 242 */       transformSrc = AXIOMUtils.asSource(sourceNode);
/*     */       
/* 244 */       tempTargetData = synCtx.getEnvironment().createTemporaryData();
/* 245 */       OutputStream osForTarget = tempTargetData.getOutputStream();
/* 246 */       transformTgt = new StreamResult(osForTarget);
/*     */     } 
/*     */     
/* 249 */     if (transformTgt == null) {
/* 250 */       if (traceOrDebugOn) {
/* 251 */         traceOrDebug(traceOn, ""Was unable to get a javax.xml.transform.Result created"");
/*     */       }
/*     */       
/*     */       return;
/*     */     } 
/*     */     
/* 257 */     Entry dp = synCtx.getConfiguration().getEntryDefinition(this.xsltKey);
/*     */ 
/*     */     
/* 260 */     if (dp != null && dp.isDynamic() && (
/* 261 */       !dp.isCached() || dp.isExpired())) {
/* 262 */       reCreate = true;
/*     */     }
/*     */ 
/*     */     
/* 266 */     synchronized (this.transformerLock) {
/* 267 */       if (reCreate || this.cachedTemplates == null) {
/*     */         try {
/* 269 */           this.cachedTemplates = this.transFact.newTemplates(SynapseConfigUtils.getStreamSource(synCtx.getEntry(this.xsltKey)));
/*     */           
/* 271 */           if (this.cachedTemplates == null) {
/* 272 */             handleException(""Error compiling the XSLT with key : "" + this.xsltKey, synCtx);
/*     */           }
/* 274 */         } catch (Exception e) {
/* 275 */           handleException(""Error creating XSLT transformer using : "" + this.xsltKey, e, synCtx);
/*     */         } 
/*     */       }
/*     */     } 
/*     */ 
/*     */ 
/*     */     
/*     */     try {
/* 283 */       Transformer transformer = this.cachedTemplates.newTransformer();
/* 284 */       if (!this.properties.isEmpty())
/*     */       {
/* 286 */         for (MediatorProperty prop : this.properties) {
/* 287 */           if (prop != null) {
/* 288 */             if (prop.getValue() != null) {
/* 289 */               transformer.setParameter(prop.getName(), prop.getValue()); continue;
/*     */             } 
/* 291 */             transformer.setParameter(prop.getName(), prop.getExpression().stringValueOf(synCtx));
/*     */           } 
/*     */         } 
/*     */       }
/*     */ 
/*     */ 
/*     */       
/* 298 */       transformer.setErrorListener(new ErrorListener()
/*     */           {
/*     */             public void warning(TransformerException e) throws TransformerException
/*     */             {
/* 302 */               if (traceOrDebugOn) {
/* 303 */                 XSLTMediator.this.traceOrDebugWarn(traceOn, ""Warning encountered during transformation : "" + e);
/*     */               }
/*     */             }
/*     */ 
/*     */             
/*     */             public void error(TransformerException e) throws TransformerException {
/* 309 */               XSLTMediator.this.log.error(""Error occured in XSLT transformation : "" + e);
/* 310 */               throw e;
/*     */             }
/*     */             
/*     */             public void fatalError(TransformerException e) throws TransformerException {
/* 314 */               XSLTMediator.this.log.error(""Fatal error occured in the XSLT transformation : "" + e);
/* 315 */               throw e;
/*     */             }
/*     */           });
/*     */       
/* 319 */       transformer.transform(transformSrc, transformTgt);
/*     */       
/* 321 */       if (traceOrDebugOn) {
/* 322 */         traceOrDebug(traceOn, ""Transformation completed - processing result"");
/*     */       }
/*     */ 
/*     */       
/* 326 */       OMElement result = null;
/* 327 */       if (transformTgt instanceof DOMResult) {
/*     */         
/* 329 */         Node node = ((DOMResult)transformTgt).getNode();
/* 330 */         if (node == null) {
/* 331 */           if (traceOrDebugOn) {
/* 332 */             traceOrDebug(traceOn, ""Transformation result (DOMResult) was null"");
/*     */           }
/*     */           
/*     */           return;
/*     */         } 
/* 337 */         Node resultNode = node.getFirstChild();
/* 338 */         if (resultNode == null) {
/* 339 */           if (traceOrDebugOn) {
/* 340 */             traceOrDebug(traceOn, ""Transformation result (DOMResult) was empty"");
/*     */           }
/*     */           
/*     */           return;
/*     */         } 
/* 345 */         result = ElementHelper.importOMElement((OMElement)resultNode, OMAbstractFactory.getOMFactory());
/*     */       
/*     */       }
/*     */       else {
/*     */         
/* 350 */         String outputMethod = transformer.getOutputProperty(""method"");
/* 351 */         String encoding = transformer.getOutputProperty(""encoding"");
/*     */         
/* 353 */         if (traceOrDebugOn) {
/* 354 */           traceOrDebug(traceOn, ""output method: "" + outputMethod + ""; encoding: "" + encoding);
/*     */         }
/*     */ 
/*     */         
/* 358 */         if (""text"".equals(outputMethod)) {
/* 359 */           result = handleNonXMLResult(tempTargetData, Charset.forName(encoding), traceOrDebugOn, traceOn);
/*     */         } else {
/*     */           
/*     */           try {
/* 363 */             XMLStreamReader reader = StAXUtils.createXMLStreamReader(tempTargetData.getInputStream());
/*     */             
/* 365 */             if (isSoapEnvelope) {
/* 366 */               SOAPEnvelope sOAPEnvelope = (new StAXSOAPModelBuilder(reader)).getSOAPEnvelope();
/*     */             } else {
/* 368 */               result = (new StAXOMBuilder(reader)).getDocumentElement();
/*     */             }
/*     */           
/* 371 */           } catch (XMLStreamException e) {
/* 372 */             handleException(""Error building result element from XSLT transformation"", e, synCtx);
/*     */           
/*     */           }
/* 375 */           catch (IOException e) {
/* 376 */             handleException(""Error reading temporary data"", e, synCtx);
/*     */           } 
/*     */         } 
/*     */       } 
/*     */       
/* 381 */       if (result == null) {
/* 382 */         if (traceOrDebugOn) {
/* 383 */           traceOrDebug(traceOn, ""Transformation result was null"");
/*     */         }
/*     */         return;
/*     */       } 
/* 387 */       if (traceOn && trace.isTraceEnabled()) {
/* 388 */         trace.trace(""Transformation result : "" + result.toString());
/*     */       }
/*     */ 
/*     */       
/* 392 */       if (this.targetPropertyName != null) {
/*     */         
/* 394 */         if (traceOrDebugOn) {
/* 395 */           traceOrDebug(traceOn, ""Adding result as message context property : "" + this.targetPropertyName);
/*     */         }
/*     */         
/* 398 */         synCtx.setProperty(this.targetPropertyName, result);
/*     */       } else {
/* 400 */         if (traceOrDebugOn) {
/* 401 */           traceOrDebug(traceOn, ""Replace "" + (isSoapEnvelope ? ""SOAP envelope"" : (isSoapBody ? ""SOAP body"" : ""node"")) + "" with result"");
/*     */         }
/*     */ 
/*     */ 
/*     */         
/* 406 */         if (isSoapEnvelope) {
/*     */           try {
/* 408 */             synCtx.setEnvelope((SOAPEnvelope)result);
/* 409 */           } catch (AxisFault ex) {
/* 410 */             handleException(""Unable to replace SOAP envelope with result"", (Exception)ex, synCtx);
/*     */           }
/*     */         
/* 413 */         } else if (isSoapBody) {
/* 414 */           Iterator<OMElement> iter = synCtx.getEnvelope().getBody().getChildElements();
/* 415 */           while (iter.hasNext()) {
/* 416 */             OMElement child = iter.next();
/* 417 */             child.detach();
/*     */           } 
/*     */           
/* 420 */           for (Iterator<OMElement> iter = result.getChildElements(); iter.hasNext(); ) {
/* 421 */             OMElement child = iter.next();
/* 422 */             synCtx.getEnvelope().getBody().addChild((OMNode)child);
/*     */           } 
/*     */         } else {
/*     */           
/* 426 */           sourceNode.insertSiblingAfter((OMNode)result);
/* 427 */           sourceNode.detach();
/*     */         }
/*     */       
/*     */       } 
/* 431 */     } catch (TransformerException e) {
/* 432 */       handleException(""Error performing XSLT transformation using : "" + this.xsltKey, e, synCtx);
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   private OMNode getTransformSource(MessageContext synCtx) {
/*     */     try {
/* 446 */       Object o = this.source.evaluate(synCtx);
/* 447 */       if (o instanceof OMNode)
/* 448 */         return (OMNode)o; 
/* 449 */       if (o instanceof List && !((List)o).isEmpty()) {
/* 450 */         return ((List<OMNode>)o).get(0);
/*     */       }
/* 452 */       handleException(""The evaluation of the XPath expression "" + this.source + "" did not result in an OMNode"", synCtx);
/*     */     
/*     */     }
/* 455 */     catch (JaxenException e) {
/* 456 */       handleException(""Error evaluating XPath expression : "" + this.source, (Exception)e, synCtx);
/*     */     } 
/* 458 */     return null;
/*     */   }
/*     */ 
/*     */   
/* 462 */   public SynapseXPath getSource() { return this.source; }
/*     */ 
/*     */ 
/*     */   
/* 466 */   public void setSource(SynapseXPath source) { this.source = source; }
/*     */ 
/*     */ 
/*     */   
/* 470 */   public String getXsltKey() { return this.xsltKey; }
/*     */ 
/*     */ 
/*     */   
/* 474 */   public void setXsltKey(String xsltKey) { this.xsltKey = xsltKey; }
/*     */ 
/*     */ 
/*     */   
/* 478 */   public void addProperty(MediatorProperty p) { this.properties.add(p); }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public void addFeature(String featureName, boolean isFeatureEnable) {
/*     */     try {
/* 489 */       MediatorProperty mp = new MediatorProperty();
/* 490 */       mp.setName(featureName);
/* 491 */       if (isFeatureEnable) {
/* 492 */         mp.setValue(""true"");
/*     */       } else {
/* 494 */         mp.setValue(""false"");
/*     */       } 
/* 496 */       this.explicitFeatures.add(mp);
/* 497 */       if (""http://ws.apache.org/ns/synapse/transform/feature/dom"".equals(featureName)) {
/* 498 */         this.useDOMSourceAndResults = isFeatureEnable;
/*     */       } else {
/* 500 */         this.transFact.setFeature(featureName, isFeatureEnable);
/*     */       } 
/* 502 */     } catch (TransformerConfigurationException e) {
/* 503 */       String msg = ""Error occured when setting features to the TransformerFactory"";
/* 504 */       this.log.error(msg, e);
/* 505 */       throw new SynapseException(msg, e);
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   private OMElement handleNonXMLResult(TemporaryData tempData, Charset charset, boolean traceOrDebugOn, boolean traceOn) {
/* 521 */     if (traceOrDebugOn) {
/* 522 */       traceOrDebug(traceOn, ""Processing non SOAP/XML (text) transformation result"");
/*     */     }
/* 524 */     if (traceOn && trace.isTraceEnabled()) {
/* 525 */       trace.trace(""Wrapping text transformation result"");
/*     */     }
/*     */     
/* 528 */     return (OMElement)TextFileDataSource.createOMSourcedElement(tempData, charset);
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 536 */   public List<MediatorProperty> getFeatures() { return this.explicitFeatures; }
/*     */ 
/*     */ 
/*     */   
/* 540 */   public void addAllProperties(List<MediatorProperty> list) { this.properties.addAll(list); }
/*     */ 
/*     */ 
/*     */   
/* 544 */   public List<MediatorProperty> getProperties() { return this.properties; }
/*     */ 
/*     */ 
/*     */   
/* 548 */   public void setSourceXPathString(String sourceXPathString) { this.sourceXPathString = sourceXPathString; }
/*     */ 
/*     */ 
/*     */   
/* 552 */   public String getTargetPropertyName() { return this.targetPropertyName; }
/*     */ 
/*     */ 
/*     */   
/* 556 */   public void setTargetPropertyName(String targetPropertyName) { this.targetPropertyName = targetPropertyName; }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\mediators\transform\XSLTMediator.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.metrics.Counter,"/*    */ package org.apache.synapse.metrics;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class Counter
/*    */ {
/* 28 */   private long count = 0L;
/*    */ 
/*    */   
/* 31 */   public synchronized void increment() { this.count++; }
/*    */ 
/*    */ 
/*    */   
/* 35 */   public long getCount() { return this.count; }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\metrics\Counter.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.metrics.GlobalRequestCountHandler,"/*    */ package org.apache.synapse.metrics;
/*    */ 
/*    */ import org.apache.axis2.AxisFault;
/*    */ import org.apache.axis2.context.MessageContext;
/*    */ import org.apache.axis2.engine.Handler;
/*    */ import org.apache.axis2.handlers.AbstractHandler;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class GlobalRequestCountHandler
/*    */   extends AbstractHandler
/*    */ {
/*    */   public Handler.InvocationResponse invoke(MessageContext msgContext) throws AxisFault {
/* 34 */     msgContext.setProperty(""__REQUEST_RECEIVED_TIME__"", new Long(System.currentTimeMillis()));
/*    */ 
/*    */     
/* 37 */     ((Counter)msgContext.getParameter(""__GLOBAL_REQUEST_COUNTER__"").getValue()).increment();
/*    */     
/* 39 */     return Handler.InvocationResponse.CONTINUE;
/*    */   }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\metrics\GlobalRequestCountHandler.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.metrics.MetricsAggregatorModule,"/*    */ package org.apache.synapse.metrics;
/*    */ 
/*    */ import org.apache.axis2.AxisFault;
/*    */ import org.apache.axis2.context.ConfigurationContext;
/*    */ import org.apache.axis2.description.AxisDescription;
/*    */ import org.apache.axis2.description.AxisModule;
/*    */ import org.apache.axis2.description.Parameter;
/*    */ import org.apache.axis2.engine.AxisConfiguration;
/*    */ import org.apache.axis2.modules.Module;
/*    */ import org.apache.neethi.Assertion;
/*    */ import org.apache.neethi.Policy;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class MetricsAggregatorModule
/*    */   implements Module
/*    */ {
/*    */   public void init(ConfigurationContext configContext, AxisModule module) throws AxisFault {
/* 38 */     AxisConfiguration axiConfiguration = configContext.getAxisConfiguration();
/*    */     
/* 40 */     Counter globalRequestCounter = new Counter();
/* 41 */     Parameter globalRequestCounterParameter = new Parameter();
/* 42 */     globalRequestCounterParameter.setName(""__GLOBAL_REQUEST_COUNTER__"");
/* 43 */     globalRequestCounterParameter.setValue(globalRequestCounter);
/* 44 */     axiConfiguration.addParameter(globalRequestCounterParameter);
/*    */   }
/*    */ 
/*    */   
/*    */   public void engageNotify(AxisDescription axisDescription) throws AxisFault {}
/*    */ 
/*    */   
/* 51 */   public boolean canSupportAssertion(Assertion assertion) { return false; }
/*    */   
/*    */   public void applyPolicy(Policy policy, AxisDescription axisDescription) throws AxisFault {}
/*    */   
/*    */   public void shutdown(ConfigurationContext configurationContext) throws AxisFault {}
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\metrics\MetricsAggregatorModule.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.metrics.MetricsConstants,"package org.apache.synapse.metrics;
public final class MetricsConstants {
  public static final String GLOBAL_REQUEST_COUNTER = ""__GLOBAL_REQUEST_COUNTER__"";
  public static final String REQUEST_RECEIVED_TIME = ""__REQUEST_RECEIVED_TIME__"";
}
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\metrics\MetricsConstants.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.registry.AbstractRegistry,"/*     */ package org.apache.synapse.registry;
/*     */ 
/*     */ import java.net.URI;
/*     */ import java.util.Properties;
/*     */ import org.apache.axiom.om.OMNode;
/*     */ import org.apache.commons.logging.Log;
/*     */ import org.apache.commons.logging.LogFactory;
/*     */ import org.apache.synapse.config.Entry;
/*     */ import org.apache.synapse.config.XMLToObjectMapper;
/*     */ import org.apache.synapse.endpoints.Endpoint;
/*     */ import org.apache.synapse.mediators.base.SequenceMediator;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public abstract class AbstractRegistry
/*     */   implements Registry
/*     */ {
/*  40 */   private static final Log log = LogFactory.getLog(AbstractRegistry.class);
/*     */ 
/*     */   
/*  43 */   protected Properties properties = new Properties();
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public Object getResource(Entry entry) {
/*  52 */     OMNode omNode = null;
/*  53 */     RegistryEntry re = null;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */     
/*  59 */     if (entry.isCached() && !entry.isExpired()) {
/*  60 */       return entry.getValue();
/*     */     }
/*     */     
/*  63 */     if (!entry.isCached()) {
/*  64 */       omNode = lookup(entry.getKey());
/*  65 */       if (omNode == null) {
/*  66 */         return null;
/*     */       }
/*  68 */       re = getRegistryEntry(entry.getKey());
/*     */ 
/*     */ 
/*     */     
/*     */     }
/*  73 */     else if (entry.isExpired()) {
/*  74 */       if (log.isDebugEnabled()) {
/*  75 */         log.debug(""Cached object has expired for key : "" + entry.getKey());
/*     */       }
/*  77 */       re = getRegistryEntry(entry.getKey());
/*     */       
/*  79 */       if (re.getVersion() != Long.MIN_VALUE && re.getVersion() == entry.getVersion()) {
/*     */         
/*  81 */         if (log.isDebugEnabled()) {
/*  82 */           log.debug(""Expired version number is same as current version in registry"");
/*     */         }
/*     */ 
/*     */ 
/*     */         
/*  87 */         if (re.getCachableDuration() > 0L) {
/*  88 */           entry.setExpiryTime(System.currentTimeMillis() + re.getCachableDuration());
/*     */         } else {
/*     */           
/*  91 */           entry.setExpiryTime(-1L);
/*     */         } 
/*  93 */         if (log.isDebugEnabled()) {
/*  94 */           log.debug(""Renew cache lease for another "" + (re.getCachableDuration() / 1000L) + ""s"");
/*     */         }
/*     */ 
/*     */         
/*  98 */         return entry.getValue();
/*     */       } 
/*     */       
/* 101 */       omNode = lookup(entry.getKey());
/*     */     } 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */     
/* 110 */     if (entry.getMapper() != null) {
/* 111 */       entry.setValue(entry.getMapper().getObjectFromOMNode(omNode));
/*     */       
/* 113 */       if (entry.getValue() instanceof SequenceMediator) {
/* 114 */         SequenceMediator seq = (SequenceMediator)entry.getValue();
/* 115 */         seq.setDynamic(true);
/* 116 */         seq.setRegistryKey(entry.getKey());
/* 117 */       } else if (entry.getValue() instanceof Endpoint) {
/* 118 */         Endpoint ep = (Endpoint)entry.getValue();
/*     */ 
/*     */       
/*     */       }
/*     */ 
/*     */     
/*     */     }
/* 125 */     else if (re != null && re.getType() != null) {
/*     */       
/* 127 */       XMLToObjectMapper mapper = getMapper(re.getType());
/* 128 */       if (mapper != null) {
/* 129 */         entry.setMapper(mapper);
/* 130 */         entry.setValue(mapper.getObjectFromOMNode(omNode));
/*     */       } else {
/*     */         
/* 133 */         entry.setValue(omNode);
/*     */       } 
/*     */     } 
/*     */ 
/*     */ 
/*     */     
/* 139 */     if (re != null) {
/* 140 */       if (re.getCachableDuration() > 0L) {
/* 141 */         entry.setExpiryTime(System.currentTimeMillis() + re.getCachableDuration());
/*     */       } else {
/* 143 */         entry.setExpiryTime(-1L);
/*     */       } 
/* 145 */       entry.setVersion(re.getVersion());
/*     */     } 
/*     */     
/* 148 */     return entry.getValue();
/*     */   }
/*     */ 
/*     */   
/* 152 */   private XMLToObjectMapper getMapper(URI type) { return null; }
/*     */ 
/*     */ 
/*     */   
/* 156 */   public String getProviderClass() { return getClass().getName(); }
/*     */ 
/*     */ 
/*     */   
/* 160 */   public Properties getConfigurationProperties() { return this.properties; }
/*     */ 
/*     */ 
/*     */   
/* 164 */   public void init(Properties properties) { this.properties = properties; }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\registry\AbstractRegistry.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.registry.Registry,"package org.apache.synapse.registry;
import java.util.Properties;
import org.apache.axiom.om.OMNode;
import org.apache.synapse.config.Entry;
public interface Registry {
  void init(Properties paramProperties);
  OMNode lookup(String paramString);
  Object getResource(Entry paramEntry);
  RegistryEntry getRegistryEntry(String paramString);
  RegistryEntry[] getChildren(RegistryEntry paramRegistryEntry);
  RegistryEntry[] getDescendants(RegistryEntry paramRegistryEntry);
  String getProviderClass();
  Properties getConfigurationProperties();
  void delete(String paramString);
  void newResource(String paramString, boolean paramBoolean);
  void updateResource(String paramString, Object paramObject);
  void updateRegistryEntry(RegistryEntry paramRegistryEntry);
}
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\registry\Registry.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.registry.RegistryEntry,"package org.apache.synapse.registry;
import java.net.URI;
public interface RegistryEntry {
  String getKey();
  String getName();
  long getVersion();
  URI getType();
  String getDescription();
  long getCreated();
  long getLastModified();
  long getCachableDuration();
}
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\registry\RegistryEntry.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.registry.RegistryEntryImpl,"/*     */ package org.apache.synapse.registry;
/*     */ 
/*     */ import java.net.URI;
/*     */ import java.util.Date;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class RegistryEntryImpl
/*     */   implements RegistryEntry
/*     */ {
/*  29 */   private String key = null;
/*  30 */   private String name = null;
/*  31 */   private long version = Long.MIN_VALUE;
/*  32 */   private URI type = null;
/*     */   
/*     */   private String description;
/*     */   private long created;
/*     */   private long lastModified;
/*     */   private long cachableDuration;
/*     */   
/*  39 */   public String getKey() { return this.key; }
/*     */ 
/*     */ 
/*     */   
/*  43 */   public void setKey(String key) { this.key = key; }
/*     */ 
/*     */ 
/*     */   
/*  47 */   public String getName() { return this.name; }
/*     */ 
/*     */ 
/*     */   
/*  51 */   public void setName(String name) { this.name = name; }
/*     */ 
/*     */ 
/*     */   
/*  55 */   public long getVersion() { return this.version; }
/*     */ 
/*     */ 
/*     */   
/*  59 */   public void setVersion(long version) { this.version = version; }
/*     */ 
/*     */ 
/*     */   
/*  63 */   public URI getType() { return this.type; }
/*     */ 
/*     */ 
/*     */   
/*  67 */   public void setType(URI type) { this.type = type; }
/*     */ 
/*     */ 
/*     */   
/*  71 */   public String getDescription() { return this.description; }
/*     */ 
/*     */ 
/*     */   
/*  75 */   public void setDescription(String description) { this.description = description; }
/*     */ 
/*     */ 
/*     */   
/*  79 */   public long getCreated() { return this.created; }
/*     */ 
/*     */ 
/*     */   
/*  83 */   public void setCreated(long created) { this.created = created; }
/*     */ 
/*     */ 
/*     */   
/*  87 */   public long getLastModified() { return this.lastModified; }
/*     */ 
/*     */ 
/*     */   
/*  91 */   public void setLastModified(long lastModified) { this.lastModified = lastModified; }
/*     */ 
/*     */ 
/*     */   
/*  95 */   public long getCachableDuration() { return this.cachableDuration; }
/*     */ 
/*     */ 
/*     */   
/*  99 */   public void setCachableDuration(long cachableDuration) { this.cachableDuration = cachableDuration; }
/*     */ 
/*     */   
/*     */   public String toString() {
/* 103 */     StringBuffer sb = new StringBuffer();
/* 104 */     sb.append(""RegistryEntry {"").append("" Key : "" + this.key).append("" Name : "" + this.name).append("" Ver : "" + this.version).append("" Type : "" + this.type).append("" Desc : "" + this.description).append("" Created : "" + new Date(this.created)).append("" Modified : "" + new Date(this.lastModified)).append("" Cacheable for : "" + (this.cachableDuration / 1000L) + ""sec"").append(""}"");
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */     
/* 114 */     return sb.toString();
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\registry\RegistryEntryImpl.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.registry.url.SimpleURLRegistry,"/*     */ package org.apache.synapse.registry.url;
/*     */ 
/*     */ import java.io.BufferedInputStream;
/*     */ import java.io.BufferedReader;
/*     */ import java.io.File;
/*     */ import java.io.IOException;
/*     */ import java.io.InputStream;
/*     */ import java.io.InputStreamReader;
/*     */ import java.net.MalformedURLException;
/*     */ import java.net.URI;
/*     */ import java.net.URISyntaxException;
/*     */ import java.net.URL;
/*     */ import java.net.URLConnection;
/*     */ import java.util.ArrayList;
/*     */ import java.util.Properties;
/*     */ import javax.xml.stream.XMLInputFactory;
/*     */ import javax.xml.stream.XMLStreamException;
/*     */ import javax.xml.stream.XMLStreamReader;
/*     */ import org.apache.axiom.om.OMElement;
/*     */ import org.apache.axiom.om.OMException;
/*     */ import org.apache.axiom.om.OMNode;
/*     */ import org.apache.axiom.om.impl.builder.StAXOMBuilder;
/*     */ import org.apache.commons.logging.Log;
/*     */ import org.apache.commons.logging.LogFactory;
/*     */ import org.apache.synapse.SynapseException;
/*     */ import org.apache.synapse.config.SynapseConfigUtils;
/*     */ import org.apache.synapse.registry.AbstractRegistry;
/*     */ import org.apache.synapse.registry.Registry;
/*     */ import org.apache.synapse.registry.RegistryEntry;
/*     */ import org.apache.synapse.registry.RegistryEntryImpl;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class SimpleURLRegistry
/*     */   extends AbstractRegistry
/*     */   implements Registry
/*     */ {
/*  50 */   private static final Log log = LogFactory.getLog(SimpleURLRegistry.class);
/*     */   
/*     */   private static final int MAX_KEYS = 200;
/*  53 */   private String root = """";
/*     */   
/*     */   public OMNode lookup(String key) {
/*     */     BufferedInputStream inputStream;
/*  57 */     log.debug(""==> Repository fetch of resource with key : "" + key);
/*     */     
/*  59 */     URL url = SynapseConfigUtils.getURLFromPath(this.root + key);
/*  60 */     if (url == null) {
/*  61 */       return null;
/*     */     }
/*     */ 
/*     */     
/*     */     try {
/*  66 */       URLConnection connection = url.openConnection();
/*  67 */       connection.connect();
/*  68 */       inputStream = new BufferedInputStream(connection.getInputStream());
/*  69 */     } catch (IOException e) {
/*  70 */       return null;
/*     */     } 
/*     */     
/*  73 */     OMNode result = null;
/*     */     
/*  75 */     if (inputStream != null) {
/*     */       
/*     */       try {
/*     */         
/*  79 */         XMLStreamReader parser = XMLInputFactory.newInstance().createXMLStreamReader(inputStream);
/*     */         
/*  81 */         StAXOMBuilder builder = new StAXOMBuilder(parser);
/*  82 */         OMElement oMElement = builder.getDocumentElement();
/*     */       }
/*  84 */       catch (OMException ignored) {
/*     */         
/*  86 */         if (log.isDebugEnabled()) {
/*  87 */           log.debug(""The resource at the provided URL isn't well-formed XML,So,takes it as a text"");
/*     */         }
/*     */ 
/*     */         
/*     */         try {
/*  92 */           inputStream.close();
/*  93 */         } catch (IOException e) {
/*  94 */           log.error(""Error in closing the input stream. "", e);
/*     */         } 
/*  96 */         result = SynapseConfigUtils.readNonXML(url);
/*     */       }
/*  98 */       catch (XMLStreamException ignored) {
/*     */         
/* 100 */         if (log.isDebugEnabled()) {
/* 101 */           log.debug(""The resource at the provided URL isn't well-formed XML,So,takes it as a text"");
/*     */         }
/*     */ 
/*     */         
/*     */         try {
/* 106 */           inputStream.close();
/* 107 */         } catch (IOException e) {
/* 108 */           log.error(""Error in closing the input stream. "", e);
/*     */         } 
/* 110 */         result = SynapseConfigUtils.readNonXML(url);
/*     */       } finally {
/*     */ 
/*     */         
/*     */         try {
/* 115 */           inputStream.close();
/* 116 */         } catch (IOException e) {
/* 117 */           log.error(""Error in closing the input stream."", e);
/*     */         } 
/*     */       } 
/*     */     }
/*     */ 
/*     */     
/* 123 */     return result;
/*     */   }
/*     */   
/*     */   public RegistryEntry getRegistryEntry(String key) {
/* 127 */     if (log.isDebugEnabled()) {
/* 128 */       log.debug(""Perform RegistryEntry lookup for key : "" + key);
/*     */     }
/*     */     try {
/* 131 */       URL url = SynapseConfigUtils.getURLFromPath(this.root + key);
/* 132 */       if (url == null) {
/* 133 */         return null;
/*     */       }
/* 135 */       URLConnection urlc = url.openConnection();
/* 136 */       urlc.setReadTimeout(30000);
/* 137 */       urlc.setRequestProperty(""Connection"", ""Close"");
/*     */       
/* 139 */       RegistryEntryImpl wre = new RegistryEntryImpl();
/* 140 */       wre.setKey(key);
/* 141 */       wre.setName(url.getFile());
/* 142 */       wre.setType(new URI(urlc.getContentType()));
/* 143 */       wre.setDescription(""Resource at : "" + url.toString());
/* 144 */       wre.setLastModified(urlc.getLastModified());
/* 145 */       wre.setVersion(urlc.getLastModified());
/* 146 */       if (urlc.getExpiration() > 0L) {
/* 147 */         wre.setCachableDuration(urlc.getExpiration() - System.currentTimeMillis());
/*     */       } else {
/*     */         
/* 150 */         wre.setCachableDuration(getCachableDuration(key));
/*     */       } 
/* 152 */       return (RegistryEntry)wre;
/*     */     }
/* 154 */     catch (MalformedURLException e) {
/* 155 */       handleException(""Invalid URL reference "" + this.root + key, e);
/* 156 */     } catch (IOException e) {
/* 157 */       handleException(""IO Error reading from URL "" + this.root + key, e);
/* 158 */     } catch (URISyntaxException e) {
/* 159 */       handleException(""URI Syntax error reading from URL "" + this.root + key, e);
/*     */     } 
/* 161 */     return null;
/*     */   }
/*     */   
/*     */   public void init(Properties properties) {
/* 165 */     super.init(properties);
/* 166 */     String value = properties.getProperty(""root"");
/* 167 */     if (value != null) {
/*     */ 
/*     */       
/*     */       try {
/*     */         
/* 172 */         URL url = new URL(value);
/* 173 */         if (url.getProtocol().equals(""file"") && 
/* 174 */           !value.endsWith(""/"")) {
/* 175 */           value = value + ""/"";
/*     */         }
/*     */       }
/* 178 */       catch (MalformedURLException e) {}
/*     */ 
/*     */       
/* 181 */       this.root = value;
/*     */     } else {
/* 183 */       handleException("""");
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public void delete(String path) {}
/*     */ 
/*     */ 
/*     */   
/*     */   public void newResource(String path, boolean isDirectory) {}
/*     */ 
/*     */ 
/*     */   
/*     */   public void updateResource(String path, Object value) {}
/*     */ 
/*     */ 
/*     */   
/*     */   public void updateRegistryEntry(RegistryEntry entry) {}
/*     */ 
/*     */ 
/*     */   
/*     */   public long getCachableDuration(String rootPath) {
/* 207 */     String cachableDuration = (String)this.properties.get(""cachableDuration"");
/* 208 */     return (cachableDuration == null) ? 1500L : Long.parseLong(cachableDuration);
/*     */   }
/*     */   
/*     */   public RegistryEntry[] getChildren(RegistryEntry entry) {
/*     */     RegistryEntryImpl registryEntryImpl1;
/* 213 */     if (entry == null) {
/* 214 */       RegistryEntryImpl entryImpl = new RegistryEntryImpl();
/* 215 */       entryImpl.setKey("""");
/* 216 */       registryEntryImpl1 = entryImpl;
/*     */     } 
/* 218 */     URL url = SynapseConfigUtils.getURLFromPath(this.root + registryEntryImpl1.getKey());
/* 219 */     if (url == null) {
/* 220 */       return null;
/*     */     }
/* 222 */     if (url.getProtocol().equals(""file"")) {
/*     */       
/* 224 */       File file = new File(url.getFile());
/* 225 */       if (!file.isDirectory()) {
/* 226 */         return null;
/*     */       }
/* 228 */       InputStream inStream = null;
/*     */       try {
/* 230 */         inStream = (InputStream)url.getContent();
/*     */         
/* 232 */         BufferedReader reader = new BufferedReader(new InputStreamReader(inStream));
/* 233 */         ArrayList<RegistryEntryImpl> entryList = new ArrayList();
/* 234 */         String key = """";
/* 235 */         while ((key = reader.readLine()) != null) {
/* 236 */           RegistryEntryImpl registryEntryImpl = new RegistryEntryImpl();
/* 237 */           if (registryEntryImpl1.getKey().equals("""")) {
/* 238 */             registryEntryImpl.setKey(key);
/*     */           }
/* 240 */           else if (registryEntryImpl1.getKey().endsWith(""/"")) {
/* 241 */             registryEntryImpl.setKey(registryEntryImpl1.getKey() + key);
/*     */           } else {
/* 243 */             registryEntryImpl.setKey(registryEntryImpl1.getKey() + ""/"" + key);
/*     */           } 
/*     */ 
/*     */           
/* 247 */           entryList.add(registryEntryImpl);
/*     */         } 
/*     */         
/* 250 */         RegistryEntry[] entries = new RegistryEntry[entryList.size()];
/* 251 */         for (int i = 0; i < entryList.size(); i++) {
/* 252 */           entries[i] = (RegistryEntry)entryList.get(i);
/*     */         }
/* 254 */         return entries;
/*     */       }
/* 256 */       catch (Exception e) {
/* 257 */         throw new SynapseException(""Error in reading the URL."");
/*     */       } 
/*     */     } 
/*     */     
/* 261 */     throw new SynapseException(""Invalid protocol."");
/*     */   }
/*     */ 
/*     */ 
/*     */   
/*     */   public RegistryEntry[] getDescendants(RegistryEntry entry) {
/* 267 */     ArrayList<RegistryEntry> list = new ArrayList();
/* 268 */     RegistryEntry[] entries = getChildren(entry);
/* 269 */     if (entries != null) {
/* 270 */       for (int i = 0; i < entries.length; i++) {
/*     */         
/* 272 */         if (list.size() > 200) {
/*     */           break;
/*     */         }
/*     */         
/* 276 */         fillDescendants(entries[i], list);
/*     */       } 
/*     */     }
/*     */     
/* 280 */     RegistryEntry[] descendants = new RegistryEntry[list.size()];
/* 281 */     for (int i = 0; i < list.size(); i++) {
/* 282 */       descendants[i] = list.get(i);
/*     */     }
/*     */     
/* 285 */     return descendants;
/*     */   }
/*     */ 
/*     */   
/*     */   private void fillDescendants(RegistryEntry parent, ArrayList<RegistryEntry> list) {
/* 290 */     RegistryEntry[] entries = getChildren(parent);
/* 291 */     if (entries != null) {
/* 292 */       for (int i = 0; i < entries.length; i++) {
/*     */         
/* 294 */         if (list.size() > 200) {
/*     */           break;
/*     */         }
/*     */         
/* 298 */         fillDescendants(entries[i], list);
/*     */       } 
/*     */     } else {
/* 301 */       list.add(parent);
/*     */     } 
/*     */   }
/*     */   
/*     */   private void handleException(String msg, Exception e) {
/* 306 */     log.error(msg, e);
/* 307 */     throw new SynapseException(msg, e);
/*     */   }
/*     */   
/*     */   private void handleException(String msg) {
/* 311 */     log.error(msg);
/* 312 */     throw new SynapseException(msg);
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\registr\\url\SimpleURLRegistry.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.startup.AbstractStartup,"/*    */ package org.apache.synapse.startup;
/*    */ 
/*    */ import org.apache.synapse.Startup;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public abstract class AbstractStartup
/*    */   implements Startup
/*    */ {
/* 32 */   protected String name = null;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */   
/* 40 */   public String getName() { return this.name; }
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */   
/* 50 */   public void setName(String name) { this.name = name; }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\startup\AbstractStartup.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.startup.Task,"package org.apache.synapse.startup;
public interface Task {
  void execute();
}
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\startup\Task.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.startup.quartz.SimpleQuartz,"/*     */ package org.apache.synapse.startup.quartz;
/*     */ 
/*     */ import java.net.InetAddress;
/*     */ import java.net.UnknownHostException;
/*     */ import java.util.HashSet;
/*     */ import java.util.List;
/*     */ import java.util.Random;
/*     */ import java.util.Set;
/*     */ import javax.xml.namespace.QName;
/*     */ import org.apache.axiom.om.OMElement;
/*     */ import org.apache.commons.logging.Log;
/*     */ import org.apache.commons.logging.LogFactory;
/*     */ import org.apache.synapse.ServerManager;
/*     */ import org.apache.synapse.SynapseException;
/*     */ import org.apache.synapse.core.SynapseEnvironment;
/*     */ import org.apache.synapse.startup.AbstractStartup;
/*     */ import org.quartz.CronTrigger;
/*     */ import org.quartz.JobDataMap;
/*     */ import org.quartz.JobDetail;
/*     */ import org.quartz.Scheduler;
/*     */ import org.quartz.SchedulerException;
/*     */ import org.quartz.Trigger;
/*     */ import org.quartz.TriggerUtils;
/*     */ import org.quartz.impl.DirectSchedulerFactory;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class SimpleQuartz
/*     */   extends AbstractStartup
/*     */ {
/*  57 */   private static final Log log = LogFactory.getLog(SimpleQuartz.class);
/*     */   private static final int THREADPOOLSIZE = 5;
/*     */   
/*     */   static  {
/*     */     try {
/*  62 */       DirectSchedulerFactory.getInstance().createVolatileScheduler(5);
/*  63 */     } catch (SchedulerException e) {
/*  64 */       throw new SynapseException(""Error initializing scheduler factory"", (Throwable)e);
/*     */     } 
/*     */   }
/*     */   
/*     */   private String cron;
/*  69 */   private int repeatCount = -1;
/*     */   private long repeatInterval;
/*     */   private String className;
/*     */   private List pinnedServers;
/*     */   private Scheduler sch;
/*  74 */   Set xmlProperties = new HashSet();
/*     */ 
/*     */   
/*  77 */   public QName getTagQName() { return SimpleQuartzFactory.TASK; }
/*     */ 
/*     */   
/*     */   public void destroy() {
/*  81 */     if (this.sch != null) {
/*     */       try {
/*  83 */         this.sch.shutdown();
/*  84 */       } catch (SchedulerException e) {
/*  85 */         log.warn(""Error shutting down scheduler"", (Throwable)e);
/*  86 */         throw new SynapseException(""Error shutting down scheduler"", (Throwable)e);
/*     */       } 
/*     */     }
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public void init(SynapseEnvironment synapseEnvironment) {
/*  96 */     String thisServerName = ServerManager.getInstance().getServerName();
/*  97 */     if (thisServerName == null || thisServerName.equals("""")) {
/*     */       try {
/*  99 */         InetAddress addr = InetAddress.getLocalHost();
/* 100 */         thisServerName = addr.getHostName();
/*     */       }
/* 102 */       catch (UnknownHostException e) {
/* 103 */         log.warn(""Could not get local host name"", e);
/*     */       } 
/*     */       
/* 106 */       if (thisServerName == null || thisServerName.equals("""")) {
/* 107 */         thisServerName = ""localhost"";
/*     */       }
/*     */     } 
/* 110 */     log.debug(""Synapse server name : "" + thisServerName);
/*     */ 
/*     */ 
/*     */ 
/*     */     
/* 115 */     List pinnedServers = getPinnedServers();
/* 116 */     if (pinnedServers != null && !pinnedServers.isEmpty() && 
/* 117 */       !pinnedServers.contains(thisServerName)) {
/* 118 */       log.info(""Server name not in pinned servers list. Not starting Task : "" + getName());
/*     */ 
/*     */       
/*     */       return;
/*     */     } 
/*     */     
/*     */     try {
/* 125 */       this.sch = DirectSchedulerFactory.getInstance().getScheduler();
/* 126 */       if (this.sch == null) {
/* 127 */         DirectSchedulerFactory.getInstance().createVolatileScheduler(5);
/* 128 */         this.sch = DirectSchedulerFactory.getInstance().getScheduler();
/*     */       } 
/*     */       
/* 131 */       if (this.sch == null) {
/* 132 */         throw new NullPointerException(""Scheduler is null"");
/*     */       }
/*     */       
/* 135 */       Object object = null;
/* 136 */       if (this.cron == null) {
/* 137 */         if (this.repeatCount >= 0) {
/* 138 */           object = TriggerUtils.makeImmediateTrigger(this.repeatCount - 1, this.repeatInterval);
/*     */         } else {
/* 140 */           object = TriggerUtils.makeImmediateTrigger(-1, this.repeatInterval);
/*     */         } 
/*     */       } else {
/*     */         
/* 144 */         CronTrigger cronTrig = new CronTrigger();
/* 145 */         cronTrig.setCronExpression(this.cron);
/* 146 */         object = cronTrig;
/*     */       } 
/*     */ 
/*     */       
/* 150 */       object.setName(""Trigger"" + String.valueOf((new Random()).nextLong()));
/* 151 */       object.setGroup(""synapse.simple.quartz"");
/* 152 */       object.setVolatility(true);
/* 153 */       JobDetail jobDetail = new JobDetail();
/*     */ 
/*     */       
/* 156 */       jobDetail.setName(this.name);
/* 157 */       jobDetail.setGroup(""synapse.simple.quartz"");
/* 158 */       jobDetail.setJobClass(SimpleQuartzJob.class);
/* 159 */       JobDataMap jdm = new JobDataMap();
/* 160 */       jdm.put(""SynapseEnvironment"", synapseEnvironment);
/* 161 */       jdm.put(""ClassName"", this.className);
/* 162 */       jdm.put(""Properties"", this.xmlProperties);
/* 163 */       jobDetail.setJobDataMap(jdm);
/*     */       
/* 165 */       this.sch.scheduleJob(jobDetail, (Trigger)object);
/* 166 */       this.sch.start();
/* 167 */       log.info(""Scheduled job "" + jobDetail.getFullName() + "" for class "" + this.className);
/*     */     }
/* 169 */     catch (Exception e) {
/* 170 */       log.fatal(""Error starting up Scheduler"", e);
/* 171 */       throw new SynapseException(""Error starting up Scheduler"", e);
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */   
/* 177 */   public String getJobClass() { return this.className; }
/*     */ 
/*     */ 
/*     */   
/* 181 */   public void setJobClass(String attributeValue) { this.className = attributeValue; }
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 186 */   public void setInterval(long l) { this.repeatInterval = l; }
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 191 */   public long getInterval() { return this.repeatInterval; }
/*     */ 
/*     */ 
/*     */   
/* 195 */   public void setCount(int i) { this.repeatCount = i; }
/*     */ 
/*     */ 
/*     */   
/* 199 */   public int getCount() { return this.repeatCount; }
/*     */ 
/*     */ 
/*     */   
/* 203 */   public void addProperty(OMElement prop) { this.xmlProperties.add(prop); }
/*     */ 
/*     */ 
/*     */   
/* 207 */   public Set getProperties() { return this.xmlProperties; }
/*     */ 
/*     */ 
/*     */   
/* 211 */   public void setCron(String attributeValue) { this.cron = attributeValue; }
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 216 */   public String getCron() { return this.cron; }
/*     */ 
/*     */ 
/*     */   
/* 220 */   public List getPinnedServers() { return this.pinnedServers; }
/*     */ 
/*     */ 
/*     */   
/* 224 */   public void setPinnedServers(List pinnedServers) { this.pinnedServers = pinnedServers; }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\startup\quartz\SimpleQuartz.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.startup.quartz.SimpleQuartzFactory,"/*     */ package org.apache.synapse.startup.quartz;
/*     */ 
/*     */ import java.util.ArrayList;
/*     */ import java.util.Iterator;
/*     */ import java.util.List;
/*     */ import java.util.StringTokenizer;
/*     */ import javax.xml.namespace.QName;
/*     */ import org.apache.axiom.om.OMAttribute;
/*     */ import org.apache.axiom.om.OMElement;
/*     */ import org.apache.commons.logging.Log;
/*     */ import org.apache.commons.logging.LogFactory;
/*     */ import org.apache.synapse.Startup;
/*     */ import org.apache.synapse.SynapseException;
/*     */ import org.apache.synapse.config.xml.PropertyHelper;
/*     */ import org.apache.synapse.config.xml.StartupFactory;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class SimpleQuartzFactory
/*     */   implements StartupFactory
/*     */ {
/*  50 */   public static final QName TASK = new QName(""http://ws.apache.org/ns/synapse"", ""task"");
/*     */ 
/*     */   
/*  53 */   private static final QName TRIGGER = new QName(""http://ws.apache.org/ns/synapse"", ""trigger"");
/*     */ 
/*     */   
/*  56 */   private static final QName PROPERTY = new QName(""http://ws.apache.org/ns/synapse"", ""property"");
/*     */ 
/*     */   
/*  59 */   private static final Log log = LogFactory.getLog(SimpleQuartzFactory.class);
/*     */ 
/*     */   
/*     */   public Startup createStartup(OMElement el) {
/*  63 */     if (log.isDebugEnabled()) {
/*  64 */       log.debug(""Creating SimpleQuartz Task"");
/*     */     }
/*     */     
/*  67 */     if (el.getQName().equals(TASK)) {
/*     */       
/*  69 */       SimpleQuartz q = new SimpleQuartz();
/*     */       
/*  71 */       String name = el.getAttributeValue(new QName("""", ""name""));
/*     */       
/*  73 */       if (name != null) {
/*  74 */         q.setName(name);
/*     */       } else {
/*  76 */         handleException(""Name for a task is required, missing name in the task"");
/*     */       } 
/*     */ 
/*     */       
/*  80 */       OMAttribute classAttr = el.getAttribute(new QName(""class""));
/*  81 */       if (classAttr != null && classAttr.getAttributeValue() != null) {
/*  82 */         String classname = classAttr.getAttributeValue();
/*     */         try {
/*  84 */           Class.forName(classname).newInstance();
/*  85 */         } catch (Exception e) {
/*  86 */           handleException(""Failed to load task class "" + classname, e);
/*     */         } 
/*  88 */         q.setJobClass(classname);
/*     */       } else {
/*  90 */         handleException(""Syntax error in the Task : no task class specified"");
/*     */       } 
/*     */ 
/*     */       
/*  94 */       OMAttribute pinnedServers = el.getAttribute(new QName("""", ""pinnedServers""));
/*  95 */       if (pinnedServers != null) {
/*  96 */         String pinnedServersValue = pinnedServers.getAttributeValue();
/*  97 */         if (pinnedServersValue != null) {
/*     */ 
/*     */           
/* 100 */           StringTokenizer st = new StringTokenizer(pinnedServersValue, "" ,"");
/* 101 */           List<String> pinnedServersList = new ArrayList();
/* 102 */           while (st.hasMoreTokens()) {
/* 103 */             String token = st.nextToken();
/* 104 */             if (token.length() != 0) {
/* 105 */               pinnedServersList.add(token);
/*     */             }
/*     */           } 
/* 108 */           q.setPinnedServers(pinnedServersList);
/*     */         } 
/*     */       } 
/*     */ 
/*     */       
/* 113 */       Iterator<OMElement> it = el.getChildrenWithName(PROPERTY);
/* 114 */       while (it.hasNext()) {
/* 115 */         OMElement prop = it.next();
/* 116 */         if (PropertyHelper.isStaticProperty(prop)) {
/* 117 */           q.addProperty(prop); continue;
/*     */         } 
/* 119 */         handleException(""Tasks does not support dynamic properties"");
/*     */       } 
/*     */ 
/*     */ 
/*     */       
/* 124 */       OMElement trigger = el.getFirstChildWithName(TRIGGER);
/* 125 */       if (trigger != null) {
/*     */         
/* 127 */         OMAttribute count = trigger.getAttribute(new QName(""count""));
/* 128 */         if (count != null) {
/*     */           try {
/* 130 */             q.setCount(Integer.parseInt(count.getAttributeValue()));
/* 131 */           } catch (Exception e) {
/* 132 */             handleException(""Failed to parse trigger count as an integer"", e);
/*     */           } 
/*     */         }
/*     */         
/* 136 */         OMAttribute once = trigger.getAttribute(new QName(""once""));
/* 137 */         if (once != null && Boolean.TRUE.toString().equals(once.getAttributeValue())) {
/* 138 */           q.setCount(1);
/* 139 */           q.setInterval(1L);
/*     */         } 
/*     */         
/* 142 */         OMAttribute repeatInterval = trigger.getAttribute(new QName(""interval""));
/* 143 */         if (repeatInterval == null && q.getCount() > 1) {
/* 144 */           handleException(""Trigger seems to be a simple trigger, but no interval specified"");
/*     */         }
/* 146 */         else if (repeatInterval != null && repeatInterval.getAttributeValue() != null) {
/*     */           try {
/* 148 */             long repeatIntervalInSeconds = Long.parseLong(repeatInterval.getAttributeValue());
/* 149 */             long repeatIntervalInMillis = repeatIntervalInSeconds * 1000L;
/* 150 */             q.setInterval(repeatIntervalInMillis);
/* 151 */           } catch (Exception e) {
/* 152 */             handleException(""Failed to parse trigger interval as a long value"", e);
/*     */           } 
/*     */         } 
/*     */         
/* 156 */         OMAttribute expr = trigger.getAttribute(new QName(""cron""));
/* 157 */         if (expr == null && q.getInterval() == 0L) {
/* 158 */           q.setCount(1);
/* 159 */           q.setInterval(1L);
/* 160 */         } else if (expr != null && q.getInterval() > 0L) {
/* 161 */           handleException(""Trigger syntax error : both cron and simple trigger attributes are present"");
/*     */         }
/* 163 */         else if (expr != null && expr.getAttributeValue() != null) {
/* 164 */           q.setCron(expr.getAttributeValue());
/*     */         } 
/*     */       } else {
/*     */         
/* 168 */         q.setCount(1);
/* 169 */         q.setInterval(1L);
/*     */       } 
/*     */       
/* 172 */       return (Startup)q;
/*     */     } 
/* 174 */     handleException(""Syntax error in the task : wrong QName for the task"");
/* 175 */     return null;
/*     */   }
/*     */ 
/*     */ 
/*     */   
/* 180 */   public Class getSerializerClass() { return SimpleQuartzSerializer.class; }
/*     */ 
/*     */ 
/*     */   
/* 184 */   public QName getTagQName() { return TASK; }
/*     */ 
/*     */   
/*     */   private void handleException(String message, Exception e) {
/* 188 */     log.error(message);
/* 189 */     throw new SynapseException(message, e);
/*     */   }
/*     */   
/*     */   private void handleException(String message) {
/* 193 */     log.error(message);
/* 194 */     throw new SynapseException(message);
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\startup\quartz\SimpleQuartzFactory.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.startup.quartz.SimpleQuartzJob,"/*    */ package org.apache.synapse.startup.quartz;
/*    */ 
/*    */ import java.util.Iterator;
/*    */ import java.util.Set;
/*    */ import org.apache.axiom.om.OMElement;
/*    */ import org.apache.commons.logging.Log;
/*    */ import org.apache.commons.logging.LogFactory;
/*    */ import org.apache.synapse.ManagedLifecycle;
/*    */ import org.apache.synapse.config.xml.PropertyHelper;
/*    */ import org.apache.synapse.core.SynapseEnvironment;
/*    */ import org.apache.synapse.startup.Task;
/*    */ import org.quartz.Job;
/*    */ import org.quartz.JobDataMap;
/*    */ import org.quartz.JobExecutionContext;
/*    */ import org.quartz.JobExecutionException;
/*    */ 
/*    */ public class SimpleQuartzJob
/*    */   implements Job
/*    */ {
/*    */   public static final String SYNAPSE_ENVIRONMENT = ""SynapseEnvironment"";
/*    */   public static final String CLASSNAME = ""ClassName"";
/*    */   public static final String PROPERTIES = ""Properties"";
/* 23 */   private static final Log log = LogFactory.getLog(SimpleQuartzJob.class);
/*    */ 
/*    */   
/*    */   public void execute(JobExecutionContext ctx) throws JobExecutionException {
/* 27 */     log.debug(""Executing task : "" + ctx.getJobDetail().getFullName());
/* 28 */     JobDataMap jdm = ctx.getMergedJobDataMap();
/* 29 */     String jobClassName = (String)jdm.get(""ClassName"");
/* 30 */     if (jobClassName == null) {
/* 31 */       handleException(""No ClassName in JobDetails"");
/*    */     }
/*    */     
/* 34 */     Task task = null;
/*    */     try {
/* 36 */       task = (Task)getClass().getClassLoader().loadClass(jobClassName).newInstance();
/* 37 */     } catch (Exception e) {
/* 38 */       handleException(""Cannot instantiate task : "" + jobClassName, e);
/*    */     } 
/*    */     
/* 41 */     Set properties = (Set)jdm.get(""Properties"");
/* 42 */     Iterator<OMElement> it = properties.iterator();
/* 43 */     while (it.hasNext()) {
/* 44 */       OMElement prop = it.next();
/* 45 */       log.debug(""Found Property : "" + prop.toString());
/* 46 */       PropertyHelper.setStaticProperty(prop, task);
/*    */     } 
/*    */     
/* 49 */     SynapseEnvironment se = (SynapseEnvironment)jdm.get(""SynapseEnvironment"");
/* 50 */     if (task instanceof ManagedLifecycle && 
/* 51 */       se != null) {
/* 52 */       ((ManagedLifecycle)task).init(se);
/*    */     }
/*    */ 
/*    */     
/* 56 */     if (se.isInitialized()) {
/* 57 */       task.execute();
/*    */     }
/*    */   }
/*    */   
/*    */   private void handleException(String msg) throws JobExecutionException {
/* 62 */     log.error(msg);
/* 63 */     throw new JobExecutionException(msg);
/*    */   }
/*    */   
/*    */   private void handleException(String msg, Exception e) throws JobExecutionException {
/* 67 */     log.error(msg, e);
/* 68 */     throw new JobExecutionException(msg, e);
/*    */   }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\startup\quartz\SimpleQuartzJob.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.startup.quartz.SimpleQuartzSerializer,"/*    */ package org.apache.synapse.startup.quartz;
/*    */ 
/*    */ import java.util.List;
/*    */ import javax.xml.namespace.QName;
/*    */ import org.apache.axiom.om.OMAbstractFactory;
/*    */ import org.apache.axiom.om.OMContainer;
/*    */ import org.apache.axiom.om.OMElement;
/*    */ import org.apache.axiom.om.OMFactory;
/*    */ import org.apache.axiom.om.OMNamespace;
/*    */ import org.apache.axiom.om.OMNode;
/*    */ import org.apache.synapse.Startup;
/*    */ import org.apache.synapse.SynapseException;
/*    */ import org.apache.synapse.config.xml.StartupSerializer;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class SimpleQuartzSerializer
/*    */   implements StartupSerializer
/*    */ {
/* 37 */   protected static final OMFactory fac = OMAbstractFactory.getOMFactory();
/* 38 */   protected static final OMNamespace synNS = fac.createOMNamespace(""http://ws.apache.org/ns/synapse"", ""syn"");
/*    */   
/* 40 */   protected static final OMNamespace nullNS = fac.createOMNamespace("""", """");
/*    */   
/* 42 */   protected static final QName PROP_Q = new QName(""http://ws.apache.org/ns/synapse"", ""property"", ""syn"");
/*    */ 
/*    */ 
/*    */   
/*    */   public OMElement serializeStartup(OMElement parent, Startup s) {
/* 47 */     if (!(s instanceof SimpleQuartz)) {
/* 48 */       throw new SynapseException(""called TaskSerializer on some other kind of startup"" + s.getClass().getName());
/*    */     }
/*    */ 
/*    */     
/* 52 */     SimpleQuartz sq = (SimpleQuartz)s;
/*    */     
/* 54 */     OMElement task = fac.createOMElement(""task"", synNS, (OMContainer)parent);
/* 55 */     task.addAttribute(""name"", sq.getName(), nullNS);
/* 56 */     task.addAttribute(""class"", sq.getJobClass(), nullNS);
/*    */     
/* 58 */     List<String> pinnedServers = sq.getPinnedServers();
/* 59 */     if (pinnedServers != null && !pinnedServers.isEmpty()) {
/* 60 */       String pinnedServersStr = """" + pinnedServers.get(0);
/* 61 */       for (int i = 1; i < pinnedServers.size(); i++) {
/* 62 */         pinnedServersStr = pinnedServersStr + "" "" + pinnedServers.get(i);
/*    */       }
/* 64 */       task.addAttribute(fac.createOMAttribute(""pinnedServers"", nullNS, pinnedServersStr));
/*    */     } 
/*    */     
/* 67 */     OMElement el = fac.createOMElement(""trigger"", synNS, (OMContainer)task);
/* 68 */     if (sq.getInterval() == 1L && sq.getCount() == 1) {
/* 69 */       el.addAttribute(""once"", ""true"", nullNS);
/* 70 */     } else if (sq.getCron() != null) {
/* 71 */       el.addAttribute(""cron"", sq.getCron(), nullNS);
/*    */     } else {
/* 73 */       if (sq.getCount() != -1) {
/* 74 */         el.addAttribute(""count"", Integer.toString(sq.getCount()), nullNS);
/*    */       }
/*    */       
/* 77 */       if (sq.getInterval() != 0L) {
/* 78 */         long interval = sq.getInterval() / 1000L;
/* 79 */         el.addAttribute(""interval"", Long.toString(interval), nullNS);
/*    */       } 
/*    */     } 
/*    */     
/* 83 */     for (Object o : sq.getProperties()) {
/* 84 */       OMElement prop = (OMElement)o;
/* 85 */       task.addChild((OMNode)prop.cloneOMElement());
/*    */     } 
/*    */     
/* 88 */     return task;
/*    */   }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\startup\quartz\SimpleQuartzSerializer.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.startup.tasks.MessageInjector,"/*     */ package org.apache.synapse.startup.tasks;
/*     */ 
/*     */ import org.apache.axiom.om.OMElement;
/*     */ import org.apache.axis2.addressing.EndpointReference;
/*     */ import org.apache.commons.logging.Log;
/*     */ import org.apache.commons.logging.LogFactory;
/*     */ import org.apache.synapse.ManagedLifecycle;
/*     */ import org.apache.synapse.MessageContext;
/*     */ import org.apache.synapse.core.SynapseEnvironment;
/*     */ import org.apache.synapse.startup.Task;
/*     */ import org.apache.synapse.util.PayloadHelper;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class MessageInjector
/*     */   implements Task, ManagedLifecycle
/*     */ {
/*  40 */   private Log log = LogFactory.getLog(MessageInjector.class);
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  45 */   private OMElement message = null;
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  50 */   private String to = null;
/*     */   
/*  52 */   private String soapAction = null;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   private SynapseEnvironment synapseEnvironment;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  66 */   public void init(SynapseEnvironment se) { this.synapseEnvironment = se; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public void setMessage(OMElement elem) {
/*  76 */     this.log.debug(""set message "" + elem.toString());
/*  77 */     this.message = elem;
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  87 */   public void setTo(String url) { this.to = url; }
/*     */ 
/*     */ 
/*     */   
/*  91 */   public void setSoapAction(String soapAction) { this.soapAction = soapAction; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public void execute() {
/*  99 */     this.log.debug(""execute"");
/* 100 */     if (this.synapseEnvironment == null) {
/* 101 */       this.log.error(""Synapse Environment not set"");
/*     */       return;
/*     */     } 
/* 104 */     if (this.message == null) {
/* 105 */       this.log.error(""message not set"");
/*     */       
/*     */       return;
/*     */     } 
/* 109 */     if (this.to == null) {
/* 110 */       this.log.error(""to address not set"");
/*     */       
/*     */       return;
/*     */     } 
/* 114 */     MessageContext mc = this.synapseEnvironment.createMessageContext();
/* 115 */     mc.setTo(new EndpointReference(this.to));
/* 116 */     PayloadHelper.setXMLPayload(mc, this.message.cloneOMElement());
/* 117 */     if (this.soapAction != null) {
/* 118 */       mc.setSoapAction(this.soapAction);
/*     */     }
/* 120 */     this.synapseEnvironment.injectMessage(mc);
/*     */   }
/*     */   
/*     */   public void destroy() {}
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\startup\tasks\MessageInjector.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.statistics.Statistics,"/*     */ package org.apache.synapse.statistics;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class Statistics
/*     */ {
/*  28 */   private long maxProcessingTime = 0L;
/*     */   
/*  30 */   private long minProcessingTime = -1L;
/*     */   
/*  32 */   private double avgProcessingTime = 0.0D;
/*     */   
/*     */   private double totalProcessingTime;
/*     */   
/*  36 */   private int count = 0;
/*     */   
/*  38 */   private int faultCount = 0;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public void update(long inTime, long outTime, boolean isFault) {
/*  49 */     if (outTime < 0L || inTime < 0L) {
/*     */       return;
/*     */     }
/*     */     
/*  53 */     this.count++;
/*  54 */     if (isFault) {
/*  55 */       this.faultCount++;
/*     */     }
/*     */     
/*  58 */     long responseTime = outTime - inTime;
/*  59 */     if (this.maxProcessingTime < responseTime) {
/*  60 */       this.maxProcessingTime = responseTime;
/*     */     }
/*  62 */     if (this.minProcessingTime > responseTime) {
/*  63 */       this.minProcessingTime = responseTime;
/*     */     }
/*  65 */     if (this.minProcessingTime == -1L) {
/*  66 */       this.minProcessingTime = responseTime;
/*     */     }
/*  68 */     this.totalProcessingTime += responseTime;
/*  69 */     this.avgProcessingTime = this.totalProcessingTime / this.count;
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  76 */   public long getMaxProcessingTime() { return this.maxProcessingTime; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  83 */   public double getAvgProcessingTime() { return this.avgProcessingTime; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  90 */   public long getMinProcessingTime() { return this.minProcessingTime; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  97 */   public int getFaultCount() { return this.faultCount; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 104 */   public int getCount() { return this.count; }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\statistics\Statistics.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.statistics.StatisticsCollector,"/*     */ package org.apache.synapse.statistics;
/*     */ 
/*     */ import java.util.Collections;
/*     */ import java.util.HashMap;
/*     */ import java.util.Map;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class StatisticsCollector
/*     */ {
/*  32 */   private Map sequenceStatistics = Collections.synchronizedMap(new HashMap<Object, Object>());
/*     */ 
/*     */   
/*  35 */   private Map endpointStatistics = Collections.synchronizedMap(new HashMap<Object, Object>());
/*     */ 
/*     */   
/*  38 */   private Map proxyServicesStatistics = Collections.synchronizedMap(new HashMap<Object, Object>());
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public void reportForEndPoint(String keyOfStatistic, boolean isResponse, long inTime, long outTime, boolean isFault) {
/*  51 */     StatisticsHolder statisticsHolder = (StatisticsHolder)this.endpointStatistics.get(keyOfStatistic);
/*     */     
/*  53 */     if (statisticsHolder == null) {
/*  54 */       statisticsHolder = new StatisticsHolder();
/*  55 */       statisticsHolder.setKey(keyOfStatistic);
/*  56 */       statisticsHolder.setStatisticsCategory(2);
/*  57 */       this.endpointStatistics.put(keyOfStatistic, statisticsHolder);
/*     */     } 
/*  59 */     statisticsHolder.update(isResponse, inTime, outTime, isFault);
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public void reportForProxyService(String keyOfStatistic, boolean isResponse, long inTime, long outTime, boolean isFault) {
/*  74 */     StatisticsHolder statisticsHolder = (StatisticsHolder)this.proxyServicesStatistics.get(keyOfStatistic);
/*     */     
/*  76 */     if (statisticsHolder == null) {
/*  77 */       statisticsHolder = new StatisticsHolder();
/*  78 */       statisticsHolder.setKey(keyOfStatistic);
/*  79 */       statisticsHolder.setStatisticsCategory(1);
/*  80 */       this.proxyServicesStatistics.put(keyOfStatistic, statisticsHolder);
/*     */     } 
/*  82 */     statisticsHolder.update(isResponse, inTime, outTime, isFault);
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public void reportForSequence(String keyOfStatistic, boolean isResponse, long inTime, long outTime, boolean isFault) {
/*  96 */     StatisticsHolder statisticsHolder = (StatisticsHolder)this.sequenceStatistics.get(keyOfStatistic);
/*     */     
/*  98 */     if (statisticsHolder == null) {
/*  99 */       statisticsHolder = new StatisticsHolder();
/* 100 */       statisticsHolder.setKey(keyOfStatistic);
/* 101 */       statisticsHolder.setStatisticsCategory(0);
/* 102 */       this.sequenceStatistics.put(keyOfStatistic, statisticsHolder);
/*     */     } 
/* 104 */     statisticsHolder.update(isResponse, inTime, outTime, isFault);
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 113 */   public Map getSequenceStatistics() { return this.sequenceStatistics; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 122 */   public Map getProxyServiceStatistics() { return this.proxyServicesStatistics; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 131 */   public Map getEndPointStatistics() { return this.endpointStatistics; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 138 */   public void resetSequenceStatistics() { this.sequenceStatistics.clear(); }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 145 */   public void resetProxyServiceStatistics() { this.proxyServicesStatistics.clear(); }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 152 */   public void resetEndPointStatistics() { this.endpointStatistics.clear(); }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\statistics\StatisticsCollector.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.statistics.StatisticsHolder,"/*     */ package org.apache.synapse.statistics;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class StatisticsHolder
/*     */ {
/*     */   private int statisticsCategory;
/*     */   private String key;
/*     */   private Statistics inFlowStatistics;
/*     */   private Statistics outFlowStatistics;
/*     */   
/*     */   public synchronized void update(boolean isResponse, long inTime, long outTime, boolean isFault) {
/*  47 */     if (isResponse) {
/*  48 */       if (this.outFlowStatistics == null) {
/*  49 */         this.outFlowStatistics = new Statistics();
/*     */       }
/*  51 */       this.outFlowStatistics.update(inTime, outTime, isFault);
/*     */     } else {
/*  53 */       if (this.inFlowStatistics == null) {
/*  54 */         this.inFlowStatistics = new Statistics();
/*     */       }
/*  56 */       this.inFlowStatistics.update(inTime, outTime, isFault);
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  66 */   public synchronized Statistics getInFlowStatistics() { return this.inFlowStatistics; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  74 */   public synchronized Statistics getOutFlowStatistics() { return this.outFlowStatistics; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  82 */   public int getStatisticsCategory() { return this.statisticsCategory; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  90 */   public void setStatisticsCategory(int statisticsCategory) { this.statisticsCategory = statisticsCategory; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  98 */   public String getKey() { return this.key; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 106 */   public void setKey(String key) { this.key = key; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public synchronized void clearStatistics() {
/* 113 */     this.inFlowStatistics = null;
/* 114 */     this.outFlowStatistics = null;
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\statistics\StatisticsHolder.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.statistics.StatisticsStack,"package org.apache.synapse.statistics;
public interface StatisticsStack {
  void put(String paramString, long paramLong, boolean paramBoolean1, boolean paramBoolean2, boolean paramBoolean3);
  void reportToStatisticsCollector(StatisticsCollector paramStatisticsCollector, boolean paramBoolean);
  void reportToStatisticsCollector(StatisticsCollector paramStatisticsCollector, boolean paramBoolean, String paramString);
  void reportAllToStatisticsCollector(StatisticsCollector paramStatisticsCollector, boolean paramBoolean);
}
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\statistics\StatisticsStack.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.statistics.StatisticsUtils,"/*     */ package org.apache.synapse.statistics;
/*     */ 
/*     */ import org.apache.synapse.MessageContext;
/*     */ import org.apache.synapse.core.SynapseEnvironment;
/*     */ import org.apache.synapse.endpoints.Endpoint;
/*     */ import org.apache.synapse.statistics.impl.EndPointStatisticsStack;
/*     */ import org.apache.synapse.statistics.impl.ProxyServiceStatisticsStack;
/*     */ import org.apache.synapse.statistics.impl.SequenceStatisticsStack;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class StatisticsUtils
/*     */ {
/*     */   public static void processProxyServiceStatistics(MessageContext synCtx) {
/*  43 */     StatisticsCollector statisticsCollector = getStatisticsCollector(synCtx);
/*  44 */     boolean isFault = synCtx.getEnvelope().getBody().hasFault();
/*  45 */     ProxyServiceStatisticsStack proxyServiceStatisticsStack = (ProxyServiceStatisticsStack)synCtx.getProperty(""synapse.proxy.stats"");
/*     */     
/*  47 */     if (proxyServiceStatisticsStack != null) {
/*  48 */       proxyServiceStatisticsStack.reportToStatisticsCollector(statisticsCollector, isFault);
/*     */     }
/*  50 */     ProxyServiceStatisticsStack synapseServiceStatisticsStack = (ProxyServiceStatisticsStack)synCtx.getProperty(""synapse.service.stats"");
/*     */     
/*  52 */     if (synapseServiceStatisticsStack != null) {
/*  53 */       synapseServiceStatisticsStack.reportToStatisticsCollector(statisticsCollector, isFault);
/*     */     }
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public static void processEndPointStatistics(MessageContext synCtx) {
/*  63 */     StatisticsCollector statisticsCollector = getStatisticsCollector(synCtx);
/*  64 */     boolean isFault = synCtx.getEnvelope().getBody().hasFault();
/*  65 */     EndPointStatisticsStack endPointStatisticsStack = (EndPointStatisticsStack)synCtx.getProperty(""synapse.endpoint.stats"");
/*     */     
/*  67 */     if (endPointStatisticsStack != null) {
/*  68 */       Object endpointObj = synCtx.getProperty(""processed_endpoint"");
/*  69 */       if (endpointObj instanceof Endpoint) {
/*  70 */         Endpoint endpoint = (Endpoint)endpointObj;
/*  71 */         String name = endpoint.getName();
/*  72 */         if (name == null) {
/*  73 */           endPointStatisticsStack.reportToStatisticsCollector(statisticsCollector, isFault);
/*     */         } else {
/*     */           
/*  76 */           endPointStatisticsStack.reportToStatisticsCollector(statisticsCollector, isFault, name);
/*     */         } 
/*     */         
/*  79 */         endPointStatisticsStack.reportAllToStatisticsCollector(statisticsCollector, true);
/*     */       } 
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public static void processSequenceStatistics(MessageContext synCtx) {
/*  90 */     StatisticsCollector statisticsCollector = getStatisticsCollector(synCtx);
/*  91 */     boolean isFault = synCtx.getEnvelope().getBody().hasFault();
/*  92 */     SequenceStatisticsStack sequenceStatisticsStack = (SequenceStatisticsStack)synCtx.getProperty(""synapse.sequence.stats"");
/*     */     
/*  94 */     if (sequenceStatisticsStack != null) {
/*  95 */       sequenceStatisticsStack.reportToStatisticsCollector(statisticsCollector, isFault);
/*     */     }
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public static void processAllSequenceStatistics(MessageContext synCtx) {
/* 105 */     StatisticsCollector statisticsCollector = getStatisticsCollector(synCtx);
/* 106 */     boolean isFault = synCtx.getEnvelope().getBody().hasFault();
/* 107 */     SequenceStatisticsStack sequenceStatisticsStack = (SequenceStatisticsStack)synCtx.getProperty(""synapse.sequence.stats"");
/*     */     
/* 109 */     if (sequenceStatisticsStack != null) {
/* 110 */       sequenceStatisticsStack.reportAllToStatisticsCollector(statisticsCollector, isFault);
/*     */     }
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   private static StatisticsCollector getStatisticsCollector(MessageContext synCtx) {
/* 120 */     SynapseEnvironment synEnv = synCtx.getEnvironment();
/* 121 */     StatisticsCollector statisticsCollector = null;
/* 122 */     if (synEnv != null) {
/* 123 */       statisticsCollector = synEnv.getStatisticsCollector();
/* 124 */       if (statisticsCollector == null) {
/* 125 */         statisticsCollector = new StatisticsCollector();
/* 126 */         synEnv.setStatisticsCollector(statisticsCollector);
/*     */       } 
/*     */     } 
/* 129 */     return statisticsCollector;
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\statistics\StatisticsUtils.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.statistics.impl.EndPointStatisticsStack,"/*     */ package org.apache.synapse.statistics.impl;
/*     */ 
/*     */ import java.util.ArrayList;
/*     */ import java.util.Iterator;
/*     */ import java.util.List;
/*     */ import org.apache.synapse.statistics.StatisticsCollector;
/*     */ import org.apache.synapse.statistics.StatisticsStack;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class EndPointStatisticsStack
/*     */   implements StatisticsStack
/*     */ {
/*     */   private List endpointStatistics;
/*     */   private boolean isCompleteInFlowStatisicsReport = false;
/*     */   
/*     */   public void put(String key, long initTime, boolean isInFlow, boolean isStatisticsEnable, boolean isFault) {
/*  49 */     if (this.endpointStatistics == null) {
/*  50 */       this.endpointStatistics = new ArrayList();
/*     */     }
/*  52 */     this.endpointStatistics.add(new EndPointStatistics(key, initTime, isInFlow, isStatisticsEnable, isFault));
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public void reportToStatisticsCollector(StatisticsCollector statisticsCollector, boolean isFault) {
/*  64 */     if (this.endpointStatistics != null && !this.endpointStatistics.isEmpty()) {
/*  65 */       EndPointStatistics statistics = this.endpointStatistics.get(this.endpointStatistics.size() - 1);
/*     */ 
/*     */       
/*  68 */       if (statistics != null && statistics.isStatisticsEnable && statistics.endPointName != null)
/*     */       {
/*  70 */         if (statistics.inTimeForInFlow != -1L) {
/*  71 */           long initTimeForOutFlow = System.currentTimeMillis();
/*  72 */           statisticsCollector.reportForEndPoint(statistics.endPointName, false, statistics.inTimeForInFlow, initTimeForOutFlow, isFault);
/*     */ 
/*     */           
/*  75 */           statistics.inTimeForInFlow = -1L;
/*  76 */           statistics.inTimeForOutFlow = initTimeForOutFlow;
/*  77 */         } else if (statistics.inTimeForOutFlow != -1L && this.isCompleteInFlowStatisicsReport) {
/*     */           
/*  79 */           statisticsCollector.reportForEndPoint(statistics.endPointName, true, statistics.inTimeForOutFlow, System.currentTimeMillis(), isFault);
/*     */ 
/*     */           
/*  82 */           this.endpointStatistics.remove(statistics);
/*     */         } 
/*     */       }
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public void reportToStatisticsCollector(StatisticsCollector statisticsCollector, boolean isFault, String name) {
/*  96 */     if (this.endpointStatistics != null && !this.endpointStatistics.isEmpty()) {
/*  97 */       List<EndPointStatistics> tobeRemoved = new ArrayList();
/*  98 */       Iterator epIterator = this.endpointStatistics.iterator();
/*  99 */       while (epIterator.hasNext()) {
/* 100 */         Object statisticsObj = epIterator.next();
/* 101 */         if (statisticsObj instanceof EndPointStatistics) {
/* 102 */           EndPointStatistics statistics = (EndPointStatistics)statisticsObj;
/* 103 */           if (statistics.isStatisticsEnable && statistics.endPointName != null && statistics.endPointName.equals(name)) {
/*     */             
/* 105 */             if (statistics.inTimeForInFlow != -1L) {
/* 106 */               long initTimeForOutFlow = System.currentTimeMillis();
/* 107 */               statisticsCollector.reportForEndPoint(statistics.endPointName, false, statistics.inTimeForInFlow, initTimeForOutFlow, isFault);
/*     */ 
/*     */               
/* 110 */               statistics.inTimeForInFlow = -1L;
/* 111 */               statistics.inTimeForOutFlow = initTimeForOutFlow; continue;
/* 112 */             }  if (statistics.inTimeForOutFlow != -1L && this.isCompleteInFlowStatisicsReport) {
/*     */               
/* 114 */               statisticsCollector.reportForEndPoint(statistics.endPointName, true, statistics.inTimeForOutFlow, System.currentTimeMillis(), isFault);
/*     */ 
/*     */               
/* 117 */               tobeRemoved.add(statistics);
/*     */             } 
/*     */           } 
/*     */         } 
/*     */       } 
/* 122 */       this.endpointStatistics.removeAll(tobeRemoved);
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public void reportAllToStatisticsCollector(StatisticsCollector statisticsCollector, boolean isFault) {
/* 132 */     if (this.endpointStatistics != null && !this.endpointStatistics.isEmpty()) {
/* 133 */       List<EndPointStatistics> tobeRemoved = new ArrayList();
/* 134 */       Iterator epIterator = this.endpointStatistics.iterator();
/* 135 */       while (epIterator.hasNext()) {
/* 136 */         Object statisticsObj = epIterator.next();
/* 137 */         if (statisticsObj instanceof EndPointStatistics) {
/* 138 */           EndPointStatistics statistics = (EndPointStatistics)statisticsObj;
/* 139 */           if (statistics.isStatisticsEnable && statistics.endPointName != null) {
/* 140 */             if (statistics.inTimeForInFlow != -1L) {
/* 141 */               long initTimeForOutFlow = System.currentTimeMillis();
/* 142 */               statisticsCollector.reportForEndPoint(statistics.endPointName, false, statistics.inTimeForInFlow, initTimeForOutFlow, isFault);
/*     */ 
/*     */               
/* 145 */               statistics.inTimeForInFlow = -1L;
/* 146 */               statistics.inTimeForOutFlow = initTimeForOutFlow; continue;
/* 147 */             }  if (statistics.inTimeForOutFlow != -1L && this.isCompleteInFlowStatisicsReport) {
/*     */               
/* 149 */               statisticsCollector.reportForEndPoint(statistics.endPointName, true, statistics.inTimeForOutFlow, System.currentTimeMillis(), isFault);
/*     */ 
/*     */               
/* 152 */               tobeRemoved.add(statistics);
/*     */             } 
/*     */           } 
/*     */         } 
/*     */       } 
/* 157 */       this.endpointStatistics.removeAll(tobeRemoved);
/*     */     } 
/* 159 */     this.isCompleteInFlowStatisicsReport = true;
/*     */   }
/*     */ 
/*     */   
/*     */   class EndPointStatistics
/*     */   {
/*     */     private String endPointName;
/*     */     
/*     */     private boolean isStatisticsEnable;
/*     */     
/*     */     private boolean isFault;
/*     */     
/* 171 */     private long inTimeForInFlow = -1L;
/*     */     
/* 173 */     private long inTimeForOutFlow = -1L;
/*     */ 
/*     */     
/*     */     public EndPointStatistics(String endPointName, long initTime, boolean inFlow, boolean statisticsEnable, boolean fault) {
/* 177 */       if (inFlow) {
/* 178 */         this.endPointName = endPointName;
/* 179 */         this.inTimeForInFlow = initTime;
/* 180 */         this.isStatisticsEnable = statisticsEnable;
/* 181 */         this.isFault = fault;
/*     */       } 
/*     */     }
/*     */     
/*     */     public boolean equals(Object o) {
/* 186 */       if (this == o) return true; 
/* 187 */       if (o == null || getClass() != o.getClass()) return false;
/*     */       
/* 189 */       EndPointStatistics that = (EndPointStatistics)o;
/*     */       
/* 191 */       if ((this.endPointName != null) ? !this.endPointName.equals(that.endPointName) : (that.endPointName != null)) {
/* 192 */         return false;
/*     */       }
/* 194 */       return true;
/*     */     }
/*     */ 
/*     */     
/* 198 */     public int hashCode() { return (this.endPointName != null) ? this.endPointName.hashCode() : 0; }
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\statistics\impl\EndPointStatisticsStack.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.statistics.impl.ProxyServiceStatisticsStack,"/*     */ package org.apache.synapse.statistics.impl;
/*     */ 
/*     */ import org.apache.commons.logging.Log;
/*     */ import org.apache.commons.logging.LogFactory;
/*     */ import org.apache.synapse.SynapseException;
/*     */ import org.apache.synapse.statistics.StatisticsCollector;
/*     */ import org.apache.synapse.statistics.StatisticsStack;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class ProxyServiceStatisticsStack
/*     */   implements StatisticsStack
/*     */ {
/*  34 */   private static final Log log = LogFactory.getLog(ProxyServiceStatisticsStack.class);
/*     */   
/*     */   private String proxyServiceName;
/*     */   
/*     */   private boolean isStatisticsEnable = false;
/*     */   
/*  40 */   private long inTimeForInFlow = -1L;
/*     */   
/*  42 */   private long inTimeForOutFlow = -1L;
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   private boolean isINFault;
/*     */ 
/*     */ 
/*     */   
/*     */   private boolean isOUTFault;
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public void put(String key, long initTime, boolean isInFlow, boolean isStatisticsEnable, boolean isFault) {
/*  57 */     if (isInFlow) {
/*  58 */       this.proxyServiceName = key;
/*  59 */       this.isStatisticsEnable = isStatisticsEnable;
/*  60 */       this.inTimeForInFlow = initTime;
/*  61 */       this.isINFault = isFault;
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public void reportToStatisticsCollector(StatisticsCollector statisticsCollector, boolean isFault) {
/*  71 */     synchronized (this) {
/*  72 */       if (this.proxyServiceName != null && this.isStatisticsEnable && this.inTimeForInFlow != -1L) {
/*  73 */         this.inTimeForOutFlow = System.currentTimeMillis();
/*  74 */         this.isOUTFault = isFault;
/*  75 */         statisticsCollector.reportForProxyService(this.proxyServiceName, false, this.inTimeForInFlow, this.inTimeForOutFlow, this.isINFault);
/*     */         
/*  77 */         this.inTimeForInFlow = -1L;
/*  78 */       } else if (this.inTimeForOutFlow != -1L) {
/*  79 */         statisticsCollector.reportForProxyService(this.proxyServiceName, true, this.inTimeForOutFlow, System.currentTimeMillis(), isFault);
/*     */         
/*  81 */         this.inTimeForOutFlow = -1L;
/*     */       } 
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public void reportToStatisticsCollector(StatisticsCollector statisticsCollector, boolean isFault, String name) {
/*  95 */     if (name != null && this.proxyServiceName != null && this.proxyServiceName.equals(name)) {
/*  96 */       reportToStatisticsCollector(statisticsCollector, isFault);
/*     */     } else {
/*  98 */       handleException(""Invalid ProxyService Name "" + name + "" expected "" + this.proxyServiceName);
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 109 */   public void reportAllToStatisticsCollector(StatisticsCollector statisticsCollector, boolean isFault) { reportToStatisticsCollector(statisticsCollector, isFault); }
/*     */ 
/*     */   
/*     */   private void handleException(String msg) {
/* 113 */     log.error(msg);
/* 114 */     throw new SynapseException(msg);
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\statistics\impl\ProxyServiceStatisticsStack.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.statistics.impl.SequenceStatisticsStack,"/*     */ package org.apache.synapse.statistics.impl;
/*     */ 
/*     */ import java.util.ArrayList;
/*     */ import java.util.Iterator;
/*     */ import java.util.List;
/*     */ import org.apache.synapse.statistics.StatisticsCollector;
/*     */ import org.apache.synapse.statistics.StatisticsStack;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class SequenceStatisticsStack
/*     */   implements StatisticsStack
/*     */ {
/*  36 */   private List sequenceStatisticsList = new ArrayList();
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  49 */   public void put(String sequenceName, long initTime, boolean isInFlow, boolean isStatisticsEnable, boolean isFault) { this.sequenceStatisticsList.add(new SequenceStatistics(sequenceName, initTime, isInFlow, isStatisticsEnable, isFault)); }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public void reportToStatisticsCollector(StatisticsCollector statisticsCollector, boolean isFault) {
/*  61 */     int top = this.sequenceStatisticsList.size();
/*  62 */     if (top > 0) {
/*  63 */       popSequenceStatistics(this.sequenceStatisticsList.size() - 1, statisticsCollector);
/*     */     }
/*     */   }
/*     */ 
/*     */   
/*     */   public void reportToStatisticsCollector(StatisticsCollector statisticsCollector, boolean isFault, String name) {
/*  69 */     if (!this.sequenceStatisticsList.isEmpty()) {
/*  70 */       List<SequenceStatistics> tobeRemoved = new ArrayList();
/*  71 */       Iterator<SequenceStatistics> seqIterator = this.sequenceStatisticsList.iterator();
/*  72 */       while (seqIterator.hasNext()) {
/*  73 */         SequenceStatistics sequenceStatistics = seqIterator.next();
/*     */         
/*  75 */         if (sequenceStatistics != null) {
/*  76 */           if (sequenceStatistics.isStatisticsEnable && sequenceStatistics.sequenceName != null && sequenceStatistics.sequenceName.equals(name))
/*     */           {
/*     */ 
/*     */             
/*  80 */             statisticsCollector.reportForSequence(sequenceStatistics.sequenceName, !sequenceStatistics.isInFlow, sequenceStatistics.initTime, System.currentTimeMillis(), sequenceStatistics.isFault);
/*     */           }
/*     */ 
/*     */           
/*  84 */           tobeRemoved.add(sequenceStatistics);
/*     */         } 
/*     */       } 
/*  87 */       this.sequenceStatisticsList.removeAll(tobeRemoved);
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public void reportAllToStatisticsCollector(StatisticsCollector statisticsCollector, boolean isFault) {
/*  99 */     int i = this.sequenceStatisticsList.size() - 1;
/* 100 */     for (; i >= 0; i--) {
/* 101 */       popSequenceStatistics(i, statisticsCollector);
/*     */     }
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   private void popSequenceStatistics(int index, StatisticsCollector statisticsCollector) {
/* 111 */     if (index >= 0) {
/* 112 */       SequenceStatistics sequenceStatistics = this.sequenceStatisticsList.get(index);
/*     */       
/* 114 */       if (sequenceStatistics != null) {
/* 115 */         if (sequenceStatistics.isStatisticsEnable && sequenceStatistics.sequenceName != null)
/*     */         {
/* 117 */           statisticsCollector.reportForSequence(sequenceStatistics.sequenceName, !sequenceStatistics.isInFlow, sequenceStatistics.initTime, System.currentTimeMillis(), sequenceStatistics.isFault);
/*     */         }
/*     */ 
/*     */         
/* 121 */         this.sequenceStatisticsList.remove(index);
/*     */       } 
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */   
/*     */   class SequenceStatistics
/*     */   {
/*     */     String sequenceName;
/*     */ 
/*     */     
/*     */     long initTime;
/*     */ 
/*     */     
/*     */     boolean isInFlow;
/*     */     
/*     */     boolean isStatisticsEnable;
/*     */     
/*     */     private boolean isFault;
/*     */ 
/*     */     
/*     */     public SequenceStatistics(String sequenceName, long initTime, boolean inFlow, boolean statisticsEnable, boolean isFault) {
/* 144 */       this.sequenceName = sequenceName;
/* 145 */       this.initTime = initTime;
/* 146 */       this.isInFlow = inFlow;
/* 147 */       this.isStatisticsEnable = statisticsEnable;
/* 148 */       this.isFault = isFault;
/*     */     }
/*     */     
/*     */     public boolean equals(Object o) {
/* 152 */       if (this == o) return true; 
/* 153 */       if (o == null || getClass() != o.getClass()) return false;
/*     */       
/* 155 */       SequenceStatistics that = (SequenceStatistics)o;
/*     */       
/* 157 */       if (!this.sequenceName.equals(that.sequenceName)) return false;
/*     */       
/* 159 */       return true;
/*     */     }
/*     */ 
/*     */     
/* 163 */     public int hashCode() { return this.sequenceName.hashCode(); }
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synapse\statistics\impl\SequenceStatisticsStack.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.util.AXIOMUtils,"/*    */ package org.apache.synapse.util;
/*    */ 
/*    */ import javax.xml.transform.Source;
/*    */ import javax.xml.transform.dom.DOMSource;
/*    */ import org.apache.axiom.om.OMElement;
/*    */ import org.apache.axiom.om.OMNode;
/*    */ import org.springframework.xml.transform.StaxSource;
/*    */ import org.w3c.dom.Node;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class AXIOMUtils
/*    */ {
/*    */   public static Source asSource(OMNode node) {
/* 44 */     if (node instanceof org.apache.axiom.om.impl.dom.NodeImpl) {
/* 45 */       return new DOMSource((Node)node);
/*    */     }
/*    */ 
/*    */     
/* 49 */     return (Source)new StaxSource(((OMElement)node).getXMLStreamReader());
/*    */   }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synaps\\util\AXIOMUtils.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.util.ClasspathURLStreamHandler,"/*    */ package org.apache.synapse.util;
/*    */ 
/*    */ import java.io.IOException;
/*    */ import java.io.InputStream;
/*    */ import java.io.OutputStream;
/*    */ import java.net.MalformedURLException;
/*    */ import java.net.URL;
/*    */ import java.net.URLConnection;
/*    */ import java.net.URLStreamHandler;
/*    */ import org.apache.commons.lang.StringUtils;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public final class ClasspathURLStreamHandler
/*    */   extends URLStreamHandler
/*    */ {
/* 35 */   public URLConnection openConnection(URL url) { return new URLConnectionImpl(url); }
/*    */ 
/*    */   
/*    */   private static final class URLConnectionImpl
/*    */     extends URLConnection
/*    */   {
/* 41 */     public URLConnectionImpl(URL url) { super(url); }
/*    */ 
/*    */     
/*    */     public void connect() {}
/*    */     
/*    */     public InputStream getInputStream() throws IOException {
/* 47 */       if (StringUtils.isNotEmpty(this.url.getHost())) {
/* 48 */         throw new MalformedURLException(""No host expected in classpath URLs"");
/*    */       }
/* 50 */       InputStream is = ClasspathURLStreamHandler.class.getClassLoader().getResourceAsStream(this.url.getFile());
/* 51 */       if (is == null) {
/* 52 */         throw new IOException(""Classpath resource not found: "" + this.url);
/*    */       }
/* 54 */       return is;
/*    */     }
/*    */ 
/*    */     
/* 58 */     public OutputStream getOutputStream() { throw new UnsupportedOperationException(); }
/*    */   }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synaps\\util\ClasspathURLStreamHandler.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.util.DataSourceRegistrar,"/*     */ package org.apache.synapse.util;
/*     */ 
/*     */ import java.io.ByteArrayOutputStream;
/*     */ import java.io.IOException;
/*     */ import java.io.ObjectOutputStream;
/*     */ import java.net.InetAddress;
/*     */ import java.net.UnknownHostException;
/*     */ import java.util.Hashtable;
/*     */ import java.util.Properties;
/*     */ import javax.naming.BinaryRefAddr;
/*     */ import javax.naming.Context;
/*     */ import javax.naming.InitialContext;
/*     */ import javax.naming.NamingException;
/*     */ import javax.naming.Reference;
/*     */ import javax.naming.StringRefAddr;
/*     */ import org.apache.commons.logging.Log;
/*     */ import org.apache.commons.logging.LogFactory;
/*     */ import org.apache.synapse.SynapseException;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class DataSourceRegistrar
/*     */ {
/*  40 */   public static final Log log = LogFactory.getLog(DataSourceRegistrar.class);
/*     */   
/*     */   private static final String PROP_ICFACTORY = ""icFactory"";
/*     */   
/*     */   private static final String PROP_PROVIDER_URL = ""providerUrl"";
/*     */   
/*     */   private static final String PROP_PROVIDER_PORT = ""providerPort"";
/*     */   
/*     */   private static final String DOT_STRING = ""."";
/*     */   
/*     */   private static final String PROP_USER_NAME = ""username"";
/*     */   
/*     */   private static final String PROP_PASSWORD = ""password"";
/*     */   
/*     */   private static final String PROP_DRIVER_CLS_NAME = ""driverClassName"";
/*     */   
/*     */   private static final String PROP_DSNAME = ""dsName"";
/*     */   
/*     */   private static final String PROP_URL = ""url"";
/*     */   
/*     */   private static final String PROP_DRIVER = ""driver"";
/*     */   
/*     */   private static final String PROP_USER = ""user"";
/*     */   
/*     */   private static final String PROP_CPDSADAPTER = ""cpdsadapter"";
/*     */   
/*     */   private static final String PROP_JNDI_ENV = ""jndiEnvironment"";
/*     */   
/*     */   private static final String PROP_DEFAULTMAXACTIVE = ""defaultMaxActive"";
/*     */   
/*     */   private static final String PROP_DEFAULTMAXIDLE = ""defaultMaxIdle"";
/*     */   
/*     */   private static final String PROP_DEFAULTMAXWAIT = ""defaultMaxWait"";
/*     */   private static final String PROP_DATA_SOURCE_NAME = ""dataSourceName"";
/*     */   private static final String PROP_DEFAULTAUTOCOMMIT = ""defaultAutoCommit"";
/*     */   private static final String PROP_DEFAULTREADONLY = ""defaultReadOnly"";
/*     */   private static final String PROP_TESTONBORROW = ""testOnBorrow"";
/*     */   private static final String PROP_TESTONRETURN = ""testOnReturn"";
/*     */   private static final String PROP_TIMEBETWEENEVICTIONRUNSMILLIS = ""timeBetweenEvictionRunsMillis"";
/*     */   private static final String PROP_NUMTESTSPEREVICTIONRUN = ""numTestsPerEvictionRun"";
/*     */   private static final String PROP_MINEVICTABLEIDLETIMEMILLIS = ""minEvictableIdleTimeMillis"";
/*     */   private static final String PROP_TESTWHILEIDLE = ""testWhileIdle"";
/*     */   private static final String PROP_VALIDATIONQUERY = ""validationQuery"";
/*     */   private static final String PROP_MAXACTIVE = ""maxActive"";
/*     */   private static final String PROP_MAXIDLE = ""maxIdle"";
/*     */   private static final String PROP_MAXWAIT = ""maxWait"";
/*     */   private static final String PROP_MINIDLE = ""minIdle"";
/*     */   private static final String PROP_INITIALSIZE = ""initialSize"";
/*     */   private static final String PROP_DEFAULTTRANSACTIONISOLATION = ""defaultTransactionIsolation"";
/*     */   private static final String PROP_DEFAULTCATALOG = ""defaultCatalog"";
/*     */   private static final String PROP_ACCESSTOUNDERLYINGCONNECTIONALLOWED = ""accessToUnderlyingConnectionAllowed"";
/*     */   private static final String PROP_REMOVEABANDONED = ""removeAbandoned"";
/*     */   private static final String PROP_REMOVEABANDONEDTIMEOUT = ""removeAbandonedTimeout"";
/*     */   private static final String PROP_LOGABANDONED = ""logAbandoned"";
/*     */   private static final String PROP_POOLPREPAREDSTATEMENTS = ""poolPreparedStatements"";
/*     */   private static final String PROP_MAXOPENPREPAREDSTATEMENTS = ""maxOpenPreparedStatements"";
/*     */   private static final String PROP_CONNECTIONPROPERTIES = ""connectionProperties"";
/*     */   
/*     */   public static void registerDataSources(Properties dsProperties) {
/*  99 */     if (dsProperties == null) {
/* 100 */       if (log.isDebugEnabled()) {
/* 101 */         log.debug(""DataSource properties cannot be found.."");
/*     */       }
/*     */       
/*     */       return;
/*     */     } 
/* 106 */     String dataSources = getProperty(dsProperties, ""synapse.datasources"", null);
/*     */ 
/*     */     
/* 109 */     if (dataSources == null || """".equals(dataSources)) {
/* 110 */       if (log.isDebugEnabled()) {
/* 111 */         log.debug(""No DataSources defined for initialization.."");
/*     */       }
/*     */       
/*     */       return;
/*     */     } 
/* 116 */     String[] dataSourcesNames = dataSources.split("","");
/* 117 */     if (dataSourcesNames == null || dataSourcesNames.length == 0) {
/* 118 */       if (log.isDebugEnabled()) {
/* 119 */         log.debug(""No DataSource definitions found for initialization.."");
/*     */       }
/*     */       
/*     */       return;
/*     */     } 
/* 124 */     StringBuffer buffer = new StringBuffer();
/* 125 */     buffer.append(""synapse.datasources"");
/* 126 */     buffer.append(""."");
/*     */     
/* 128 */     String rootPrefix = buffer.toString();
/*     */ 
/*     */     
/* 131 */     Hashtable<Object, Object> props = new Hashtable<Object, Object>();
/* 132 */     Properties jndiEvn = new Properties();
/*     */     
/* 134 */     String namingFactory = getProperty(dsProperties, rootPrefix + ""icFactory"", ""com.sun.jndi.rmi.registry.RegistryContextFactory"");
/*     */ 
/*     */     
/* 137 */     props.put(""java.naming.factory.initial"", namingFactory);
/* 138 */     jndiEvn.put(""java.naming.factory.initial"", namingFactory);
/*     */     
/* 140 */     String providerHost = ""localhost"";
/*     */     try {
/* 142 */       InetAddress addr = InetAddress.getLocalHost();
/* 143 */       if (addr != null) {
/* 144 */         String hostname = addr.getHostName();
/* 145 */         if (hostname == null) {
/* 146 */           String ipAddr = addr.getHostAddress();
/* 147 */           if (ipAddr != null) {
/* 148 */             providerHost = ipAddr;
/*     */           }
/*     */         } else {
/* 151 */           providerHost = hostname;
/*     */         } 
/*     */       } 
/* 154 */     } catch (UnknownHostException e) {
/* 155 */       log.warn(""Unable to determine hostname or IP address.. Using localhost"", e);
/*     */     } 
/*     */ 
/*     */     
/* 159 */     int port = 2199;
/* 160 */     String providerPort = getProperty(dsProperties, rootPrefix + ""providerPort"", String.valueOf(port));
/*     */     
/*     */     try {
/* 163 */       port = Integer.parseInt(providerPort);
/* 164 */     } catch (NumberFormatException ignored) {}
/*     */ 
/*     */ 
/*     */     
/* 168 */     RMIRegistryController.getInstance().createLocalRegistry(port);
/*     */     
/* 170 */     String providerUrl = getProperty(dsProperties, rootPrefix + ""providerUrl"", ""rmi://"" + providerHost + "":"" + providerPort);
/*     */ 
/*     */     
/* 173 */     props.put(""java.naming.provider.url"", providerUrl);
/* 174 */     jndiEvn.put(""java.naming.provider.url"", providerUrl);
/*     */     
/* 176 */     log.info(""DataSources will be registered in the JNDI context with provider PROP_URL : "" + providerUrl);
/*     */ 
/*     */     
/*     */     try {
/* 180 */       InitialContext initialContext = new InitialContext(props);
/*     */       
/* 182 */       for (int i = 0; i < dataSourcesNames.length; i++) {
/* 183 */         registerDataSource(dataSourcesNames[i], dsProperties, initialContext, jndiEvn);
/*     */       }
/*     */     }
/* 186 */     catch (NamingException e) {
/* 187 */       String msg = ""Error constructing an InitialContext to register DataSources"";
/* 188 */       handleException(msg, e);
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   private static void registerDataSource(String dsName, Properties dsProperties, InitialContext initialContext, Properties jndiEnv) {
/* 203 */     if (dsName == null || """".equals(dsName)) {
/* 204 */       if (log.isDebugEnabled()) {
/* 205 */         log.debug(""DataSource name is either empty or null, ignoring.."");
/*     */       }
/*     */       
/*     */       return;
/*     */     } 
/* 210 */     StringBuffer buffer = new StringBuffer();
/* 211 */     buffer.append(""synapse.datasources"");
/* 212 */     buffer.append(""."");
/* 213 */     buffer.append(dsName);
/* 214 */     buffer.append(""."");
/*     */ 
/*     */     
/* 217 */     String prefix = buffer.toString();
/*     */     
/* 219 */     String driver = getProperty(dsProperties, prefix + ""driverClassName"", null);
/* 220 */     if (driver == null) {
/* 221 */       handleException(prefix + ""driverClassName"" + "" cannot be found."");
/*     */     }
/*     */     
/* 224 */     String url = getProperty(dsProperties, prefix + ""url"", null);
/* 225 */     if (url == null) {
/* 226 */       handleException(prefix + ""url"" + "" cannot be found."");
/*     */     }
/*     */ 
/*     */     
/* 230 */     String user = getProperty(dsProperties, prefix + ""username"", ""synapse"");
/* 231 */     String password = getProperty(dsProperties, prefix + ""password"", ""synapse"");
/* 232 */     String dataSourceName = getProperty(dsProperties, prefix + ""dsName"", dsName);
/*     */ 
/*     */     
/* 235 */     populateContextTree(initialContext, dataSourceName);
/*     */     
/* 237 */     String dsType = getProperty(dsProperties, prefix + ""type"", ""BasicDataSource"");
/*     */     
/* 239 */     String maxActive = getProperty(dsProperties, prefix + ""maxActive"", String.valueOf(8));
/*     */     
/* 241 */     String maxIdle = getProperty(dsProperties, prefix + ""maxIdle"", String.valueOf(8));
/*     */     
/* 243 */     String maxWait = getProperty(dsProperties, prefix + ""maxWait"", String.valueOf(-1L));
/*     */ 
/*     */     
/* 246 */     if (""BasicDataSource"".equals(dsType)) {
/*     */       
/* 248 */       Reference ref = new Reference(""javax.sql.DataSource"", ""org.apache.commons.dbcp.BasicDataSourceFactory"", null);
/*     */ 
/*     */       
/* 251 */       ref.add(new StringRefAddr(""driverClassName"", driver));
/* 252 */       ref.add(new StringRefAddr(""url"", url));
/* 253 */       ref.add(new StringRefAddr(""username"", user));
/* 254 */       ref.add(new StringRefAddr(""password"", password));
/* 255 */       ref.add(new StringRefAddr(""maxActive"", maxActive));
/* 256 */       ref.add(new StringRefAddr(""maxIdle"", maxIdle));
/* 257 */       ref.add(new StringRefAddr(""maxWait"", maxWait));
/*     */ 
/*     */       
/* 260 */       setBasicDataSourceParameters(ref, dsProperties, prefix);
/*     */       
/* 262 */       setCommonParameters(ref, dsProperties, prefix);
/*     */       
/*     */       try {
/* 265 */         initialContext.rebind(dataSourceName, ref);
/* 266 */       } catch (NamingException e) {
/* 267 */         String msg = "" Error binding name ' "" + dataSourceName + "" ' to "" + ""the DataSource(BasicDataSource) reference"";
/*     */         
/* 269 */         handleException(msg, e);
/*     */       }
/*     */     
/* 272 */     } else if (""PerUserPoolDataSource"".equals(dsType)) {
/*     */ 
/*     */       
/* 275 */       String className = getProperty(dsProperties, prefix + ""cpdsadapter"" + ""."" + ""className"", ""org.apache.commons.dbcp.cpdsadapter.DriverAdapterCPDS"");
/*     */ 
/*     */       
/* 278 */       String factory = getProperty(dsProperties, prefix + ""cpdsadapter"" + ""."" + ""factory"", ""org.apache.commons.dbcp.cpdsadapter.DriverAdapterCPDS"");
/*     */ 
/*     */       
/* 281 */       String name = getProperty(dsProperties, prefix + ""cpdsadapter"" + ""."" + ""name"", ""cpds"");
/*     */ 
/*     */ 
/*     */       
/* 285 */       Reference cpdsRef = new Reference(className, factory, null);
/*     */ 
/*     */       
/* 288 */       cpdsRef.add(new StringRefAddr(""driver"", driver));
/* 289 */       cpdsRef.add(new StringRefAddr(""url"", url));
/* 290 */       cpdsRef.add(new StringRefAddr(""user"", user));
/* 291 */       cpdsRef.add(new StringRefAddr(""password"", password));
/*     */       
/*     */       try {
/* 294 */         initialContext.rebind(name, cpdsRef);
/* 295 */       } catch (NamingException e) {
/* 296 */         String msg = ""Error binding name '"" + name + ""' to "" + ""the DriverAdapterCPDS reference"";
/*     */         
/* 298 */         handleException(msg, e);
/*     */       } 
/*     */ 
/*     */       
/* 302 */       Reference ref = new Reference(""org.apache.commons.dbcp.datasources.PerUserPoolDataSource"", ""org.apache.commons.dbcp.datasources.PerUserPoolDataSourceFactory"", null);
/*     */ 
/*     */ 
/*     */       
/* 306 */       ref.add(new BinaryRefAddr(""jndiEnvironment"", serialize(jndiEnv)));
/* 307 */       ref.add(new StringRefAddr(""dataSourceName"", name));
/* 308 */       ref.add(new StringRefAddr(""defaultMaxActive"", maxActive));
/* 309 */       ref.add(new StringRefAddr(""defaultMaxIdle"", maxIdle));
/* 310 */       ref.add(new StringRefAddr(""defaultMaxWait"", maxWait));
/*     */ 
/*     */       
/* 313 */       setCommonParameters(ref, dsProperties, prefix);
/*     */       
/*     */       try {
/* 316 */         initialContext.rebind(dataSourceName, ref);
/* 317 */       } catch (NamingException e) {
/* 318 */         String msg = ""Error binding name ' "" + dataSourceName + "" ' to "" + ""the PerUserPoolDataSource reference"";
/*     */         
/* 320 */         handleException(msg, e);
/*     */       } 
/*     */     } else {
/*     */       
/* 324 */       handleException(""Unsupported data source type : "" + dsType);
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   private static byte[] serialize(Object data) {
/* 336 */     ObjectOutputStream outputStream = null;
/* 337 */     ByteArrayOutputStream binOut = null;
/* 338 */     byte[] result = null;
/*     */     try {
/* 340 */       binOut = new ByteArrayOutputStream();
/* 341 */       outputStream = new ObjectOutputStream(binOut);
/* 342 */       outputStream.writeObject(data);
/* 343 */       result = binOut.toByteArray();
/* 344 */     } catch (IOException e) {
/* 345 */       handleException(""Error serializing object :"" + data);
/*     */     } finally {
/* 347 */       if (binOut != null) {
/*     */         try {
/* 349 */           binOut.close();
/* 350 */         } catch (IOException ex) {}
/*     */       }
/*     */       
/* 353 */       if (outputStream != null) {
/*     */         try {
/* 355 */           outputStream.close();
/* 356 */         } catch (IOException ex) {}
/*     */       }
/*     */     } 
/*     */     
/* 360 */     return result;
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   private static void setCommonParameters(Reference reference, Properties properties, String prefix) {
/* 371 */     String defaultAutoCommit = getProperty(properties, prefix + ""defaultAutoCommit"", String.valueOf(true));
/*     */     
/* 373 */     String defaultReadOnly = getProperty(properties, prefix + ""defaultReadOnly"", String.valueOf(false));
/*     */     
/* 375 */     String testOnBorrow = getProperty(properties, prefix + ""testOnBorrow"", String.valueOf(true));
/*     */     
/* 377 */     String testOnReturn = getProperty(properties, prefix + ""testOnReturn"", String.valueOf(false));
/*     */     
/* 379 */     String timeBetweenEvictionRunsMillis = getProperty(properties, prefix + ""timeBetweenEvictionRunsMillis"", String.valueOf(-1L));
/*     */ 
/*     */     
/* 382 */     String numTestsPerEvictionRun = getProperty(properties, prefix + ""numTestsPerEvictionRun"", String.valueOf(3));
/*     */ 
/*     */     
/* 385 */     String minEvictableIdleTimeMillis = getProperty(properties, prefix + ""minEvictableIdleTimeMillis"", String.valueOf(1800000L));
/*     */ 
/*     */     
/* 388 */     String testWhileIdle = getProperty(properties, prefix + ""testWhileIdle"", String.valueOf(false));
/*     */     
/* 390 */     String validationQuery = getProperty(properties, prefix + ""validationQuery"", null);
/*     */ 
/*     */     
/* 393 */     reference.add(new StringRefAddr(""defaultAutoCommit"", defaultAutoCommit));
/* 394 */     reference.add(new StringRefAddr(""defaultReadOnly"", defaultReadOnly));
/* 395 */     reference.add(new StringRefAddr(""testOnBorrow"", testOnBorrow));
/* 396 */     reference.add(new StringRefAddr(""testOnReturn"", testOnReturn));
/* 397 */     reference.add(new StringRefAddr(""timeBetweenEvictionRunsMillis"", timeBetweenEvictionRunsMillis));
/*     */     
/* 399 */     reference.add(new StringRefAddr(""numTestsPerEvictionRun"", numTestsPerEvictionRun));
/* 400 */     reference.add(new StringRefAddr(""minEvictableIdleTimeMillis"", minEvictableIdleTimeMillis));
/*     */     
/* 402 */     reference.add(new StringRefAddr(""testWhileIdle"", testWhileIdle));
/* 403 */     if (validationQuery != null && !"""".equals(validationQuery)) {
/* 404 */       reference.add(new StringRefAddr(""validationQuery"", validationQuery));
/*     */     }
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   private static void setBasicDataSourceParameters(Reference reference, Properties properties, String prefix) {
/* 416 */     String minIdle = getProperty(properties, prefix + ""minIdle"", String.valueOf(0));
/*     */     
/* 418 */     String initialSize = getProperty(properties, prefix + ""initialSize"", String.valueOf(0));
/* 419 */     String defaultTransactionIsolation = getProperty(properties, prefix + ""defaultTransactionIsolation"", null);
/*     */     
/* 421 */     String defaultCatalog = getProperty(properties, prefix + ""defaultCatalog"", null);
/* 422 */     String accessToUnderlyingConnectionAllowed = getProperty(properties, prefix + ""accessToUnderlyingConnectionAllowed"", String.valueOf(false));
/*     */     
/* 424 */     String removeAbandoned = getProperty(properties, prefix + ""removeAbandoned"", String.valueOf(false));
/*     */     
/* 426 */     String removeAbandonedTimeout = getProperty(properties, prefix + ""removeAbandonedTimeout"", String.valueOf(300));
/*     */     
/* 428 */     String logAbandoned = getProperty(properties, prefix + ""logAbandoned"", String.valueOf(false));
/*     */     
/* 430 */     String poolPreparedStatements = getProperty(properties, prefix + ""poolPreparedStatements"", String.valueOf(false));
/*     */     
/* 432 */     String maxOpenPreparedStatements = getProperty(properties, prefix + ""maxOpenPreparedStatements"", String.valueOf(-1));
/*     */ 
/*     */ 
/*     */     
/* 436 */     reference.add(new StringRefAddr(""minIdle"", minIdle));
/* 437 */     if (defaultTransactionIsolation != null && !"""".equals(defaultTransactionIsolation)) {
/* 438 */       reference.add(new StringRefAddr(""defaultTransactionIsolation"", defaultTransactionIsolation));
/*     */     }
/*     */     
/* 441 */     reference.add(new StringRefAddr(""accessToUnderlyingConnectionAllowed"", accessToUnderlyingConnectionAllowed));
/*     */     
/* 443 */     reference.add(new StringRefAddr(""removeAbandoned"", removeAbandoned));
/* 444 */     reference.add(new StringRefAddr(""removeAbandonedTimeout"", removeAbandonedTimeout));
/* 445 */     reference.add(new StringRefAddr(""logAbandoned"", logAbandoned));
/* 446 */     reference.add(new StringRefAddr(""poolPreparedStatements"", poolPreparedStatements));
/* 447 */     reference.add(new StringRefAddr(""maxOpenPreparedStatements"", maxOpenPreparedStatements));
/*     */     
/* 449 */     reference.add(new StringRefAddr(""initialSize"", initialSize));
/* 450 */     if (defaultCatalog != null && !"""".equals(defaultCatalog)) {
/* 451 */       reference.add(new StringRefAddr(""defaultCatalog"", defaultCatalog));
/*     */     }
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   private static void populateContextTree(InitialContext initialContext, String path) {
/* 463 */     String[] paths = path.split(""/"");
/* 464 */     if (paths != null && paths.length > 1) {
/*     */       
/* 466 */       Context context = initialContext;
/* 467 */       for (int i = 0; i < paths.length; i++) {
/*     */         
/*     */         try {
/* 470 */           context = context.createSubcontext(paths[i]);
/* 471 */           if (context == null) {
/* 472 */             handleException(""sub context "" + paths[i] + "" could not be created"");
/*     */           }
/*     */         }
/* 475 */         catch (NamingException e) {
/* 476 */           handleException(""Unable to create sub context : "" + paths[i], e);
/*     */         } 
/*     */       } 
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   private static void handleException(String msg) {
/* 488 */     log.error(msg);
/* 489 */     throw new SynapseException(msg);
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   private static void handleException(String msg, Exception e) {
/* 499 */     log.error(msg, e);
/* 500 */     throw new SynapseException(msg, e);
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   private static String getProperty(Properties dsProperties, String name, String def) {
/* 513 */     String result = dsProperties.getProperty(name);
/* 514 */     if ((result == null || result.length() == 0 || """".equals(result)) && def != null) {
/* 515 */       if (log.isDebugEnabled()) {
/* 516 */         log.debug(""The name with ' "" + name + "" ' cannot be found. "" + ""Using default value "" + def);
/*     */       }
/*     */       
/* 519 */       result = def;
/*     */     } 
/* 521 */     if (result != null) {
/* 522 */       return result.trim();
/*     */     }
/* 524 */     return def;
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synaps\\util\DataSourceRegistrar.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.util.FixedByteArrayOutputStream,"/*    */ package org.apache.synapse.util;
/*    */ 
/*    */ import java.io.ByteArrayOutputStream;
/*    */ import org.apache.synapse.SynapseException;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class FixedByteArrayOutputStream
/*    */   extends ByteArrayOutputStream
/*    */ {
/* 28 */   public FixedByteArrayOutputStream(int size) { super(size); }
/*    */ 
/*    */   
/*    */   public synchronized void write(int b) {
/* 32 */     if (this.count + 1 > this.buf.length) {
/* 33 */       throw new SynapseException(""Fixed size of internal byte array exceeded"");
/*    */     }
/* 35 */     super.write(b);
/*    */   }
/*    */   
/*    */   public synchronized void write(byte[] b, int off, int len) {
/* 39 */     if (this.count + len > this.buf.length) {
/* 40 */       throw new SynapseException(""Fixed size of internal byte array exceeded"");
/*    */     }
/* 42 */     super.write(b, off, len);
/*    */   }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synaps\\util\FixedByteArrayOutputStream.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.util.MessageHelper,"/*     */ package org.apache.synapse.util;
/*     */ 
/*     */ import java.util.ArrayList;
/*     */ import java.util.HashMap;
/*     */ import java.util.Iterator;
/*     */ import java.util.Map;
/*     */ import org.apache.axiom.attachments.Attachments;
/*     */ import org.apache.axiom.om.OMAbstractFactory;
/*     */ import org.apache.axiom.om.OMElement;
/*     */ import org.apache.axiom.om.OMNamespace;
/*     */ import org.apache.axiom.om.OMNode;
/*     */ import org.apache.axiom.soap.SOAPEnvelope;
/*     */ import org.apache.axiom.soap.SOAPHeader;
/*     */ import org.apache.axiom.soap.SOAPHeaderBlock;
/*     */ import org.apache.axis2.AxisFault;
/*     */ import org.apache.axis2.context.MessageContext;
/*     */ import org.apache.axis2.description.AxisDescription;
/*     */ import org.apache.synapse.MessageContext;
/*     */ import org.apache.synapse.core.axis2.Axis2MessageContext;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class MessageHelper
/*     */ {
/*     */   public static MessageContext cloneMessageContext(MessageContext synCtx) throws AxisFault {
/*  47 */     MessageContext newCtx = synCtx.getEnvironment().createMessageContext();
/*  48 */     Axis2MessageContext axis2MC = (Axis2MessageContext)newCtx;
/*  49 */     axis2MC.setAxis2MessageContext(cloneAxis2MessageContext(((Axis2MessageContext)synCtx).getAxis2MessageContext()));
/*     */ 
/*     */     
/*  52 */     newCtx.setConfiguration(synCtx.getConfiguration());
/*  53 */     newCtx.setEnvironment(synCtx.getEnvironment());
/*  54 */     newCtx.setContextEntries(synCtx.getContextEntries());
/*     */ 
/*     */ 
/*     */     
/*  58 */     newCtx.setProperty(""aggregateCorelation"", synCtx.getMessageID());
/*     */ 
/*     */     
/*  61 */     newCtx.setTo(synCtx.getTo());
/*  62 */     newCtx.setReplyTo(synCtx.getReplyTo());
/*  63 */     newCtx.setSoapAction(synCtx.getSoapAction());
/*  64 */     newCtx.setWSAAction(synCtx.getWSAAction());
/*  65 */     newCtx.setResponse(synCtx.isResponse());
/*     */ 
/*     */     
/*  68 */     for (Object o : synCtx.getPropertyKeySet()) {
/*     */       
/*  70 */       if (o instanceof String) {
/*  71 */         newCtx.setProperty((String)o, synCtx.getProperty((String)o));
/*     */       }
/*     */     } 
/*     */     
/*  75 */     return newCtx;
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public static MessageContext cloneAxis2MessageContext(MessageContext mc) throws AxisFault {
/*  96 */     MessageContext newMC = clonePartially(mc);
/*  97 */     newMC.setEnvelope(cloneSOAPEnvelope(mc.getEnvelope()));
/*     */     
/*  99 */     newMC.setServiceContext(mc.getServiceContext());
/* 100 */     newMC.setOperationContext(mc.getOperationContext());
/* 101 */     newMC.setAxisMessage(mc.getAxisMessage());
/* 102 */     if (newMC.getAxisMessage() != null) {
/* 103 */       newMC.getAxisMessage().setParent((AxisDescription)mc.getAxisOperation());
/*     */     }
/* 105 */     newMC.setAxisService(mc.getAxisService());
/*     */ 
/*     */     
/* 108 */     newMC.setTransportIn(mc.getTransportIn());
/* 109 */     newMC.setTransportOut(mc.getTransportOut());
/* 110 */     newMC.setProperty(""OutTransportInfo"", mc.getProperty(""OutTransportInfo""));
/*     */ 
/*     */     
/* 113 */     newMC.setProperty(""TRANSPORT_HEADERS"", getClonedTransportHeaders(mc));
/*     */ 
/*     */     
/* 116 */     return newMC;
/*     */   }
/*     */ 
/*     */   
/*     */   public static Map getClonedTransportHeaders(MessageContext msgCtx) {
/* 121 */     Map headers = (Map)msgCtx.getProperty(""TRANSPORT_HEADERS"");
/*     */     
/* 123 */     Map<Object, Object> clonedHeaders = new HashMap<Object, Object>();
/*     */     
/* 125 */     if (headers != null && headers.isEmpty()) {
/* 126 */       for (Object o : headers.keySet()) {
/* 127 */         String headerName = (String)o;
/* 128 */         clonedHeaders.put(headerName, headers.get(headerName));
/*     */       } 
/*     */     }
/*     */     
/* 132 */     return clonedHeaders;
/*     */   }
/*     */ 
/*     */ 
/*     */   
/*     */   public static MessageContext clonePartially(MessageContext ori) throws AxisFault {
/* 138 */     MessageContext newMC = new MessageContext();
/*     */ 
/*     */ 
/*     */     
/* 142 */     newMC.setConfigurationContext(ori.getConfigurationContext());
/* 143 */     newMC.setMessageID(UUIDGenerator.getUUID());
/* 144 */     newMC.setTo(ori.getTo());
/* 145 */     newMC.setSoapAction(ori.getSoapAction());
/*     */     
/* 147 */     newMC.setProperty(""CHARACTER_SET_ENCODING"", ori.getProperty(""CHARACTER_SET_ENCODING""));
/*     */     
/* 149 */     newMC.setProperty(""enableMTOM"", ori.getProperty(""enableMTOM""));
/*     */     
/* 151 */     newMC.setProperty(""enableSwA"", ori.getProperty(""enableSwA""));
/*     */     
/* 153 */     newMC.setProperty(""HTTP_METHOD"", ori.getProperty(""HTTP_METHOD""));
/*     */ 
/*     */     
/* 156 */     newMC.setProperty(""messageType"", ori.getProperty(""messageType""));
/*     */ 
/*     */     
/* 159 */     newMC.setDoingREST(ori.isDoingREST());
/* 160 */     newMC.setDoingMTOM(ori.isDoingMTOM());
/* 161 */     newMC.setDoingSwA(ori.isDoingSwA());
/*     */ 
/*     */ 
/*     */     
/* 165 */     Attachments attachments = ori.getAttachmentMap();
/* 166 */     if (attachments != null && (attachments.getAllContentIDs()).length > 0) {
/* 167 */       String[] cIDs = attachments.getAllContentIDs();
/* 168 */       String soapPart = attachments.getSOAPPartContentID();
/* 169 */       for (String cID : cIDs) {
/* 170 */         if (!cID.equals(soapPart)) {
/* 171 */           newMC.addAttachment(cID, attachments.getDataHandler(cID));
/*     */         }
/*     */       } 
/*     */     } 
/*     */     
/* 176 */     for (Object o : ori.getOptions().getProperties().keySet()) {
/* 177 */       String key = (String)o;
/* 178 */       newMC.getOptions().setProperty(key, ori.getOptions().getProperty(key));
/*     */     } 
/*     */     
/* 181 */     Iterator<String> itr = ori.getPropertyNames();
/* 182 */     while (itr.hasNext()) {
/* 183 */       String key = itr.next();
/* 184 */       if (key != null)
/*     */       {
/*     */ 
/*     */         
/* 188 */         newMC.setNonReplicableProperty(key, ori.getPropertyNonReplicable(key));
/*     */       }
/*     */     } 
/*     */     
/* 192 */     newMC.setServerSide(false);
/*     */     
/* 194 */     return newMC;
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public static SOAPEnvelope cloneSOAPEnvelope(SOAPEnvelope envelope) {
/*     */     SOAPEnvelope newEnvelope;
/* 206 */     if (""http://schemas.xmlsoap.org/soap/envelope/"".equals(envelope.getBody().getNamespace().getNamespaceURI())) {
/*     */       
/* 208 */       newEnvelope = OMAbstractFactory.getSOAP11Factory().getDefaultEnvelope();
/*     */     } else {
/* 210 */       newEnvelope = OMAbstractFactory.getSOAP12Factory().getDefaultEnvelope();
/*     */     } 
/*     */     
/* 213 */     if (envelope.getHeader() != null) {
/* 214 */       Iterator<OMNode> itr = envelope.getHeader().cloneOMElement().getChildren();
/* 215 */       while (itr.hasNext()) {
/* 216 */         newEnvelope.getHeader().addChild(itr.next());
/*     */       }
/*     */     } 
/*     */     
/* 220 */     if (envelope.getBody() != null) {
/* 221 */       Iterator<OMNode> itr = envelope.getBody().cloneOMElement().getChildren();
/* 222 */       while (itr.hasNext()) {
/* 223 */         newEnvelope.getBody().addChild(itr.next());
/*     */       }
/*     */     } 
/*     */     
/* 227 */     return newEnvelope;
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public static SOAPEnvelope removeAddressingHeaders(MessageContext axisMsgCtx) {
/* 240 */     SOAPEnvelope env = axisMsgCtx.getEnvelope();
/* 241 */     SOAPHeader soapHeader = env.getHeader();
/*     */ 
/*     */     
/* 244 */     if (soapHeader != null) {
/* 245 */       ArrayList addressingHeaders = soapHeader.getHeaderBlocksWithNSURI(""http://schemas.xmlsoap.org/ws/2004/08/addressing"");
/*     */ 
/*     */       
/* 248 */       if (addressingHeaders != null && addressingHeaders.size() != 0) {
/* 249 */         detachAddressingInformation(addressingHeaders);
/*     */       } else {
/*     */         
/* 252 */         addressingHeaders = soapHeader.getHeaderBlocksWithNSURI(""http://www.w3.org/2005/08/addressing"");
/*     */         
/* 254 */         if (addressingHeaders != null && addressingHeaders.size() != 0) {
/* 255 */           detachAddressingInformation(addressingHeaders);
/*     */         }
/*     */       } 
/*     */     } 
/* 259 */     return env;
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   private static void detachAddressingInformation(ArrayList headerInformation) {
/* 268 */     for (Object o : headerInformation) {
/* 269 */       if (o instanceof SOAPHeaderBlock) {
/* 270 */         SOAPHeaderBlock headerBlock = (SOAPHeaderBlock)o;
/* 271 */         headerBlock.detach(); continue;
/* 272 */       }  if (o instanceof OMElement) {
/*     */         
/* 274 */         OMElement om = (OMElement)o;
/* 275 */         OMNamespace ns = om.getNamespace();
/* 276 */         if (ns != null && (""http://schemas.xmlsoap.org/ws/2004/08/addressing"".equals(ns.getNamespaceURI()) || ""http://www.w3.org/2005/08/addressing"".equals(ns.getNamespaceURI())))
/*     */         {
/*     */           
/* 279 */           om.detach();
/*     */         }
/*     */       } 
/*     */     } 
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synaps\\util\MessageHelper.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.util.PayloadHelper,"/*     */ package org.apache.synapse.util;
/*     */ 
/*     */ import java.util.Iterator;
/*     */ import javax.activation.DataHandler;
/*     */ import javax.xml.namespace.QName;
/*     */ import javax.xml.stream.XMLStreamReader;
/*     */ import org.apache.axiom.om.OMAbstractFactory;
/*     */ import org.apache.axiom.om.OMElement;
/*     */ import org.apache.axiom.om.OMFactory;
/*     */ import org.apache.axiom.om.OMNode;
/*     */ import org.apache.axiom.om.OMText;
/*     */ import org.apache.axiom.om.impl.builder.StAXOMBuilder;
/*     */ import org.apache.axiom.soap.SOAPBody;
/*     */ import org.apache.axiom.soap.SOAPEnvelope;
/*     */ import org.apache.axiom.soap.SOAPVersion;
/*     */ import org.apache.commons.logging.Log;
/*     */ import org.apache.commons.logging.LogFactory;
/*     */ import org.apache.synapse.MessageContext;
/*     */ import org.apache.synapse.SynapseException;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class PayloadHelper
/*     */ {
/*     */   public static final String AXIOMPAYLOADNS = ""http://ws.apache.org/commons/ns/payload"";
/*  32 */   public static final QName BINARYELT = new QName(""http://ws.apache.org/commons/ns/payload"", ""binary"", ""ax"");
/*     */ 
/*     */   
/*  35 */   public static final QName TEXTELT = new QName(""http://ws.apache.org/commons/ns/payload"", ""text"", ""ax"");
/*     */   
/*  37 */   public static final QName MAPELT = new QName(""http://ws.apache.org/commons/ns/payload"", ""map"", ""ax"");
/*     */   public static final int XMLPAYLOADTYPE = 0;
/*     */   public static final int BINARYPAYLOADTYPE = 1;
/*     */   public static final int TEXTPAYLOADTYPE = 2;
/*     */   public static final int MAPPAYLOADTYPE = 3;
/*  42 */   public static final Log log = LogFactory.getLog(PayloadHelper.class);
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public static int getPayloadType(SOAPEnvelope envelope) {
/*  48 */     OMElement el = getXMLPayload(envelope);
/*  49 */     if (el.getQName().equals(BINARYELT))
/*  50 */       return 1; 
/*  51 */     if (el.getQName().equals(TEXTELT))
/*  52 */       return 2; 
/*  53 */     if (el.getQName().equals(MAPELT)) {
/*  54 */       return 3;
/*     */     }
/*  56 */     return 0;
/*     */   }
/*     */   
/*     */   public static int getPayloadType(MessageContext mc) {
/*  60 */     if (mc.getEnvelope() == null)
/*  61 */       return 0; 
/*  62 */     return getPayloadType(mc.getEnvelope());
/*     */   }
/*     */ 
/*     */   
/*     */   public static OMElement getXMLPayload(SOAPEnvelope envelope) {
/*  67 */     SOAPBody body = envelope.getBody();
/*  68 */     if (body == null) {
/*  69 */       log.error(""No body found"");
/*  70 */       return null;
/*     */     } 
/*  72 */     OMElement bodyEl = body.getFirstElement();
/*  73 */     if (bodyEl == null) {
/*  74 */       log.error(""No body child found"");
/*  75 */       return null;
/*     */     } 
/*  77 */     return bodyEl;
/*     */   }
/*     */   
/*     */   public static void setXMLPayload(SOAPEnvelope envelope, OMElement element) {
/*  81 */     SOAPBody body = envelope.getBody();
/*  82 */     if (body == null) {
/*     */       
/*  84 */       SOAPVersion version = envelope.getVersion();
/*  85 */       if (version.getEnvelopeURI().equals(""http://schemas.xmlsoap.org/soap/envelope/"")) {
/*     */         
/*  87 */         body = OMAbstractFactory.getSOAP11Factory().createSOAPBody();
/*     */       } else {
/*  89 */         body = OMAbstractFactory.getSOAP12Factory().createSOAPBody();
/*     */       } 
/*  91 */       if (envelope.getHeader() != null) {
/*  92 */         envelope.getHeader().insertSiblingAfter((OMNode)body);
/*     */       } else {
/*  94 */         envelope.addChild((OMNode)body);
/*     */       } 
/*     */     } else {
/*  97 */       for (Iterator<OMNode> it = body.getChildren(); it.hasNext(); ) {
/*  98 */         OMNode node = it.next();
/*  99 */         node.discard();
/*     */       } 
/*     */     } 
/* 102 */     body.addChild((OMNode)element);
/*     */   }
/*     */   
/*     */   public static void setXMLPayload(MessageContext mc, OMElement element) {
/* 106 */     if (mc.getEnvelope() == null) {
/*     */       try {
/* 108 */         mc.setEnvelope(OMAbstractFactory.getSOAP12Factory().createSOAPEnvelope());
/*     */       }
/* 110 */       catch (Exception e) {
/* 111 */         throw new SynapseException(e);
/*     */       } 
/*     */     }
/* 114 */     setXMLPayload(mc.getEnvelope(), element);
/*     */   }
/*     */ 
/*     */   
/*     */   public static DataHandler getBinaryPayload(SOAPEnvelope envelope) {
/* 119 */     OMElement el = getXMLPayload(envelope);
/* 120 */     if (el == null)
/* 121 */       return null; 
/* 122 */     if (!el.getQName().equals(BINARYELT)) {
/* 123 */       log.error(""Wrong QName"" + el.getQName());
/* 124 */       return null;
/*     */     } 
/* 126 */     OMNode textNode = el.getFirstOMChild();
/* 127 */     if (textNode.getType() != 4) {
/* 128 */       log.error(""Text Node not found"");
/* 129 */       return null;
/*     */     } 
/* 131 */     OMText text = (OMText)textNode;
/* 132 */     DataHandler dh = null;
/*     */     try {
/* 134 */       dh = (DataHandler)text.getDataHandler();
/* 135 */     } catch (ClassCastException ce) {
/* 136 */       log.error(""cannot get DataHandler"" + ce.getMessage());
/* 137 */       return null;
/*     */     } 
/* 139 */     return dh;
/*     */   }
/*     */ 
/*     */   
/*     */   public static DataHandler getBinaryPayload(MessageContext mc) {
/* 144 */     if (mc.getEnvelope() == null) {
/* 145 */       log.error(""null envelope"");
/* 146 */       return null;
/*     */     } 
/* 148 */     return getBinaryPayload(mc.getEnvelope());
/*     */   }
/*     */   
/*     */   public static void setBinaryPayload(SOAPEnvelope envelope, DataHandler dh) {
/* 152 */     OMFactory fac = envelope.getOMFactory();
/* 153 */     OMElement binaryElt = envelope.getOMFactory().createOMElement(BINARYELT);
/*     */     
/* 155 */     OMText text = fac.createOMText(dh, true);
/* 156 */     binaryElt.addChild((OMNode)text);
/* 157 */     setXMLPayload(envelope, binaryElt);
/*     */   }
/*     */   
/*     */   public static void setBinaryPayload(MessageContext mc, DataHandler dh) {
/* 161 */     if (mc.getEnvelope() == null) {
/*     */       try {
/* 163 */         mc.setEnvelope(OMAbstractFactory.getSOAP12Factory().createSOAPEnvelope());
/*     */       }
/* 165 */       catch (Exception e) {
/* 166 */         throw new SynapseException(e);
/*     */       } 
/*     */     }
/* 169 */     setBinaryPayload(mc.getEnvelope(), dh);
/*     */   }
/*     */ 
/*     */ 
/*     */   
/*     */   public static String getTextPayload(SOAPEnvelope envelope) {
/* 175 */     OMElement el = getXMLPayload(envelope);
/* 176 */     if (el == null)
/* 177 */       return null; 
/* 178 */     if (!el.getQName().equals(TEXTELT)) {
/* 179 */       log.error(""Wrong QName"" + el.getQName());
/* 180 */       return null;
/*     */     } 
/* 182 */     OMNode textNode = el.getFirstOMChild();
/* 183 */     if (textNode.getType() != 4) {
/* 184 */       log.error(""Text Node not found"");
/* 185 */       return null;
/*     */     } 
/* 187 */     OMText text = (OMText)textNode;
/* 188 */     return text.getText();
/*     */   }
/*     */   
/*     */   public static String getTextPayload(MessageContext mc) {
/* 192 */     if (mc.getEnvelope() == null) {
/* 193 */       log.error(""null envelope"");
/* 194 */       return null;
/*     */     } 
/* 196 */     return getTextPayload(mc.getEnvelope());
/*     */   }
/*     */   
/*     */   public static void setTextPayload(SOAPEnvelope envelope, String text) {
/* 200 */     OMFactory fac = envelope.getOMFactory();
/* 201 */     OMElement textElt = envelope.getOMFactory().createOMElement(TEXTELT);
/* 202 */     OMText textNode = fac.createOMText(text);
/* 203 */     textElt.addChild((OMNode)textNode);
/* 204 */     setXMLPayload(envelope, textElt);
/*     */   }
/*     */   
/*     */   public static void setTextPayload(MessageContext mc, String text) {
/* 208 */     if (mc.getEnvelope() == null) {
/*     */       try {
/* 210 */         mc.setEnvelope(OMAbstractFactory.getSOAP12Factory().createSOAPEnvelope());
/*     */       }
/* 212 */       catch (Exception e) {
/* 213 */         throw new SynapseException(e);
/*     */       } 
/*     */     }
/* 216 */     setTextPayload(mc.getEnvelope(), text);
/*     */   }
/*     */ 
/*     */ 
/*     */   
/*     */   public static SimpleMap getMapPayload(SOAPEnvelope envelope) {
/* 222 */     OMElement el = getXMLPayload(envelope);
/* 223 */     if (el == null)
/* 224 */       return null; 
/* 225 */     if (!el.getQName().equals(MAPELT)) {
/* 226 */       log.error(""Wrong QName"" + el.getQName());
/* 227 */       return null;
/*     */     } 
/* 229 */     SimpleMap map = new SimpleMapImpl(el);
/* 230 */     return map;
/*     */   }
/*     */   
/*     */   public static SimpleMap getMapPayload(MessageContext mc) {
/* 234 */     if (mc.getEnvelope() == null) {
/* 235 */       log.error(""null envelope"");
/* 236 */       return null;
/*     */     } 
/* 238 */     return getMapPayload(mc.getEnvelope());
/*     */   }
/*     */ 
/*     */   
/*     */   public static void setMapPayload(SOAPEnvelope envelope, SimpleMap map) {
/* 243 */     if (map instanceof SimpleMapImpl) {
/* 244 */       SimpleMapImpl impl = (SimpleMapImpl)map;
/* 245 */       OMElement mapElt = impl.getOMElement(envelope.getOMFactory());
/* 246 */       if (mapElt == null) {
/* 247 */         log.debug(""null map element returned"");
/*     */         return;
/*     */       } 
/* 250 */       setXMLPayload(envelope, mapElt);
/*     */     } else {
/* 252 */       throw new SynapseException(""cannot handle any other instance of SimpleMap at this point TODO"");
/*     */     } 
/*     */   }
/*     */   
/*     */   public static void setMapPayload(MessageContext mc, SimpleMap map) {
/* 257 */     if (mc.getEnvelope() == null) {
/*     */       try {
/* 259 */         mc.setEnvelope(OMAbstractFactory.getSOAP12Factory().createSOAPEnvelope());
/*     */       }
/* 261 */       catch (Exception e) {
/* 262 */         throw new SynapseException(e);
/*     */       } 
/*     */     }
/* 265 */     setMapPayload(mc.getEnvelope(), map);
/*     */   }
/*     */ 
/*     */   
/*     */   public static XMLStreamReader getStAXPayload(SOAPEnvelope envelope) {
/* 270 */     OMElement el = getXMLPayload(envelope);
/* 271 */     if (el == null) {
/* 272 */       return null;
/*     */     }
/* 274 */     return el.getXMLStreamReader();
/*     */   }
/*     */   public static XMLStreamReader getStAXPayload(MessageContext mc) {
/* 277 */     if (mc.getEnvelope() == null) {
/* 278 */       log.error(""null envelope"");
/* 279 */       return null;
/*     */     } 
/* 281 */     return getStAXPayload(mc.getEnvelope());
/*     */   }
/*     */   public static void setStAXPayload(SOAPEnvelope envelope, XMLStreamReader streamReader) {
/* 284 */     StAXOMBuilder builder = new StAXOMBuilder(envelope.getOMFactory(), streamReader);
/* 285 */     OMElement el = builder.getDocumentElement();
/* 286 */     setXMLPayload(envelope, el);
/*     */   }
/*     */   public static void setStAXPayload(MessageContext mc, XMLStreamReader streamReader) {
/* 289 */     if (mc.getEnvelope() == null) {
/*     */       try {
/* 291 */         mc.setEnvelope(OMAbstractFactory.getSOAP12Factory().createSOAPEnvelope());
/*     */       }
/* 293 */       catch (Exception e) {
/* 294 */         throw new SynapseException(e);
/*     */       } 
/* 296 */       setStAXPayload(mc.getEnvelope(), streamReader);
/*     */     } 
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synaps\\util\PayloadHelper.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.util.PolicyInfo,"/*     */ package org.apache.synapse.util;
/*     */ 
/*     */ import javax.xml.namespace.QName;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class PolicyInfo
/*     */ {
/*     */   private String policyKey;
/*     */   private int type;
/*     */   private QName operation;
/*     */   public static final int MESSAGE_TYPE_IN = 1;
/*     */   public static final int MESSAGE_TYPE_OUT = 2;
/*     */   
/*  39 */   public PolicyInfo(String policyKey) { this.policyKey = policyKey; }
/*     */ 
/*     */   
/*     */   public PolicyInfo(String policyKey, int type) {
/*  43 */     this.policyKey = policyKey;
/*  44 */     this.type = type;
/*     */   }
/*     */   
/*     */   public PolicyInfo(String policyKey, QName operation) {
/*  48 */     this.policyKey = policyKey;
/*  49 */     this.operation = operation;
/*     */   }
/*     */   
/*     */   public PolicyInfo(String policyKey, int type, QName operation) {
/*  53 */     this.policyKey = policyKey;
/*  54 */     this.type = type;
/*  55 */     this.operation = operation;
/*     */   }
/*     */ 
/*     */   
/*  59 */   public boolean isServicePolicy() { return (this.policyKey != null && this.type == 0 && this.operation == null); }
/*     */ 
/*     */ 
/*     */   
/*  63 */   public boolean isOperationPolicy() { return (this.policyKey != null && this.type == 0 && this.operation != null); }
/*     */ 
/*     */ 
/*     */   
/*  67 */   public boolean isMessagePolicy() { return (this.policyKey != null && this.type != 0); }
/*     */ 
/*     */   
/*     */   public String getMessageLable() {
/*  71 */     if (this.type == 1)
/*  72 */       return ""In""; 
/*  73 */     if (this.type == 2) {
/*  74 */       return ""Out"";
/*     */     }
/*  76 */     return null;
/*     */   }
/*     */ 
/*     */ 
/*     */   
/*  81 */   public String getPolicyKey() { return this.policyKey; }
/*     */ 
/*     */ 
/*     */   
/*  85 */   public void setPolicyKey(String policyKey) { this.policyKey = policyKey; }
/*     */ 
/*     */ 
/*     */   
/*  89 */   public int getType() { return this.type; }
/*     */ 
/*     */ 
/*     */   
/*  93 */   public void setType(int type) { this.type = type; }
/*     */ 
/*     */ 
/*     */   
/*  97 */   public QName getOperation() { return this.operation; }
/*     */ 
/*     */ 
/*     */   
/* 101 */   public void setOperation(QName operation) { this.operation = operation; }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synaps\\util\PolicyInfo.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.util.POXUtils,"/*    */ package org.apache.synapse.util;
/*    */ 
/*    */ import javax.xml.namespace.QName;
/*    */ import org.apache.axiom.om.OMElement;
/*    */ import org.apache.axiom.om.OMFactory;
/*    */ import org.apache.axiom.om.OMNode;
/*    */ import org.apache.axiom.soap.SOAPBody;
/*    */ import org.apache.axiom.soap.SOAPFault;
/*    */ import org.apache.axis2.context.MessageContext;
/*    */ import org.apache.commons.logging.Log;
/*    */ import org.apache.commons.logging.LogFactory;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class POXUtils
/*    */ {
/* 37 */   private static final Log log = LogFactory.getLog(POXUtils.class);
/*    */ 
/*    */   
/*    */   public static void convertSOAPFaultToPOX(MessageContext msgCtx) {
/* 41 */     SOAPBody body = msgCtx.getEnvelope().getBody();
/* 42 */     SOAPFault fault = body.getFault();
/* 43 */     if (fault != null) {
/*    */       
/* 45 */       OMFactory fac = msgCtx.getEnvelope().getOMFactory();
/* 46 */       OMElement faultPayload = fac.createOMElement(new QName(""Exception""));
/*    */       
/* 48 */       if (fault.getDetail() != null && !fault.getDetail().getText().equals("""")) {
/*    */         
/* 50 */         String faultDetail = fault.getDetail().getText();
/*    */         
/* 52 */         if (log.isDebugEnabled()) {
/* 53 */           log.debug(""Setting the fault detail : "" + faultDetail + "" as athe POX Fault"");
/*    */         }
/* 55 */         faultPayload.setText(faultDetail);
/*    */       }
/* 57 */       else if (fault.getReason() != null && !fault.getReason().getText().equals("""")) {
/*    */         
/* 59 */         String faultReasonValue = fault.getReason().getText();
/*    */         
/* 61 */         if (log.isDebugEnabled()) {
/* 62 */           log.debug(""Setting the fault reason : "" + faultReasonValue + "" as athe POX Fault"");
/*    */         }
/*    */         
/* 65 */         faultPayload.setText(faultReasonValue);
/*    */       }
/* 67 */       else if (log.isDebugEnabled()) {
/*    */         
/* 69 */         log.debug(""Couldn't find the fault detail or reason to compose POX Fault"");
/*    */       } 
/*    */       
/* 72 */       if (body.getFirstElement() != null) {
/* 73 */         body.getFirstElement().detach();
/*    */       }
/*    */       
/* 76 */       msgCtx.setProcessingFault(true);
/*    */       
/* 78 */       if (log.isDebugEnabled()) {
/*    */         
/* 80 */         String msg = ""Original SOAP Message : "" + msgCtx.getEnvelope().toString() + ""POXFault Message created : "" + faultPayload.toString();
/*    */         
/* 82 */         log.debug(msg);
/*    */         
/* 84 */         if (log.isTraceEnabled()) {
/* 85 */           log.trace(msg);
/*    */         }
/*    */       } 
/*    */       
/* 89 */       body.addChild((OMNode)faultPayload);
/*    */     } 
/*    */   }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synaps\\util\POXUtils.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.util.RMIRegistryController,"/*    */ package org.apache.synapse.util;
/*    */ 
/*    */ import java.rmi.NoSuchObjectException;
/*    */ import java.rmi.RemoteException;
/*    */ import java.rmi.registry.LocateRegistry;
/*    */ import java.rmi.registry.Registry;
/*    */ import java.rmi.server.UnicastRemoteObject;
/*    */ import org.apache.commons.logging.Log;
/*    */ import org.apache.commons.logging.LogFactory;
/*    */ import org.apache.synapse.SynapseException;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class RMIRegistryController
/*    */ {
/* 18 */   public static final Log log = LogFactory.getLog(RMIRegistryController.class);
/*    */   
/* 20 */   private static RMIRegistryController ourInstance = new RMIRegistryController();
/*    */   
/*    */   private Registry localRegistry;
/*    */   private boolean weCreatedRMIReg = false;
/*    */   
/* 25 */   public static RMIRegistryController getInstance() { return ourInstance; }
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */   
/*    */   public void createLocalRegistry(int port) {
/*    */     try {
/* 37 */       this.localRegistry = LocateRegistry.createRegistry(port);
/* 38 */     } catch (RemoteException e) {
/* 39 */       String msg = ""Couldn't create a local registry(RMI) : port "" + port + "" already in use."";
/*    */       
/* 41 */       handleException(msg, e);
/*    */     } 
/*    */   }
/*    */ 
/*    */ 
/*    */ 
/*    */   
/*    */   public void removeLocalRegistry() {
/* 49 */     if (this.localRegistry != null) {
/*    */       try {
/* 51 */         log.info(""Removing the RMI registy instance from the RMI runtime "");
/* 52 */         UnicastRemoteObject.unexportObject(this.localRegistry, true);
/* 53 */       } catch (NoSuchObjectException e) {
/* 54 */         String msg = ""Error when stoping localregistry(RMI)"";
/* 55 */         handleException(msg, e);
/*    */       } 
/*    */     }
/*    */   }
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */   
/*    */   private static void handleException(String msg, Exception e) {
/* 68 */     log.error(msg, e);
/* 69 */     throw new SynapseException(msg, e);
/*    */   }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synaps\\util\RMIRegistryController.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.util.SimpleMap,"package org.apache.synapse.util;
import java.util.Map;
public interface SimpleMap extends Map {
  Object get(String paramString);
  void put(String paramString, Object paramObject);
  boolean getBoolean(String paramString);
  void putBoolean(String paramString, boolean paramBoolean);
  String getString(String paramString);
  void putString(String paramString1, String paramString2);
  char getChar(String paramString);
  void putChar(String paramString, char paramChar);
  int getInt(String paramString);
  void putInt(String paramString, int paramInt);
  short getShort(String paramString);
  void putShort(String paramString, short paramShort);
  float getFloat(String paramString);
  void putFloat(String paramString, float paramFloat);
  double getDouble(String paramString);
  void putDouble(String paramString, double paramDouble);
  long getLong(String paramString);
  void putLong(String paramString, long paramLong);
  byte getByte(String paramString);
  void putByte(String paramString, byte paramByte);
  byte[] getBytes(String paramString);
  void putBytes(String paramString, byte[] paramArrayOfbyte);
}
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synaps\\util\SimpleMap.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.util.SimpleMapImpl,"/*     */ package org.apache.synapse.util;
/*     */ 
/*     */ import java.io.ByteArrayOutputStream;
/*     */ import java.util.HashMap;
/*     */ import java.util.Iterator;
/*     */ import javax.activation.DataHandler;
/*     */ import javax.activation.DataSource;
/*     */ import javax.xml.namespace.QName;
/*     */ import org.apache.axiom.attachments.ByteArrayDataSource;
/*     */ import org.apache.axiom.om.OMAbstractFactory;
/*     */ import org.apache.axiom.om.OMContainer;
/*     */ import org.apache.axiom.om.OMElement;
/*     */ import org.apache.axiom.om.OMFactory;
/*     */ import org.apache.axiom.om.OMNamespace;
/*     */ import org.apache.axiom.om.OMNode;
/*     */ import org.apache.axiom.om.OMText;
/*     */ 
/*     */ public class SimpleMapImpl
/*     */   extends HashMap
/*     */   implements SimpleMap {
/*  21 */   private static final OMNamespace attrNS = OMAbstractFactory.getOMFactory().createOMNamespace("""", """");
/*     */   
/*     */   private static final String TYPE = ""type"";
/*     */   
/*     */   private static final String NAME = ""name"";
/*     */   
/*     */   private static final String ENTRY = ""entry"";
/*     */   
/*     */   private static final String SHORT = ""short"";
/*     */   
/*     */   private static final String LONG = ""long"";
/*     */   
/*     */   private static final String DOUBLE = ""double"";
/*     */   
/*     */   private static final String INTEGER = ""int"";
/*     */   
/*     */   private static final String FLOAT = ""float"";
/*     */   
/*     */   private static final String BYTEARRAY = ""byte[]"";
/*     */   
/*     */   private static final String BYTE = ""byte"";
/*     */   
/*     */   private static final String STRING = ""string"";
/*     */   
/*     */   private static final String BOOLEAN = ""boolean"";
/*     */   
/*     */   private static final String CHAR = ""char"";
/*     */   
/*     */   private static final long serialVersionUID = 1L;
/*     */   
/*     */   public SimpleMapImpl() {}
/*     */   
/*  53 */   public Object get(String name) { return get(name); }
/*     */ 
/*     */   
/*     */   public boolean getBoolean(String name) {
/*  57 */     Object o = get(name);
/*  58 */     if (o instanceof Boolean) {
/*  59 */       return ((Boolean)o).booleanValue();
/*     */     }
/*  61 */     throw new RuntimeException(""getBoolean("" + name + ""): "" + o.getClass().getName() + "" is not an instance of Boolean"");
/*     */   }
/*     */ 
/*     */ 
/*     */   
/*     */   public byte getByte(String name) {
/*  67 */     Object o = get(name);
/*  68 */     if (o instanceof Byte) {
/*  69 */       return ((Byte)o).byteValue();
/*     */     }
/*  71 */     throw new RuntimeException(""getByte("" + name + ""): "" + o.getClass().getName() + "" is not an instance of Byte"");
/*     */   }
/*     */ 
/*     */ 
/*     */   
/*     */   public byte[] getBytes(String name) {
/*  77 */     Object o = get(name);
/*  78 */     if (o instanceof byte[]) {
/*  79 */       return (byte[])o;
/*     */     }
/*  81 */     throw new RuntimeException(""getByteArray("" + name + ""): "" + o.getClass().getName() + "" is not an instance of byte[]"");
/*     */   }
/*     */ 
/*     */ 
/*     */   
/*     */   public char getChar(String name) {
/*  87 */     Object o = get(name);
/*  88 */     if (o instanceof Character) {
/*  89 */       return ((Character)o).charValue();
/*     */     }
/*  91 */     throw new RuntimeException(""getChar("" + name + ""): "" + o.getClass().getName() + "" is not an instance of Character"");
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public double getDouble(String name) {
/*  98 */     Object o = get(name);
/*  99 */     if (o instanceof Double) {
/* 100 */       return ((Double)o).doubleValue();
/*     */     }
/* 102 */     throw new RuntimeException(""getDouble("" + name + ""): "" + o.getClass().getName() + "" is not an instance of Double"");
/*     */   }
/*     */ 
/*     */ 
/*     */   
/*     */   public float getFloat(String name) {
/* 108 */     Object o = get(name);
/* 109 */     if (o instanceof Float) {
/* 110 */       return ((Float)o).floatValue();
/*     */     }
/* 112 */     throw new RuntimeException(""getFloat("" + name + ""): "" + o.getClass().getName() + "" is not an instance of Float"");
/*     */   }
/*     */ 
/*     */ 
/*     */   
/*     */   public int getInt(String name) {
/* 118 */     Object o = get(name);
/* 119 */     if (o instanceof Integer) {
/* 120 */       return ((Integer)o).intValue();
/*     */     }
/* 122 */     throw new RuntimeException(""getInt("" + name + ""): "" + o.getClass().getName() + "" is not an instance of Integer"");
/*     */   }
/*     */ 
/*     */ 
/*     */   
/*     */   public long getLong(String name) {
/* 128 */     Object o = get(name);
/* 129 */     if (o instanceof Long) {
/* 130 */       return ((Long)o).longValue();
/*     */     }
/* 132 */     throw new RuntimeException(""getLong("" + name + ""): "" + o.getClass().getName() + "" is not an instance of Long"");
/*     */   }
/*     */ 
/*     */ 
/*     */   
/*     */   public short getShort(String name) {
/* 138 */     Object o = get(name);
/* 139 */     if (o instanceof Short) {
/* 140 */       return ((Short)o).shortValue();
/*     */     }
/* 142 */     throw new RuntimeException(""getShort("" + name + ""): "" + o.getClass().getName() + "" is not an instance of Short"");
/*     */   }
/*     */ 
/*     */ 
/*     */   
/*     */   public String getString(String name) {
/* 148 */     Object o = get(name);
/* 149 */     if (o instanceof String) {
/* 150 */       return (String)o;
/*     */     }
/* 152 */     throw new RuntimeException(""getString("" + name + ""): "" + o.getClass().getName() + "" is not an instance of String"");
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 158 */   public void put(String name, Object value) { put((K)name, (V)value); }
/*     */ 
/*     */ 
/*     */   
/* 162 */   public void putBoolean(String name, boolean b) { put((K)name, (V)new Boolean(b)); }
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 167 */   public void putByte(String name, byte b) { put((K)name, (V)new Byte(b)); }
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 172 */   public void putBytes(String name, byte[] bytes) { put((K)name, (V)bytes); }
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 177 */   public void putChar(String name, char c) { put((K)name, (V)new Character(c)); }
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 182 */   public void putDouble(String name, double d) { put((K)name, (V)new Double(d)); }
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 187 */   public void putFloat(String name, float fl) { put((K)name, (V)new Float(fl)); }
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 192 */   public void putInt(String name, int i) { put((K)name, (V)new Integer(i)); }
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 197 */   public void putLong(String name, long l) { put((K)name, (V)new Long(l)); }
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 202 */   public void putShort(String name, short s) { put((K)name, (V)new Short(s)); }
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 207 */   public void putString(String name, String value) { put((K)name, (V)value); }
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 212 */   public OMElement getOMElement() { return getOMElement(OMAbstractFactory.getOMFactory()); }
/*     */ 
/*     */   
/*     */   public OMElement getOMElement(OMFactory fac) {
/* 216 */     OMElement mapElement = fac.createOMElement(PayloadHelper.MAPELT);
/*     */     
/* 218 */     for (Iterator<K> it = keySet().iterator(); it.hasNext(); ) {
/* 219 */       OMElement entry = fac.createOMElement(new QName(""http://ws.apache.org/commons/ns/payload"", ""entry""), (OMContainer)mapElement);
/*     */ 
/*     */ 
/*     */       
/* 223 */       Object key = it.next();
/* 224 */       if (key instanceof String) {
/* 225 */         Object o = get(key);
/* 226 */         entry.addAttribute(""name"", (String)key, attrNS);
/* 227 */         if (o instanceof Character) {
/* 228 */           entry.addAttribute(""type"", ""char"", attrNS);
/* 229 */           entry.setText(o.toString()); continue;
/* 230 */         }  if (o instanceof Boolean) {
/* 231 */           entry.addAttribute(""type"", ""boolean"", attrNS);
/* 232 */           entry.setText(o.toString()); continue;
/* 233 */         }  if (o instanceof String) {
/* 234 */           entry.addAttribute(""type"", ""string"", attrNS);
/* 235 */           entry.setText(o.toString()); continue;
/* 236 */         }  if (o instanceof Byte) {
/* 237 */           entry.addAttribute(""type"", ""byte"", attrNS);
/* 238 */           entry.setText(((Byte)o).toString()); continue;
/* 239 */         }  if (o instanceof byte[]) {
/* 240 */           entry.addAttribute(""type"", ""byte[]"", attrNS);
/* 241 */           OMText text = fac.createOMText(new DataHandler((DataSource)new ByteArrayDataSource((byte[])o)), true);
/*     */           
/* 243 */           entry.addChild((OMNode)text); continue;
/* 244 */         }  if (o instanceof Float) {
/* 245 */           entry.addAttribute(""type"", ""float"", attrNS);
/* 246 */           entry.setText(o.toString()); continue;
/* 247 */         }  if (o instanceof Double) {
/* 248 */           entry.addAttribute(""type"", ""double"", attrNS);
/* 249 */           entry.setText(o.toString()); continue;
/* 250 */         }  if (o instanceof Long) {
/* 251 */           entry.addAttribute(""type"", ""long"", attrNS);
/* 252 */           entry.setText(o.toString()); continue;
/* 253 */         }  if (o instanceof Short) {
/* 254 */           entry.addAttribute(""type"", ""short"", attrNS);
/* 255 */           entry.setText(o.toString()); continue;
/* 256 */         }  if (o instanceof Integer) {
/* 257 */           entry.addAttribute(""type"", ""int"", attrNS);
/* 258 */           entry.setText(o.toString());
/*     */         } 
/*     */       } 
/*     */     } 
/*     */ 
/*     */ 
/*     */ 
/*     */     
/* 266 */     return mapElement;
/*     */   }
/*     */ 
/*     */ 
/*     */   
/*     */   public SimpleMapImpl(OMElement el) {
/* 272 */     if (el.getQName().equals(PayloadHelper.MAPELT))
/* 273 */       for (Iterator<OMElement> it = el.getChildElements(); it.hasNext(); ) {
/* 274 */         OMElement child = it.next();
/* 275 */         if (child.getLocalName().equals(""entry"")) {
/* 276 */           String name = child.getAttributeValue(new QName("""", ""name""));
/* 277 */           String type = child.getAttributeValue(new QName("""", ""type""));
/*     */           try {
/* 279 */             if (type == null || name == null) {
/*     */               continue;
/*     */             }
/*     */             
/* 283 */             OMNode data = child.getFirstOMChild();
/* 284 */             if (data.getType() != 4) {
/*     */               continue;
/*     */             }
/* 287 */             OMText text = (OMText)data;
/* 288 */             if (type.equals(""int"")) {
/* 289 */               put((K)name, (V)new Integer(text.getText())); continue;
/* 290 */             }  if (type.equals(""char"")) {
/* 291 */               put((K)name, (V)new Character(text.getText().charAt(0))); continue;
/* 292 */             }  if (type.equals(""double"")) {
/* 293 */               put((K)name, (V)new Double(text.getText())); continue;
/* 294 */             }  if (type.equals(""float"")) {
/* 295 */               put((K)name, (V)new Float(text.getText())); continue;
/* 296 */             }  if (type.equals(""byte"")) {
/* 297 */               put((K)name, (V)new Byte(text.getText().getBytes()[0])); continue;
/* 298 */             }  if (type.equals(""short"")) {
/* 299 */               put((K)name, (V)new Short(text.getText())); continue;
/* 300 */             }  if (type.equals(""long"")) {
/* 301 */               put((K)name, (V)new Long(text.getText())); continue;
/* 302 */             }  if (type.equals(""string"")) {
/* 303 */               put((K)name, (V)text.getText()); continue;
/* 304 */             }  if (type.equals(""byte[]"")) {
/* 305 */               DataHandler dh = (DataHandler)text.getDataHandler();
/* 306 */               ByteArrayOutputStream baos = new ByteArrayOutputStream();
/* 307 */               dh.writeTo(baos);
/* 308 */               put((K)name, (V)baos.toByteArray());
/*     */             } 
/* 310 */           } catch (Exception e) {
/* 311 */             e.printStackTrace();
/*     */           } 
/*     */         } 
/*     */       }  
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synaps\\util\SimpleMapImpl.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.util.SynapseBinaryDataSource,"/*    */ package org.apache.synapse.util;
/*    */ 
/*    */ import java.io.IOException;
/*    */ import java.io.InputStream;
/*    */ import java.io.OutputStream;
/*    */ import javax.activation.DataSource;
/*    */ import org.apache.synapse.core.SynapseEnvironment;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class SynapseBinaryDataSource
/*    */   implements DataSource
/*    */ {
/*    */   private String contentType;
/*    */   private TemporaryData data;
/*    */   
/*    */   public SynapseBinaryDataSource(InputStream inputstream, String contentType) throws IOException {
/* 53 */     this.contentType = contentType;
/* 54 */     this.data = new TemporaryData(4, 1024, ""tmp_"", "".dat"");
/*    */     
/* 56 */     this.data.readFrom(inputstream);
/* 57 */     inputstream.close();
/*    */   }
/*    */ 
/*    */ 
/*    */   
/*    */   public SynapseBinaryDataSource(InputStream inputstream, String contentType, SynapseEnvironment synEnv) throws IOException {
/* 63 */     this.contentType = contentType;
/* 64 */     this.data = synEnv.createTemporaryData();
/*    */     
/* 66 */     this.data.readFrom(inputstream);
/* 67 */     inputstream.close();
/*    */   }
/*    */ 
/*    */   
/* 71 */   public String getContentType() { return this.contentType; }
/*    */ 
/*    */ 
/*    */   
/* 75 */   public InputStream getInputStream() throws IOException { return this.data.getInputStream(); }
/*    */ 
/*    */ 
/*    */   
/* 79 */   public String getName() { return getClass().getName(); }
/*    */ 
/*    */ 
/*    */   
/* 83 */   public OutputStream getOutputStream() throws IOException { return this.data.getOutputStream(); }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synaps\\util\SynapseBinaryDataSource.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.util.TemporaryData,"/*     */ package org.apache.synapse.util;
/*     */ 
/*     */ import java.io.File;
/*     */ import java.io.FileInputStream;
/*     */ import java.io.FileOutputStream;
/*     */ import java.io.IOException;
/*     */ import java.io.InputStream;
/*     */ import java.io.OutputStream;
/*     */ import org.apache.commons.io.IOUtils;
/*     */ import org.apache.commons.logging.Log;
/*     */ import org.apache.commons.logging.LogFactory;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class TemporaryData
/*     */ {
/*     */   final int chunkSize;
/*     */   final String tempPrefix;
/*     */   final String tempSuffix;
/*     */   byte[][] chunks;
/*  23 */   private static final Log log = LogFactory.getLog(TemporaryData.class);
/*     */   int chunkIndex;
/*     */   int chunkOffset;
/*     */   File temporaryFile;
/*     */   
/*     */   class OutputStreamImpl
/*     */     extends OutputStream {
/*     */     public void write(byte[] b, int off, int len) throws IOException {
/*  31 */       if (this.fileOutputStream != null) {
/*  32 */         this.fileOutputStream.write(b, off, len);
/*  33 */       } else if (len > (TemporaryData.this.chunks.length - TemporaryData.this.chunkIndex) * TemporaryData.this.chunkSize - TemporaryData.this.chunkOffset) {
/*     */ 
/*     */         
/*  36 */         this.fileOutputStream = TemporaryData.this.switchToTempFile();
/*     */ 
/*     */         
/*  39 */         this.fileOutputStream.write(b, off, len);
/*     */       
/*     */       }
/*     */       else {
/*     */         
/*  44 */         while (len > 0) {
/*     */           
/*  46 */           byte[] chunk = TemporaryData.this.getCurrentChunk();
/*     */ 
/*     */           
/*  49 */           int c = Math.min(len, TemporaryData.this.chunkSize - TemporaryData.this.chunkOffset);
/*     */           
/*  51 */           System.arraycopy(b, off, chunk, TemporaryData.this.chunkOffset, c);
/*     */ 
/*     */           
/*  54 */           len -= c;
/*  55 */           off += c;
/*  56 */           TemporaryData.this.chunkOffset += c;
/*  57 */           if (TemporaryData.this.chunkOffset == TemporaryData.this.chunkSize) {
/*  58 */             TemporaryData.this.chunkIndex++;
/*  59 */             TemporaryData.this.chunkOffset = 0;
/*     */           } 
/*     */         } 
/*     */       } 
/*     */     }
/*     */ 
/*     */     
/*  66 */     public void write(byte[] b) throws IOException { write(b, 0, b.length); }
/*     */     
/*     */     private FileOutputStream fileOutputStream;
/*     */     
/*  70 */     public void write(int b) throws IOException { write(new byte[] { (byte)b }, 0, 1); }
/*     */ 
/*     */     
/*     */     public void flush() throws IOException {
/*  74 */       if (this.fileOutputStream != null) {
/*  75 */         this.fileOutputStream.flush();
/*     */       }
/*     */     }
/*     */     
/*     */     public void close() throws IOException {
/*  80 */       if (this.fileOutputStream != null) {
/*  81 */         this.fileOutputStream.close();
/*     */       }
/*     */     }
/*     */   }
/*     */   
/*     */   class InputStreamImpl
/*     */     extends InputStream
/*     */   {
/*     */     private int currentChunkIndex;
/*     */     private int currentChunkOffset;
/*     */     private int markChunkIndex;
/*     */     private int markChunkOffset;
/*     */     
/*  94 */     public int available() throws IOException { return (TemporaryData.this.chunkIndex - this.currentChunkIndex) * TemporaryData.this.chunkSize + TemporaryData.this.chunkOffset - this.currentChunkOffset; }
/*     */ 
/*     */ 
/*     */     
/*     */     public int read(byte[] b, int off, int len) throws IOException {
/*  99 */       if (len == 0) {
/* 100 */         return 0;
/*     */       }
/*     */       
/* 103 */       int read = 0;
/* 104 */       while (len > 0 && (this.currentChunkIndex != TemporaryData.this.chunkIndex || this.currentChunkOffset != TemporaryData.this.chunkOffset)) {
/*     */         int c;
/*     */ 
/*     */         
/* 108 */         if (this.currentChunkIndex == TemporaryData.this.chunkIndex) {
/*     */           
/* 110 */           c = Math.min(len, TemporaryData.this.chunkOffset - this.currentChunkOffset);
/*     */         } else {
/* 112 */           c = Math.min(len, TemporaryData.this.chunkSize - this.currentChunkOffset);
/*     */         } 
/*     */ 
/*     */         
/* 116 */         System.arraycopy(TemporaryData.this.chunks[this.currentChunkIndex], this.currentChunkOffset, b, off, c);
/*     */ 
/*     */         
/* 119 */         len -= c;
/* 120 */         off += c;
/* 121 */         this.currentChunkOffset += c;
/* 122 */         read += c;
/* 123 */         if (this.currentChunkOffset == TemporaryData.this.chunkSize) {
/* 124 */           this.currentChunkIndex++;
/* 125 */           this.currentChunkOffset = 0;
/*     */         } 
/*     */       } 
/*     */       
/* 129 */       if (read == 0)
/*     */       {
/* 131 */         return -1;
/*     */       }
/* 133 */       return read;
/*     */     }
/*     */ 
/*     */ 
/*     */     
/* 138 */     public int read(byte[] b) throws IOException { return read(b, 0, b.length); }
/*     */ 
/*     */     
/*     */     public int read() throws IOException {
/* 142 */       byte[] b = new byte[1];
/* 143 */       return (read(b) == -1) ? -1 : (b[0] & 0xFF);
/*     */     }
/*     */ 
/*     */     
/* 147 */     public boolean markSupported() { return true; }
/*     */ 
/*     */     
/*     */     public void mark(int readlimit) {
/* 151 */       this.markChunkIndex = this.currentChunkIndex;
/* 152 */       this.markChunkOffset = this.currentChunkOffset;
/*     */     }
/*     */     
/*     */     public void reset() throws IOException {
/* 156 */       this.currentChunkIndex = this.markChunkIndex;
/* 157 */       this.currentChunkOffset = this.markChunkOffset;
/*     */     }
/*     */ 
/*     */     
/*     */     public long skip(long n) throws IOException {
/* 162 */       int available = available();
/* 163 */       int c = (n < available) ? (int)n : available;
/* 164 */       int newOffset = this.currentChunkOffset + c;
/* 165 */       int chunkDelta = newOffset / TemporaryData.this.chunkSize;
/* 166 */       this.currentChunkIndex += chunkDelta;
/* 167 */       this.currentChunkOffset = newOffset - chunkDelta * TemporaryData.this.chunkSize;
/* 168 */       return c;
/*     */     }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */     
/*     */     public void close() throws IOException {}
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public TemporaryData(int numberOfChunks, int chunkSize, String tempPrefix, String tempSuffix) {
/* 215 */     this.chunkSize = chunkSize;
/* 216 */     this.tempPrefix = tempPrefix;
/* 217 */     this.tempSuffix = tempSuffix;
/* 218 */     this.chunks = new byte[numberOfChunks][];
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   byte[] getCurrentChunk() {
/* 227 */     if (this.chunkOffset == 0) {
/*     */       
/* 229 */       byte[] chunk = new byte[this.chunkSize];
/* 230 */       this.chunks[this.chunkIndex] = chunk;
/* 231 */       return chunk;
/*     */     } 
/*     */     
/* 234 */     return this.chunks[this.chunkIndex];
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   FileOutputStream switchToTempFile() throws IOException {
/* 245 */     this.temporaryFile = File.createTempFile(this.tempPrefix, this.tempSuffix);
/* 246 */     if (log.isDebugEnabled()) {
/* 247 */       log.debug(""Using temporary file "" + this.temporaryFile);
/*     */     }
/* 249 */     this.temporaryFile.deleteOnExit();
/*     */     
/* 251 */     FileOutputStream fileOutputStream = new FileOutputStream(this.temporaryFile);
/*     */     
/* 253 */     for (int i = 0; i < this.chunkIndex; i++) {
/* 254 */       fileOutputStream.write(this.chunks[i]);
/*     */     }
/*     */     
/* 257 */     if (this.chunkOffset > 0) {
/* 258 */       fileOutputStream.write(this.chunks[this.chunkIndex], 0, this.chunkOffset);
/*     */     }
/*     */ 
/*     */     
/* 262 */     this.chunks = (byte[][])null;
/*     */     
/* 264 */     return fileOutputStream;
/*     */   }
/*     */ 
/*     */   
/* 268 */   public OutputStream getOutputStream() { return new OutputStreamImpl(); }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public void readFrom(InputStream in) throws IOException {
/*     */     while (true) {
/* 289 */       int c = in.read(getCurrentChunk(), this.chunkOffset, this.chunkSize - this.chunkOffset);
/* 290 */       if (c == -1) {
/*     */         break;
/*     */       }
/* 293 */       this.chunkOffset += c;
/* 294 */       if (this.chunkOffset == this.chunkSize) {
/* 295 */         this.chunkIndex++;
/* 296 */         this.chunkOffset = 0;
/* 297 */         if (this.chunkIndex == this.chunks.length) {
/* 298 */           FileOutputStream fileOutputStream = switchToTempFile();
/* 299 */           IOUtils.copy(in, fileOutputStream);
/* 300 */           fileOutputStream.close();
/*     */           break;
/*     */         } 
/*     */       } 
/*     */     } 
/*     */   }
/*     */   
/*     */   public InputStream getInputStream() throws IOException {
/* 308 */     if (this.temporaryFile != null) {
/* 309 */       return new FileInputStream(this.temporaryFile);
/*     */     }
/* 311 */     return new InputStreamImpl();
/*     */   }
/*     */ 
/*     */   
/*     */   public void release() {
/* 316 */     if (this.temporaryFile != null) {
/* 317 */       if (log.isDebugEnabled()) {
/* 318 */         log.debug(""Deleting temporary file "" + this.temporaryFile);
/*     */       }
/* 320 */       this.temporaryFile.delete();
/*     */     } 
/*     */   }
/*     */   
/*     */   protected void finalize() throws Throwable {
/* 325 */     if (this.temporaryFile != null) {
/* 326 */       log.warn(""Cleaning up unreleased temporary file "" + this.temporaryFile);
/* 327 */       this.temporaryFile.delete();
/*     */     } 
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synaps\\util\TemporaryData.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.util.TextFileDataSource,"/*     */ package org.apache.synapse.util;
/*     */ 
/*     */ import java.io.IOException;
/*     */ import java.io.InputStream;
/*     */ import java.io.InputStreamReader;
/*     */ import java.io.OutputStream;
/*     */ import java.io.UnsupportedEncodingException;
/*     */ import java.io.Writer;
/*     */ import java.nio.charset.Charset;
/*     */ import javax.xml.stream.XMLStreamException;
/*     */ import javax.xml.stream.XMLStreamReader;
/*     */ import javax.xml.stream.XMLStreamWriter;
/*     */ import org.apache.axiom.om.OMAbstractFactory;
/*     */ import org.apache.axiom.om.OMDataSource;
/*     */ import org.apache.axiom.om.OMDataSourceExt;
/*     */ import org.apache.axiom.om.OMFactory;
/*     */ import org.apache.axiom.om.OMOutputFormat;
/*     */ import org.apache.axiom.om.OMSourcedElement;
/*     */ import org.apache.axiom.om.ds.OMDataSourceExtBase;
/*     */ import org.apache.axiom.om.impl.MTOMXMLStreamWriter;
/*     */ import org.apache.axiom.om.impl.llom.OMSourcedElementImpl;
/*     */ import org.apache.axiom.om.impl.serialize.StreamingOMSerializer;
/*     */ import org.apache.axiom.om.util.StAXUtils;
/*     */ import org.apache.synapse.transport.base.BaseConstants;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class TextFileDataSource
/*     */   extends OMDataSourceExtBase
/*     */ {
/*     */   private final TemporaryData temporaryData;
/*     */   private final Charset charset;
/*     */   
/*     */   public TextFileDataSource(TemporaryData temporaryData, Charset charset) {
/*  51 */     this.temporaryData = temporaryData;
/*  52 */     this.charset = charset;
/*     */   }
/*     */   
/*     */   public static OMSourcedElement createOMSourcedElement(TemporaryData temporaryData, Charset charset) {
/*  56 */     OMFactory fac = OMAbstractFactory.getOMFactory();
/*  57 */     TextFileDataSource txtFileDS = new TextFileDataSource(temporaryData, charset);
/*  58 */     return (OMSourcedElement)new OMSourcedElementImpl(BaseConstants.DEFAULT_TEXT_WRAPPER, fac, (OMDataSource)txtFileDS);
/*     */   }
/*     */ 
/*     */   
/*     */   public void serialize(OutputStream out, OMOutputFormat format) throws XMLStreamException {
/*  63 */     MTOMXMLStreamWriter mTOMXMLStreamWriter = new MTOMXMLStreamWriter(out, format);
/*  64 */     serialize((XMLStreamWriter)mTOMXMLStreamWriter);
/*  65 */     mTOMXMLStreamWriter.flush();
/*     */   }
/*     */ 
/*     */   
/*     */   public void serialize(Writer writer, OMOutputFormat format) throws XMLStreamException {
/*  70 */     MTOMXMLStreamWriter xmlWriter = new MTOMXMLStreamWriter(StAXUtils.createXMLStreamWriter(writer));
/*     */     
/*  72 */     xmlWriter.setOutputFormat(format);
/*  73 */     serialize((XMLStreamWriter)xmlWriter);
/*  74 */     xmlWriter.flush();
/*     */   }
/*     */ 
/*     */   
/*     */   public void serialize(XMLStreamWriter xmlWriter) throws XMLStreamException {
/*  79 */     StreamingOMSerializer serializer = new StreamingOMSerializer();
/*  80 */     serializer.serialize(getReader(), xmlWriter);
/*     */   }
/*     */   
/*     */   public XMLStreamReader getReader() throws XMLStreamException {
/*     */     InputStream is;
/*     */     try {
/*  86 */       is = this.temporaryData.getInputStream();
/*     */     }
/*  88 */     catch (IOException ex) {
/*  89 */       throw new XMLStreamException(ex);
/*     */     } 
/*  91 */     return new WrappedTextNodeStreamReader(BaseConstants.DEFAULT_TEXT_WRAPPER, new InputStreamReader(is, this.charset));
/*     */   }
/*     */ 
/*     */   
/*  95 */   public Object getObject() { return this.temporaryData; }
/*     */ 
/*     */ 
/*     */   
/*  99 */   public boolean isDestructiveRead() { return false; }
/*     */ 
/*     */ 
/*     */   
/* 103 */   public boolean isDestructiveWrite() { return false; }
/*     */ 
/*     */ 
/*     */   
/* 107 */   public byte[] getXMLBytes(String encoding) throws UnsupportedEncodingException { throw new UnsupportedOperationException(); }
/*     */ 
/*     */ 
/*     */   
/*     */   public void close() {}
/*     */ 
/*     */   
/* 114 */   public OMDataSourceExt copy() { return (OMDataSourceExt)new TextFileDataSource(this.temporaryData, this.charset); }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synaps\\util\TextFileDataSource.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.util.UUIDGenerator,"/*     */ package org.apache.synapse.util;
/*     */ 
/*     */ import java.net.InetAddress;
/*     */ import java.net.UnknownHostException;
/*     */ import java.security.MessageDigest;
/*     */ import java.security.NoSuchAlgorithmException;
/*     */ import java.util.Random;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class UUIDGenerator
/*     */ {
/*  34 */   private static String baseUUID = null;
/*  35 */   private static long incrementingValue = 0L;
/*     */   
/*  37 */   private static Random myRand = null;
/*     */ 
/*     */ 
/*     */   
/*     */   private static boolean useNano = false;
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public static String getUUID() {
/*  47 */     if (baseUUID == null) {
/*  48 */       baseUUID = getInitialUUID();
/*  49 */       baseUUID = ""urn:uuid:"" + baseUUID;
/*     */     } 
/*  51 */     if (++incrementingValue >= Long.MAX_VALUE) {
/*  52 */       incrementingValue = 0L;
/*     */     }
/*     */     
/*  55 */     if (useNano) {
/*  56 */       return baseUUID + (System.nanoTime() + incrementingValue) + Integer.toString(myRand.nextInt());
/*     */     }
/*     */ 
/*     */     
/*  60 */     return baseUUID + (System.currentTimeMillis() + incrementingValue) + Integer.toString(myRand.nextInt());
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   protected static String getInitialUUID() {
/*     */     String str;
/*     */     try {
/*  69 */       if (System.class.getMethod(""nanoTime"", new Class[0]) != null) {
/*  70 */         useNano = true;
/*     */       }
/*  72 */     } catch (NoSuchMethodException ignore) {}
/*     */     
/*  74 */     if (myRand == null) {
/*  75 */       myRand = new Random();
/*     */     }
/*  77 */     long rand = myRand.nextLong();
/*     */     
/*     */     try {
/*  80 */       str = InetAddress.getLocalHost().toString();
/*  81 */     } catch (UnknownHostException e) {
/*  82 */       str = Thread.currentThread().getName();
/*     */     } 
/*  84 */     StringBuffer sb = new StringBuffer();
/*  85 */     sb.append(str);
/*  86 */     sb.append("":"");
/*  87 */     sb.append(Long.toString(rand));
/*  88 */     MessageDigest md5 = null;
/*     */     try {
/*  90 */       md5 = MessageDigest.getInstance(""MD5"");
/*  91 */     } catch (NoSuchAlgorithmException e) {}
/*     */ 
/*     */ 
/*     */     
/*  95 */     md5.update(sb.toString().getBytes());
/*  96 */     byte[] array = md5.digest();
/*  97 */     StringBuffer sb2 = new StringBuffer();
/*  98 */     for (int j = 0; j < array.length; j++) {
/*  99 */       int b = array[j] & 0xFF;
/* 100 */       sb2.append(Integer.toHexString(b));
/*     */     } 
/* 102 */     int begin = myRand.nextInt();
/* 103 */     if (begin < 0) begin *= -1; 
/* 104 */     begin %= 8;
/* 105 */     return sb2.toString().substring(begin, begin + 18).toUpperCase();
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synaps\\util\UUIDGenerator.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.util.WrappedTextNodeStreamReader,"/*     */ package org.apache.synapse.util;
/*     */ 
/*     */ import java.io.IOException;
/*     */ import java.io.Reader;
/*     */ import java.util.Collections;
/*     */ import javax.xml.namespace.NamespaceContext;
/*     */ import javax.xml.namespace.QName;
/*     */ import javax.xml.stream.Location;
/*     */ import javax.xml.stream.XMLStreamException;
/*     */ import javax.xml.stream.XMLStreamReader;
/*     */ import org.apache.axiom.om.impl.EmptyOMLocation;
/*     */ import org.apache.axiom.om.impl.llom.util.NamespaceContextImpl;
/*     */ import org.apache.commons.io.IOUtils;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class WrappedTextNodeStreamReader
/*     */   implements XMLStreamReader
/*     */ {
/*  74 */   private static final Location EMPTY_LOCATION = (Location)new EmptyOMLocation();
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   private final QName wrapperElementName;
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   private final Reader reader;
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   private final int chunkSize;
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  94 */   private int eventType = 7;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   private char[] charData;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   private int charDataLength;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   private NamespaceContext namespaceContext;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public WrappedTextNodeStreamReader(QName wrapperElementName, Reader reader, int chunkSize) {
/* 124 */     this.wrapperElementName = wrapperElementName;
/* 125 */     this.reader = reader;
/* 126 */     this.chunkSize = chunkSize;
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 136 */   public WrappedTextNodeStreamReader(QName wrapperElementName, Reader reader) { this(wrapperElementName, reader, 4096); }
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 141 */   public Object getProperty(String name) throws IllegalArgumentException { return null; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 149 */   public boolean hasNext() throws XMLStreamException { return (this.eventType != 8); }
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public int next() throws XMLStreamException {
/* 155 */     switch (this.eventType) {
/*     */       case 7:
/* 157 */         this.eventType = 1;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */         
/* 182 */         return this.eventType;case 1: this.charData = new char[this.chunkSize];case 4: try { this.charDataLength = this.reader.read(this.charData); } catch (IOException ex) { throw new XMLStreamException(ex); }  if (this.charDataLength == -1) { this.charData = null; this.eventType = 2; } else { this.eventType = 4; }  return this.eventType;case 2: this.eventType = 8; return this.eventType;
/*     */     } 
/*     */     throw new IllegalStateException();
/*     */   }
/*     */   
/* 187 */   public int nextTag() throws XMLStreamException { throw new XMLStreamException(""Current event is not white space""); }
/*     */ 
/*     */ 
/*     */   
/* 191 */   public int getEventType() { return this.eventType; }
/*     */ 
/*     */   
/* 194 */   public boolean isStartElement() { return (this.eventType == 1); }
/* 195 */   public boolean isEndElement() { return (this.eventType == 2); }
/* 196 */   public boolean isCharacters() { return (this.eventType == 4); }
/* 197 */   public boolean isWhiteSpace() { return false; }
/* 198 */   public boolean hasText() { return (this.eventType == 4); }
/* 199 */   public boolean hasName() { return (this.eventType == 1 || this.eventType == 2); }
/*     */   
/*     */   public void require(int type, String namespaceURI, String localName) throws XMLStreamException {
/* 202 */     if (type != this.eventType || (namespaceURI != null && !namespaceURI.equals(getNamespaceURI())) || (localName != null && !namespaceURI.equals(getLocalName())))
/*     */     {
/*     */       
/* 205 */       throw new XMLStreamException(""Unexpected event type"");
/*     */     }
/*     */   }
/*     */ 
/*     */ 
/*     */   
/* 211 */   public Location getLocation() { return EMPTY_LOCATION; }
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public void close() throws XMLStreamException {
/*     */     try {
/* 218 */       this.reader.close();
/*     */     }
/* 220 */     catch (IOException ex) {
/* 221 */       throw new XMLStreamException(ex);
/*     */     } 
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 231 */   public String getEncoding() { return null; }
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 236 */   public String getCharacterEncodingScheme() { return null; }
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 241 */   public String getVersion() { return null; }
/*     */ 
/*     */ 
/*     */   
/* 245 */   public boolean standaloneSet() { return false; }
/*     */ 
/*     */ 
/*     */   
/* 249 */   public boolean isStandalone() { return true; }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public NamespaceContext getNamespaceContext() {
/* 257 */     if (this.namespaceContext == null) {
/* 258 */       this.namespaceContext = (NamespaceContext)new NamespaceContextImpl(Collections.singletonMap(this.wrapperElementName.getPrefix(), this.wrapperElementName.getNamespaceURI()));
/*     */     }
/* 260 */     return this.namespaceContext;
/*     */   }
/*     */   
/*     */   public String getNamespaceURI(String prefix) {
/* 264 */     String namespaceURI = getNamespaceContext().getNamespaceURI(prefix);
/*     */ 
/*     */     
/* 267 */     return namespaceURI.equals("""") ? null : prefix;
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   private void checkStartElement() {
/* 275 */     if (this.eventType != 1) {
/* 276 */       throw new IllegalStateException();
/*     */     }
/*     */   }
/*     */   
/*     */   public String getAttributeValue(String namespaceURI, String localName) {
/* 281 */     checkStartElement();
/* 282 */     return null;
/*     */   }
/*     */   
/*     */   public int getAttributeCount() {
/* 286 */     checkStartElement();
/* 287 */     return 0;
/*     */   }
/*     */   
/*     */   public QName getAttributeName(int index) {
/* 291 */     checkStartElement();
/* 292 */     throw new ArrayIndexOutOfBoundsException();
/*     */   }
/*     */   
/*     */   public String getAttributeLocalName(int index) {
/* 296 */     checkStartElement();
/* 297 */     throw new ArrayIndexOutOfBoundsException();
/*     */   }
/*     */   
/*     */   public String getAttributePrefix(int index) {
/* 301 */     checkStartElement();
/* 302 */     throw new ArrayIndexOutOfBoundsException();
/*     */   }
/*     */   
/*     */   public String getAttributeNamespace(int index) {
/* 306 */     checkStartElement();
/* 307 */     throw new ArrayIndexOutOfBoundsException();
/*     */   }
/*     */   
/*     */   public String getAttributeType(int index) {
/* 311 */     checkStartElement();
/* 312 */     throw new ArrayIndexOutOfBoundsException();
/*     */   }
/*     */   
/*     */   public String getAttributeValue(int index) {
/* 316 */     checkStartElement();
/* 317 */     throw new ArrayIndexOutOfBoundsException();
/*     */   }
/*     */   
/*     */   public boolean isAttributeSpecified(int index) {
/* 321 */     checkStartElement();
/* 322 */     throw new ArrayIndexOutOfBoundsException();
/*     */   }
/*     */   
/*     */   private void checkElement() {
/* 326 */     if (this.eventType != 1 && this.eventType != 2) {
/* 327 */       throw new IllegalStateException();
/*     */     }
/*     */   }
/*     */ 
/*     */   
/* 332 */   public QName getName() { return null; }
/*     */ 
/*     */   
/*     */   public String getLocalName() {
/* 336 */     checkElement();
/* 337 */     return this.wrapperElementName.getLocalPart();
/*     */   }
/*     */ 
/*     */   
/* 341 */   public String getPrefix() { return this.wrapperElementName.getPrefix(); }
/*     */ 
/*     */   
/*     */   public String getNamespaceURI() {
/* 345 */     checkElement();
/* 346 */     return this.wrapperElementName.getNamespaceURI();
/*     */   }
/*     */   
/*     */   public int getNamespaceCount() {
/* 350 */     checkElement();
/*     */     
/* 352 */     return 1;
/*     */   }
/*     */   
/*     */   public String getNamespacePrefix(int index) {
/* 356 */     checkElement();
/* 357 */     if (index == 0) {
/* 358 */       return this.wrapperElementName.getPrefix();
/*     */     }
/* 360 */     throw new IndexOutOfBoundsException();
/*     */   }
/*     */ 
/*     */   
/*     */   public String getNamespaceURI(int index) {
/* 365 */     checkElement();
/* 366 */     if (index == 0) {
/* 367 */       return this.wrapperElementName.getNamespaceURI();
/*     */     }
/* 369 */     throw new IndexOutOfBoundsException();
/*     */   }
/*     */ 
/*     */   
/*     */   public String getElementText() throws XMLStreamException {
/* 374 */     if (this.eventType == 1) {
/*     */       
/*     */       try {
/*     */ 
/*     */         
/* 379 */         String result = IOUtils.toString(this.reader);
/* 380 */         this.eventType = 2;
/* 381 */         return result;
/*     */       }
/* 383 */       catch (IOException ex) {
/* 384 */         throw new XMLStreamException(ex);
/*     */       } 
/*     */     }
/* 387 */     throw new XMLStreamException(""Current event is not a START_ELEMENT"");
/*     */   }
/*     */ 
/*     */   
/*     */   private void checkCharacters() {
/* 392 */     if (this.eventType != 4) {
/* 393 */       throw new IllegalStateException();
/*     */     }
/*     */   }
/*     */   
/*     */   public String getText() {
/* 398 */     checkCharacters();
/* 399 */     return new String(this.charData, 0, this.charDataLength);
/*     */   }
/*     */   
/*     */   public char[] getTextCharacters() {
/* 403 */     checkCharacters();
/* 404 */     return this.charData;
/*     */   }
/*     */   
/*     */   public int getTextStart() {
/* 408 */     checkCharacters();
/* 409 */     return 0;
/*     */   }
/*     */   
/*     */   public int getTextLength() {
/* 413 */     checkCharacters();
/* 414 */     return this.charDataLength;
/*     */   }
/*     */   
/*     */   public int getTextCharacters(int sourceStart, char[] target, int targetStart, int length) throws XMLStreamException {
/* 418 */     checkCharacters();
/* 419 */     int c = Math.min(this.charDataLength - sourceStart, length);
/* 420 */     System.arraycopy(this.charData, sourceStart, target, targetStart, c);
/* 421 */     return c;
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/* 429 */   public String getPIData() { throw new IllegalStateException(); }
/*     */ 
/*     */ 
/*     */   
/* 433 */   public String getPITarget() { throw new IllegalStateException(); }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synaps\\util\WrappedTextNodeStreamReader.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.util.concurrent.SynapseThreadFactory,"/*    */ package org.apache.synapse.util.concurrent;
/*    */ 
/*    */ import java.util.concurrent.ThreadFactory;
/*    */ import java.util.concurrent.atomic.AtomicInteger;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class SynapseThreadFactory
/*    */   implements ThreadFactory
/*    */ {
/*    */   final ThreadGroup group;
/*    */   final AtomicInteger count;
/*    */   final String namePrefix;
/*    */   
/*    */   public SynapseThreadFactory(ThreadGroup group, String namePrefix) {
/* 48 */     this.count = new AtomicInteger(1);
/* 49 */     this.group = group;
/* 50 */     this.namePrefix = namePrefix;
/*    */   }
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */   
/*    */   public Thread newThread(Runnable runnable) {
/* 62 */     StringBuffer buffer = new StringBuffer();
/* 63 */     buffer.append(this.namePrefix);
/* 64 */     buffer.append('-');
/* 65 */     buffer.append(this.count.getAndIncrement());
/* 66 */     Thread t = new Thread(this.group, runnable, buffer.toString(), 0L);
/* 67 */     t.setDaemon(false);
/* 68 */     t.setPriority(5);
/* 69 */     return t;
/*    */   }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synaps\\util\concurrent\SynapseThreadFactory.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.util.concurrent.SynapseThreadPool,"/*    */ package org.apache.synapse.util.concurrent;
/*    */ 
/*    */ import java.util.concurrent.BlockingQueue;
/*    */ import java.util.concurrent.LinkedBlockingQueue;
/*    */ import java.util.concurrent.ThreadPoolExecutor;
/*    */ import java.util.concurrent.TimeUnit;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class SynapseThreadPool
/*    */   extends ThreadPoolExecutor
/*    */ {
/*    */   public static final int SYNAPSE_CORE_THREADS = 20;
/*    */   public static final int SYNAPSE_MAX_THREADS = 100;
/*    */   public static final int SYNAPSE_KEEP_ALIVE = 5;
/*    */   public static final int SYNAPSE_THREAD_QLEN = 10;
/*    */   public static final String SYNAPSE_THREAD_GROUP = ""synapse-thread-group"";
/*    */   public static final String SYNAPSE_THREAD_ID_PREFIX = ""SynapseWorker"";
/*    */   public static final String SYN_THREAD_CORE = ""synapse.threads.core"";
/*    */   public static final String SYN_THREAD_MAX = ""synapse.threads.max"";
/*    */   public static final String SYN_THREAD_ALIVE = ""synapse.threads.keepalive"";
/*    */   public static final String SYN_THREAD_QLEN = ""synapse.threads.qlen"";
/*    */   public static final String SYN_THREAD_GROUP = ""synapse.threads.group"";
/*    */   public static final String SYN_THREAD_IDPREFIX = ""synapse.threads.idprefix"";
/*    */   
/* 59 */   public SynapseThreadPool(int corePoolSize, int maximumPoolSize, long keepAliveTime, TimeUnit unit, BlockingQueue<Runnable> workQueue) { super(corePoolSize, maximumPoolSize, keepAliveTime, unit, workQueue, new SynapseThreadFactory(new ThreadGroup(""synapse-thread-group""), ""SynapseWorker"")); }
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */   
/* 68 */   public SynapseThreadPool() { this(20, 100, 5L, TimeUnit.SECONDS, new LinkedBlockingQueue<Runnable>()); }
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */   
/* 85 */   public SynapseThreadPool(int corePoolSize, int maxPoolSize, long keepAliveTime, int qlen, String threadGroup, String threadIdPrefix) { super(corePoolSize, maxPoolSize, keepAliveTime, TimeUnit.SECONDS, new LinkedBlockingQueue<Runnable>(qlen), new SynapseThreadFactory(new ThreadGroup(threadGroup), threadIdPrefix)); }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synaps\\util\concurrent\SynapseThreadPool.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.util.xpath.SynapseXPath,"/*     */ package org.apache.synapse.util.xpath;
/*     */ 
/*     */ import java.util.List;
/*     */ import org.apache.axiom.om.OMNamespace;
/*     */ import org.apache.axiom.om.impl.llom.OMDocumentImpl;
/*     */ import org.apache.axiom.om.impl.llom.OMElementImpl;
/*     */ import org.apache.axiom.om.impl.llom.OMTextImpl;
/*     */ import org.apache.axiom.om.xpath.AXIOMXPath;
/*     */ import org.apache.axiom.soap.SOAPEnvelope;
/*     */ import org.apache.commons.logging.Log;
/*     */ import org.apache.commons.logging.LogFactory;
/*     */ import org.apache.synapse.MessageContext;
/*     */ import org.apache.synapse.SynapseException;
/*     */ import org.jaxen.Context;
/*     */ import org.jaxen.ContextSupport;
/*     */ import org.jaxen.JaxenException;
/*     */ import org.jaxen.util.SingletonList;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class SynapseXPath
/*     */   extends AXIOMXPath
/*     */ {
/*     */   private static final long serialVersionUID = 7639226137534334222L;
/*  80 */   private static final Log log = LogFactory.getLog(SynapseXPath.class);
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*  90 */   public SynapseXPath(String xpathString) throws JaxenException { super(xpathString); }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public String stringValueOf(MessageContext synCtx) {
/*     */     try {
/* 104 */       Object result = evaluate(synCtx);
/*     */       
/* 106 */       if (result == null) {
/* 107 */         return null;
/*     */       }
/*     */       
/* 110 */       StringBuffer textValue = new StringBuffer();
/* 111 */       if (result instanceof List) {
/*     */         
/* 113 */         List list = (List)result;
/* 114 */         for (Object o : list)
/*     */         {
/* 116 */           if (o == null && list.size() == 1) {
/* 117 */             return null;
/*     */           }
/*     */           
/* 120 */           if (o instanceof OMTextImpl) {
/* 121 */             textValue.append(((OMTextImpl)o).getText()); continue;
/* 122 */           }  if (o instanceof OMElementImpl) {
/*     */             
/* 124 */             String s = ((OMElementImpl)o).getText();
/*     */             
/* 126 */             if (s.trim().length() == 0) {
/* 127 */               s = o.toString();
/*     */             }
/* 129 */             textValue.append(s); continue;
/*     */           } 
/* 131 */           if (o instanceof OMDocumentImpl)
/*     */           {
/* 133 */             textValue.append(((OMDocumentImpl)o).getOMDocumentElement().toString());
/*     */           }
/*     */         }
/*     */       
/*     */       } else {
/*     */         
/* 139 */         textValue.append(result.toString());
/*     */       } 
/*     */       
/* 142 */       return textValue.toString();
/*     */     }
/* 144 */     catch (JaxenException je) {
/* 145 */       handleException(""Evaluation of the XPath expression "" + toString() + "" resulted in an error"", (Throwable)je);
/*     */ 
/*     */ 
/*     */       
/* 149 */       return null;
/*     */     } 
/*     */   }
/*     */   
/* 153 */   public void addNamespace(OMNamespace ns) throws JaxenException { addNamespace(ns.getPrefix(), ns.getNamespaceURI()); }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   protected Context getContext(Object obj) {
/* 182 */     if (obj instanceof MessageContext) {
/* 183 */       MessageContext synCtx = (MessageContext)obj;
/* 184 */       ContextSupport baseContextSupport = getContextSupport();
/* 185 */       ContextSupport contextSupport = new ContextSupport(baseContextSupport.getNamespaceContext(), new SynapseXPathFunctionContext(baseContextSupport.getFunctionContext(), synCtx), new SynapseXPathVariableContext(baseContextSupport.getVariableContext(), synCtx), baseContextSupport.getNavigator());
/*     */ 
/*     */ 
/*     */ 
/*     */       
/* 190 */       Context context = new Context(contextSupport);
/* 191 */       context.setNodeSet((List)new SingletonList(synCtx.getEnvelope()));
/* 192 */       return context;
/* 193 */     }  if (obj instanceof SOAPEnvelope) {
/* 194 */       SOAPEnvelope env = (SOAPEnvelope)obj;
/* 195 */       ContextSupport baseContextSupport = getContextSupport();
/* 196 */       ContextSupport contextSupport = new ContextSupport(baseContextSupport.getNamespaceContext(), baseContextSupport.getFunctionContext(), new SynapseXPathVariableContext(baseContextSupport.getVariableContext(), env), baseContextSupport.getNavigator());
/*     */ 
/*     */ 
/*     */ 
/*     */       
/* 201 */       Context context = new Context(contextSupport);
/* 202 */       context.setNodeSet((List)new SingletonList(env));
/* 203 */       return context;
/*     */     } 
/* 205 */     return super.getContext(obj);
/*     */   }
/*     */ 
/*     */   
/*     */   private void handleException(String msg, Throwable e) {
/* 210 */     log.error(msg, e);
/* 211 */     throw new SynapseException(msg, e);
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synaps\\util\xpath\SynapseXPath.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.util.xpath.SynapseXPathConstants,"package org.apache.synapse.util.xpath;
public final class SynapseXPathConstants {
  public static final String GET_PROPERTY_FUNCTION = ""get-property"";
  public static final String SOAP_BODY_VARIABLE = ""body"";
  public static final String SOAP_HEADER_VARIABLE = ""header"";
  public static final String MESSAGE_CONTEXT_VARIABLE_PREFIX = ""ctx"";
  public static final String AXIS2_CONTEXT_VARIABLE_PREFIX = ""axis2"";
  public static final String TRANSPORT_VARIABLE_PREFIX = ""trp"";
}
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synaps\\util\xpath\SynapseXPathConstants.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.util.xpath.SynapseXPathFunctionContext,"/*    */ package org.apache.synapse.util.xpath;
/*    */ 
/*    */ import org.apache.synapse.MessageContext;
/*    */ import org.apache.synapse.mediators.GetPropertyFunction;
/*    */ import org.jaxen.Function;
/*    */ import org.jaxen.FunctionContext;
/*    */ import org.jaxen.UnresolvableException;
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ public class SynapseXPathFunctionContext
/*    */   implements FunctionContext
/*    */ {
/*    */   private final FunctionContext parent;
/*    */   private final MessageContext synCtx;
/*    */   
/*    */   public SynapseXPathFunctionContext(FunctionContext parent, MessageContext synCtx) {
/* 55 */     this.parent = parent;
/* 56 */     this.synCtx = synCtx;
/*    */   }
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */ 
/*    */   
/*    */   public Function getFunction(String namespaceURI, String prefix, String localName) throws UnresolvableException {
/* 74 */     if (localName != null && ""get-property"".equals(localName)) {
/*    */ 
/*    */ 
/*    */       
/* 78 */       GetPropertyFunction getPropertyFunc = new GetPropertyFunction();
/* 79 */       getPropertyFunc.setSynCtx(this.synCtx);
/*    */       
/* 81 */       return (Function)getPropertyFunc;
/*    */     } 
/*    */ 
/*    */     
/* 85 */     return this.parent.getFunction(namespaceURI, prefix, localName);
/*    */   }
/*    */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synaps\\util\xpath\SynapseXPathFunctionContext.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
org.apache.synapse.util.xpath.SynapseXPathVariableContext,"/*     */ package org.apache.synapse.util.xpath;
/*     */ 
/*     */ import java.util.Map;
/*     */ import org.apache.axiom.soap.SOAPEnvelope;
/*     */ import org.apache.axis2.context.MessageContext;
/*     */ import org.apache.synapse.MessageContext;
/*     */ import org.apache.synapse.core.axis2.Axis2MessageContext;
/*     */ import org.jaxen.UnresolvableException;
/*     */ import org.jaxen.VariableContext;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ public class SynapseXPathVariableContext
/*     */   implements VariableContext
/*     */ {
/*     */   private final VariableContext parent;
/*     */   private final MessageContext synCtx;
/*     */   private final SOAPEnvelope env;
/*     */   
/*     */   public SynapseXPathVariableContext(VariableContext parent, MessageContext synCtx) {
/*  57 */     this.parent = parent;
/*  58 */     this.synCtx = synCtx;
/*  59 */     this.env = synCtx.getEnvelope();
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public SynapseXPathVariableContext(VariableContext parent, SOAPEnvelope env) {
/*  69 */     this.parent = parent;
/*  70 */     this.synCtx = null;
/*  71 */     this.env = env;
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   public Object getVariableValue(String namespaceURI, String prefix, String localName) throws UnresolvableException {
/* 103 */     if (namespaceURI == null) {
/*     */       
/* 105 */       if (this.env != null) {
/*     */         
/* 107 */         if (""body"".equals(localName))
/* 108 */           return this.env.getBody(); 
/* 109 */         if (""header"".equals(localName)) {
/* 110 */           return this.env.getHeader();
/*     */         }
/*     */       } 
/*     */       
/* 114 */       if (prefix != null && !"""".equals(prefix) && this.synCtx != null) {
/*     */         
/* 116 */         if (""ctx"".equals(prefix))
/*     */         {
/* 118 */           return this.synCtx.getProperty(localName);
/*     */         }
/* 120 */         if (""axis2"".equals(prefix))
/*     */         {
/* 122 */           return ((Axis2MessageContext)this.synCtx).getAxis2MessageContext().getProperty(localName);
/*     */         }
/*     */         
/* 125 */         if (""trp"".equals(prefix)) {
/*     */           
/* 127 */           MessageContext axis2MessageContext = ((Axis2MessageContext)this.synCtx).getAxis2MessageContext();
/*     */           
/* 129 */           Object headers = axis2MessageContext.getProperty(""TRANSPORT_HEADERS"");
/*     */ 
/*     */           
/* 132 */           if (headers != null && headers instanceof Map) {
/* 133 */             Map headersMap = (Map)headers;
/* 134 */             return headersMap.get(localName);
/*     */           } 
/*     */         } 
/*     */       } 
/*     */     } 
/*     */     
/* 140 */     return this.parent.getVariableValue(namespaceURI, prefix, localName);
/*     */   }
/*     */ }
/* Location:              D:\资源包\synapse-core-1.2.jar!\org\apache\synaps\\util\xpath\SynapseXPathVariableContext.class
 * Java compiler version: 5 (49.0)
 * JD-Core Version:       1.1.2
 */"
